Core.Object.extend("Wn.RfidReader",{constructor:function(a){this.addEvents("enter")},fireEnter:function(a){this.fireEvent("enter",this,a)}});Core.Object.extend("Wn.RfidEvent",{prevent:!1,preventDefault:function(){this.prevent=!0},getPreventDefault:function(){return this.prevent}});
Core.Object.extend("Wn.Rfid",{constructor:function(a){this.addEvents("enter")},fireEnter:function(a){var b=new Wn.RfidEvent;this.fireEvent("enter",this,a,b)}},{},{supportRfid:!1,current:void 0,constructor:function(){Wn.Rfid.supportRfid="rfid"in window;Wn.Rfid.supportRfid&&window.rfid.setOnRfidEnter("Wn.Rfid.onRfidEnter");Wn.Rfid.current=new Wn.Rfid},onRfidEnter:function(a){Wn.Rfid.current.fireEnter.call(Wn.Rfid.current,a)}});Ui.Image.extend("Wn.RatioImage",{squareSize:void 0,setSquareSize:function(a){this.squareSize=a;this.invalidateMeasure()}},{measureCore:function(a,b){if(this.getIsReady()){var c=this.getNaturalWidth()/this.getNaturalHeight(),d=this.squareSize;void 0===d&&(d=a);return 1<c?{width:d,height:d/c}:{width:d*c,height:d}}return{width:d,height:d}}});Ui.Button.extend("Wn.SelectionButton",{constructor:function(){this.setDraggableData(this)}},{onPress:function(){Wn.SelectionButton.base.onPress.apply(this,arguments);this.getIsSelected()?this.unselect():this.select();this.setIsActive(this.getIsSelected())},onSelect:function(){this.setIsActive(!0)},onUnselect:function(){this.setIsActive(!1)}});Core.FilePostUploader.extend("Wn.FilePostUploader",{resource:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;void 0!==this.resource&&this.resource.addUploader(this)},getResource:function(){return this.resource}});Ui.LBox.extend("Wn.RatioBox",{ratio:1,constructor:function(a){},setRatio:function(a){this.ratio!==a&&(this.ratio=a,this.invalidateMeasure())}},{measureCore:function(a,b){var c,d;this.ratio>a/b?(c=a,d=c/this.ratio):(d=b,c=d*this.ratio);return Wn.RatioBox.base.measureCore.call(this,c,d)},arrangeCore:function(a,b){var c,d,e,f;this.ratio>a/b?(c=a,d=c/this.ratio,e=0,f=(b-d)/2):(d=b,c=d*this.ratio,f=0,e=(a-c)/2);var g=this.getPaddingLeft(),k=this.getPaddingRight(),h=this.getPaddingTop(),q=this.getPaddingBottom();
c-=g+k;d-=h+q;for(k=0;k<this.getChildren().length;k++)this.getChildren()[k].arrange(g+e,h+f,c,d)}});Ui.VBox.extend("Wn.Field",{title:void 0,fieldBox:void 0,constructor:function(a){this.addEvents("change");var b=new Ui.Text({text:a.title});delete a.title;this.append(b);this.fieldBox=new Ui.LBox({marginLeft:10});this.append(this.fieldBox);a.desc&&(this.append(new Ui.Text({text:a.desc,color:"#aaaaaa"})),delete a.desc)},getTitle:function(){return this.title.getText()},setTitle:function(a){this.title.setText(a)},getField:function(){return this.fieldBox.getFirstChild()},setField:function(a){this.fieldBox.setContent(a)},
getValue:function(){if(void 0!==this.getField()&&void 0!==this.getField().getValue)return this.getField().getValue()},setValue:function(a){void 0!==this.getField()&&void 0!==this.getField().setValue&&this.getField().setValue(a)}});Wn.Field.extend("Wn.GroupField",{},{setContent:function(a){this.setField(a)}});Wn.Field.extend("Wn.TextField",{constructor:function(a){a=new Ui.TextField;this.connect(a,"change",this.onFieldChange);this.setField(a)},getTextHolder:function(){return this.getField().getTextHolder()},setTextHolder:function(a){this.getField().setTextHolder(a)},setPasswordMode:function(a){this.getField().setPasswordMode(a)},onFieldChange:function(a,b){this.fireEvent("change",this,b)}});Wn.Field.extend("Wn.TextAreaField",{constructor:function(a){a=new Ui.TextAreaField;this.connect(a,"change",this.onFieldChange);this.setField(a)},onFieldChange:function(a,b){this.fireEvent("change",this,b)}});Wn.Field.extend("Wn.SliderField",{constructor:function(a){a=new Ui.Slider;this.connect(a,"change",this.onFieldChange);this.setField(a)},onFieldChange:function(a,b){this.fireEvent("change",this,b)}});Wn.Field.extend("Wn.CheckField",{constructor:function(a){a=new Ui.CheckBox;this.connect(a,"change",this.onFieldChange);this.setField(a)},getText:function(){return this.field.getText()},setText:function(a){this.getField().setText(a)},onFieldChange:function(a,b){this.fireEvent("change",this,b)}});Wn.Field.extend("Wn.DateField",{dateField:void 0,hoursField:void 0,displayHours:!1,constructor:function(a){a=new Ui.HBox;this.setField(a);this.dateField=new Ui.DatePicker;a.append(this.dateField,!0);this.connect(this.dateField,"change",this.onFieldChange);this.hoursField=new Ui.TextField({width:60});this.hoursField.hide(!0);a.append(this.hoursField)},setDisplayHours:function(a){this.displayHours!==a&&((this.displayHours=a)?this.hoursField.show():this.hoursField.hide(!0))},onFieldChange:function(a,
b){this.fireEvent("change",this,b)}},{getValue:function(){return this.dateField.getValue()},setValue:function(a){this.dateField.setValue(a);var b="",c=a.getHours();10>c&&(b="0");b=b+c+":";a=a.getMinutes();10>a&&(b+="0");b+=a;this.hoursField.setValue(b)}});Ui.MenuToolBar.extend("Wn.MenuToolBar");Ui.CanvasElement.extend("Wn.NewRibbon",{},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();a.rotate(-Math.PI/2);a.translate(-b,0);a.fillStyle=Ui.Color.create(this.getStyleProperty("background")).getCssRgba();a.beginPath();a.moveTo(0,0);a.lineTo(b/2,0);a.lineTo(b,c/2);a.lineTo(b,c);a.closePath();a.fill();a.translate((b/4+b)/2,3*c/4/2);a.fillStyle="#ffffff";a.rotate(Math.atan2(3*c/4,3*b/4));a.textAlign="center";a.textBaseline="middle";a.font="normal "+0.3*Math.min(b,c)+
"px Ubuntu";a.fillText("nouv.",0,0)},onStyleChange:function(){this.invalidateDraw()}},{style:{background:"#E20045"}});Ui.Button.extend("Wn.OptionOpenButton",{constructor:function(){this.setIcon("optionarrow")}});
Ui.Fold.extend("Wn.OptionSection",{title:void 0,arrow:void 0,optionContent:void 0,optionOpenButton:void 0,constructor:function(){this.setOver(!1);this.setIsFolded(!1);this.optionOpenButton=new Wn.OptionOpenButton;this.connect(this.optionOpenButton,"press",this.invert);this.setHeader(this.optionOpenButton);this.optionContent=new Ui.LBox({paddingLeft:10});Wn.OptionSection.base.setContent.call(this,this.optionContent)},setTitle:function(a){this.optionOpenButton.setText(a)}},{setContent:function(a){this.optionContent.setContent(a)},
setOffset:function(a){Wn.OptionSection.base.setOffset.call(this,a);void 0!==this.optionOpenButton&&this.optionOpenButton.getIcon().setTransform(Ui.Matrix.createRotate(90*a))}});Ui.CanvasElement.extend("Wn.ContentBgGraphic",{color:void 0,setColor:function(a){this.color=Ui.Color.create(a);this.invalidateDraw()}},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();a.roundRectFilledShadow(0,0,b,c,3,3,3,3,!1,2,new Ui.Color({a:0.2}));var d="#f8f8f8";void 0!=this.color&&(d=this.color.getCssRgba());a.fillStyle=d;a.beginPath();a.roundRect(2,2,b-4,c-4,0,0,0,0);a.closePath();a.fill()}});Ui.Button.extend("Wn.ListAddButton",{constructor:function(){this.setIcon("plus")}});Ui.Html.extend("Wn.ImprovedText",{constructor:function(){this.getDrawing().style.wordWrap="break-word";this.connect(this,"link",this.onLink)},convertTextLinkToHtml:function(){var a=this.getHtml(),b;b=navigator.supportRgba?Ui.Color.create(this.getStyleProperty("linkColor")).getCssRgba():Ui.Color.create(this.getStyleProperty("linkColor")).getCssHtml();for(var c="";-1!=a.indexOf("http://")||-1!=a.indexOf("https://");){var d=a.indexOf("http://");-1==d?d=a.indexOf("https://"):-1!=a.indexOf("https://")&&
a.indexOf("https://")<d&&(d=a.indexOf("https://"));for(var e=d,e=d;e<a.length&&" "!==a.charAt(e)&&"\t"!==a.charAt(e)&&"\n"!==a.charAt(e)&&'"'!==a.charAt(e)&&"'"!==a.charAt(e)&&"&"!==a.charAt(e)&&"<"!==a.charAt(e);e++);var f=a.substr(d,e-d),c=c+a.substr(0,d),c=c+('<a href="'+f+'" style="cursor: pointer; text-decoration: underline; color: '+b+'">'+f+"</a>"),a=a.substr(e)}this.setHtml(c+a)},onLink:function(a,b){var c=b,d=c.lastIndexOf("#");-1!=d&&(c=c.substring(0,d));var e=(new Core.Uri).toString(),
d=e.lastIndexOf("#");-1!=d&&(e=e.substring(0,d));c==e?(d=b.lastIndexOf("#"),-1!=d&&(c=b.substr(d+1),Ui.App.current.setMainPath(c))):window.open(b,"_blank")}},{setText:function(a){Wn.ImprovedText.base.setText.apply(this,arguments);this.convertTextLinkToHtml()},onStyleChange:function(){Wn.ImprovedText.base.onStyleChange.apply(this,arguments);var a;a=navigator.supportRgba?Ui.Color.create(this.getStyleProperty("linkColor")).getCssRgba():Ui.Color.create(this.getStyleProperty("linkColor")).getCssHtml();
for(var b=this.getElements("A"),c=0;c<b.length;c++)b[c].style.color=a}},{style:{linkColor:new Ui.Color({r:0.3,g:0.3,b:0.3})}});Ui.DropBox.extend("Wn.FlowDropBox",{flow:void 0,fixed:void 0,marker:void 0,hideTimeout:void 0,constructor:function(a){this.addEvents("dropat");this.fixed=new Ui.Fixed;Wn.FlowDropBox.base.append.call(this,this.fixed);this.marker=new Ui.Frame({margin:2,frameWidth:2,radius:2,width:6,height:6});this.marker.hide();this.fixed.append(this.marker);this.flow=new Ui.Flow({uniform:!0});Wn.FlowDropBox.base.append.call(this,this.flow);this.connect(this,"dragover",this.onBoxDragOver);this.connect(this,"drop",this.onBoxDrop)},
setMarkerPos:function(a){void 0!=this.hideTimeout&&this.hideTimeout.abort();this.hideTimeout=new Core.DelayedTask({delay:1,scope:this,callback:this.markerHide});this.marker.show();if(a<this.flow.getChildren().length){var b=this.flow.getChildren()[a];a=b.getLayoutX()-b.getMarginLeft()-(this.marker.getLayoutWidth()+this.marker.getMarginLeft()+this.marker.getMarginRight())/2;var c=b.getLayoutY(),b=b.getLayoutHeight();this.marker.setHeight(b);this.fixed.setPosition(this.marker,a,c)}else 0<this.flow.getChildren().length?
(b=this.flow.getChildren()[this.flow.getChildren().length-1],a=b.getLayoutX()+b.getLayoutWidth()-this.marker.getLayoutWidth()/2,c=b.getLayoutY(),b=b.getLayoutHeight(),this.marker.setHeight(b),this.fixed.setPosition(this.marker,a,c)):this.markerHide()},markerHide:function(a){this.hideTimeout=void 0;this.marker.hide()},findPosition:function(a){for(var b=[],c=this.flow.getChildren(),d=0;d<c.length;d++)a.y>=c[d].getLayoutY()&&a.y<c[d].getLayoutY()+c[d].getLayoutHeight()&&b.push(c[d]);for(var e=void 0,
f=Number.MAX_VALUE,d=0;d<b.length;d++){var g=b[d].getLayoutX()+b[d].getLayoutWidth()/2,g=Math.abs(a.x-g);g<f&&(f=g,e=b[d])}void 0===e&&0<b.length&&(e=b[b.length-1]);d=c.length;if(void 0!==e){b=-1;for(d=0;-1==b&&d<c.length;d++)c[d]==e&&(b=d);d=a.x<e.getLayoutX()+e.getLayoutWidth()/2?b:b+1}return d},insertAt:function(a,b){this.flow.insertAt(a,b)},moveAt:function(a,b){this.flow.moveAt(a,b)},getLogicalChildren:function(){return this.flow.getChildren()},onBoxDragOver:function(a,b,c){a=this.findPosition({x:b,
y:c});this.checkPosition(a)?this.setMarkerPos(a):this.markerHide()},onBoxDrop:function(a,b,c,d,e){this.markerHide();a=this.findPosition({x:d,y:e});this.checkPosition(a)&&this.fireEvent("dropat",this,b,c,a)},checkPosition:function(a){return!0}},{setContent:function(a){this.flow.setContent(a)},append:function(a){this.flow.append(a)},remove:function(a){this.flow.remove(a)},onStyleChange:function(){var a=this.getStyleProperty("markerColor");this.marker.setFill(a)}},{style:{markerColor:new Ui.Color({r:0.4,
g:0,b:0.35,a:0.8})}});Ui.DropBox.extend("Wn.SFlowDropBox",{flow:void 0,fixed:void 0,marker:void 0,hideTimeout:void 0,constructor:function(a){this.addEvents("dropat");this.fixed=new Ui.Fixed;Wn.SFlowDropBox.base.append.call(this,this.fixed);this.marker=new Ui.Frame({margin:2,frameWidth:2,radius:2,width:6,height:6});this.marker.hide();this.fixed.append(this.marker);this.flow=new Ui.SFlow({uniform:!0,itemAlign:"stretch"});Wn.SFlowDropBox.base.append.call(this,this.flow);this.connect(this,"dragover",this.onBoxDragOver);this.connect(this,
"drop",this.onBoxDrop)},setSpacing:function(a){this.flow.setSpacing(a)},setMarkerPos:function(a){void 0!=this.hideTimeout&&this.hideTimeout.abort();this.hideTimeout=new Core.DelayedTask({delay:1,scope:this,callback:this.markerHide});this.marker.show();if(a<this.flow.getChildren().length){var b=this.flow.getChildren()[a];a=b.getLayoutX()-b.getMarginLeft()-(this.marker.getLayoutWidth()+this.marker.getMarginLeft()+this.marker.getMarginRight()+this.flow.getSpacing())/2;var c=b.getLayoutY(),b=b.getLayoutHeight();
this.marker.setHeight(b);this.fixed.setPosition(this.marker,a,c)}else 0<this.flow.getChildren().length?(b=this.flow.getChildren()[this.flow.getChildren().length-1],a=b.getLayoutX()+b.getLayoutWidth()-(this.marker.getLayoutWidth()+this.flow.getSpacing())/2,c=b.getLayoutY(),b=b.getLayoutHeight(),this.marker.setHeight(b),this.fixed.setPosition(this.marker,a,c)):this.markerHide()},markerHide:function(a){this.hideTimeout=void 0;this.marker.hide()},findPosition:function(a){for(var b=[],c=this.flow.getChildren(),
d=0;d<c.length;d++)a.y>=c[d].getLayoutY()&&a.y<c[d].getLayoutY()+c[d].getLayoutHeight()&&b.push(c[d]);for(var e=void 0,f=Number.MAX_VALUE,d=0;d<b.length;d++){var g=b[d].getLayoutX()+b[d].getLayoutWidth()/2,g=Math.abs(a.x-g);g<f&&(f=g,e=b[d])}void 0===e&&0<b.length&&(e=b[b.length-1]);d=c.length;if(void 0!==e){b=-1;for(d=0;-1==b&&d<c.length;d++)c[d]==e&&(b=d);d=a.x<e.getLayoutX()+e.getLayoutWidth()/2?b:b+1}return d},insertAt:function(a,b){this.flow.insertAt(a,b)},moveAt:function(a,b){this.flow.moveAt(a,
b)},getLogicalChildren:function(){return this.flow.getChildren()},onBoxDragOver:function(a,b,c){a=this.findPosition({x:b,y:c});this.checkPosition(a)?this.setMarkerPos(a):this.markerHide()},onBoxDrop:function(a,b,c,d,e){this.markerHide();a=this.findPosition({x:d,y:e});this.checkPosition(a)&&this.fireEvent("dropat",this,b,c,a)},checkPosition:function(a){return!0}},{setContent:function(a){this.flow.setContent(a)},append:function(a){this.flow.append(a)},remove:function(a){this.flow.remove(a)},onStyleChange:function(){var a=
this.getStyleProperty("markerColor");this.marker.setFill(a)}},{style:{markerColor:new Ui.Color({r:0.4,g:0,b:0.35,a:0.8})}});Ui.DropBox.extend("Wn.VDropBox",{vbox:void 0,fixed:void 0,marker:void 0,hideTimeout:void 0,constructor:function(a){this.addEvents("dropat");this.fixed=new Ui.Fixed;Wn.VDropBox.base.append.call(this,this.fixed);this.marker=new Ui.Frame({margin:2,frameWidth:2,radius:2,width:6,height:6});this.marker.hide();this.fixed.append(this.marker);this.vbox=new Ui.VBox({uniform:!0});Wn.VDropBox.base.append.call(this,this.vbox);this.connect(this,"dragover",this.onBoxDragOver);this.connect(this,"drop",this.onBoxDrop)},
setSpacing:function(a){this.vbox.setSpacing(a)},setMarkerPos:function(a){void 0!=this.hideTimeout&&this.hideTimeout.abort();this.hideTimeout=new Core.DelayedTask({delay:1,scope:this,callback:this.markerHide});this.marker.show();if(a<this.vbox.getChildren().length){a=this.vbox.getChildren()[a];var b=a.getLayoutX(),c=a.getLayoutY()-a.getMarginTop()-(this.marker.getLayoutHeight()+this.marker.getMarginTop()+this.marker.getMarginBottom())/2-this.vbox.getSpacing()/2;this.marker.setWidth(a.getLayoutWidth());
this.fixed.setPosition(this.marker,b,c)}else 0<this.vbox.getChildren().length?(a=this.vbox.getChildren()[this.vbox.getChildren().length-1],b=a.getLayoutX(),c=a.getLayoutY()+a.getLayoutHeight()-this.marker.getLayoutHeight()/2,this.marker.setWidth(a.getLayoutWidth()),this.fixed.setPosition(this.marker,b,c)):this.markerHide()},markerHide:function(a){this.hideTimeout=void 0;this.marker.hide()},findPosition:function(a){for(var b=this.vbox.getChildren(),c=void 0,d=Number.MAX_VALUE,e=0;e<b.length;e++){var f=
b[e].getLayoutY()+b[e].getLayoutHeight()/2,f=Math.abs(a.y-f);f<d&&(d=f,c=b[e])}void 0===c&&0<b.length&&(c=b[b.length-1]);e=b.length;if(void 0!==c){d=-1;for(e=0;-1===d&&e<b.length;e++)b[e]===c&&(d=e);e=a.y<c.getLayoutY()+c.getLayoutHeight()/2?d:d+1}return e},insertAt:function(a,b,c){this.vbox.insertAt(a,b,c)},moveAt:function(a,b){this.vbox.moveAt(a,b)},getLogicalChildren:function(){return this.vbox.getChildren()},onBoxDragOver:function(a,b,c){a=this.findPosition({x:b,y:c});this.checkPosition(a)?this.setMarkerPos(a):
this.markerHide()},onBoxDrop:function(a,b,c,d,e){this.markerHide();this.fireEvent("dropat",this,b,c,this.findPosition({x:d,y:e}))},checkPosition:function(a){return!0}},{setContent:function(a){this.vbox.setContent(a)},append:function(a,b){this.vbox.append(a,b)},remove:function(a){this.vbox.remove(a)},onStyleChange:function(){this.marker.setFill(this.getStyleProperty("markerColor"))}},{style:{markerColor:new Ui.Color({r:0.4,g:0,b:0.35,a:0.8})}});Ui.DropBox.extend("Wn.HDropBox",{hbox:void 0,fixed:void 0,marker:void 0,hideTimeout:void 0,constructor:function(a){this.addEvents("dropat","dropfileat");this.fixed=new Ui.Fixed;Wn.HDropBox.base.append.call(this,this.fixed);this.marker=new Ui.Frame({margin:2,frameWidth:2,radius:2,width:6,height:6});this.marker.hide();this.fixed.append(this.marker);this.hbox=new Ui.HBox({uniform:!0});Wn.HDropBox.base.append.call(this,this.hbox);this.connect(this,"dragover",this.onBoxDragOver);this.connect(this,"drop",
this.onBoxDrop);this.connect(this,"dropfile",this.onBoxDropFile)},setSpacing:function(a){this.hbox.setSpacing(a)},setMarkerPos:function(a){void 0!=this.hideTimeout&&this.hideTimeout.abort();this.hideTimeout=new Core.DelayedTask({delay:1,scope:this,callback:this.markerHide});this.marker.show();if(a<this.hbox.getChildren().length){a=this.hbox.getChildren()[a];var b=a.getLayoutX()-a.getMarginLeft()-(this.marker.getLayoutWidth()+this.marker.getMarginLeft()+this.marker.getMarginRight())/2-this.hbox.getSpacing()/
2,c=a.getLayoutY();this.marker.setHeight(a.getLayoutHeight());this.fixed.setPosition(this.marker,b,c)}else 0<this.hbox.getChildren().length?(a=this.hbox.getChildren()[this.hbox.getChildren().length-1],b=a.getLayoutX()+a.getLayoutWidth()-this.marker.getLayoutWidth()/2,c=a.getLayoutY(),this.marker.setHeight(a.getLayoutHeight()),this.fixed.setPosition(this.marker,b,c)):this.markerHide()},markerHide:function(a){this.hideTimeout=void 0;this.marker.hide()},findPosition:function(a){for(var b=this.hbox.getChildren(),
c=void 0,d=Number.MAX_VALUE,e=0;e<b.length;e++){var f=b[e].getLayoutX()+b[e].getLayoutWidth()/2,f=Math.abs(a.x-f);f<d&&(d=f,c=b[e])}void 0===c&&0<b.length&&(c=b[b.length-1]);e=b.length;if(void 0!==c){d=-1;for(e=0;-1===d&&e<b.length;e++)b[e]===c&&(d=e);e=a.x<c.getLayoutX()+c.getLayoutWidth()/2?d:d+1}return e},insertAt:function(a,b,c){this.hbox.insertAt(a,b,c)},moveAt:function(a,b){this.hbox.moveAt(a,b)},getLogicalChildren:function(){return this.hbox.getChildren()},onBoxDragOver:function(a,b,c){a=this.findPosition({x:b,
y:c});this.checkPosition(a)?this.setMarkerPos(a):this.markerHide()},onBoxDrop:function(a,b,c,d,e){this.markerHide();this.fireEvent("dropat",this,b,c,this.findPosition({x:d,y:e}))},onBoxDropFile:function(a,b,c,d){this.markerHide();this.fireEvent("dropfileat",this,b,this.findPosition({x:c,y:d}))},checkPosition:function(a){return!0}},{setContent:function(a){this.hbox.setContent(a)},append:function(a,b){this.hbox.append(a,b)},remove:function(a){this.hbox.remove(a)},onStyleChange:function(){this.marker.setFill(this.getStyleProperty("markerColor"))}},
{style:{markerColor:new Ui.Color({r:0.4,g:0,b:0.35,a:0.8})}});Ui.LBox.extend("Wn.GroupIconView",{label:void 0,constructor:function(a){a=new Ui.DualIcon({icon:"group",width:48,height:48,strokeWidth:2});this.append(a);this.label=new Ui.Label({fontSize:12,fontWeight:"bold",horizontalAlign:"center",verticalAlign:"bottom",marginBottom:12,color:"black"});this.append(this.label)},setValue:function(a){this.label.setText(a.toString())}});Core.Object.extend("Wn.Resource",{id:void 0,ready:!1,data:void 0,deleted:!1,request:void 0,user:void 0,uploaders:void 0,constructor:function(a){this.addEvents("ready","change","delete","error","uploadstart","uploadcomplete","uploadprogress");this.user=a.user;delete a.user;this.uploaders=[];"resource"in a?(this.id=a.resource.id,this.updateData(a.resource),delete a.resource):"id"in a&&(this.id=a.id,delete a.id,this.data={},this.update())},getIsReady:function(){return this.ready},getIsDeleted:function(){return this.deleted},
getIsMonitored:function(){if(!("owner_id"in this.data))return!1;var a=Ui.App.current.getUser().getContact(this.data.owner_id);return void 0===a?!1:a.getResource(this.id)===this},getId:function(){return this.id},getType:function(){return this.data.type},getOwnerId:function(){return this.data.owner_id},getStorageId:function(){return this.data.storage_id},getPreviewImageUrl:function(){return null===this.data.preview_file_id?void 0:"/cloud/previewhigh/"+this.data.storage_id+"/"+this.data.preview_file_id+
"?rev="+this.data.preview_file_rev},getRights:function(){return this.data.rights},getRev:function(){return this.data.rev},getSeenByMeRev:function(){return this.data.seenByMeRev},addRights:function(a){(new Core.HttpRequest({method:"POST",url:"/cloud/resource/"+this.id+"/rights",content:JSON.stringify(a)})).send()},getPublicRights:function(){return{read:this.data.public_read,write:this.data.public_write,share:this.data.public_share}},addPublicRights:function(a){(new Core.HttpRequest({method:"PUT",url:"/cloud/resource/"+
this.id,content:JSON.stringify({public_read:a.read,public_write:a.write,public_share:a.share})})).send()},changeData:function(a){a=new Core.HttpRequest({method:"PUT",url:"/cloud/resource/"+this.id,content:JSON.stringify(a)});this.connect(a,"done",this.onChangeDataDone);a.send()},markSeenByMe:function(){if(this.data.rev!=this.data.seenByMeRev){var a=new Core.HttpRequest({method:"PUT",url:"/cloud/resource/"+this.id+"?seenBy="+this.user.getId(),content:JSON.stringify({seenByMeRev:this.data.rev})});this.connect(a,
"done",this.onMarkSeenByMeDone);a.send()}},onMarkSeenByMeDone:function(a){this.updateData(a.getResponseJSON())},onChangeDataDone:function(a){this.updateData(a.getResponseJSON())},canShare:function(){var a=this.user.getId();if(this.data.public_share||this.data.owner_id==a)return!0;for(var b=0;b<this.data.rights.length;b++){var c=this.data.rights[b];if(c.user_id==a)return c.share}return!1},canWrite:function(){var a=this.user.getId();if(this.data.public_write||this.data.owner_id==a)return!0;for(var b=
0;b<this.data.rights.length;b++){var c=this.data.rights[b];if(c.user_id==a)return c.write}return!1},getData:function(){return this.data},getName:function(){return this.data.name},getBookmark:function(){for(var a=0;a<this.user.getBookmarks().length;a++)if(this.user.getBookmarks()[a].getId()==this.getId())return!0;return!1},bookmark:function(){this.user.bookmarkResource(this)},unbookmark:function(){this.user.unbookmarkResource(this)},deleteResource:function(){var a=new Core.HttpRequest({method:"DELETE",
url:"/cloud/resource/"+this.id});this.connect(a,"done",function(){this.fireEvent("delete",this)});a.send()},addUploader:function(a){this.uploaders.push(a);1===this.uploaders.length&&this.fireEvent("uploadstart",this);this.connect(a,"complete",this.onUploaderCompleteError);this.connect(a,"error",this.onUploaderCompleteError);this.connect(a,"progress",this.updateUploaders)},getUploaders:function(){return this.uploaders},onUploaderCompleteError:function(a){a=!0;for(var b=0;a&&b<this.uploaders.length;b++)a=
this.uploaders[b].getIsCompleted();this.updateUploaders();a&&(this.uploaders=[],this.fireEvent("uploadcomplete",this))},updateUploaders:function(){for(var a=0,b=0,c=0,d=0,e=0;e<this.uploaders.length;e++){var f=this.uploaders[e];void 0!=f.getTotal()&&(c+=f.getTotal(),d+=f.getIsCompleted()?f.getTotal():f.getLoaded(),b++);a++}this.fireEvent("uploadprogress",this,d/c,d,c,a)},update:function(){void 0===this.request&&(this.request=new Core.HttpRequest({url:"/cloud/resource/"+this.id+"?seenBy="+this.user.getId()}),
this.connect(this.request,"done",this.onGetDataDone),this.connect(this.request,"error",this.onGetDataError),this.request.send())},updateData:function(a){if(void 0===this.data||JSON.stringify(this.data)!=JSON.stringify(a))this.data=a,this.ready||(this.ready=!0,this.fireEvent("ready",this)),this.fireEvent("change",this)},onGetDataError:function(a){this.ready=!0;404==a.getStatus()||403==a.getStatus()?(this.fireEvent("delete",this),this.deleted=!0,this.getBookmark()&&this.user.unbookmarkResource(this)):
this.fireEvent("error",this);this.request=void 0},onGetDataDone:function(a){a=a.getResponseJSON();this.updateData(a);this.request=void 0}},{},{getResource:function(a,b,c){var d=void 0;void 0===b&&(b=Ui.App.current.getUser());d=b.getResource(a);if(void 0===d)for(var e=0;void 0===d&&e<b.getContacts().length;e++)d=b.getContacts()[e].getResource(a);void 0===d&&!c&&(d=new Wn.Resource({id:a,user:b}));return d}});Ui.Pressable.extend("Wn.UserFace",{user:void 0,image:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setVerticalAlign("center");this.connect(this,"press",this.onUserPress);this.append(new Ui.Rectangle({fill:"#7b7c7c"}));this.append(new Ui.Rectangle({fill:"#f1f1f1",margin:1}));this.image=new Ui.Image({width:46,height:46,margin:1,src:this.user.getFaceUrl()});this.append(this.image)},onUserChange:function(){this.image.setSrc(this.user.getFaceUrl())},onUserPress:function(){Ui.App.current.setMainPath("user:"+
this.user.getId())}},{onLoad:function(){Wn.UserFace.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange)},onUnload:function(){Wn.UserFace.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange)}});Ui.CanvasElement.extend("Wn.ResourceViewGraphic",{title:"",icon:void 0,image:void 0,shareMode:"group",shareCount:0,userImage:void 0,foreground:void 0,background:void 0,constructor:function(a){this.setForeground("white");this.setBackground("black")},setShareMode:function(a){this.shareMode=a;this.invalidateDraw()},setShareCount:function(a){this.shareCount=a;this.invalidateDraw()},setIcon:function(a){this.icon=a;this.invalidateDraw()},setForeground:function(a){this.foreground=Ui.Color.create(a);this.invalidateDraw()},
setColor:function(a){this.color=Ui.Color.create(a);this.invalidateDraw()},getPreviewImage:function(){if(void 0!==this.image)return this.image.getSrc()},setPreviewImage:function(a){void 0==this.image&&(this.image=new Ui.Image,this.appendChild(this.image));this.image.setSrc(a);this.image.getIsReady()?this.invalidateDraw():this.connect(this.image,"ready",this.invalidateDraw)},setTitle:function(a){this.title=a;this.invalidateDraw()},setUserImage:function(a){void 0===this.userImage?(this.userImage=new Ui.Image({src:a}),
this.appendChild(this.userImage),this.connect(this.userImage,"ready",this.invalidateDraw)):this.userImage.getSrc()!==a&&this.userImage.setSrc(a)}},{setBackground:function(a){this.background=Ui.Color.create(a);this.invalidateDraw()},measureCore:function(a,b){return{width:20,height:44}},updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=this.getStyleProperty("fontSize"),e=this.getStyleProperty("interLine"),f=Math.max(55,d*(1+e)+20);if(void 0!==this.image&&this.image.getIsReady()){a.save();
var g=b,k=c-f,h=g/k,q=this.image.getNaturalWidth()/this.image.getNaturalHeight(),l=this.image.getNaturalWidth(),m=this.image.getNaturalHeight(),n=0,p=0;q>h?(p=0,m=this.image.getNaturalHeight(),l=m*h,n=(this.image.getNaturalWidth()-l)/2):(n=0,l=this.image.getNaturalWidth(),m=l/h,p=0);a.drawImage(this.image.getDrawing(),n,p,l,m,0,0,g,k);a.restore()}else void 0!==this.icon&&(g=Ui.Icon.getPath(this.icon),a.save(),a.translate((b-96)/2,(c-(96+f))/2),a.scale(2,2),a.fillStyle=this.foreground.getCssRgba(),
a.beginPath(),a.svgPath(g),a.closePath(),a.fill(),a.restore());a.fillStyle=this.color.getCssRgba();a.beginPath();a.rect(0,c-f,b,f);a.closePath();a.fill();void 0!==this.userImage&&this.userImage.getIsReady()&&(a.save(),a.translate(8,c-46),k=g=30,h=g/k,q=this.userImage.getNaturalWidth()/this.userImage.getNaturalHeight(),l=this.userImage.getNaturalWidth(),m=this.userImage.getNaturalHeight(),p=n=0,a.fillStyle="white",a.fillRect(1,1,32,32),q>h?(p=0,m=this.userImage.getNaturalHeight(),l=m*h,n=(this.userImage.getNaturalWidth()-
l)/2):(n=0,l=this.userImage.getNaturalWidth(),m=l/h,p=(this.userImage.getNaturalHeight()-m)/2),a.drawImage(this.userImage.getDrawing(),n,p,l,m,2,2,g,k),a.restore());""!==this.title&&(a.save(),a.translate(48,c-(3+f)+d+10),c=new Ui.CompactLabelContext,c.setFontSize(d),c.setInterLine(e),c.setMaxLine(2),c.setText(this.title),a.fillStyle="white",a.font=c.getFontWeight()+" "+c.getFontSize()+"px "+c.getFontFamily(),c.setDrawLine(function(b,c,d){a.fillText(d,b,c)}),c.drawText(b-60,!0),a.restore());"public"==
this.shareMode?(a.save(),a.fillStyle="rgba(40, 40, 40, 0.5)",a.fillRect(26,0,30,40),a.translate(30,15),Ui.Icon.drawIcon(a,"earth",22,"white"),a.restore()):0<this.shareCount&&(a.save(),a.fillStyle="rgba(40, 40, 40, 0.5)",a.fillRect(26,0,30,40),a.translate(30,15),Ui.Icon.drawIconAndBadge(a,"group",22,"white",this.shareCount,8.8,"white","black"),a.restore())}},{style:{fontSize:16,interLine:1.2,fontWeight:"normal"}});Ui.Button.extend("Wn.ResourceView",{user:void 0,contact:void 0,resource:void 0,contactface:void 0,previewBox:void 0,newicon:void 0,graphic:void 0,constructor:function(a){this.user=a.user;delete a.user;"contact"in a&&(this.contact=a.contact,delete a.contact);this.resource=a.resource;delete a.resource;this.setDraggableData(this);this.getDropBox().addMimetype(Wn.MenuContact);this.connect(this.getDropBox(),"drop",this.onUserDrop);a=new Ui.LBox;this.setIcon(a);this.graphic=new Wn.ResourceViewGraphic;a.append(this.graphic);
this.newicon=new Wn.NewRibbon({width:54,height:54,verticalAlign:"top",horizontalAlign:"left",margin:1});a.append(this.newicon)},getGraphic:function(){return this.graphic},getResource:function(){return this.resource},onUserDrop:function(a,b,c){this.resource.canShare()&&(a={user_id:c.getContact().getId(),read:!0,share:this.user.getData().default_share_right},this.resource.canWrite()&&this.user.getData().default_write_right&&(a.write=!0),this.resource.addRights(a))},onResourceChange:function(){this.resource.getIsReady()&&
(this.resource.getOwnerId()!==this.user.getId()?(void 0===this.contact&&(this.contact=Wn.Contact.getContact(this.resource.getOwnerId())),this.graphic.setUserImage(this.contact.getFaceUrl())):this.graphic.setUserImage(this.user.getFaceUrl()),this.graphic.setTitle(this.resource.getName().toUpperCase()),this.resource.getSeenByMeRev()!==this.resource.getRev()?this.newicon.show():this.newicon.hide(),this.graphic.setShareCount(this.resource.getRights().length),this.resource.getPublicRights().read?this.graphic.setShareMode("public"):
this.graphic.setShareMode("group"))},onResourceEdit:function(){(new Wn.ResourcePropertiesDialog({user:this.user,resource:this.resource})).open()},onResourceDelete:function(){(new Wn.ResourceDeleteDialog({resource:this.resource})).open()},testDeleteRight:function(){return Ui.App.current.getUser().isAdmin()||this.resource.canWrite()},onBookmark:function(){this.resource.bookmark()},onUnbookmark:function(){this.resource.unbookmark()},testBookmarkRight:function(){return!this.resource.getBookmark()&&this.resource.getOwnerId()!==
this.user.getId()},testUnbookmarkRight:function(){return this.resource.getBookmark()&&this.resource.getOwnerId()!==this.user.getId()}},{onPress:function(){Ui.App.current.setMainPath("resource:"+this.resource.getId())},updateColors:function(){Wn.ResourceView.base.updateColors.apply(this,arguments);this.graphic.setColor(this.getColor());this.graphic.setForeground(this.getForeground());this.graphic.setBackground(this.getBackground())},getSelectionActions:function(){return{bookmark:{text:"Mettre en favoris",
icon:"star",testRight:this.testBookmarkRight,scope:this,callback:this.onBookmark,multiple:!1},unbookmark:{text:"Enlever des favoris",icon:"star",testRight:this.testUnbookmarkRight,scope:this,callback:this.onUnbookmark,multiple:!1},"delete":{text:"Supprimer",icon:"trash",color:"#d02020",testRight:this.testDeleteRight,scope:this,callback:this.onResourceDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onResourceEdit,multiple:!1}}},onLoad:function(){Wn.ResourceView.base.onLoad.call(this);
this.connect(this.resource,"change",this.onResourceChange);this.onResourceChange()},onUnload:function(){Wn.ResourceView.base.onUnload.call(this);this.disconnect(this.resource,"change",this.onResourceChange)},onStyleChange:function(){Wn.ResourceView.base.onStyleChange.apply(this,arguments);this.graphic.setMargin(this.getStyleProperty("borderWidth"))},getColor:function(){var a=Ui.Color.create(this.getStyleProperty("color")).getYuva(),b=0;this.getIsDown()?b=-0.2:this.getIsOver()&&(b=0.2,a.a=Math.max(0.4,
a.a));return new Ui.Color({y:a.y+b,u:a.u,v:a.v,a:a.a})}},{style:{color:"#a1a1a1"},views:void 0,constructor:function(){this.views={}},register:function(a,b){Wn.ResourceView.views[a]=b},getView:function(a){return Wn.ResourceView.views[a]}});Core.Object.extend("Wn.Contact",{id:void 0,data:void 0,ready:!1,resourcesReady:!1,request:void 0,resources:void 0,user:void 0,constructor:function(a){this.addEvents("ready","error","change","delete","resourcechange");this.resources=[];this.user=a.user;delete a.user;"contact"in a?(this.data=a.contact,delete a.contact,this.id=this.data.id,this.updateData(this.data)):"id"in a&&(this.id=a.id,delete a.id,this.update());if(void 0===this.id)throw"Wn.Contact id not set";},getName:function(){return this.getIsReady()?
null===this.getData().firstname&&null===this.getData().lastname&&null===this.getData().login?"":null===this.getData().firstname&&null===this.getData().lastname?this.getData().login:null===this.getData().firstname?this.getData().lastname:null===this.getData().lastname?this.getData().firstname:this.getData().firstname+" "+this.getData().lastname:""},getIsReady:function(){return this.ready},getIsMonitored:function(){return Ui.App.current.getUser().getContact(this.id)===this},setIsOnline:function(a){this.data.online=
a;this.fireEvent("change",this)},getIsOnline:function(){return this.data.online},getIsResourcesLoaded:function(){return this.resourcesReady},getFirstname:function(){return this.data.firstname},getLastname:function(){return this.data.lastname},update:function(){void 0===this.request&&(this.request=new Core.HttpRequest({url:"/cloud/user/"+this.id+"?seenBy="+this.user.getId()}),this.connect(this.request,"done",this.onGetDataDone),this.connect(this.request,"error",this.onGetDataError),this.request.send())},
updateData:function(a){if(void 0!==a.resources){this.resourcesReady=!0;for(var b=[],c=0;c<this.resources.length;c++)delete this.resources[c].wnContactSeen;for(c=0;c<a.resources.length;c++){for(var d=void 0,e=0;void 0===d&&e<this.resources.length;e++)this.resources[e].getId()===a.resources[c].id&&(d=this.resources[e]);void 0!==d?d.updateData(a.resources[c]):(d=new Wn.Resource({resource:a.resources[c],user:this.user}),this.connect(d,"change",this.onResourceChange));d.wnContactSeen=!0;b.push(d)}for(c=
0;c<this.resources.length;c++)!0!==this.resources[c].wnContactSeen&&this.disconnect(this.resources[c],"change",this.onResourceChange);this.resources=b}this.data=a;this.ready||(this.ready=!0,this.fireEvent("ready",this));this.fireEvent("change",this)},getId:function(){return this.id},getData:function(){return this.data},getFaceUrl:function(){return void 0!==this.data&&void 0!==this.data.face_rev?"/cloud/user/"+this.id+"/face?rev="+this.data.face_rev:"/cloud/user/"+this.id+"/face"},getPosition:function(){return this.data.position},
getResources:function(){return this.resources},getResource:function(a){for(var b=0;b<this.resources.length;b++)if(this.resources[b].getId()===a)return this.resources[b]},onGetDataError:function(a){404==a.getStatus()?this.fireEvent("delete",this):this.fireEvent("error",this);this.request=void 0},onGetDataDone:function(a){a=a.getResponseJSON();this.updateData(a);this.request=void 0},onResourceChange:function(a){this.fireEvent("resourcechange",this,a)}},{},{getContact:function(a,b){var c=Ui.App.current.getUser().getContact(a);
void 0===c&&!b&&(c=new Wn.Contact({id:a,user:Ui.App.current.getUser()}));return c}});Ui.LBox.extend("Wn.VideoConfView",{user:void 0,contact:void 0,localVideo:void 0,localStream:void 0,remoteVideo:void 0,remoteStream:void 0,queue:void 0,remoteBox:void 0,peerConnection:void 0,isCaller:!0,message:void 0,channel:void 0,hasAccepted:!1,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;"message"in a&&(this.message=a.message,delete a.message)},findParentDialog:function(){for(var a=this.getParent();void 0!==a&&!Ui.Dialog.hasInstance(a);)a=a.getParent();
return a},buildUi:function(){if(void 0!==this.message){this.channel=this.message.content;this.isCaller=!1;var a=new Ui.VBox({spacing:10,margin:20,verticalAlign:"center"});this.setContent(a);var b=new Ui.Image({width:128,height:128,horizontalAlign:"center",src:this.contact.getFaceUrl()});a.append(b);b=new Ui.Text({textAlign:"center",text:"Vous avez un appel vid\u00e9o de "+this.contact.getName()});a.append(b);var b=new Ui.HBox({uniform:!0,horizontalAlign:"center",spacing:10}),c=new Wn.AlertButton({text:"Refuser"});
b.append(c);var d=new Ui.DefaultButton({text:"Accepter"});b.append(d);a.append(b);this.queue=new Wn.Queue({channel:this.channel});this.connect(this.queue,"open",this.onQueueOpen);this.connect(this.queue,"close",this.onQueueClose);this.connect(this.queue,"message",this.onQueueMessage);this.connect(c,"press",function(){this.queue.sendMessage({user:this.user.getId(),event:"reject"});var a=this.findParentDialog();void 0!==a&&a.close()});this.connect(d,"press",function(){this.hasAccepted=!0;this.buildVideoUi()})}else navigator.supportWebRTC?
this.contact.getIsOnline()?this.buildVideoUi():this.setContent(new Ui.Text({verticalAlign:"center",margin:10,textAlign:"center",text:"Votre interlocuteur n'est pas connect\u00e9 pour le moment. Il doit \u00eatre connect\u00e9 pour pouvoir passer un appel vid\u00e9o."})):this.setContent(new Ui.Text({verticalAlign:"center",margin:10,textAlign:"center",text:"Votre navigateur Web ne supporte pas cette fonctionnalit\u00e9e. Pour passer un appel vid\u00e9o, votre navigateur doit g\u00e9rer le protocole WebRTC."}))},
buildRemoteVideo:function(){this.remoteVideo=new Ui.Video({autoplay:!0});this.remoteBox.setContent(this.remoteVideo)},buildVideoUi:function(){var a=new Ui.LBox;this.setContent(a);this.remoteBox=new Ui.LBox;a.append(this.remoteBox);this.remoteBox.setContent(new Ui.Text({text:"Attente d'autorisation",margin:10,textAlign:"center",verticalAlign:"center",fontSize:24}));var b=new Ui.LBox({verticalAlign:"bottom",horizontalAlign:"left"});a.append(b);b.append(new Ui.Rectangle({fill:"#999999"}));this.localVideo=
new Ui.Video({margin:2,width:100,height:100,autoplay:!0});this.connect(this.localVideo,"ready",this.onLocalVideoReady);b.append(this.localVideo);var c=this;navigator.getUserMedia({audio:!0,video:{mandatory:{},optional:[]}},function(a){c.onUserMediaSuccess.call(c,a)},function(a){this.onUserMediaError.call(c,a)})},onUserMediaSuccess:function(a){this.localStream=a;this.localVideo.setSrc(this.localStream);if(this.isCaller){this.buildRemoteVideo();this.channel="";for(a=0;10>a;a++)this.channel+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*
Math.random()));this.queue=new Wn.Queue({channel:this.channel});this.connect(this.queue,"open",this.onQueueOpen);this.connect(this.queue,"close",this.onQueueClose);this.connect(this.queue,"message",this.onQueueMessage);this.remoteBox.setContent(new Ui.Text({text:"Appel en cours...",margin:10,textAlign:"center",verticalAlign:"center",fontSize:24}))}else this.remoteBox.setContent(new Ui.Text({text:"Appel en cours...",margin:10,textAlign:"center",verticalAlign:"center",fontSize:24})),this.queue.sendMessage({user:this.user.getId(),
event:"accept"})},onUserMediaError:function(a){this.close()},onLocalVideoReady:function(){var a=this.localVideo.getNaturalWidth(),b=this.localVideo.getNaturalHeight();a>b?(this.localVideo.setWidth(100),this.localVideo.setHeight(100*b/a)):(this.localVideo.setHeight(100),this.localVideo.setWidth(100*a/b))},onQueueOpen:function(){this.isCaller&&this.user.sendMessage(this.contact,this.channel,"call")},onQueueClose:function(){console.log(this+".onQueueClose");this.setContent(new Ui.Text({textAlign:"center",
margin:10,verticalAlign:"center",text:"Votre interlocuteur a mis fin \u00e0 cet appel vid\u00e9o"}))},onQueueMessage:function(a,b){console.log("onQueueMessage contact: "+this.contact.getId());console.log(b);if("reject"===b.event)if(this.isCaller)this.setContent(new Ui.Text({textAlign:"center",margin:10,verticalAlign:"center",text:"Votre interlocuteur refuser cet appel vid\u00e9o"}));else{var c=this.findParentDialog();void 0!==c&&c.close()}else if("accept"===b.event)if(this.isCaller){this.createPeerConnection();
var d=this;this.peerConnection.createOffer(function(a){d.onGotDescription.call(d,a)},function(a){console.log("createOffer ERROR");console.log(a)})}else this.hasAccepted||(c=this.findParentDialog(),void 0!==c&&c.close());else"sdp"===b.event&&b.user!==this.user.getId()?(void 0===this.peerConnection&&this.createPeerConnection(),this.peerConnection.setRemoteDescription(new RTCSessionDescription(b.sdp)),d=this,this.peerConnection.createAnswer(function(a){d.onGotDescription.call(d,a)},function(a){console.log("createAnswer ERROR");
console.log(a)})):"candidate"===b.event&&null!==b.candidate&&b.user!==this.user.getId()?(void 0===this.peerConnection&&this.createPeerConnection(),this.peerConnection.addIceCandidate(new RTCIceCandidate(b.candidate))):"end"===b.event&&(!this.isCaller&&!this.hasAccepted&&(c=this.findParentDialog(),void 0!==c&&c.close()),void 0!==this.queue&&(this.queue.close(),this.queue=void 0))},onGotDescription:function(a){this.peerConnection.setLocalDescription(a);this.queue.sendMessage({user:this.user.getId(),
event:"sdp",sdp:a})},createPeerConnection:function(){this.peerConnection=new RTCPeerConnection({iceServers:[{url:"stun:stun.services.mozilla.com"}]},{optional:[{DtlsSrtpKeyAgreement:"true"}]});this.peerConnection.addStream(this.localStream);var a=this;this.peerConnection.onicecandidate=function(b){a.queue.sendMessage({user:a.user.getId(),event:"candidate",candidate:b.candidate})};this.peerConnection.onaddstream=function(b){a.buildRemoteVideo();a.remoteStream=b.stream;a.remoteVideo.setSrc(b.stream)};
this.peerConnection.onremovestream=function(b){console.log("onremovestream");a.remoteStream=null;a.close()}}},{onLoad:function(){Wn.VideoConfView.base.onLoad.apply(this,arguments);this.buildUi()},onUnload:function(){Wn.VideoConfView.base.onUnload.apply(this,arguments);void 0!==this.localStream&&(this.localStream.stop(),this.localStream=void 0);void 0!==this.queue&&((this.hasAccepted||this.isCaller)&&this.queue.sendMessage({user:this.user.getId(),event:"end"}),this.queue.close(),this.queue=void 0)}});Ui.LBox.extend("Wn.ContactNewMessage",{user:void 0,contact:void 0,userface:void 0,textfield:void 0,sendButton:void 0,text:void 0,request:void 0,vbox:void 0,constructor:function(a){this.addEvents("new");this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;var b=new Ui.VBox;this.vbox=b;this.append(b);a=new Ui.HBox({spacing:5});b.append(a,!0);b=new Ui.LBox({verticalAlign:"top",horizontalAlign:"right",margin:0});a.append(b);b.append(new Ui.Rectangle({fill:"#999999"}));b.append(new Ui.Rectangle({fill:"#f1f1f1",
margin:1}));this.userface=new Ui.Image({width:32,height:32,margin:1});b.append(this.userface);this.textfield=new Ui.TextAreaField({margin:0,marginLeft:0,textHolder:"Un message ?"});this.connect(this.textfield.textarea,"focus",this.onTextAreaFocus);this.connect(this.textfield.textarea,"blur",this.onTextAreaBlur);this.connect(this.textfield,"change",function(a,b){""==b?this.sendButton.disable():this.sendButton.enable()});a.append(this.textfield,!0);this.sendButton=new Ui.DefaultButton({text:"Envoyer",
horizontalAlign:"right",marginBottom:10,marginRight:10});this.sendButton.disable();this.connect(this.sendButton,"press",this.onButtonPress)},onTextAreaFocus:function(){void 0==this.sendButton.getParent()&&this.vbox.append(this.sendButton)},onTextAreaBlur:function(){void 0!==this.sendButton.getParent()&&""===this.textfield.getValue()&&this.vbox.remove(this.sendButton)},onUserChange:function(){void 0!=this.user.getFaceUrl()&&this.userface.setSrc(this.user.getFaceUrl())},onButtonPress:function(){this.text=
this.textfield.getValue();this.request=this.user.sendMessage(this.contact,this.text);this.connect(this.request,"done",this.onRequestDone);this.connect(this.request,"error",this.onRequestError);this.disable()},onRequestDone:function(){console.log(this+".onRequestDone");this.fireEvent("new",this,this.text);this.textfield.setValue("");this.enable();this.request=void 0},onRequestError:function(){console.log(this+".onRequestError");this.textfield.setValue("");this.enable();this.request=void 0}},{onLoad:function(){Wn.ContactNewMessage.base.onLoad.call(this);
this.connect(this.user,"change",this.onUserChange);this.onUserChange()},onUnload:function(){Wn.ContactNewMessage.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange)}});
Ui.Pressable.extend("Wn.UserMessageView",{user:void 0,sourceFace:void 0,message:void 0,dialog:void 0,destinationFace:void 0,contact:void 0,previewBox:void 0,label:void 0,dateLabel:void 0,showDestination:!0,showSource:!0,source:void 0,destination:void 0,bg:void 0,constructor:function(a){this.user=a.user;delete a.user;this.message=a.message;delete a.message;"dialog"in a&&(this.dialog=a.dialog,delete a.dialog);"showSource"in a&&(this.showSource=a.showSource,delete a.showSource);"showDestination"in a&&
(this.showDestination=a.showDestination,delete a.showDestination);this.message.getOrigin()===this.user.getId()?this.source=this.user:this.source=Wn.Contact.getContact(this.message.getOrigin());this.message.getDestination()===this.user.getId()?this.destination=this.user:this.destination=Wn.Contact.getContact(this.message.getDestination());this.bg=new Ui.Rectangle;this.append(this.bg);a=new Ui.HBox({spacing:10});this.append(a);var b=new Ui.LBox({verticalAlign:"top",horizontalAlign:"right"});b.append(new Ui.Rectangle({fill:"#f1f1f1",
margin:0}));this.sourceFace=new Ui.Image({width:32,height:32,margin:0});b.append(this.sourceFace);this.showSource&&a.append(b);b=new Ui.VBox({spacing:5});a.append(b,!0);var c;c=this.source===this.user?"Moi, ":this.source.getName()+", ";var d=new Date-this.message.getDate();if(604800>d){var e=Math.floor(d/864E5),f=Math.floor(d/36E5),d=Math.floor(d/6E4);c+="il y a ";c=0<e?c+(e+" jours"):0<f?c+(f+" heures"):c+(d+" minutes")}else c+="le ",e=this.message.getDate(),c+=e.getDate()-1+"/"+(e.getMonth()+1)+
"/"+e.getFullYear();this.dateLabel=new Ui.Text({opacity:0.8,fontSize:10,textAlign:"left",text:c});b.append(this.dateLabel);"message"===this.message.getType()||"comment"===this.message.getType()?this.label=new Wn.ImprovedText({text:""}):this.label=new Ui.Text({text:""});b.append(this.label);"message"===this.message.getType()&&this.label.setText(this.message.getContent());b=new Ui.LBox({verticalAlign:"top",horizontalAlign:"right"});b.append(new Ui.Rectangle({fill:"#f1f1f1",margin:0}));this.destinationFace=
new Ui.Image({width:32,height:32,margin:0});b.append(this.destinationFace);this.showDestination&&a.append(b);this.setLock("contact"!==this.message.getType()&&"resource"!==this.message.getType()&&"comment"!==this.message.getType()&&"message"===this.message.getType()&&Ui.Dialog.hasInstance(this.dialog));this.connect(this,"press",this.onMessageViewPress);"comment"==this.message.getType()&&(this.resource=Wn.Resource.getResource(this.message.getContent().resource.id,this.user))},setAllowMessage:function(a){a?
this.setLock(!1):this.setLock("message"===this.message.getType())},onBothReady:function(){var a;if(this.message.getOrigin()===this.user.getId()){var b=this.destination.getName()+" ";a="J'ai ";a="resource"===this.message.getType()?a+('partag\u00e9 la ressouce "'+this.message.getContent().name+'" avec '+b):"contact"===this.message.getType()?a+("ajout\u00e9 "+b+" \u00e0 mes contacts"):"comment"===this.message.getType()?a+('laiss\u00e9 un commentaire sur la ressource "'+this.message.getContent().resource.name+
'"'):"call"===this.message.getType()?a+("pass\u00e9 un appel vid\u00e9o \u00e0 "+b):this.message.getContent()}else a=this.source.getName()+" ",a="resource"===this.message.getType()?a+('vous a partag\u00e9 la ressouce "'+this.message.getContent().name+'"'):"contact"==this.message.getType()?a+"vous a ajout\u00e9 \u00e0 ses contacts":"comment"==this.message.getType()?a+('\u00e0 laiss\u00e9 un commentaire sur la ressource "'+this.message.getContent().resource.name+'"'):"call"===this.message.getType()?
a+"vous a appel\u00e9 en vid\u00e9o":this.message.getContent();this.label.setText(a)},onDestinationChange:function(){void 0!==this.destination.getFaceUrl()&&this.destinationFace.setSrc(this.destination.getFaceUrl());if(this.source.getIsReady())this.onBothReady()},onMessageViewPress:function(){this.message.markSeen();if("message"==this.message.getType()){var a;a=this.message.getOrigin()===this.user.getId()?this.destination:this.source;(new Wn.ContactMessagesDialog({user:this.user,contact:a})).open()}else"resource"==
this.message.getType()?(Ui.App.current.setMainPath("resource:"+this.message.getContent().id),void 0!==this.dialog&&Ui.Dialog.hasInstance(this.dialog)&&this.dialog.close()):"comment"==this.message.getType()?(Ui.App.current.setMainPath("resource:"+this.message.getContent().resource.id+":"+this.message.getContent().file),void 0!==this.dialog&&Ui.Dialog.hasInstance(this.dialog)&&this.dialog.close()):"contact"==this.message.getType()&&(Ui.App.current.setMainPath("user:"+this.message.getContent()),void 0!==
this.dialog&&Ui.Dialog.hasInstance(this.dialog)&&this.dialog.close())},onSourceChange:function(){void 0!==this.source.getFaceUrl()&&this.sourceFace.setSrc(this.source.getFaceUrl());if(this.destination.getIsReady())this.onBothReady()},getMessage:function(){return this.message},getSearchText:function(){return this.dateLabel.getText()+" "+this.label.getText()}},{onStyleChange:function(){this.bg.setFill(this.getStyleProperty("background"))},onLoad:function(){Wn.UserMessageView.base.onLoad.apply(this,
arguments);if(void 0!==this.source){if(this.source.getIsReady())this.onSourceChange();this.connect(this.source,"change",this.onSourceChange)}if(void 0!==this.destination){if(this.destination.getIsReady())this.onDestinationChange();this.connect(this.destination,"change",this.onDestinationChange)}},onUnload:function(){Wn.UserMessageView.base.onUnload.apply(this,arguments);void 0!==this.source&&this.disconnect(this.source,"change",this.onSourceChange);void 0!==this.destination&&this.disconnect(this.destination,
"change",this.onDestinationChange)}},{style:{background:"rgba(250, 250, 250, 0)"}});
Ui.Dialog.extend("Wn.ContactMessagesDialog",{user:void 0,contact:void 0,message:void 0,messagesView:void 0,startMessageId:-1,messageRequest:void 0,messages:void 0,transBox:void 0,messagesPart:void 0,videoconfPart:void 0,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;"message"in a&&(this.message=a.message,delete a.message);this.setFullScrolling(!1);this.setTitle("Messages");this.setPreferredWidth(600);this.setPreferredHeight(600);this.setCancelButton(new Ui.DialogCloseButton);
this.transBox=new Ui.TransitionBox;this.setContent(this.transBox);this.messagesPart=new Ui.ScrollingArea;a=new Ui.VBox({margin:10,spacing:10});this.messagesPart.setContent(a);a.append(new Wn.ContactNewMessage({user:this.user,contact:this.contact}));this.messagesView=new Ui.VBox({spacing:15});a.append(this.messagesView);a=new Ui.SegmentBar({field:"text",data:[{text:"Texte",type:"text"},{text:"Appel vid\u00e9o",type:"video"}]});this.setActionButtons([a]);this.connect(a,"change",this.onSegmentBarChange);
void 0!==this.message?a.setCurrentPosition(1):a.setCurrentPosition(0);this.updateMessages()},onSegmentBarChange:function(a,b){"video"===b.type?void 0!==this.message?this.transBox.replaceContent(new Wn.VideoConfView({user:this.user,contact:this.contact,message:this.message})):this.transBox.replaceContent(new Wn.VideoConfView({user:this.user,contact:this.contact})):this.transBox.replaceContent(this.messagesPart)},updateMessages:function(){void 0!==this.messagesRequest&&(this.disconnect(this.messagesRequest,
"done",this.onGetMessagesDone),this.disconnect(this.messagesRequest,"error",this.onGetMessagesError),this.messagesRequest.abort());this.messagesRequest=new Core.HttpRequest({url:"/cloud/message?limit=100&user="+this.user.getId()+"&with="+this.contact.getId()});this.connect(this.messagesRequest,"done",this.onGetMessagesDone);this.connect(this.messagesRequest,"error",this.onGetMessagesError);this.messagesRequest.send()},onGetMessagesDone:function(){var a=this.messagesRequest.getResponseJSON();this.messages=
[];for(var b=0;b<a.length;b++)this.messages.push(new Wn.Message({message:a[b]}));this.updateMessagesView();this.messagesRequest=void 0},onGetMessagesError:function(){this.messagesRequest=void 0},findMessageView:function(a){for(var b=0;b<this.messagesView.getChildren().length;b++)if(Wn.UserMessageView.hasInstance(this.messagesView.getChildren()[b])&&this.messagesView.getChildren()[b].getMessage().getId()==a.getId())return this.messagesView.getChildren()[b]},updateMessagesView:function(){if(void 0!==
this.messages){for(var a=[],b=this.messages,c,d=b.length-1;0<=d;d--){var e=void 0,f=b[d].getDate();void 0!==c&&(c.getFullYear()!=f.getFullYear()?(e=new Ui.HBox({spacing:10}),e.append(new Ui.Label({text:c.getFullYear(),fontSize:14,fontWeight:"bold"})),e.append(new Ui.Separator({verticalAlign:"center"}),!0)):c.getMonth()!=f.getMonth()&&(e=new Ui.HBox({spacing:10}),e.append(new Ui.Separator({verticalAlign:"center",width:10})),e.append(new Ui.Label({text:"Janvier F\u00e9vrier Mars Avril Mai Juin Juillet Ao\u00fbt Septembre Octobre Novembre D\u00e9cembre".split(" ")[c.getMonth()],
fontSize:12})),e.append(new Ui.Separator({verticalAlign:"center"}),!0)));c=f;"comment"!=b[d].getType()&&(b[d].getOrigin()===this.user.getId()?b[d].getDestination()==this.contact.getId()&&(f=this.findMessageView(b[d]),void 0==f&&(void 0!==e&&this.messagesView.prepend(e),f=new Wn.UserMessageView({user:this.user,message:b[d],dialog:this,showDestination:!1}),this.messagesView.prepend(f))):b[d].getOrigin()===this.contact.getId()&&(f=this.findMessageView(b[d]),void 0==f&&(void 0!==e&&this.messagesView.prepend(e),
f=new Wn.UserMessageView({user:this.user,message:b[d],dialog:this,showDestination:!1}),this.messagesView.prepend(f),!b[d].getSeen()&&"message"===b[d].getType()&&a.push(b[d]))))}for(d=0;d<a.length;d++)a[d].markSeen()}},onMessagesChange:function(){if(void 0!==this.messages){for(var a=this.user.getMessages(),b=a.length-1;0<=b;b--){for(var c=a[b],d=void 0,e=0;void 0===d&&e<this.messages.length;e++)this.messages[e].getId()===c.getId()&&(d=this.messages[e]);void 0===d&&this.messages.unshift(c)}this.updateMessagesView()}}},
{onLoad:function(){Wn.ContactMessagesDialog.base.onLoad.apply(this,arguments);this.connect(this.user,"messageschange",this.onMessagesChange)},onUnload:function(){Wn.ContactMessagesDialog.base.onUnload.apply(this,arguments);this.disconnect(this.user,"messageschange",this.onMessagesChange)}});Wn.UserMessageView.extend("Wn.UserNotifyView",{constructor:function(a){this.setAllowMessage(!0)}});
Ui.ScrollLoader.extend("Wn.MessagesLoader",{user:void 0,dialog:void 0,data:void 0,filteredData:void 0,constructor:function(a){this.user=a.user;delete a.user;this.dialog=a.dialog;delete a.dialog;this.data=a.data;delete a.data;this.filteredData=this.data},testFilter:function(a,b){for(var c=!0,d=0;c&&d<a.length;d++)c=-1!==b.indexOf(a[d]);return c},setFilter:function(a){var b;if(void 0!==a&&""!==a){b=a.split(" ");for(a=0;a<b.length;a++)b[a]=b[a].toLowerCase().toNoDiacritics()}this.filteredData=[];for(a=
0;a<this.data.length;a++){var c=this.data[a];void 0===b?this.filteredData.push(c):this.testFilter(b,c.getSearchText())&&this.filteredData.push(c)}this.fireEvent("change")}},{getMin:function(){return 0},getMax:function(){return this.filteredData.length-1},getElementAt:function(a){if(!(a>this.filteredData.length-1))return this.filteredData[a].getOrigin()===this.user.getId()?new Wn.UserMessageView({user:this.user,message:this.filteredData[a],dialog:this.dialog,showSource:!1,marginBottom:20}):new Wn.UserMessageView({user:this.user,
message:this.filteredData[a],dialog:this.dialog,showDestination:!1,marginBottom:20})}});
Ui.VBox.extend("Wn.HistoryMessages",{user:void 0,limit:250,messagesView:void 0,startMessageId:-1,messageRequest:void 0,messages:void 0,filter:void 0,isReady:!1,constructor:function(a){this.addEvents("ready");this.user=a.user;delete a.user;"limit"in a&&(this.limit=a.limit,delete a.limit);this.updateMessages()},testFilter:function(a,b){for(var c=!0,d=0;c&&d<a.length;d++)c=-1!==b.indexOf(a[d]);return c},setFilter:function(a){var b;if(void 0!==a&&""!==a){b=a.split(" ");for(a=0;a<b.length;a++)b[a]=b[a].toLowerCase()}for(a=
0;a<this.getChildren().length;a++){var c=this.getChildren()[a];void 0===b?c.show():Wn.UserMessageView.hasInstance(c)?this.testFilter(b,c.getSearchText().toLowerCase())?c.show():c.hide(!0):c.hide(!0)}},updateMessages:function(){void 0!==this.messagesRequest&&(this.disconnect(this.messagesRequest,"done",this.onGetMessagesDone),this.disconnect(this.messagesRequest,"error",this.onGetMessagesError),this.messagesRequest.abort());this.messagesRequest=new Core.HttpRequest({url:"/cloud/message?limit="+this.limit+
"&user="+this.user.getId()});this.connect(this.messagesRequest,"done",this.onGetMessagesDone);this.connect(this.messagesRequest,"error",this.onGetMessagesError);this.messagesRequest.send()},onGetMessagesDone:function(){var a=this.messagesRequest.getResponseJSON();this.messages=[];for(var b=0;b<a.length;b++)this.messages.push(new Wn.Message({message:a[b]}));this.updateMessagesView();this.messagesRequest=void 0;this.isReady||(this.isReady=!0,new Core.DelayedTask({delay:0.1,scope:this,callback:function(){this.fireEvent("ready")}}))},
onGetMessagesError:function(){this.messagesRequest=void 0},findMessageView:function(a){for(var b=0;b<this.getChildren().length;b++)if(Wn.UserMessageView.hasInstance(this.getChildren()[b])&&this.getChildren()[b].getMessage().getId()==a.getId())return this.getChildren()[b]},updateMessagesView:function(){if(void 0!==this.messages)for(var a=this.messages,b,c=a.length-1;0<=c;c--)if("comment"!=a[c].getType()&&a[c].getSeen()){var d=a[c].getDate();if(void 0!==b)if(b.getFullYear()!=d.getFullYear()){var e=
new Ui.HBox({spacing:10});e.append(new Ui.Label({text:b.getFullYear(),fontSize:14,fontWeight:"bold"}));e.append(new Ui.Separator({verticalAlign:"center"}),!0);this.prepend(e)}else b.getMonth()!=d.getMonth()&&(e=new Ui.HBox({spacing:10}),e.append(new Ui.Separator({verticalAlign:"center",width:10})),e.append(new Ui.Label({text:"Janvier F\u00e9vrier Mars Avril Mai Juin Juillet Ao\u00fbt Septembre Octobre Novembre D\u00e9cembre".split(" ")[b.getMonth()],fontSize:12})),e.append(new Ui.Separator({verticalAlign:"center"}),
!0),this.prepend(e));b=d;d=this.findMessageView(a[c]);a[c].getOrigin()===this.user.getId()?void 0==d&&(d=new Wn.UserMessageView({user:this.user,message:a[c],dialog:this,showSource:!1}),this.prepend(d)):void 0==d&&(d=new Wn.UserMessageView({user:this.user,message:a[c],dialog:this,showDestination:!1}),this.prepend(d))}},onMessagesChange:function(){if(void 0!==this.messages){for(var a=this.user.getMessages(),b=a.length-1;0<=b;b--){for(var c=a[b],d=void 0,e=0;void 0===d&&e<this.messages.length;e++)this.messages[e].getId()===
c.getId()&&(d=this.messages[e]);void 0===d&&this.messages.unshift(c)}this.updateMessagesView()}}},{onLoad:function(){Wn.HistoryMessages.base.onLoad.apply(this,arguments);this.connect(this.user,"messageschange",this.onMessagesChange)},onUnload:function(){Wn.HistoryMessages.base.onUnload.apply(this,arguments);this.disconnect(this.user,"messageschange",this.onMessagesChange)}});
Ui.Dialog.extend("Wn.HistoryMessagesDialog",{messagesView:void 0,messagesLoader:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setPreferredWidth(600);this.setPreferredHeight(600);this.setTitle("Historique des messages");this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.TextButtonField({buttonIcon:"search",width:150});this.connect(a,"validate",this.onSearchValidate);Ui.Box.setResizable(a,!0);this.setActionButtons([a]);a=new Core.HttpRequest({url:"/cloud/message?limit=5000&user="+
this.user.getId()});this.connect(a,"done",function(a){a=a.getResponseJSON();for(var c=[],d=0;d<a.length;d++){var e=new Wn.Message({message:a[d]});"comment"!=e.getType()&&c.push(e)}this.messagesLoader=new Wn.MessagesLoader({user:this.user,dialog:this,data:c});a=new Ui.VBoxScrollingArea({loader:this.messagesLoader});this.setContent(a)});a.send()},onSearchValidate:function(a,b){void 0!==this.messagesLoader&&this.messagesLoader.setFilter(b)}});
Ui.Popup.extend("Wn.HistoryMessagesPopup",{user:void 0,contact:void 0,notifyView:void 0,noNotifyMessage:void 0,messagesView:void 0,startMessageId:-1,constructor:function(a){this.user=a.user;delete a.user;this.setPreferredWidth(400);this.setPreferredHeight(400);a=new Ui.VBox({margin:10,spacing:10});this.setContent(a);a.append(new Ui.Text({text:"Notifications",fontWeight:"bold"}));this.notifyView=new Ui.VBox({spacing:10});a.append(this.notifyView);this.noNotifyMessage=new Ui.Text({margin:15,textAlign:"center",
text:"il n'y a pas de nouveau message"});this.noNotifyMessage.hide(!0);a.append(this.noNotifyMessage);this.markAllSeenButton=new Ui.DefaultButton({icon:"done",text:"Tout valider",horizontalAlign:"right"});this.markAllSeenButton.hide(!0);this.connect(this.markAllSeenButton,"press",this.onMarkAllSeenPress);a.append(this.markAllSeenButton);a.append(new Ui.Text({text:"Messages anciens",fontWeight:"bold"}));this.messagesView=new Ui.VBox({spacing:20});a.append(this.messagesView);var b=new Ui.DefaultButton({text:"Plus de messages...",
marginBottom:10});this.connect(b,"press",this.onMorePress);a.append(b)},findNotifyView:function(a){for(var b=0;b<this.notifyView.getChildren().length;b++)if(Wn.UserNotifyView.hasInstance(this.notifyView.getChildren()[b])&&this.notifyView.getChildren()[b].getMessage().getId()==a.getId())return this.notifyView.getChildren()[b]},findMessageView:function(a){for(var b=0;b<this.messagesView.getChildren().length;b++)if(Wn.UserMessageView.hasInstance(this.messagesView.getChildren()[b])&&this.messagesView.getChildren()[b].getMessage().getId()==
a.getId())return this.messagesView.getChildren()[b]},updateNotifyView:function(){for(var a=this.user.getMessages(),b=0,c=a.length-1;0<=c;c--)if(!a[c].getSeen()&&a[c].getOrigin()!==this.user.getId()){var d=this.findNotifyView(a[c]);void 0===d&&(d=a[c].getOrigin()===this.user.getId()?new Wn.UserNotifyView({user:this.user,message:a[c],dialog:this,showSource:!1}):new Wn.UserNotifyView({user:this.user,message:a[c],dialog:this,showDestination:!1}),this.notifyView.prepend(d),b++)}a=[];for(c=0;c<this.notifyView.getChildren().length;c++)b=
this.notifyView.getChildren()[c],Wn.UserNotifyView.hasInstance(b)&&b.getMessage().getSeen()&&a.push(this.notifyView.getChildren()[c]);for(c=0;c<a.length;c++)this.notifyView.remove(a[c]);0===this.notifyView.getChildren().length?(this.noNotifyMessage.show(),this.markAllSeenButton.hide(!0)):(this.noNotifyMessage.hide(!0),this.markAllSeenButton.show())},updateMessagesView:function(){for(var a=this.user.getMessages(),b=a.length-1;0<=b;b--)if("comment"!=a[b].getType()&&a[b].getSeen()){var c=this.findMessageView(a[b]);
a[b].getOrigin()===this.user.getId()?void 0==c&&(c=new Wn.UserMessageView({user:this.user,message:a[b],dialog:this,showSource:!1}),this.messagesView.prepend(c)):void 0==c&&(c=new Wn.UserMessageView({user:this.user,message:a[b],dialog:this,showDestination:!1}),this.messagesView.prepend(c))}},onMessagesChange:function(){this.updateNotifyView();this.updateMessagesView()},onMarkAllSeenPress:function(){for(var a=0;a<this.user.getMessages().length;a++){var b=this.user.getMessages()[a];b.getDestination()===
this.user.getId()&&!b.getSeen()&&b.markSeen()}},onMorePress:function(){this.hide();(new Wn.HistoryMessagesDialog({user:this.user})).open()}},{onLoad:function(){Wn.HistoryMessagesPopup.base.onLoad.apply(this,arguments);this.connect(this.user,"messageschange",this.onMessagesChange);this.onMessagesChange()},onUnload:function(){Wn.HistoryMessagesPopup.base.onUnload.apply(this,arguments);this.disconnect(this.user,"messageschange",this.onMessagesChange)}});Ui.CanvasElement.extend("Wn.BarGraph",{data:void 0,xAxis:void 0,minY:void 0,maxY:void 0,xAxisLabel:void 0,yAxisLabel:void 0,constructor:function(a){this.data=a.data;delete a.data;this.xAxis=a.xAxis;delete a.xAxis;this.xAxisLabel=a.xAxisLabel;delete a.xAxisLabel;this.yAxisLabel=a.yAxisLabel;delete a.yAxisLabel;for(a=0;a<this.data.length;a++){var b=this.data[a];if(void 0===this.minY||b<this.minY)this.minY=b;if(void 0===this.maxY||b>this.maxY)this.maxY=b}}},{updateCanvas:function(a){for(var b=this.getLayoutWidth(),
c=this.getLayoutHeight(),d=(b-40)/this.xAxis.length,e=this.maxY,f=0;10<e;)e/=10,f++;e=Math.pow(10,f+1);e>2*this.maxY&&(e/=2);e>2*this.maxY&&(e/=2);a.fillStyle=Ui.Color.create(this.getStyleProperty("foreground")).getCssRgba();a.font="normal 10px Sans-Serif";a.textBaseline="top";a.textAlign="center";a.fillRect(40,c-20,b-40,1);for(f=0;f<this.xAxis.length;f++){var g=this.xAxis[f];a.fillText(g,40+f*d+d/2,c-20+4,d);0<f&&a.fillRect(40+f*d,c-20,1,4)}a.textBaseline="middle";a.textAlign="right";for(f=0;5>f;f++)g=
e*f/5,a.fillText(g,36,c-20-(c-40)*f/5),a.fillRect(40,c-20-(c-40)*f/5,b-40,1);a.fillStyle=Ui.Color.create(this.getStyleProperty("barColor")).getCssRgba();for(f=0;f<this.data.length;f++)b=(c-40)*this.data[f]/e,g=d/2,a.fillRect(40+d*f+d/2-g/2,20+(c-40)-b,g,b)},onStyleChange:function(){this.invalidateDraw()}},{style:{foreground:"black",barColor:"#88c888"}});
Wn.OptionSection.extend("Wn.UserStatsSection",{contact:void 0,constructor:function(a){this.contact=a.contact;delete a.contact;this.setTitle("Statistiques d'utilisation");this.setContent(new Wn.UserStats({contact:this.contact}))}});
Ui.LBox.extend("Wn.UserStats",{contact:void 0,logs:void 0,cbox:void 0,constructor:function(a){this.contact=a.contact;delete a.contact;a=void 0!==this.contact?new Core.HttpRequest({method:"GET",url:"/cloud/pathlog?user="+this.contact.getId()+"&limit=100000"}):new Core.HttpRequest({method:"GET",url:"/cloud/pathlog?limit=10000000"});this.connect(a,"done",this.onRequestDone);this.connect(a,"error",this.onRequestError);a.send()},formatDate:function(a){var b="",b=10>a.getDate()?b+("0"+a.getDate()):b+a.getDate(),
b=b+"/",b=10>a.getMonth()+1?b+("0"+(a.getMonth()+1)):b+(a.getMonth()+1),b=b+("/"+a.getFullYear()+" "),b=10>a.getHours()?b+("0"+a.getHours()):b+a.getHours(),b=b+":",b=10>a.getMinutes()?b+("0"+a.getMinutes()):b+a.getMinutes(),b=b+":";return b=10>a.getSeconds()?b+("0"+a.getSeconds()):b+a.getSeconds()},onRequestDone:function(a){this.logs=a.getResponseJSON();this.cbox=new Ui.VBox;this.setContent(this.cbox);this.cbox.append(new Ui.Text({text:"Les 20 derniers \u00e9v\u00e8nements",textAlign:"left"}));for(a=
0;a<Math.min(20,this.logs.length);a++){var b=this.logs[a],c=new Date(1E3*b.create),d=new Ui.HBox;this.cbox.append(d);d.append(new Ui.Text({textAlign:"right",text:this.formatDate(c),width:180,margin:2,marginRight:10}));d.append(new Ui.Text({textAlign:"left",text:b.path,margin:2}),!0)}this.hourActivity();this.dayActivity();this.monthActivity()},onRequestError:function(a){this.setContent(new Ui.Text({text:"Erreur lors de la r\u00e9cup\u00e9ration des logs..."}))},hourActivity:function(){for(var a=new Date((new Date).getTime()-
6048E5),b=[],c=[],d=0;24>d;d++)b.push(0),c.push(d+"h");for(var e=0,d=0;d<this.logs.length;d++){var f=new Date(1E3*this.logs[d].create);if(f<a)break;b[f.getHours()]++;e++}this.cbox.append(new Ui.Text({text:"Activit\u00e9 par heure sur une semaine glissante ("+e+")",textAlign:"left"}));this.cbox.append(new Wn.BarGraph({xAxis:c,data:b,height:250,marginBottom:20}))},dayToString:function(a){if(0===a)return"dim";if(1===a)return"lun";if(2===a)return"mar";if(3===a)return"mer";if(4===a)return"jeu";if(5===
a)return"ven";if(6===a)return"sam"},dayActivity:function(){for(var a=new Date,b=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),b=new Date(b.getTime()+864E5),c=new Date(b.getTime()-6048E5),b={},d=[],e=[],f=0;7>f;f++){var g=new Date(a.getTime()+864E5*(f-6));b[g.getDay()]=0;e.push(g.getDay());d.push(this.dayToString(g.getDay()))}for(f=a=0;f<this.logs.length;f++){g=new Date(1E3*this.logs[f].create);if(g<c)break;b[g.getDay()]++;a++}c=[];for(f=0;f<e.length;f++)c.push(b[e[f]]);this.cbox.append(new Ui.Text({text:"Activit\u00e9 par jour sur une semaine glissante ("+
a+")",textAlign:"left"}));this.cbox.append(new Wn.BarGraph({xAxis:d,data:c,height:250,marginBottom:20}))},monthToString:function(a){if(0===a)return"jan";if(1===a)return"fev";if(2===a)return"mar";if(3===a)return"avr";if(4===a)return"mai";if(5===a||6===a)return"jui";if(7===a)return"aou";if(8===a)return"sep";if(9===a)return"oct";if(10===a)return"nov";if(11===a)return"dec"},monthActivity:function(){var a=new Date;a.getFullYear();a.getMonth();var b;b=11==a.getMonth()?new Date(a.getFullYear()+1,0,1,0,0,
0,0):new Date(a.getFullYear(),a.getMonth()+1,1,0,0,0,0);var c=new Date(b.getTime()-31536E6);b={};for(var d=[],e=[],f=0;12>f;f++){var g=(a.getMonth()-11+f+12)%12;b[g]=0;e.push(g);d.push(this.monthToString(g))}for(f=a=0;f<this.logs.length;f++){g=new Date(1E3*this.logs[f].create);if(g<c)break;b[g.getMonth()]++;a++}c=[];for(f=0;f<e.length;f++)c.push(b[e[f]]);this.cbox.append(new Ui.Text({text:"Utilisation sur l'ann\u00e9e ("+a+")",textAlign:"left"}));this.cbox.append(new Wn.BarGraph({xAxis:d,data:c,height:250,
marginBottom:20}))}});
Ui.LBox.extend("Wn.ClientsList",{request:void 0,constructor:function(a){this.request=new Core.HttpRequest({url:"/cloud/status/clients"});this.connect(this.request,"done",this.onRequestDone);this.connect(this.request,"error",this.onRequestError);this.request.send()},onRequestDone:function(){var a=this.request.getResponseJSON(),b=new Ui.ListView({headers:[{type:"string",title:"WS",key:"websocket"},{type:"string",title:"Address",key:"remote"},{type:"string",title:"User",key:"user"},{type:"string",title:"Path",
key:"path"},{type:"string",title:"Uptime",key:"uptime"},{type:"string",title:"Read",key:"readcounter"},{type:"string",title:"Write",key:"writecounter"},{type:"string",title:"Requests",key:"requestcounter"},{type:"string",title:"User-Agent",key:"user-agent"}]});b.setData(a);this.setContent(b)},onRequestError:function(){this.setContent(new Ui.Text({margin:20,textAlign:"center",text:"Erreur au chargement des donn\u00e9es"}))}});
Ui.LBox.extend("Wn.TasksList",{request:void 0,constructor:function(a){this.request=new Core.HttpRequest({url:"/cloud/status/tasks"});this.connect(this.request,"done",this.onRequestDone);this.connect(this.request,"error",this.onRequestError);this.request.send()},onRequestDone:function(){var a=this.request.getResponseJSON(),b=new Ui.ListView({headers:[{type:"string",title:"Id",key:"id"},{type:"string",title:"Owner",key:"owner"},{type:"string",title:"Status",key:"status"},{type:"string",title:"Priority",
key:"priority"},{type:"string",title:"Description",key:"description"}]});b.setData(a);this.setContent(b)},onRequestError:function(){this.setContent(new Ui.Text({margin:20,textAlign:"center",text:"Erreur au chargement des donn\u00e9es"}))}});
Ui.Dialog.extend("Wn.UserStatsDialog",{constructor:function(a){this.setTitle("Outils d'administration");this.setFullScrolling(!0);this.setPreferredWidth(900);this.setPreferredHeight(600);this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.SegmentBar({field:"text",data:[{text:"Clients",type:"clients"},{text:"T\u00e2ches",type:"tasks"},{text:"Stats",type:"stats"}]});this.connect(a,"change",this.onSegmentBarChange);this.setActionButtons([a]);a.setCurrentPosition(0)},onSegmentBarChange:function(a,
b,c){"stats"===b.type?this.setContent(new Wn.UserStats):"clients"===b.type?this.setContent(new Wn.ClientsList):"tasks"===b.type&&this.setContent(new Wn.TasksList)}});Ui.LBox.extend("Wn.ContactSharesView",{user:void 0,contact:void 0,shares:void 0,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.contact.update()},onContactChange:function(){var a=this.contact.getResources();if(this.contact.getIsResourcesLoaded())if(0===a.length)this.setContent(new Ui.Text({fontSize:20,text:"Ce contact ne partage pas de ressources avec vous",margin:20,textAlign:"center",verticalAlign:"center"})),this.shares=void 0;else{void 0===this.shares&&
(this.shares=new Ui.SFlow({uniform:!0,itemAlign:"stretch",margin:40,spacing:40}),this.setContent(this.shares));for(var b=[],c=[],d=0;d<this.shares.getChildren().length;d++){for(var e=this.shares.getChildren()[d],f=!1,g=0;!1===f&&g<a.length;g++)f=e.getResource().getId()===a[g].getId();f||b.push(e)}for(d=0;d<a.length;d++){e=a[d];f=!1;for(g=0;!1===f&&g<this.shares.getChildren().length;g++)f=e.getId()===this.shares.getChildren()[g].getResource().getId();f||c.push(e)}for(d=0;d<b.length;d++)this.shares.remove(b[d]);
if(0<c.length)for(d=0;d<c.length;d++)if(c[d].getIsReady())this.onAddNewResourceReady(c[d]);else this.connect(c[d],"ready",this.onAddNewResourceReady)}else this.setContent(new Ui.Text({fontSize:20,text:"Chargement en cours...",margin:20,textAlign:"center",verticalAlign:"center"}))},onAddNewResourceReady:function(a){var b=Wn.ResourceView.getView(a.getType());void 0===b&&(b=Wn.ResourceView);a=new b({user:this.user,contact:this.contact,resource:a,width:180,height:220});void 0!==this.shares&&this.shares.append(a)}},
{onLoad:function(){Wn.ContactSharesView.base.onLoad.call(this);this.connect(this.contact,"change",this.onContactChange);if(this.contact.getIsReady())this.onContactChange()},onUnload:function(){Wn.ContactSharesView.base.onUnload.call(this);this.disconnect(this.contact,"change",this.onContactChange)}});
Ui.LBox.extend("Wn.ContactView",{user:void 0,contact:void 0,contentbox:void 0,actions:void 0,constructor:function(a){this.addEvents("change");this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.actions=[];a=new Ui.VBox;this.setContent(a);var b=new Ui.Button({icon:"bubble",text:"Message"});this.connect(b,"press",this.onMessagesPress);this.actions.push(b);b=new Ui.ScrollingArea({scrollHorizontal:!1});a.append(b,!0);b.setContent(new Wn.ContactSharesView({user:this.user,contact:this.contact}),
!0);this.user.watchContact(this.contact)},getTitle:function(){return this.contact.getName()},getActions:function(){return this.actions},onProfilPress:function(){(new Wn.UserProfil({user:this.contact})).open()},onMessagesPress:function(){(new Wn.ContactMessagesDialog({user:this.user,contact:this.contact})).open()},onContactChange:function(){this.fireEvent("change",this)}},{onLoad:function(){Wn.ContactView.base.onLoad.call(this);this.connect(this.contact,"change",this.onContactChange);if(this.contact.getIsReady())this.onContactChange()},
onUnload:function(){Wn.ContactView.base.onUnload.call(this);this.disconnect(this.contact,"change",this.onContactChange)}});Core.Object.extend("Wn.User",{id:void 0,user:void 0,resources:void 0,contacts:void 0,bookmarks:void 0,userRequest:void 0,userSocket:void 0,userSocketAlive:!1,userRetryTask:void 0,monitor:!0,serverVersion:void 0,watchedResource:void 0,isReady:!1,messages:void 0,messagesRequest:void 0,constructor:function(a){this.addEvents("ready","delete","change","messageschange","serverchange","order","call");this.user=a.user;delete a.user;this.id=this.user.id;"monitor"in a&&(this.monitor=a.monitor,delete a.monitor);
this.resources=[];this.contacts=[];this.bookmarks=[];this.monitor?(this.startUserMonitoring(),this.updateUserData(this.user)):this.updateUser();this.messages=[];this.updateMessages()},getName:function(){return this.getIsReady()?null===this.getData().firstname&&null===this.getData().lastname&&null===this.getData().login?"":null===this.getData().firstname&&null===this.getData().lastname?this.getData().login:null===this.getData().firstname?this.getData().lastname:null===this.getData().lastname?this.getData().firstname:
this.getData().firstname+" "+this.getData().lastname:""},getIsReady:function(){return this.isReady},getUser:function(){return this.user},getData:function(){return this.user},getId:function(){return this.id},getLogin:function(){return this.user.login},getFaceUrl:function(){return"/cloud/user/"+this.id+"/face?rev="+this.user.face_rev},isAdmin:function(){return this.user.admin},getBookmarks:function(){return this.bookmarks},getResources:function(){return this.resources},getRfidsFromPath:function(a){var b=
[];if(void 0!==this.user.rfids)for(var c=0;c<this.user.rfids.length;c++){var d=this.user.rfids[c];d.path==a&&b.push(d.id)}return b},getRfidPath:function(a){if(void 0!==this.user.rfids)for(var b=0;b<this.user.rfids.length;b++){var c=this.user.rfids[b];if(c.id==a)return c.path}},watchResource:function(a){this.watchedContact=void 0;this.watchedResource=a;this.userSocketAlive&&this.userSocket.send(JSON.stringify({type:"watch",resource:this.watchedResource.getId()}))},watchContact:function(a){this.watchedResource=
void 0;this.watchedContact=a;this.userSocketAlive&&this.userSocket.send(JSON.stringify({type:"watch",resource:this.watchedContact.getId()}))},getResource:function(a){for(var b=0;b<this.resources.length;b++)if(this.resources[b].getId()===a)return this.resources[b]},getResourceAndPathFromData:function(a){var b=void 0,c=void 0,d=a.indexOf(":");if(-1!==d){c=a.substring(0,d);a=a.substring(d+1);for(var e=d=void 0,f=0;void 0===d&&f<this.resources.length;f++)b=this.resources[f],b.getType()==c&&0==a.search(b.getData())&&
(d=b,a.length!=b.getData().length&&(e=a.substring(b.getData().length)));b=d;c=e}return{resource:b,path:c}},getContacts:function(){return this.contacts},getContact:function(a){for(var b=void 0,c=0;void 0===b&&c<this.contacts.length;c++)this.contacts[c].getId()===a&&(b=this.contacts[c]);return b},addContacts:function(a){for(var b=[],c=0;c<a.length;c++)b.push({id:a[c].getId()});(new Core.HttpRequest({method:"POST",url:"/cloud/user/"+this.id+"/contacts",content:JSON.stringify(b)})).send();this.userSocketAlive||
this.updateUser()},prependContacts:function(a){for(var b=[],c=0;c<a.length;c++)b.push({id:a[c].getId(),position:c});(new Core.HttpRequest({method:"POST",url:"/cloud/user/"+this.id+"/contacts",content:JSON.stringify(b)})).send();this.userSocketAlive||this.updateUser()},prependContact:function(a){this.prependContacts([a])},addContact:function(a){this.addContacts([a])},removeContacts:function(a){for(var b=0;b<a.length;b++)(new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.id+"/contacts/"+
a[b].getId()})).send();this.userSocketAlive||this.updateUser()},removeContact:function(a){this.removeContacts([a])},removeResource:function(a){a.deleteResource();this.userSocketAlive||this.updateUser()},createResource:function(a){(new Core.HttpRequest({method:"POST",url:"/cloud/user/"+this.id+"/resources",content:JSON.stringify(a)})).send();this.userSocketAlive||this.updateUser()},bookmarkResource:function(a){a=Wn.Resource.hasInstance(a)?a.getId():"id"in a?a.id:a;(new Core.HttpRequest({method:"POST",
url:"/cloud/user/"+this.id+"/bookmarks",content:JSON.stringify({resource:a})})).send();this.userSocketAlive||this.updateUser()},unbookmarkResource:function(a){a=Wn.Resource.hasInstance(a)?a.getId():"id"in a?a.id:a;(new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.id+"/bookmarks/"+a})).send();this.userSocketAlive||this.updateUser()},setBookmarkPosition:function(a,b){var c;Wn.Resource.hasInstance(a)?c=a.getId():"id"in a?(c=a.id,void 0==b&&"position"in a&&(b=a.position)):c=a;(new Core.HttpRequest({method:"PUT",
url:"/cloud/user/"+this.id+"/bookmarks/"+c,content:JSON.stringify({position:b})})).send();this.userSocketAlive||this.updateUser()},setContactPosition:function(a,b){var c;Wn.Contact.hasInstance(a)?c=a.getId():"id"in a?(c=a.id,void 0==b&&"position"in a&&(b=a.position)):c=a;(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.id+"/contacts/"+c,content:JSON.stringify({position:b})})).send();this.userSocketAlive||this.updateUser()},getWallpaper:function(){if(null!==this.user.data&&void 0!==this.user.data&&
void 0!==this.user.data.wallpaper&&null!==this.user.data.wallpaper)return this.user.data.wallpaper;var a=Ui.App.current.getThemeWallpaper(this.getTheme());return void 0!==a?a:"default.jpeg"},setWallpaper:function(a){this.changeData({wallpaper:a})},getTheme:function(){return null!==this.user.data&&void 0!==this.user.data&&void 0!==this.user.data.theme?this.user.data.theme:"default"},setTheme:function(a){this.changeData({theme:a})},getCustomTheme:function(){if(null!==this.user.data&&void 0!==this.user.data&&
void 0!==this.user.data.theme)return this.user.data.customTheme},setCustomTheme:function(a){this.changeData({customTheme:a})},changeData:function(a){var b;b=null!==this.user.data&&void 0!==this.user.data?this.user.data:{};for(var c in a)b[c]=a[c];this.data=b;(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.id,content:JSON.stringify({data:b})})).send()},updateUser:function(){void 0===this.userRequest&&(this.userRequest=new Core.HttpRequest({url:"/cloud/user/"+this.id}),this.connect(this.userRequest,
"done",this.onGetUserDone),this.connect(this.userRequest,"error",this.onGetUserError),this.userRequest.send())},startUserMonitoring:function(){void 0===this.userSocket&&(this.userSocket=new Core.Socket({service:"/cloud/user/"+this.id}),this.connect(this.userSocket,"message",this.onUserMessageReceived),this.connect(this.userSocket,"open",this.onUserSocketOpen),this.connect(this.userSocket,"error",this.onUserSocketError),this.connect(this.userSocket,"close",this.onUserSocketClose))},onUserSocketOpen:function(){this.userSocketAlive=
!0;this.updateUser();void 0!==this.watchedResource&&this.userSocket.send(JSON.stringify({type:"watch",resource:this.watchedResource.getId()}))},onUserSocketError:function(){this.userSocketAlive=!1;this.userSocket.close()},onUserSocketClose:function(){this.userSocketAlive=!1;this.disconnect(this.userSocket,"open",this.onUserSocketOpen);this.disconnect(this.userSocket,"message",this.onUserMessageReceived);this.disconnect(this.userSocket,"error",this.onUserSocketError);this.disconnect(this.userSocket,
"close",this.onUserSocketClose);this.userSocket=void 0;this.userRetryTask=new Core.DelayedTask({delay:5,scope:this,callback:this.startUserMonitoring})},onUserMessageReceived:function(a,b){b=JSON.parse(b);if("userchanged"===b.event)if(b.user==this.getId())this.updateUser();else if(null!==this.watchedContact&&void 0!==this.watchedContact&&this.watchedContact.getId()===b.user)this.watchedContact.update();else{var c=Wn.Contact.getContact(b.user,!0);void 0!==c&&c.update()}else if("resourcechanged"===b.event)null!==
this.watchedResource&&void 0!==this.watchedResource&&this.watchedResource.getId()===b.resource?this.watchedResource.update():(c=Wn.Resource.getResource(b.resource,this,!0),void 0!==c&&c.update());else if("userdisconnected"===b.event)c=Wn.Contact.getContact(b.user,!0),void 0!==c&&c.setIsOnline(!1);else if("userconnected"===b.event)c=Wn.Contact.getContact(b.user,!0),void 0!==c&&c.setIsOnline(!0);else if("messagereceived"===b.event)this.onMessagesMessageReceived(b.message);else"messagechanged"===b.event?
this.updateMessage(b.message):this.updateUser()},onGetUserError:function(a){404==a.getStatus()&&this.fireEvent("delete",this);this.userRequest=void 0},onGetUserDone:function(a){void 0===this.serverVersion?this.serverVersion=a.getResponseHeader("Server"):this.serverVersion!=a.getResponseHeader("Server")&&(this.serverVersion=a.getResponseHeader("Server"),this.fireEvent("serverchange",this));a=a.getResponseJSON();this.updateUserData(a);this.userRequest=void 0},updateUserData:function(a){for(var b=[],
c=0;c<a.resources.length;c++){for(var d=void 0,e=0;void 0===d&&e<this.resources.length;e++)this.resources[e].getId()===a.resources[c].id&&(d=this.resources[e]);void 0!==d?d.updateData(a.resources[c]):d=new Wn.Resource({resource:a.resources[c],user:this});b.push(d)}this.resources=b;b=[];for(c=0;c<a.contacts.length;c++){d=void 0;for(e=0;void 0===d&&e<this.contacts.length;e++)this.contacts[e].getId()===a.contacts[c].id&&(d=this.contacts[e]);void 0!==d?d.updateData(a.contacts[c]):d=new Wn.Contact({contact:a.contacts[c],
user:this});b.push(d)}this.contacts=b;this.user=a;this.bookmarks=[];for(c=0;c<a.bookmarks.length;c++)this.bookmarks.push(Wn.Resource.getResource(a.bookmarks[c].resource,this));!1===this.isReady&&(this.isReady=!0,this.fireEvent("ready",this));this.fireEvent("change",this)},sendMessage:function(a,b,c){void 0===c&&(c="message");Wn.Contact.hasInstance(a)&&(a=a.getId());a=new Core.HttpRequest({method:"POST",url:"/cloud/message",content:JSON.stringify({content:b,type:c,origin:this.getId(),destination:a})});
"message"===c&&this.connect(a,"done",function(a){this.prependMessage(a.getResponseJSON())});a.send();return a},getMessages:function(){return this.messages},updateMessages:function(){void 0===this.messagesRequest&&(this.messagesRequest=new Core.HttpRequest({url:"/cloud/message?limit=50&user="+this.id}),this.connect(this.messagesRequest,"done",this.onGetMessagesDone),this.connect(this.messagesRequest,"error",this.onGetMessagesError),this.messagesRequest.send())},updateMessage:function(a){for(var b=
void 0,c=0;void 0===b&&c<this.messages.length;c++)a.id==this.messages[c].getMessage().id&&(b=this.messages[c]);void 0!==b&&(b.updateData(a),this.fireEvent("messageschange",this))},prependMessage:function(a){for(var b=void 0,c=0;void 0==b&&c<this.messages.length;c++)a.id==this.messages[c].getMessage().id&&(b=this.messages[c]);void 0!==b?b.updateData(a):this.messages.unshift(new Wn.Message({message:a}));this.fireEvent("messageschange",this)},onMessagesMessageReceived:function(a){"order"==a.type?this.fireEvent("order",
this,a):"rfid"==a.type?Ui.App.current.getRfidReader().fireEnter(a.content):"call"==a.type&&a.origin!==this.getId()?this.fireEvent("call",this,Wn.Contact.getContact(a.origin),a):this.prependMessage(a)},onGetMessagesError:function(a){this.messagesRequest=void 0},onGetMessagesDone:function(a){var b=[];a=a.getResponseJSON();for(var c=0;c<a.length;c++){for(var d=void 0,e=0;void 0==d&&e<this.messages.length;e++)a[c].id==this.messages[e].getMessage().id&&(d=this.messages[e]);void 0===d?d=new Wn.Message({message:a[c]}):
d.updateData(a[c]);b.push(d)}this.messages=b;this.fireEvent("messageschange",this);this.messagesRequest=void 0}});Core.Object.extend("Wn.Queue",{channel:void 0,socket:void 0,retryTask:void 0,stopped:!1,constructor:function(a){this.addEvents("open","message","close");this.channel=a.channel;delete a.channel;this.startMonitoring()},getChannel:function(){return this.channel},setChannel:function(a){this.channel!=a&&(this.channel=a,void 0!==this.socket&&(this.socket.close(),void 0!=this.retryTask&&this.retryTask.abort(),this.startMonitoring()))},sendMessage:function(a){this.socket.send(JSON.stringify(a))},startMonitoring:function(){this.socket=
new Core.Socket({service:"/cloud/queue/"+this.channel});this.connect(this.socket,"message",this.onMessageReceived);this.connect(this.socket,"open",this.onSocketOpen);this.connect(this.socket,"error",this.onSocketError);this.connect(this.socket,"close",this.onSocketClose)},onSocketOpen:function(){this.fireEvent("open",this)},onSocketError:function(){this.socket.close()},onSocketClose:function(){this.disconnect(this.socket,"message",this.onMessageReceived);this.disconnect(this.socket,"error",this.onSocketError);
this.disconnect(this.socket,"close",this.onSocketClose);this.socket=void 0;this.stopped?this.fireEvent("close",this):this.retryTask=new Core.DelayedTask({delay:5,scope:this,callback:this.startMonitoring})},onMessageReceived:function(a,b){this.fireEvent("message",this,JSON.parse(b))},close:function(){!this.stopped&&void 0!==this.socket&&(this.stopped=!0,this.socket.close())}});Wn.SelectionButton.extend("Wn.WebAccount",{user:void 0,constructor:function(a){this.addEvents("delete");this.user=a.user;delete a.user;this.setIcon("google")},getUser:function(){return this.user},setAccountIcon:function(a){this.setIcon(a)},"delete":function(){this.fireEvent("delete",this)},testDeleteRight:function(){var a=this.user.getData(),b=0;null!==a.login&&b++;null!==a.googleid&&b++;null!==a.facebookid&&b++;return 1<b}},{});
Ui.Dialog.extend("Wn.WebAccountNewDialog",{user:void 0,path:void 0,constructor:function(a){this.addEvents("done");this.user=a.user;delete a.user;this.setTitle("Nouveau compte Web");this.setPreferredWidth(400);this.setPreferredHeight(400);this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.VBox({spacing:5});this.setContent(a);var b=this.user.getData();if(null===b.login){var c=new Ui.Button({icon:"localaccount",text:"HOST",orientation:"horizontal"});this.connect(c,"press",this.onLocalPress);a.append(c)}null===
b.googleid&&(c=new Ui.Button({icon:"google",text:"Google",orientation:"horizontal"}),this.connect(c,"press",this.onGooglePress),a.append(c));null===b.facebookid&&(c=new Ui.Button({icon:"facebook",text:"Facebook",orientation:"horizontal"}),this.connect(c,"press",this.onFacebookPress),a.append(c))},onLocalPress:function(){var a=new Ui.VBox({spacing:10});this.setContent(a);var b=new Wn.TextField({title:"Identifiant"});a.append(b);passwordField=new Wn.TextField({title:"Mot de passe",passwordMode:!0});
a.append(passwordField);var c=new Ui.Text({color:"red"});c.hide();a.append(c);var d=void 0,e=new Ui.DefaultButton({text:"Cr\u00e9er"});this.connect(e,"press",function(){var a=new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify({login:b.getValue(),password:passwordField.getValue()})});this.connect(a,"done",function(){this.close();this.user.getData().login=b.getValue();this.fireEvent("done",this,new Wn.LocalAccount({user:this.user}))});this.connect(a,"error",
function(a){var b=a.getStatus(),f="Echec de la cr\u00e9ation. V\u00e9rifier vos donn\u00e9es";403==b?1==a.getResponseJSON().code&&(f="Echec: mot de passe trop faible"):409==b&&(f="Echec: identifiant d\u00e9j\u00e0 utilis\u00e9");void 0!==d&&d.abort();c.setText(f);c.show();d=new Core.DelayedTask({scope:this,delay:4,callback:function(){c.hide()}});this.getContent().enable();e.enable()});this.getContent().disable();e.disable();a.send()});this.setActionButtons([e])},onGooglePress:function(){this.setContent(new Ui.Text({verticalAlign:"center",
textAlign:"center",text:"En attente d'authorization..."}));var a=window.open("/cloud/googleoauth2/redirect?state=grant","googleoauth");this.connect(a,"unload",function(){this.close()})},onFacebookPress:function(){this.setContent(new Ui.Text({verticalAlign:"center",textAlign:"center",text:"En attente d'authorization..."}));var a=window.open("/cloud/facebookoauth2/redirect?state=grant","facebookoauth");this.connect(a,"unload",function(){this.close()})}});
Ui.Dialog.extend("Wn.GoogleAccountDialog",{user:void 0,account:void 0,constructor:function(a){this.user=a.user;delete a.user;this.account=a.account;delete a.account;this.setPreferredWidth(400);this.setTitle("Compte Google");this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);var b=new Ui.VBox({spacing:10});this.setContent(b);var c=new Ui.HBox({spacing:10});c.append(new Ui.Text({text:"Identifiant",textAlign:"right",verticalAlign:"center",
width:100}));c.append(new Ui.Text({text:this.user.getData().googleid}),!0);b.append(c);this.account.testDeleteRight()&&this.setActionButtons([a])},onDeletePress:function(){this.account["delete"]();this.close()}});
Wn.WebAccount.extend("Wn.GoogleAccount",{constructor:function(a){this.setAccountIcon("google");this.setText("Google")},onGoogleEdit:function(){(new Wn.GoogleAccountDialog({user:this.getUser(),account:this})).open()},onGoogleDelete:function(){this["delete"]()}},{"delete":function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.getUser().getId(),content:JSON.stringify({googleid:null})})).send();this.fireEvent("delete",this)},getSelectionActions:function(){return{"delete":{text:"Supprimer",
icon:"trash",color:"#d02020",testRight:this.testDeleteRight,scope:this,callback:this.onGoogleDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onGoogleEdit,multiple:!1}}}});
Ui.Dialog.extend("Wn.FacebookAccountDialog",{user:void 0,account:void 0,constructor:function(a){this.user=a.user;delete a.user;this.account=a.account;delete a.account;this.setPreferredWidth(400);this.setTitle("Compte Facebook");this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);var b=new Ui.VBox({spacing:10});this.setContent(b);var c=new Ui.HBox({spacing:10});c.append(new Ui.Text({text:"Identifiant",textAlign:"right",verticalAlign:"center",
width:100}));c.append(new Ui.Text({text:this.user.getData().facebookid}),!0);b.append(c);this.account.testDeleteRight()&&this.setActionButtons([a])},onDeletePress:function(){this.account["delete"]();this.close()}});
Wn.WebAccount.extend("Wn.FacebookAccount",{constructor:function(a){this.setAccountIcon("facebook");this.setText("Facebook")},onFacebookEdit:function(){(new Wn.FacebookAccountDialog({user:this.getUser(),account:this})).open()},onFacebookDelete:function(){this["delete"]()}},{"delete":function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.getUser().getId(),content:JSON.stringify({facebookid:null})})).send();this.fireEvent("delete",this)},getSelectionActions:function(){return{"delete":{text:"Supprimer",
icon:"trash",color:"#d02020",testRight:this.testDeleteRight,scope:this,callback:this.onFacebookDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onFacebookEdit,multiple:!1}}}});
Ui.Dialog.extend("Wn.LocalAccountDialog",{user:void 0,account:void 0,loginField:void 0,passwordField:void 0,deleteButton:void 0,saveButton:void 0,errorMessage:void 0,errorTimeout:void 0,constructor:function(a){this.user=a.user;delete a.user;this.account=a.account;delete a.account;this.setPreferredWidth(400);this.setTitle("Compte HOST");this.setCancelButton(new Ui.DialogCloseButton);this.deleteButton=new Ui.Button({text:"Supprimer"});this.connect(this.deleteButton,"press",this.onDeletePress);this.saveButton=
new Ui.DefaultButton({text:"Enregistrer"});this.connect(this.saveButton,"press",this.onSavePress);a=new Ui.VBox({spacing:10});this.setContent(a);this.loginField=new Wn.TextField({title:"Identifiant",value:this.user.getData().login});a.append(this.loginField);this.passwordField=new Wn.TextField({title:"Mot de passe",textHolder:"********",passwordMode:!0});a.append(this.passwordField);this.errorMessage=new Ui.Text({color:"red"});this.errorMessage.hide();a.append(this.errorMessage);this.account.testDeleteRight()?
this.setActionButtons([this.deleteButton,this.saveButton]):this.setActionButtons([this.saveButton])},onDeletePress:function(){this.account["delete"]();this.close()},onSavePress:function(){var a={};void 0!=this.passwordField.getValue()&&""!=this.passwordField.getValue()&&(a.password=this.passwordField.getValue());a.login=this.loginField.getValue();a=new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify(a)});this.connect(a,"done",this.onSaveDone);this.connect(a,
"error",this.onSaveError);this.getContent().disable();this.saveButton.disable();this.deleteButton.disable();a.send()},onSaveDone:function(){this.close()},onSaveError:function(a){var b="Echec de la modification. V\u00e9rifier vos donn\u00e9es";403==a.getStatus()&&1==a.getResponseJSON().code&&(b="Echec: mot de passe trop faible");this.showError(b);this.getContent().enable();this.saveButton.enable();this.deleteButton.enable()},showError:function(a){void 0!=this.errorTimeout&&this.errorTimeout.abort();
this.errorMessage.setText(a);this.errorMessage.show();this.errorTimeout=new Core.DelayedTask({scope:this,delay:4,callback:this.onShowErrorTimeout})},onShowErrorTimeout:function(){void 0!==this.errorTimeout&&(this.errorTimeout.abort(),this.errorTimeout=void 0,this.errorMessage.hide());this.errorTimeout=void 0;this.errorMessage.hide()}});
Wn.WebAccount.extend("Wn.LocalAccount",{constructor:function(a){this.setAccountIcon("localaccount");this.setText("HOST")},onLocalEdit:function(){(new Wn.LocalAccountDialog({user:this.getUser(),account:this})).open()},onLocalDelete:function(){this["delete"]()}},{"delete":function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify({login:null,password:null})})).send();this.fireEvent("delete",this)},getSelectionActions:function(){return{"delete":{text:"Supprimer",
icon:"trash",color:"#d02020",testRight:this.testDeleteRight,scope:this,callback:this.onLocalDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onLocalEdit,multiple:!1}}}});
Wn.OptionSection.extend("Wn.WebAccountSection",{flow:void 0,user:void 0,plus:void 0,googleAccount:void 0,facebookAccount:void 0,localAccount:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setTitle("Comptes Web");this.selection=[];this.flow=new Ui.Flow({uniform:!0});this.setContent(this.flow);this.plus=new Wn.ListAddButton({verticalAlign:"center",horizontalAlign:"center"});this.flow.append(this.plus);this.connect(this.plus,"press",this.onPlusPress)},testPlus:function(){4<=this.flow.getChildren().length?
this.plus.hide(!0):this.plus.show()},onPlusPress:function(){(new Wn.WebAccountNewDialog({user:this.user})).open()},onUserChange:function(){null!==this.user.getData().googleid&&void 0===this.googleAccount?(this.googleAccount=new Wn.GoogleAccount({user:this.user}),this.flow.prepend(this.googleAccount)):null===this.user.getData().googleid&&void 0!==this.googleAccount&&(this.flow.remove(this.googleAccount),this.googleAccount=void 0);null!==this.user.getData().facebookid&&void 0===this.facebookAccount?
(this.facebookAccount=new Wn.FacebookAccount({user:this.user}),this.flow.prepend(this.facebookAccount)):null===this.user.getData().facebookid&&void 0!==this.facebookAccount&&(this.flow.remove(this.facebookAccount),this.facebookAccount=void 0);null!==this.user.getData().login&&void 0===this.localAccount?(this.localAccount=new Wn.LocalAccount({user:this.user}),this.flow.prepend(this.localAccount)):null===this.user.getData().login&&void 0!==this.localAccount&&(this.flow.remove(this.localAccount),this.localAccount=
void 0);this.testPlus()}},{onLoad:function(){Wn.WebAccountSection.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},onUnload:function(){Wn.WebAccountSection.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange)}});Ui.HBox.extend("Wn.ColorChooser",{value:void 0,colorRect:void 0,hSlider:void 0,sSlider:void 0,lSlider:void 0,field:void 0,constructor:function(a){this.addEvents("change");this.setSpacing(10);this.colorRect=new Ui.Rectangle({width:80,height:80});this.append(this.colorRect);a=new Ui.VBox({spacing:10});this.append(a,!0);this.hSlider=new Wn.SliderField({title:"Couleur"});this.connect(this.hSlider,"change",function(a,c){var d=this.value.getHsla();d.h=360*c;this.value=new Ui.Color(d);this.updateColor();
this.updateField();this.fireEvent("change",this,this.value)});a.append(this.hSlider);this.sSlider=new Wn.SliderField({title:"Saturation"});this.connect(this.sSlider,"change",function(a,c){var d=this.value.getHsla();d.s=c;this.value=new Ui.Color(d);this.updateColor();this.updateField();this.fireEvent("change",this,this.value)});a.append(this.sSlider);this.lSlider=new Wn.SliderField({title:"Lumi\u00e8re"});this.connect(this.lSlider,"change",function(a,c){var d=this.value.getHsla();d.l=c;this.value=
new Ui.Color(d);this.updateColor();this.updateField();this.fireEvent("change",this,this.value)});a.append(this.lSlider);this.field=new Wn.TextField({title:"HTML",width:200});this.connect(this.field,"change",function(a,c){try{this.value=Ui.Color.parse(c),this.updateColor(),this.updateSliders(),this.fireEvent("change",this,this.value)}catch(d){}});a.append(this.field);this.setValue("black")},updateColor:function(){this.colorRect.setFill(this.value)},updateSliders:function(){var a=this.value.getHsla();
this.hSlider.setValue(a.h/360,!0);this.sSlider.setValue(a.s,!0);this.lSlider.setValue(a.l,!0)},updateField:function(){this.field.setValue(this.value.getCssHtml())},setValue:function(a,b){this.value=Ui.Color.create(a);this.updateColor();this.updateSliders();this.updateField()},getValue:function(){return this.value}});
Ui.Button.extend("Wn.ColorButton",{key:void 0,color:void 0,rect:void 0,constructor:function(a){this.addEvents("change");this.rect=new Ui.Rectangle;this.setValue("black");this.setIcon(this.rect);this.connect(this,"press",this.onColorButtonPress)},setKey:function(a){this.key=a},getKey:function(){return this.key},setValue:function(a){this.color=Ui.Color.create(a);this.rect.setFill(this.color);this.fireEvent("change",this,this.color)},getValue:function(){return this.color},onColorButtonPress:function(){var a=
new Ui.MenuPopup,b=new Wn.ColorChooser({value:this.color,margin:10});this.connect(b,"change",function(a,b){this.setValue(b)});a.setContent(b);a.show(this,"left")}},{onStyleChange:function(){Wn.ColorButton.base.onStyleChange.apply(this,arguments);var a=this.getStyleProperty("iconSize");this.rect.setWidth(a);this.rect.setHeight(a)}});
Ui.Dialog.extend("Wn.CustomStyleEditor",{theme:void 0,thicknessField:void 0,roundnessField:void 0,spacingField:void 0,constructor:function(a){this.addEvents("done");this.theme=Core.Util.clone(a.theme);delete a.theme;this.setFullScrolling(!0);this.setPreferredWidth(400);this.setPreferredHeight(500);this.setTitle("Editeur de th\u00e8me");this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.DefaultButton({text:"Enregister"});this.setActionButtons([a]);var b=new Ui.VBox({spacing:10,margin:10});this.setContent(b);
var c=new Wn.GroupField({title:"Couleurs"});b.append(c);var d=new Ui.Flow({spacing:5,uniform:!0});c.setField(d);for(var e in this.theme.palette)c="",e in Wn.CustomStyleEditor.colorsNames&&(c=Wn.CustomStyleEditor.colorsNames[e]),c=new Wn.ColorButton({value:this.theme.palette[e],key:e,text:c}),this.connect(c,"change",this.onColorChange),d.append(c);this.thicknessField=new Wn.SliderField({title:"\u00c9paisseur"});this.thicknessField.setValue((this.theme.thickness-1)/3);b.append(this.thicknessField);
this.roundnessField=new Wn.SliderField({title:"Rondeur"});this.roundnessField.setValue(this.theme.roundness/10);b.append(this.roundnessField);this.spacingField=new Wn.SliderField({title:"Espacement"});this.spacingField.setValue(this.theme.spacing/15);b.append(this.spacingField);this.connect(a,"press",function(){this.theme.thickness=Math.round(3*this.thicknessField.getValue()+1);this.theme.roundness=Math.round(10*this.roundnessField.getValue());this.theme.spacing=Math.round(15*this.spacingField.getValue());
this.fireEvent("done",this,this.theme);this.close()})},onColorChange:function(a,b){this.theme.palette[a.getKey()]=b.getCssRgba()}},{},{colorsNames:{menu:"Bandeau",menuInv:"Texte bandeau",background:"Fond",foreground:"Texte fond",focus:"Notifications",focusInv:"Texte notification",active:"Actif","default":"Bouton",defaultInv:"Texte bouton",files:"Fichier",calendar:"Calendrier",news:"Journal",podcast:"Podcast"}});
Ui.Button.extend("Wn.StyleWallpaper",{wallpaper:void 0,image:void 0,constructor:function(a){this.wallpaper=a.wallpaper;delete a.wallpaper;this.image=new Wn.ScaledImage2({src:"/cloud/wallpaper/thumbnail/"+this.wallpaper,mode:"crop"});this.setIcon(this.image)},getWallpaper:function(){return this.wallpaper}},{onStyleChange:function(){Wn.StyleWallpaper.base.onStyleChange.apply(this,arguments);var a=this.getStyleProperty("iconSize");this.image.setWidth(a);this.image.setHeight(a)}});
Wn.OptionSection.extend("Wn.StyleSection",{flow:void 0,user:void 0,plus:void 0,googleAccount:void 0,facebookAccount:void 0,localAccount:void 0,wallpapers:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setTitle("Apparence");a=new Ui.VBox({spacing:10});this.setContent(a);var b=JSON.parse(JSON.stringify(Ui.App.current.getSetup().style.themes)),c=this.user.getCustomTheme();void 0===c&&(c=JSON.parse(JSON.stringify(b[0])));c.key="custom";c.title="Personnalis\u00e9";b.push(c);for(var c=
this.user.getTheme(),d=0,e=0;e<b.length;e++)b[e].key===c&&(d=e);b=new Ui.Combo({field:"title",placeHolder:"th\u00e8me...",data:b,currentAt:d});this.connect(b,"change",this.onComboChange);b=new Wn.GroupField({title:"Th\u00e8me",field:b});a.append(b);this.wallpapers=new Ui.Flow({spacing:20});b=new Wn.GroupField({title:"Fond d'\u00e9cran",field:this.wallpapers});a.append(b);a=new Core.HttpRequest({method:"GET",url:"/cloud/wallpaper/list"});this.connect(a,"done",this.onWallpapersListDone);a.send()},onWallpapersListDone:function(a){a=
a.getResponseJSON();for(var b=0;b<a.length;b++){var c=new Wn.StyleWallpaper({wallpaper:a[b]});c.setIsActive(this.user.getWallpaper()===a[b]);this.connect(c,"press",this.onWallpaperPress);this.wallpapers.append(c)}},onWallpaperPress:function(a){this.user.setWallpaper(a.getWallpaper());for(var b=0;b<this.wallpapers.getChildren().length;b++){var c=this.wallpapers.getChildren()[b];c.setIsActive(c===a)}},onComboChange:function(a,b,c){"custom"===b.key?(a=new Wn.CustomStyleEditor({theme:b}),this.connect(a,
"done",this.onCustomStyleDone),a.open()):(this.user.setWallpaper(null),Ui.App.current.setTheme(b.key));this.user.setTheme(b.key)},onCustomStyleDone:function(a,b){this.user.setCustomTheme(b);Ui.App.current.setTheme("custom")}});Ui.Dialog.extend("Wn.ReaderEditDialog",{readerUi:void 0,reader:void 0,user:void 0,nameField:void 0,constructor:function(a){this.user=a.user;delete a.user;this.readerUi=a.readerUi;delete a.readerUi;this.reader=this.readerUi.getReader();this.setTitle("Lecteur RFID");this.setPreferredWidth(400);this.setPreferredHeight(300);this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.VBox({spacing:10});this.setContent(a);this.nameField=new Wn.TextField({title:"Nom",value:this.reader.name});a.append(this.nameField);
var b=new Wn.TextField({title:"Identifiant",value:this.reader.id});b.disable();a.append(b);b=(new Core.Uri({uri:"/cloud/rfid/"+this.reader.id+"/enter"})).toString();b=new Wn.TextField({title:"URL",value:b});b.disable();a.append(b);a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);b=new Ui.DefaultButton({text:"Enregistrer"});this.connect(b,"press",this.onSavePress);this.setActionButtons([a,b])},onSavePress:function(){this.reader.name=this.nameField.getValue();(new Core.HttpRequest({method:"PUT",
url:"/cloud/user/"+this.user.getId()+"/readers/"+this.reader.id,content:JSON.stringify({name:this.nameField.getValue()})})).send();this.close()},onDeletePress:function(){this.readerUi["delete"]();this.close()}});
Ui.Dialog.extend("Wn.ReaderNewDialog",{textField:void 0,user:void 0,request:void 0,device:void 0,nameField:void 0,reader:void 0,constructor:function(a){this.user=a.user;delete a.user;this.device=a.device;delete a.device;this.addEvents("done");this.setTitle("Nouveau Lecteur RFID");this.setPreferredWidth(400);this.setPreferredHeight(300);this.setContent(new Ui.Text({textAlign:"center",text:"Cr\u00e9ation en cours..."}));this.setCancelButton(new Ui.DialogCloseButton);this.request=new Core.HttpRequest({method:"POST",
url:"/cloud/user/"+this.user.getId()+"/readers",content:JSON.stringify({name:"noname",device:this.device})});this.connect(this.request,"done",this.onCreateDone);this.connect(this.request,"error",this.onCreateError);this.request.send();this.connect(this,"close",this.onDialogClose)},onCreateDone:function(a){var b=a.getResponseJSON();this.reader=b;a=new Ui.VBox({spacing:10});this.setContent(a);this.nameField=new Wn.TextField({title:"Nom",value:b.name});a.append(this.nameField);var c=new Wn.TextField({title:"Identifiant",
value:b.id});c.disable();a.append(c);b=(new Core.Uri({uri:"/cloud/rfid/"+b.id+"/enter"})).toString();b=new Wn.TextField({title:"URL",value:b});b.disable();a.append(b);a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);b=new Ui.DefaultButton({text:"Enregistrer"});this.connect(b,"press",this.onSavePress);this.setActionButtons([a,b])},onCreateError:function(){this.setContent(new Ui.Text({textAlign:"center",text:"Echec de la cr\u00e9ation. R\u00e9\u00e9ssayer plus tard."}))},
onSavePress:function(){this.reader.name=this.nameField.getValue();(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId()+"/readers/"+this.reader.id,content:JSON.stringify({name:this.nameField.getValue()})})).send();this.close()},onDeletePress:function(){(new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.user.getId()+"/readers/"+this.reader.id})).send();this.reader=void 0;this.close()},onDialogClose:function(){void 0!==this.reader&&this.fireEvent("done",this,this.reader)}});
Wn.SelectionButton.extend("Wn.RfidReaderUi",{user:void 0,reader:void 0,constructor:function(a){this.addEvents("delete");this.user=a.user;delete a.user;this.reader=a.reader;delete a.reader;this.setIcon("rfidreader");this.setText(this.reader.name)},getUser:function(){return this.user},getReader:function(){return this.reader},"delete":function(){request=new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.user.getId()+"/readers/"+this.reader.id});request.send();this.fireEvent("delete",this)}},
{getSelectionActions:function(){return Wn.RfidReaderUi.readerActions}},{readerActions:void 0,constructor:function(){Wn.RfidReaderUi.readerActions={"delete":{text:"Supprimer",icon:"trash",color:"#d02020",callback:Wn.RfidReaderUi.onReaderDelete,multiple:!0},edit:{"default":!0,text:"Editer",icon:"pen",callback:Wn.RfidReaderUi.onReaderEdit}}},onReaderEdit:function(a){a=a.getElements();(new Wn.ReaderEditDialog({readerUi:a[0],user:a[0].getUser()})).open()},onReaderDelete:function(a){for(var b=a.getElements(),
c=0;c<b.length;c++)b[c]["delete"]();a.clear()}});
Wn.OptionSection.extend("Wn.ReaderSection",{flow:void 0,user:void 0,device:null,constructor:function(a){this.user=a.user;delete a.user;this.device=a.device;delete a.device;this.setTitle("Lecteurs RFID");this.flow=new Ui.Flow({uniform:!0});this.setContent(this.flow);a=new Wn.ListAddButton({verticalAlign:"center",horizontalAlign:"center"});this.connect(a,"press",this.onReaderNewPress);this.flow.append(a)},setReaders:function(a){for(var b=[],c,d=0;d<this.flow.getChildren();d++)c=this.flow.getChildren()[d],
Wn.RfidReaderUi.hasInstance(c)&&b.push(c);for(c in b)this.flow.remove(c);for(d=0;d<a.length;d++)a[d].device===this.device&&this.appendReader(a[d])},appendReader:function(a){a=new Wn.RfidReaderUi({user:this.user,reader:a});this.connect(a,"delete",this.onReaderDelete);this.flow.insertAt(a,this.flow.getChildren().length-1)},getReaders:function(){for(var a=[],b=0;b<this.flow.getChildren().length;b++){var c=this.flow.getChildren()[b];Wn.RfidReaderUi.hasInstance(c)&&a.push(c.getReader())}return a},onReaderDelete:function(a){this.flow.remove(a)},
onReaderNewDone:function(a,b){this.appendReader(b)},onReaderNewPress:function(){var a=new Wn.ReaderNewDialog({user:this.user,device:this.device});this.connect(a,"done",this.onReaderNewDone);a.open()}});Ui.Dialog.extend("Wn.DeviceEditDialog",{device:void 0,nameField:void 0,constructor:function(a){this.device=a.device;delete a.device;this.setPreferredWidth(500);this.setPreferredHeight(400);this.setFullScrolling(!0);this.setTitle("Client de consultation");this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);var b=new Ui.DefaultButton({text:"Enregistrer"});this.connect(b,"press",this.onSavePress);this.setActionButtons([a,b]);a=
new Ui.VBox({spacing:10,margin:10});this.setContent(a);b=new Wn.TextField({title:"Identifiant",value:this.device.getDevice().id});b.disable();a.append(b);this.nameField=new Wn.TextField({title:"Nom",value:this.device.getDevice().name});a.append(this.nameField);b=new Wn.ReaderSection({user:this.device.getUser(),device:this.device.getDevice().id,readers:this.device.getUser().getData().readers,title:"Lecteurs RFID li\u00e9s \u00e0 cette interface"});a.append(b)},onDeletePress:function(){this.device["delete"]();
this.close()},onSavePress:function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.device.getUser().getId()+"/devices/"+this.device.getDevice().id,content:JSON.stringify({name:this.nameField.getValue()})})).send();this.close()}});
Ui.Dialog.extend("Wn.DeviceNewDialog",{textField:void 0,user:void 0,request:void 0,constructor:function(a){this.user=a.user;delete a.user;this.addEvents("done");this.setTitle("Nouveau client de consultation");this.setPreferredWidth(400);this.setPreferredHeight(300);a=new Ui.VBox({spacing:10});this.setContent(a);a.append(new Ui.Text({text:"Enregister le navigateur actuel comme un nouveau client de consultation."}));this.textField=new Wn.TextField({title:"Nom d'usage"});a.append(this.textField);this.setCancelButton(new Ui.DialogCloseButton);
a=new Ui.DefaultButton({text:"Cr\u00e9er"});this.connect(a,"press",this.onCreatePress);this.setActionButtons([a])},onCreatePress:function(){this.request=new Core.HttpRequest({method:"POST",url:"/cloud/user/"+this.user.getId()+"/devices",content:JSON.stringify({name:this.textField.getValue()})});this.connect(this.request,"done",this.onCreateDone);this.connect(this.request,"error",this.onCreateError);this.request.send()},onCreateDone:function(a){this.close();a=a.getResponseJSON();Ui.App.current.setDeviceId(a.id);
this.fireEvent("done",this,a)},onCreateError:function(){this.close()}});
Wn.SelectionButton.extend("Wn.Device",{user:void 0,device:void 0,constructor:function(a){this.addEvents("delete");this.user=a.user;delete a.user;this.device=a.device;delete a.device;this.setIcon("screen");this.setText(this.device.name);"localStorage"in window&&void 0!==localStorage.getItem("deviceId")&&localStorage.getItem("deviceId")==this.device.id&&this.setBadge("@")},getUser:function(){return this.user},getDevice:function(){return this.device},"delete":function(){request=new Core.HttpRequest({method:"DELETE",
url:"/cloud/user/"+this.user.getId()+"/devices/"+this.device.id});request.send();this.fireEvent("delete",this)}},{getSelectionActions:function(){return Wn.Device.deviceActions}},{deviceActions:void 0,constructor:function(){Wn.Device.deviceActions={"delete":{text:"Supprimer",icon:"trash",color:"#d02020",callback:Wn.Device.onDeviceDelete,multiple:!0},edit:{"default":!0,text:"Editer",icon:"pen",callback:Wn.Device.onDeviceEdit}}},onDeviceEdit:function(a){a=a.getElements();(new Wn.DeviceEditDialog({device:a[0]})).open()},
onDeviceDelete:function(a){for(var b=a.getElements(),c=0;c<b.length;c++)b[c]["delete"]();a.clear()}});
Wn.OptionSection.extend("Wn.DeviceSection",{flow:void 0,user:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setTitle("Interfaces de consultation");this.flow=new Ui.Flow({uniform:!0});this.setContent(this.flow);a=new Wn.ListAddButton({verticalAlign:"center",horizontalAlign:"center"});this.connect(a,"press",this.onNewPress);this.flow.append(a)},setDevices:function(a){for(var b=[],c,d=0;d<this.flow.getChildren();d++)c=this.flow.getChildren()[d],Wn.Device.hasInstance(c)&&b.push(c);
for(c in b)this.flow.remove(c);for(d=0;d<a.length;d++)this.appendDevice(a[d])},appendDevice:function(a){a=new Wn.Device({user:this.user,device:a});this.connect(a,"delete",this.onDeviceDelete);this.flow.insertAt(a,this.flow.getChildren().length-1)},getDevices:function(){for(var a=[],b=0;b<this.flow.getChildren().length;b++){var c=this.flow.getChildren()[b];Wn.Device.hasInstance(c)&&a.push(c.getDevice())}return a},onDeviceDelete:function(a){this.flow.remove(a)},onDeviceNewDone:function(a,b){this.appendDevice(b)},
onNewPress:function(){var a=new Wn.DeviceNewDialog({user:this.user});this.connect(a,"done",this.onDeviceNewDone);a.open()}});Ui.Dialog.extend("Wn.RfidEditDialog",{rfidTags:void 0,constructor:function(a){this.rfidTags=a.rfidTags;delete a.rfidTags;this.setTitle("Tags RFID");this.setPreferredWidth(300);this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.VBox({spacing:10,margin:10,verticalAlign:"center"});this.setContent(a);for(var b=0;b<this.rfidTags.length;b++)a.append(new Ui.Label({text:this.rfidTags[b].getRfid(),horizontalAlign:"center"}));a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",function(){this.close();
for(var a=0;a<this.rfidTags.length;a++)this.rfidTags[a]["delete"]()});this.setActionButtons([a])}});
Ui.Dialog.extend("Wn.RfidNewDialog",{textField:void 0,user:void 0,path:void 0,constructor:function(a){this.user=a.user;delete a.user;this.path=a.path;delete a.path;this.addEvents("done");this.setTitle("Nouveau Tag RFID");this.setPreferredWidth(300);this.setPreferredHeight(200);a=new Ui.HBox({spacing:10,verticalAlign:"center"});this.setContent(a);a.append(new Ui.Label({text:"RFID",verticalAlign:"center"}));this.textField=new Ui.TextField({verticalAlign:"center"});a.append(this.textField,!0);a.append(new Ui.Icon({icon:"rfidreader",
verticalAlign:"center",width:30,height:30}));this.setCancelButton(new Ui.DialogCloseButton({text:"Annuler"}));a=new Ui.DefaultButton({text:"Enregistrer"});this.connect(a,"press",this.onSavePress);this.setActionButtons([a]);this.connect(this,"close",this.onClose);this.connect(Ui.App.current.getRfidReader(),"enter",this.onRfid,!0)},onSavePress:function(){(new Core.HttpRequest({method:"POST",url:"/cloud/user/"+this.user.getId()+"/rfids",content:JSON.stringify({rfid:this.textField.getValue(),path:this.path})})).send();
this.close();this.fireEvent("done",this,this.textField.getValue())},onClose:function(){this.disconnect(Ui.App.current.getRfidReader(),"enter",this.onRfid,!0)},onRfid:function(a,b){this.textField.setValue(b);return!0}});
Wn.SelectionButton.extend("Wn.RfidTag",{user:void 0,rfid:void 0,constructor:function(a){this.addEvents("delete");this.user=a.user;delete a.user;this.rfid=a.rfid;delete a.rfid;this.setIcon("rfidtag");this.setText(this.rfid)},getRfid:function(){return this.rfid},"delete":function(){(new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.user.getId()+"/rfids/"+this.rfid})).send();this.fireEvent("delete",this)}},{getSelectionActions:function(){return Wn.RfidTag.rfidActions}},{rfidActions:void 0,
constructor:function(){Wn.RfidTag.rfidActions={"delete":{text:"Supprimer",icon:"trash",color:"#d02020",callback:Wn.RfidTag.onTagDelete,multiple:!0},edit:{"default":!0,hidden:!0,text:"Editer",icon:"pen",callback:Wn.RfidTag.onTagEdit,multiple:!0}}},onTagEdit:function(a){a=a.getElements();(new Wn.RfidEditDialog({rfidTags:a})).open()},onTagDelete:function(a){for(var b=a.getElements(),c=0;c<b.length;c++)b[c]["delete"]();a.clear()}});
Wn.OptionSection.extend("Wn.RfidSection",{flow:void 0,user:void 0,path:void 0,constructor:function(a){this.user=a.user;delete a.user;this.path=a.path;delete a.path;this.setTitle("Association RFID");this.flow=new Ui.Flow({uniform:!0});this.setContent(this.flow);a=new Wn.ListAddButton({verticalAlign:"center",horizontalAlign:"center"});this.connect(a,"press",this.onTagNewPress);this.flow.append(a)},setTags:function(a){for(var b=[],c,d=0;d<this.flow.getChildren();d++)c=this.flow.getChildren()[d],Wn.RfidTag.hasInstance(c)&&
b.push(c);for(c in b)this.flow.remove(c);for(d=0;d<a.length;d++)this.appendTag(a[d])},appendTag:function(a){a=new Wn.RfidTag({user:this.user,rfid:a});this.connect(a,"delete",this.onTagDelete);this.flow.insertAt(a,this.flow.getChildren().length-1)},getTags:function(){for(var a=[],b=0;b<this.flow.getChildren().length;b++){var c=this.flow.getChildren()[b];Wn.RfidTag.hasInstance(c)&&a.push(c.getRfid())}return a},onTagDelete:function(a){this.flow.remove(a)},onTagNewDone:function(a,b){this.appendTag(b)},
onTagNewPress:function(){var a=new Wn.RfidNewDialog({user:this.user,path:this.path});this.connect(a,"done",this.onTagNewDone);a.open()}});Ui.UploadButton.extend("Wn.UploadFaceButton",{user:void 0,image:void 0,constructor:function(a){this.user=a.user;delete a.user;this.image=new Ui.Image({width:64,height:64});this.setIcon(this.image)},onUserChange:function(){this.image.setSrc(this.user.getFaceUrl())},onUploadProgress:function(a){},onUploadComplete:function(a){this.image.setSrc("/cloud/user/"+this.user.getId()+"/face")}},{onFile:function(a,b){Wn.UploadFaceButton.base.onFile.apply(this,arguments);var c=new Core.FilePostUploader({file:b,
service:"/cloud/user/"+this.user.getId()+"/face"});this.connect(c,"progress",this.onUploadProgress);this.connect(c,"complete",this.onUploadComplete);c.send()},onLoad:function(){Wn.UploadFaceButton.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},onUnload:function(){Wn.UploadFaceButton.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange)}});
Ui.Dialog.extend("Wn.UserProfil",{user:void 0,firstnameField:void 0,lastnameField:void 0,emailField:void 0,avatarBlob:void 0,avatarImage:void 0,notifyBox:void 0,notifyMessageSend:void 0,notifyUserAdd:void 0,notifyResourceShare:void 0,notifyCommentAdd:void 0,defaultShareField:void 0,defaultWriteField:void 0,defaultFriendField:void 0,adminField:void 0,saveButton:void 0,sflow:void 0,webSection:void 0,styleSection:void 0,readerSection:void 0,rfidSection:void 0,tags:void 0,saveRequests:void 0,errorRequests:void 0,
constructor:function(a){this.user=a.user;delete a.user;Ui.App.current.getUser().isAdmin()&&Wn.Contact.hasInstance(this.user)&&(this.user=new Wn.User({user:{id:this.user.getId(),face_rev:0},monitor:!1}));this.setFullScrolling(!0);this.setPreferredWidth(650);this.setPreferredHeight(550);this.setTitle("Profil utilisateur");this.setCancelButton(new Ui.DialogCloseButton);if(this.user.getIsReady())this.onUserReady();else this.connect(this.user,"ready",this.onUserReady)},onUserReady:function(){var a=[];
if(Wn.User.hasInstance(this.user)&&Ui.App.current.getUser().isAdmin()){var b=new Wn.InfoButton({text:"Commuter"});this.connect(b,"press",this.onSwitchPress);var c=new Wn.AlertButton({text:"Supprimer"});this.connect(c,"press",this.onDeletePress);Ui.App.current.getUser().getId()!==this.user.getId()&&a.push(b);a.push(c)}Ui.App.current.getUser().getId()!==this.user.getId()&&(void 0!==Ui.App.current.getUser().getContact(this.user.getId())?(b=new Ui.Button({text:"Enlever"}),this.connect(b,"press",this.onRemoveContactPress)):
(b=new Ui.Button({text:"Ajouter"}),this.connect(b,"press",this.onAddContactPress)),a.push(b));Wn.User.hasInstance(this.user)&&(this.saveButton=new Ui.DefaultButton({text:"Enregistrer"}),this.connect(this.saveButton,"press",this.onSavePress),a.push(this.saveButton));this.setActionButtons(a);a=new Ui.VBox({spacing:10});this.setContent(a);b=new Ui.SFlow({itemAlign:"stretch",stretchMaxRatio:10,spacing:10});a.append(b);this.sflow=b;c=new Wn.UploadFaceButton({user:this.user,marginLeft:10});b.append(c,"right");
this.firstnameField=new Wn.TextField({title:"Pr\u00e9nom",width:100});b.append(this.firstnameField);this.lastnameField=new Wn.TextField({title:"Nom",width:100});b.append(this.lastnameField);this.descField=new Wn.TextAreaField({title:"Description",width:400});b.append(this.descField);if(Wn.User.hasInstance(this.user)){this.emailField=new Wn.TextField({title:"Email",width:600});this.connect(this.emailField,"change",function(a,b){""==b?this.notifyBox.disable():this.notifyBox.enable()});b.append(this.emailField);
c=new Wn.GroupField({title:"Notifications par email"});b.append(c);this.notifyBox=new Ui.VBox({uniform:!0});this.notifyBox.disable();c.setContent(this.notifyBox);this.notifyMessageSend=new Ui.CheckBox({text:"on m'a envoy\u00e9 un message"});this.notifyBox.append(this.notifyMessageSend);this.notifyUserAdd=new Ui.CheckBox({text:"on m'a ajout\u00e9 en contact"});this.notifyBox.append(this.notifyUserAdd);this.notifyResourceShare=new Ui.CheckBox({text:"on m'a partag\u00e9 une resource"});this.notifyBox.append(this.notifyResourceShare);
this.notifyCommentAdd=new Ui.CheckBox({text:"on a rajout\u00e9 un commentaire"});this.notifyBox.append(this.notifyCommentAdd);c=new Wn.GroupField({title:"Droit de partage"});b.append(c);var d=new Ui.VBox({uniform:!0});this.defaultShareField=new Ui.CheckBox({text:"autoriser le repartage"});d.append(this.defaultShareField);this.defaultWriteField=new Ui.CheckBox({text:"autoriser la modification"});d.append(this.defaultWriteField);c.setContent(d);Ui.App.current.getUser().isAdmin()&&(c=new Wn.GroupField({title:"Droits administrateurs"}),
b.append(c),d=new Ui.VBox({uniform:!0}),this.adminField=new Ui.CheckBox({text:"compte administrateur"}),d.append(this.adminField),this.defaultFriendField=new Ui.CheckBox({text:"compte d'ami par d\u00e9fault"}),d.append(this.defaultFriendField),c.setContent(d));this.webSection=new Wn.WebAccountSection({user:this.user});a.append(this.webSection);this.styleSection=new Wn.StyleSection({user:this.user});a.append(this.styleSection);b=new Wn.DeviceSection({user:this.user,devices:this.user.getData().devices});
a.append(b);this.readerSection=new Wn.ReaderSection({user:this.user,device:null,readers:this.user.getData().readers,title:"Lecteurs RFID li\u00e9s \u00e0 mon compte"});a.append(this.readerSection)}this.tags=Ui.App.current.getUser().getRfidsFromPath("user:"+this.user.getId());this.rfidSection=new Wn.RfidSection({user:Ui.App.current.getUser(),tags:this.tags,path:"user:"+this.user.getId()});a.append(this.rfidSection);Ui.App.current.getUser().isAdmin()&&(b=new Wn.UserStatsSection({contact:this.user}),
a.append(b));this.firstnameField.setValue(this.user.getData().firstname);this.lastnameField.setValue(this.user.getData().lastname);this.descField.setValue(this.user.getData().description);Wn.User.hasInstance(this.user)?(this.emailField.setValue(this.user.getData().email),""==this.user.getData().email||void 0==this.user.getData().email?this.notifyBox.disable():this.notifyBox.enable(),this.notifyMessageSend.setValue(this.user.getData().email_notify_message_received),this.notifyUserAdd.setValue(this.user.getData().email_notify_contact_added),
this.notifyResourceShare.setValue(this.user.getData().email_notify_resource_shared),this.notifyCommentAdd.setValue(this.user.getData().email_notify_comment_added),this.defaultShareField.setValue(this.user.getData().default_share_right),this.defaultWriteField.setValue(this.user.getData().default_write_right),Ui.App.current.getUser().isAdmin()&&(this.adminField.setValue(this.user.getData().admin),this.defaultFriendField.setValue(this.user.getData().default_friend))):this.sflow.disable()},onSavePress:function(){this.saveRequests=
[];this.errorRequests=[];var a={};a.firstname=this.firstnameField.getValue();a.lastname=this.lastnameField.getValue();a.email=this.emailField.getValue();""===a.email&&(a.email=null);a.description=this.descField.getValue();a.email_notify_message_received=this.notifyMessageSend.getValue();a.email_notify_contact_added=this.notifyUserAdd.getValue();a.email_notify_resource_shared=this.notifyResourceShare.getValue();a.email_notify_comment_added=this.notifyCommentAdd.getValue();a.default_share_right=this.defaultShareField.getValue();
a.default_write_right=this.defaultWriteField.getValue();Ui.App.current.getUser().isAdmin()&&(a.admin=this.adminField.getValue(),a.default_friend=this.defaultFriendField.getValue());a=Core.Object.diff(this.user.getData(),a);void 0!==a&&(a=new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify(a)}),this.connect(a,"done",this.onSaveDone),this.connect(a,"error",this.onSaveError),this.saveRequests.push(a),a.send());0===this.saveRequests.length?this.close():(this.sflow.disable(),
this.saveButton.disable())},testSaveEnd:function(){if(0==this.saveRequests.length)if(0<this.errorRequests.length){this.sflow.enable();this.saveButton.enable();var a=new Ui.Dialog({preferredWidth:300,title:"Echec de l'enregistrement"});a.setContent(new Ui.Text({text:"L'enregistrement \u00e0 \u00e9chou\u00e9. V\u00e9rifiez que votre mot de passe respecte la politique de s\u00e9curit\u00e9. A savoir qu'il doit faire au moins 8 caract\u00e8res et contenir des chiffres et des lettres."}));var b=new Ui.Button({text:"Fermer"});
a.setActionButtons([b]);this.connect(b,"press",function(){a.close()});a.open()}else this.close()},onSaveDone:function(a){for(var b=void 0,c=0;c<this.saveRequests.length;c++)this.saveRequests[c]===a&&(b=c);void 0!==b&&this.saveRequests.splice(b,1);this.testSaveEnd()},onSaveError:function(a){this.errorRequests.push(a);for(var b=void 0,c=0;c<this.saveRequests.length;c++)this.saveRequests[c]===a&&(b=c);void 0!==b&&this.saveRequests.splice(b,1);this.testSaveEnd()},onDeletePress:function(){var a=new Ui.Dialog({title:"Suppression de compte",
fullScrolling:!0,preferredWidth:300,preferredHeight:300});a.setContent(new Ui.Text({text:"Voulez vous vraiment supprimer ce compte ? ATTENTION, cet utilisateur et toutes ses ressources n'existeront plus apr\u00e8s cette action."}));a.setCancelButton(new Ui.DialogCloseButton({text:"Annuler"}));var b=new Ui.DefaultButton({text:"Supprimer"});a.setActionButtons([b]);this.connect(b,"press",function(){a.disable();var b=new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.user.getId()});this.connect(b,
"done",function(){a.close();Ui.App.current.setMainPath("");this.close()});this.connect(b,"error",function(){a.close();this.close()});b.send()});a.open()},onSwitchPress:function(){var a=new Ui.Dialog({title:"Connexion au compte",fullScrolling:!0,preferredWidth:300,preferredHeight:300});a.setContent(new Ui.Text({text:"Voulez vous vraiment ouvrir une session sur le compte de cet utilisateur ? ATTENTION, vous ne serez plus sur votre compte et vous aller agir au nom de cette personne."}));a.setCancelButton(new Ui.DialogCloseButton({text:"Annuler"}));
var b=new Wn.InfoButton({text:"Commuter"});a.setActionButtons([b]);this.connect(b,"press",function(){a.close();window.open("/?user="+encodeURIComponent(this.user.getId()))});a.open()},onRemoveContactPress:function(){var a=new Ui.Dialog({title:"Enlever un contact",fullScrolling:!0,preferredWidth:300,preferredHeight:300,cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous supprimer ce contact de votre liste de contact ?\n\nCela ne vous emp\u00eachera pas de le remettre plus tard si vous changez d'avis."})}),
b=new Ui.Button({text:"Enlever"});this.connect(b,"press",function(){Ui.App.current.getUser().removeContact(this.user);a.close();this.close()});a.setActionButtons([b]);a.open()},onAddContactPress:function(){var a=new Ui.Dialog({title:"Ajout de contact",fullScrolling:!0,preferredWidth:300,preferredHeight:300,cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous ajouter ce contact dans votre liste de contact ?"})}),b=new Ui.Button({text:"Ajouter",style:{"Ui.Button":{color:"#43c3ff"}}});
this.connect(b,"press",function(){Ui.App.current.getUser().prependContact(this.user);a.close();this.close()});a.setActionButtons([b]);a.open()}});Wn.SFlowDropBox.extend("Wn.UserResourcesFlow",{},{checkPosition:function(a){return a==this.getLogicalChildren().length?!1:!0}});
Ui.LBox.extend("Wn.UserResourcesView",{user:void 0,resources:void 0,constructor:function(a){this.user=a.user;delete a.user;this.resources=new Wn.UserResourcesFlow({verticalAlign:"top",margin:40,spacing:40});this.resources.addMimetype(Wn.ResourceView);this.setContent(this.resources);this.connect(this.resources,"dropat",this.onResourceDropAt);this.resources.append(new Wn.ResourceNew({user:this.user,width:180,height:220}))},onUserChange:function(){for(var a=[],b=[],c=0;c<this.resources.getLogicalChildren().length;c++)this.resources.getLogicalChildren()[c].userViewFound=
!1;for(var d=0;d<this.user.getBookmarks().length;d++){for(var e=this.user.getBookmarks()[d],f=void 0,c=0;void 0==f&&c<this.resources.getLogicalChildren().length;c++)Wn.ResourceView.hasInstance(this.resources.getLogicalChildren()[c])&&this.resources.getLogicalChildren()[c].getResource().getId()==e.getId()&&(f=this.resources.getLogicalChildren()[c]);void 0==f?b.push(e):f.userViewFound=!0}for(c=0;c<this.resources.getLogicalChildren().length;c++)Wn.ResourceView.hasInstance(this.resources.getLogicalChildren()[c])&&
(this.resources.getLogicalChildren()[c].userViewFound||a.push(this.resources.getLogicalChildren()[c]));for(d=0;d<a.length;d++)this.resources.remove(a[d]);if(0<b.length)for(d=0;d<b.length;d++)if(b[d].getIsReady())this.onAddNewResourceReady(b[d]);else this.connect(b[d],"ready",this.onAddNewResourceReady)},onAddNewResourceReady:function(a){var b=Wn.ResourceView.getView(a.getType());void 0===b&&(b=Wn.ResourceView);a=new b({user:this.user,resource:a,width:180,height:220});this.resources.insertAt(a,this.resources.getLogicalChildren().length-
1)},onResourceDropAt:function(a,b,c,d){a=void 0;b=-1;for(var e=0;e<this.resources.getLogicalChildren().length&&void 0===a;e++){var f=this.resources.getLogicalChildren()[e];Wn.ResourceView.hasInstance(f)&&f===c&&(a=f,b=e)}void 0!==a&&(b!=d&&b+1!=d)&&(b<d&&d--,this.resources.moveAt(a,d),this.user.setBookmarkPosition(a.getResource(),d))}},{onLoad:function(){Wn.UserResourcesView.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},onUnload:function(){Wn.UserResourcesView.base.onUnload.call(this);
this.disconnect(this.user,"change",this.onUserChange)}});Ui.CompactLabel.extend("Wn.UserTitle",{constructor:function(a){this.setMaxLine(2);this.setWidth(100)}});
Ui.LBox.extend("Wn.UserView",{user:void 0,menuBackground:void 0,menuvbox:void 0,userface:void 0,contentBox:void 0,selection:void 0,actions:void 0,historyButton:void 0,constructor:function(a){this.addEvents("change");this.user=a.user;delete a.user;this.actions=[];a=new Ui.VBox;this.setContent(a);this.actionBox=new Wn.MenuToolBar({margin:5,spacing:5});this.userface=new Wn.UserFace({user:this.user});this.actionBox.append(this.userface);this.userlabel=new Wn.UserTitle({text:"",marginLeft:10,marginRight:10,
textAlign:"left",verticalAlign:"center"});this.actionBox.append(this.userlabel,!0);if(Ui.App.current.getUser().isAdmin()){var b=new Ui.Button({icon:"tools",text:"Administation"});this.connect(b,"press",this.onGlobalStatsPress);this.actions.push(b)}b=new Ui.ScrollingArea({scrollHorizontal:!1});a.append(b,!0);a=new Ui.VBox;b.setContent(a);a.append(new Wn.UserResourcesView({user:this.user}));this.user.updateUser();this.user.updateMessages()},getTitle:function(){return this.user.getName()},getActions:function(){return this.actions},
onUserChange:function(){this.userlabel.setText(this.user.getUser().firstname+" "+this.user.getUser().lastname)},onGlobalStatsPress:function(){(new Wn.UserStatsDialog).open()},onChatHistoryPress:function(a){(new Wn.HistoryMessagesPopup({user:this.user})).show(a,"bottom")},onProfilPress:function(){(new Wn.UserProfil({user:this.user})).open()},onExitPress:function(){if(void 0!==Ui.App.current.getArguments().user){var a=new Ui.Dialog({title:"D\u00e9connexion",fullScrolling:!1,preferredWidth:350,cancelButton:new Ui.Button({text:"Annuler"}),
content:new Ui.Text({text:"Voulez vous vraiment vous fermer votre session sur ce compte utilisateur ?"})}),b=new Wn.AlertButton({text:"Fermer"});this.connect(b,"press",function(){window.close()})}else a=new Ui.Dialog({title:"D\u00e9connexion",fullScrolling:!1,preferredWidth:300,cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous vraiment vous d\u00e9connecter ?"})}),b=new Ui.DefaultButton({text:"D\u00e9connecter"}),this.connect(b,"press",function(){"localStorage"in
window&&(localStorage.removeItem("login"),localStorage.removeItem("password"),localStorage.removeItem("currentPath"),localStorage.removeItem("authsession"));document.cookie="HOST_AUTH=; expires=Thu, 01-Jan-1970 00:00:01 GMT";var a=new Core.HttpRequest({method:"DELETE",url:"/cloud/authsession/current"});this.connect(a,"done",this.onAuthSessionDelete);this.connect(a,"error",this.onAuthSessionDelete);a.send()});a.setActionButtons([b]);a.open()},onAuthSessionDelete:function(){var a=window.location.href;
-1!=a.lastIndexOf("#")&&(a=a.substring(0,a.lastIndexOf("#")));window.location.replace(a)},onSelectionChange:function(a){0===a.getElements().length?(this.contextBox.hide(),this.actionBox.show()):(this.contextBox.show(),this.actionBox.hide())}},{onLoad:function(){Wn.UserResourcesView.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},onUnload:function(){Wn.UserResourcesView.base.onUnload.call(this)}});Core.Object.extend("Wn.Message",{message:void 0,ready:!1,request:void 0,searchText:"",constructor:function(a){this.addEvents("ready","change","delete");if("message"in a)this.message=a.message,delete a.message,this.updateData(this.message);else if("id"in a){var b=a.id;delete a.id;this.message={id:b};this.update()}},getIsReady:function(){return this.ready},update:function(){void 0!==this.request&&(this.disconnect(this.request,"done",this.onGetMessageDone),this.disconnect(this.request,"error",this.onGetMessageError),
this.request.abort());this.request=new Core.HttpRequest({url:"/cloud/message/"+this.message.id});this.connect(this.request,"done",this.onGetMessageDone);this.connect(this.request,"error",this.onGetMessageError);this.request.send()},updateData:function(a){this.message=a;this.updateSearchText();this.ready||(this.ready=!0,this.fireEvent("ready",this));this.fireEvent("change",this)},updateSearchText:function(){var a=this.getDate();this.searchText=a.getDate()-1+"/"+(a.getMonth()+1)+"/"+a.getFullYear()+
" ";a=this.message.origin===Ui.App.current.getUser().getId()?Wn.Contact.getContact(this.message.destination,!0):Wn.Contact.getContact(this.message.origin,!0);void 0!==a&&(this.searchText+=a.getName()+" ");this.searchText="resource"===this.message.type?this.searchText+("partage ressouce "+this.message.content.name):"contact"===this.message.type?this.searchText+"ajoute contact":"comment"===this.message.type?this.searchText+("commentaire ressource "+this.message.content.resource.name):"call"===this.message.type?
this.searchText+"appel video":this.searchText+this.message.content;this.searchText=this.searchText.toLowerCase().toNoDiacritics()},getMessage:function(){return this.message},getId:function(){return this.message.id},getType:function(){return this.message.type},getOrigin:function(){return this.message.origin},getDestination:function(){return this.message.destination},getSeen:function(){return-1!==this.message.seen},getDate:function(){return new Date(1E3*this.message.create)},getContent:function(){return this.message.content},
getSearchText:function(){return this.searchText},markSeen:function(){this.getSeen()||(new Core.HttpRequest({method:"PUT",url:"/cloud/message/"+this.message.id})).send()},onGetMessageError:function(a){404==a.getStatus()&&this.fireEvent("delete",this);this.request=void 0},onGetMessageDone:function(a){a=a.getResponseJSON();this.updateData(a);this.request=void 0}});Ui.Pressable.extend("Wn.MessageView",{user:void 0,message:void 0,contact:void 0,comment:void 0,contactface:void 0,previewBox:void 0,label:void 0,constructor:function(a){this.user=a.user;delete a.user;this.message=a.message;delete a.message;this.append(new Wn.ContentBgGraphic({color:"#7e1967"}));var b=new Ui.HBox;this.append(b);this.label=new Ui.CompactLabel({margin:10,marginRight:0,width:142,height:40,fontSize:20,maxLine:2,color:"#f1f1f1"});b.append(this.label,!0);a=new Ui.LBox({verticalAlign:"top",
horizontalAlign:"right",margin:8});b.append(a);b=new Ui.LBox({verticalAlign:"top",marginTop:8,marginLeft:8});a.append(b);b.append(new Ui.Rectangle({fill:"#999999"}));b.append(new Ui.Rectangle({fill:"#f1f1f1",margin:1}));this.contact=Wn.Contact.getContact(this.message.getOrigin());this.contactface=new Ui.Image({width:32,height:32,margin:1,src:this.contact.getFaceUrl()});b.append(this.contactface);b="bubble";"resource"==this.message.getType()?b="resource":"contact"==this.message.getType()?b="person":
"comment"==this.message.getType()&&(b="resource-comment");b=new Ui.DualIcon({width:24,height:24,icon:b,verticalAlign:"top",horizontalAlign:"left"});a.append(b);this.displayContent();this.connect(this,"press",this.onMessageViewPress)},getMessage:function(){return this.message},onMessageViewPress:function(){this.message.markSeen();"contact"==this.message.getType()?Ui.App.current.setMainPath("user:"+this.contact.getId()):"resource"==this.message.getType()?Ui.App.current.setMainPath("resource:"+this.message.getContent().id):
"comment"==this.message.getType()?Ui.App.current.setMainPath("resource:"+this.message.getContent().resource.id+":"+this.message.getContent().file):(new Wn.ContactMessagesDialog({user:this.user,contact:this.contact})).open()},displayContent:function(){"message"==this.message.getType()?this.label.setText(this.message.getContent()):"contact"==this.message.getType()?this.label.setText("Vous a ajout\u00e9 \u00e0 ses contacts"):"resource"==this.message.getType()?this.label.setText(this.message.getContent().name):
"comment"==this.message.getType()&&this.label.setText(this.message.getContent().text)}});Ui.LBox.extend("Wn.Preview",{user:void 0,resource:void 0,constructor:function(a){this.setWidth(190);this.setHeight(190);this.resource=a.resource;delete a.resource;this.user=a.user;delete a.user},getResource:function(){return this.resource},getUser:function(){return this.user}},{},{previews:void 0,constructor:function(){this.previews={}},register:function(a,b){Wn.Preview.previews[a]=b},getPreview:function(a){return Wn.Preview.previews[a]}});Ui.LBox.extend("Wn.Viewer",{user:void 0,constructor:function(a){this.user=a.user;delete a.user},getUser:function(){return this.user}},{},{viewers:void 0,constructor:function(){this.viewers={}},register:function(a,b){Wn.Viewer.viewers[a]=b},getViewer:function(a){return Wn.Viewer.viewers[a]}});Ui.Dialog.extend("Wn.ResourcePropertiesDialog",{user:void 0,resource:void 0,flow:void 0,deleteButton:void 0,modifyButton:void 0,nameField:void 0,bookmarkField:void 0,constructor:function(a){this.user=a.user;delete a.user;this.resource=a.resource;delete a.resource;this.setPreferredWidth(500);this.setPreferredHeight(500);this.setFullScrolling(!0);this.setTitle("Propri\u00e9t\u00e9s de la ressource");this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.VBox;this.setContent(a);this.nameField=new Wn.TextField({title:"Nom",
width:200,value:this.resource.getName()});a.append(this.nameField);this.resource.getOwnerId()!==this.user.getId()&&(this.bookmarkField=new Wn.CheckField({title:"Favoris",width:200,value:this.resource.getBookmark(),text:"afficher sur ma page d'accueil"}),a.append(this.bookmarkField));var b=new Wn.ResourceSharesSection({user:this.user,resource:this.resource});a.append(b);b=this.user.getRfidsFromPath("resource:"+this.resource.getId());b=new Wn.RfidSection({user:this.user,tags:b,path:"resource:"+this.resource.getId()});
a.append(b);Ui.App.current.getUser().isAdmin()||this.resource.canWrite()?(this.deleteButton=new Wn.AlertButton({text:"Supprimer"}),this.connect(this.deleteButton,"press",this.onDeletePress),this.saveButton=new Ui.DefaultButton({text:"Enregistrer"}),this.connect(this.saveButton,"press",this.onSavePress),this.setActionButtons([this.deleteButton,this.saveButton])):this.nameField.disable()},onSavePress:function(){this.resource.getName()!==this.nameField.getValue()&&this.resource.changeData({name:this.nameField.getValue()});
void 0!==this.bookmarkField&&this.resource.getBookmark()!==this.bookmarkField.getValue()&&(this.bookmarkField.getValue()?this.resource.bookmark():this.resource.unbookmark());this.close()},onDeletePress:function(){var a=new Wn.ResourceDeleteDialog({resource:this.resource});this.connect(a,"done",function(){this.close()});a.open()}});Ui.Dialog.extend("Wn.ResourceSharesModifyDialog",{flow:void 0,selection:void 0,modifyButton:void 0,shareField:void 0,writeField:void 0,constructor:function(a){this.selection=a.selection;delete a.selection;this.setPreferredWidth(400);this.setPreferredHeight(400);this.setFullScrolling(!0);this.setTitle("Modification des droits");this.setCancelButton(new Ui.DialogCloseButton);this.modifyButton=new Ui.DefaultButton({text:"Appliquer"});this.connect(this.modifyButton,"press",this.onModifyPress);this.setActionButtons([this.modifyButton]);
a=new Ui.VBox;this.setContent(a);var b=new Ui.HBox({uniform:!0});a.append(b);this.writeField=new Ui.CheckBox({text:"Ecriture"});this.selection[0].getResource().canWrite()&&b.append(this.writeField);this.shareField=new Ui.CheckBox({text:"Partage"});b.append(this.shareField);this.flow=new Ui.Flow({uniform:!0,margin:20});a.append(this.flow);for(var b=a=!0,c=0;c<this.selection.length;c++){var d=this.selection[c],e=d.getRight(),f=d.getResource(),d=d.getUser();a&=e.share;b&=e.write;e=-1==e.user_id?new Wn.ResourceWorldRight({resource:f,
user:d,right:e,margin:5}):new Wn.ResourceContactRight({resource:f,user:d,right:e,margin:5});e.disable();this.flow.append(e)}this.writeField.setValue(b);this.shareField.setValue(a)},onModifyPress:function(){for(var a=0;a<this.selection.length;a++){var b=this.selection[a],c=Core.Util.clone(b.getRight());c.share=this.shareField.getValue();b=b.getResource();b.canWrite()&&(c.write=this.writeField.getValue());-1==c.user_id?b.addPublicRights(c):b.addRights(c)}this.close()}});
Wn.SelectionButton.extend("Wn.ResourceRight",{},{getSelectionActions:function(){return Wn.ResourceRight.rightActions}},{rightActions:void 0,constructor:function(){Wn.ResourceRight.rightActions={"delete":{text:"Supprimer",icon:"trash",color:"#d02020",callback:Wn.ResourceRight.onRightDelete,multiple:!0},edit:{"default":!0,text:"Editer",icon:"pen",callback:Wn.ResourceRight.onRightEdit,multiple:!0}}},onRightEdit:function(a){a=a.getElements();(new Wn.ResourceSharesModifyDialog({selection:a})).open()},
onRightDelete:function(a){for(var b=a.getElements(),c=0;c<b.length;c++)b[c].deleteRight();a.clear()}});
Wn.ResourceRight.extend("Wn.ResourceContactRight",{user:void 0,right:void 0,contact:void 0,resource:void 0,image:void 0,label:void 0,shareRight:void 0,writeRight:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.user=a.user;delete a.user;this.right=a.right;delete a.right;a=new Ui.LBox({horizontalAlign:"center",verticalAlign:"bottom"});a.append(new Ui.Rectangle({fill:"#f1f1f1"}));this.image=new Ui.Image({width:46,height:46});a.append(this.image);var b=new Ui.HBox({uniform:!0,
verticalAlign:"bottom",horizontalAlign:"right",margin:3});this.shareRight=new Ui.DualIcon({icon:"share",fill:"#f1f1f1",width:20,height:20});b.append(this.shareRight);this.writeRight=new Ui.DualIcon({icon:"pen",fill:"#f1f1f1",width:20,height:20});b.append(this.writeRight);a.append(b);this.setIcon(a);this.contact=Wn.Contact.getContact(this.right.user_id)},getUser:function(){return this.user},getRight:function(){return this.right},getResource:function(){return this.resource},deleteRight:function(){this.resource.addRights({user_id:this.right.user_id,
read:!1,write:!1,share:!1})},changeRight:function(a){this.resource.addRights({user_id:this.right.user_id,read:a.read,write:a.write,share:a.share})},onResourceChange:function(){for(var a={},b=0;b<this.resource.getRights().length;b++)this.resource.getRights()[b].user_id==this.right.user_id&&(a=this.resource.getRights()[b]);a.share?this.shareRight.show():this.shareRight.hide();a.write?this.writeRight.show():this.writeRight.hide()},onContactChange:function(){this.setText(this.contact.getName());this.image.setSrc(this.contact.getFaceUrl())}},
{onLoad:function(){Wn.ResourceContactRight.base.onLoad.call(this);this.connect(this.contact,"change",this.onContactChange);if(this.contact.getIsReady())this.onContactChange();this.connect(this.resource,"change",this.onResourceChange);if(this.resource.getIsReady())this.onResourceChange()},onUnload:function(){Wn.ResourceContactRight.base.onUnload.call(this);this.disconnect(this.contact,"change",this.onContactChange);this.disconnect(this.resource,"change",this.onResourceChange)}});
Wn.ResourceRight.extend("Wn.ResourceWorldRight",{user:void 0,right:void 0,resource:void 0,image:void 0,label:void 0,shareRight:void 0,writeRight:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.user=a.user;delete a.user;this.right=a.right;this.right.user_id=-1;delete a.right;this.setIcon("earth");a=new Ui.HBox({uniform:!0,verticalAlign:"bottom",horizontalAlign:"right",margin:3});this.shareRight=new Ui.DualIcon({icon:"share",fill:"#f1f1f1",width:20,height:20});a.append(this.shareRight);
this.writeRight=new Ui.DualIcon({icon:"pen",fill:"#f1f1f1",width:20,height:20});a.append(this.writeRight);this.getIconBox().append(a);this.setText("Tout le monde")},getUser:function(){return this.user},getRight:function(){return this.right},getResource:function(){return this.resource},deleteRight:function(){this.resource.addPublicRights({read:!1,write:!1,share:!1})},changeRight:function(a){this.resource.addPublicRights({read:a.read,write:a.write,share:a.share})},onResourceChange:function(){var a=
this.resource.getPublicRights();a.share?this.shareRight.show():this.shareRight.hide();a.write?this.writeRight.show():this.writeRight.hide()}},{onLoad:function(){Wn.ResourceWorldRight.base.onLoad.call(this);this.connect(this.resource,"change",this.onResourceChange);if(this.resource.getIsReady())this.onResourceChange()},onUnload:function(){Wn.ResourceWorldRight.base.onUnload.call(this);this.disconnect(this.resource,"change",this.onResourceChange)}});
Wn.ListAddButton.extend("Wn.ResourceContactAdd",{user:void 0,resource:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.user=a.user;delete a.user;this.connect(this,"press",this.onAddPress)},onAddPress:function(){(new Wn.AddContactRightDialog({user:this.user,resource:this.resource})).open()}});
Wn.OptionSection.extend("Wn.ResourceSharesSection",{user:void 0,resource:void 0,flow:void 0,deleteButton:void 0,modifyButton:void 0,selection:void 0,constructor:function(a){this.user=a.user;delete a.user;this.resource=a.resource;delete a.resource;this.setTitle("Partages");this.flow=new Ui.Flow({uniform:!0});this.setContent(this.flow)},onModifyPress:function(){for(var a=[],b=0;b<this.selection.length;b++)a.push(this.selection[b].getRight());(new Wn.ResourceSharesModifyDialog({user:this.user,resource:this.resource,
selection:a})).open()},deleteSelected:function(){for(var a=0;a<this.selection.length;a++){var b=this.selection[a];b.deleteRight();this.flow.remove(b)}},onResourceChange:function(){for(;void 0!==this.flow.getFirstChild();)this.flow.remove(this.flow.getFirstChild());if(this.resource.getPublicRights().read){var a=new Wn.ResourceWorldRight({resource:this.resource,user:this.user,right:this.resource.getPublicRights()});this.resource.canShare()||a.disable();this.flow.append(a)}for(var b=0;b<this.resource.getRights().length;b++)a=
this.resource.getRights()[b],a=new Wn.ResourceContactRight({resource:this.resource,user:this.user,right:a}),this.resource.canShare()||a.disable(),this.flow.append(a);this.resource.canShare()&&(b=new Wn.ResourceContactAdd({resource:this.resource,user:this.user,verticalAlign:"center",horizontalAlign:"center"}),this.flow.append(b))},onDrop:function(a,b,c){this.resource.addRights({user_id:c,read:!0,write:!0,share:!0})}},{onLoad:function(){Wn.ResourceSharesSection.base.onLoad.call(this);this.connect(this.resource,
"change",this.onResourceChange);if(this.resource.getIsReady())this.onResourceChange()},onUnload:function(){Wn.ResourceSharesSection.base.onUnload.call(this);this.disconnect(this.resource,"change",this.onResourceChange)}});Ui.Dialog.extend("Wn.ResourceDeleteDialog",{resource:void 0,constructor:function(a){this.addEvents("done");this.resource=a.resource;delete a.resource;this.setPreferredWidth(300);this.setPreferredHeight(200);this.setFullScrolling(!0);this.setTitle("Suppression");Ui.App.current.getUser().isAdmin()||this.resource.canWrite()?(this.setCancelButton(new Ui.DialogCloseButton({text:"Annuler"})),this.setContent(new Ui.Text({text:"Voulez vous vraiment supprimer cette ressource pour vous et toutes les personnes avec qui vous la partag\u00e9e ?"})),
a=new Ui.DefaultButton({text:"Supprimer"}),this.connect(a,"press",function(){this.close();this.resource.deleteResource();this.fireEvent("done",this,this.resource)}),this.setActionButtons([a])):(this.setCancelButton(new Ui.DialogCloseButton),this.setContent(new Ui.Text({text:"Voulez n'avez pas les droits n\u00e9cessaires pour supprimer cette ressource"})))}});Ui.CompactLabel.extend("Wn.ResourceViewerTitle",{constructor:function(a){this.setMaxLine(2);this.setWidth(100)}});
Ui.DropBox.extend("Wn.ResourceViewer",{resource:void 0,path:void 0,user:void 0,contact:void 0,isFullscreen:!1,propertyButton:void 0,actions:void 0,actionButtons:void 0,constructor:function(a){this.addEvents("change");this.user=a.user;delete a.user;this.resource=a.resource;delete a.resource;this.actions=[];"contact"in a&&(this.contact=a.contact,delete a.contact);"path"in a&&(this.path=a.path,delete a.path);this.propertyButton=new Ui.Button({icon:"resourcetools",text:"Outils"});this.actions.push(this.propertyButton);
this.connect(this.propertyButton,"press",function(){(new Wn.ResourcePropertiesDialog({user:this.user,resource:this.resource})).open()});this.addMimetype(Wn.MenuContact);this.connect(this,"drop",this.onUserDrop);this.resource.markSeenByMe();this.user.watchResource(this.getResource())},getTitle:function(){return this.resource.getName()},getActions:function(){if(void 0===this.actionButtons||0===this.actionButtons.length)return this.actions;var a,b=[];for(a=0;a<this.actionButtons.length;a++)b.push(this.actionButtons[a]);
for(a=0;a<this.actions.length;a++)b.push(this.actions[a]);return b},getIsFullscreen:function(){return this.isFullscreen},fullscreen:function(){this.isFullscreen||(this.isFullscreen=!0)},unfullscreen:function(){this.isFullscreen&&(this.isFullscreen=!1)},deleteResource:function(){this.user.removeResource(this.resource);Ui.App.current.setDefaultMain()},setActionButtons:function(a){this.actionButtons=a;this.fireEvent("change",this)},getResource:function(){return this.resource},getPath:function(){return this.path},
setPath:function(a){this.path!==a&&(this.onPathChange(this.path,a),this.path=a)},getUser:function(){return this.user},onUserDrop:function(a,b,c){this.resource.canShare()&&(a={user_id:c.getContact().getId(),read:!0,share:this.user.getData().default_share_right},this.resource.canWrite()&&this.user.getData().default_write_right&&(a.write=!0),this.resource.addRights(a))},onPathChange:function(a,b){},onResourceChange:function(){this.fireEvent("change",this);this.resource.markSeenByMe()},onDeletePress:function(){if(this.resource.canWrite()){var a=
new Ui.Dialog({preferredWidth:300,preferredHeight:200,fullScrolling:!0,title:"Suppression",cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous vraiment supprimer cette ressource pour vous et toutes les personnes avec qui vous la partag\u00e9e ?"})}),b=new Wn.AlertButton({text:"Supprimer"});this.connect(b,"press",function(){a.close();this.deleteResource()});a.setActionButtons([b]);a.open()}},onSelectionChange:function(a){0===a.getElements().length?(this.contextBox.hide(),
this.actionBox.show()):(this.contextBox.show(),this.actionBox.hide())},onResourceDelete:function(){Ui.App.current.setDefaultMain()}},{onLoad:function(){Wn.ResourceViewer.base.onLoad.call(this);this.connect(this.resource,"change",this.onResourceChange);this.connect(this.resource,"delete",this.onResourceDelete)},onUnload:function(){Wn.ResourceViewer.base.onUnload.call(this);this.disconnect(this.resource,"delete",this.onResourceDelete);this.disconnect(this.resource,"change",this.onResourceChange)}},
{style:{background:"#f1f1f1"},apps:void 0,constructor:function(){this.apps={}},register:function(a,b){Wn.ResourceViewer.apps[a]=b},getApplication:function(a){return Wn.ResourceViewer.apps[a]}});Ui.LBox.extend("Wn.MenuSwitch",{pos:1,movable:void 0,switchbox:void 0,value:!1,alignClock:void 0,speed:0,animNext:0,animStart:0,ease:void 0,constructor:function(a){this.setFocusable(!0);this.setClipToBounds(!0);this.movable=new Ui.Movable({moveVertical:!1,margin:1,marginBottom:2});this.movable.setFocusable(!1);this.append(this.movable);this.switchbox=new Wn.SwitchBox;this.movable.setContent(this.switchbox);this.connect(this.movable,"move",this.onMove);this.connect(this.movable,"down",this.onDown);
this.connect(this.movable,"up",this.onUp);this.addEvents("change");"ease"in a?this.setEase(a.ease):this.ease=Anim.EasingFunction.create({type:Anim.PowerEase,mode:"out"})},setEase:function(a){this.ease=Anim.EasingFunction.create(a)},getMenu:function(){return this.switchbox.getButton()},setMenu:function(a){this.switchbox.setButton(a)},getContent1:function(){return this.switchbox.getContent1()},setContent1:function(a){this.switchbox.setContent1(a)},getContent2:function(){return this.switchbox.getContent2()},
setContent2:function(a){this.switchbox.setContent2(a)},getValue:function(){return this.value},setPos:function(a){this.pos=a;this.value=0.5>this.pos;this.invalidateArrange()},setValue:function(a){this.value!=a&&((this.value=a)?this.startAnimation(2):this.startAnimation(-2))},onMove:function(a){a=this.movable.getPositionX();var b=this.switchbox.getContentWidth();a=Math.min(0,Math.max(a,-b));this.pos=-a/b;this.updatePos()},onDown:function(a){this.focus();this.stopAnimation()},onUp:function(a,b,c,d,e,
f){b=100>Math.abs(b)?0.5<this.pos?-1:1:b/this.switchbox.getContentWidth();0!=b&&this.startAnimation(b)},updatePos:function(){var a=this.switchbox.getContentWidth();this.movable.setPosition(-this.pos*a,void 0)},startAnimation:function(a){this.stopAnimation();this.speed=a;this.animStart=this.pos;this.animNext=0>this.speed?1:0;this.animStart!=this.animNext?(this.alignClock=new Anim.Clock({duration:"forever",target:this}),this.connect(this.alignClock,"timeupdate",this.onAlignTick),this.alignClock.begin()):
this.value!=(0==this.animNext)&&(this.value=0==this.animNext,this.fireEvent("change",this,this.value))},stopAnimation:function(){void 0!=this.alignClock&&(this.alignClock.stop(),this.alignClock=void 0)},onAlignTick:function(a,b,c){0!=c&&(a=-(a.getTime()*this.speed)/(this.animNext-this.animStart),1<=a&&(this.alignClock.stop(),this.alignClock=void 0,a=1,this.value=0==this.animNext,this.fireEvent("change",this,this.value)),a=this.ease.ease(a),this.pos=this.animStart+a*(this.animNext-this.animStart),
this.updatePos())}},{arrangeCore:function(a,b){Wn.MenuSwitch.base.arrangeCore.call(this,a,b);this.updatePos()}});
Ui.Container.extend("Wn.SwitchBox",{content1:void 0,content1Box:void 0,content2:void 0,content2Box:void 0,button:void 0,buttonBox:void 0,constructor:function(){this.content1Box=new Ui.LBox;this.appendChild(this.content1Box);this.buttonBox=new Ui.LBox;this.appendChild(this.buttonBox);this.content2Box=new Ui.LBox;this.appendChild(this.content2Box)},getButton:function(){return this.button},setButton:function(a){this.button!=a&&(void 0!=this.button&&this.buttonBox.remove(this.button),this.button=a,void 0!=
this.button&&this.buttonBox.append(this.button))},getContent1:function(){return this.content1},setContent1:function(a){this.content1!=a&&(void 0!=this.content1&&this.content1Box.remove(this.content1),this.content1=a,void 0!=this.content1&&this.content1Box.append(this.content1))},getContent2:function(){return this.content2},setContent2:function(a){this.content2!=a&&(void 0!=this.content2&&this.content2Box.remove(this.content2),this.content2=a,void 0!=this.content2&&this.content2Box.append(this.content2))},
getContentWidth:function(){return this.getLayoutWidth()-this.buttonBox.getLayoutWidth()}},{measureCore:function(a,b){var c=this.buttonBox.measure(0,0),d=this.content1Box.measure(a-c.width,b),e=this.content2Box.measure(a-c.width,b);return{width:Math.max(d.width,e.width)+c.width,height:Math.max(d.height,Math.max(e.height,c.height))}},arrangeCore:function(a,b){var c=a-this.buttonBox.getMeasureWidth();this.content1Box.arrange(0,0,c,b);this.content2Box.arrange(c+this.buttonBox.getMeasureWidth(),0,c,b);
this.buttonBox.arrange(c,0,this.buttonBox.getMeasureWidth(),b)}});Ui.Fixed.extend("Wn.CroppedImage",{image:void 0,src:void 0,constructor:function(a){this.setClipToBounds(!0);"src"in a?(this.src=a.src,delete a.src,this.image=new Ui.Image({src:this.src})):this.image=new Ui.Image;this.append(this.image,0,0);this.connect(this.image,"ready",this.onReady);this.connect(this,"resize",this.onResize);this.addEvents("ready")},setSrc:function(a){this.src=a;this.image.setSrc(this.src)},getIsReady:function(){return this.image.getIsReady()},onReady:function(){this.updateSize();
this.fireEvent("ready",this)},onResize:function(){this.updateSize()},updateSize:function(){var a=this.image.getNaturalWidth(),b=this.image.getNaturalHeight(),c=this.getLayoutWidth(),d=this.getLayoutHeight();if(a/b>c/d){var e=d,f=a*e/b;this.setPosition(this.image,-(f-c)/2,0)}else f=c,e=b*f/a,this.setPosition(this.image,0,-(e-d)/2);this.image.setWidth(f);this.image.setHeight(e)}});Ui.CanvasElement.extend("Wn.ScaledImage",{image:void 0,constructor:function(a){this.image=new Ui.Image;this.connect(this.image,"ready",this.onImageReady);this.appendChild(this.image)},setSrc:function(a){this.src=a;this.image.setSrc(this.src)},getIsReady:function(){return this.image.getIsReady()},onImageReady:function(){this.invalidateDraw()}},{canvasEngine:"canvas",updateCanvas:function(a){if(this.image.getIsReady()){var b=this.image.getNaturalWidth(),c=this.image.getNaturalHeight(),d=this.getLayoutWidth(),
e=this.getLayoutHeight(),f,g;b<=d&&c<=e?(d=(d-b)/2,e=(e-c)/2,f=b,g=c):b/c<d/e?(g=e,f=b*g/c,d=-(f-d)/2,e=0):(f=d,g=c*f/b,d=0,e=-(g-e)/2);a.drawImage(this.image.getDrawing(),0,0,b,c,d,e,f,g)}}});Ui.Fixed.extend("Wn.ScaledImage2",{image:void 0,src:void 0,mode:"fit",constructor:function(a){"mode"in a&&(this.mode=a.mode,delete a.mode);this.setClipToBounds(!0);"src"in a?(this.src=a.src,delete a.src,this.image=new Ui.Image({src:this.src})):this.image=new Ui.Image;this.append(this.image,0,0);this.connect(this.image,"ready",this.onReady);this.connect(this,"resize",this.onResize);this.addEvents("ready")},setSrc:function(a){this.src=a;this.image.setSrc(this.src)},getIsReady:function(){return this.image.getIsReady()},
onReady:function(){this.updateSize();this.fireEvent("ready",this)},onResize:function(){this.updateSize()},updateSize:function(){"fit"===this.mode?this.updateSizeFit():this.updateSizeCrop()},updateSizeCrop:function(){if(this.image.getIsReady()){var a=this.image.getNaturalWidth(),b=this.image.getNaturalHeight(),c=this.getLayoutWidth(),d=this.getLayoutHeight(),a=a/b;if(a<c/d){var b=c,e=b/a;this.setPosition(this.image,0,-(e-d)/2)}else e=d,b=e*a,this.setPosition(this.image,-(b-c)/2,0);this.image.setWidth(b);
this.image.setHeight(e)}},updateSizeFit:function(){var a=this.image.getNaturalWidth(),b=this.image.getNaturalHeight(),c=this.getLayoutWidth(),d=this.getLayoutHeight();if(a<=c&&b<=d)this.setPosition(this.image,(c-a)/2,(d-b)/2),this.image.setWidth(a),this.image.setHeight(b);else{if(a/b<c/d){var e=d,f=a*e/b;this.setPosition(this.image,-(f-c)/2,0)}else f=c,e=b*f/a,this.setPosition(this.image,0,-(e-d)/2);this.image.setWidth(f);this.image.setHeight(e)}}});Ui.Button.extend("Wn.AppView",{user:void 0,constructor:function(a){this.user=a.user;delete a.user;this.resource=a.resource;delete a.resource;this.getIconBox().setVerticalAlign("center");this.getIconBox().setHorizontalAlign("center")}});Wn.AppView.extend("Wn.ResourceNew",{constructor:function(a){this.setIcon("plus");this.connect(this,"press",this.onResourceNewPress)},onResourceNewPress:function(){(new Wn.ResourceWizard({user:this.user})).open()}});Core.Object.extend("Wn.ResourceCreator",{data:void 0,user:void 0,isDone:!1,constructor:function(a){this.data=a.data;delete a.data;this.user=a.user;delete a.user;this.addEvents("done")},getIsDone:function(){return this.isDone},getData:function(){return this.data},getUser:function(){return this.user},done:function(){this.isDone||(this.isDone=!0,this.fireEvent("done"))}});Ui.LBox.extend("Wn.WizardItem",{data:void 0,isDone:!1,constructor:function(a){this.data=a.data;delete a.data;this.addEvents("done")},getData:function(){return this.data},getIsDone:function(){return this.isDone},done:function(){this.isDone||(this.isDone=!0,this.fireEvent("done"))},save:function(){this.onSave()},onSave:function(){}});Wn.WizardItem.extend("Wn.ResourceWizardSelector",{selectType:void 0,constructor:function(a){var b=new Ui.SFlow({uniform:!0,spacing:10,itemAlign:"stretch",stretchMaxRatio:2});this.setContent(b);for(var c=Wn.ResourceWizard.getWizardTypes(),d=0;d<c.length;d++){var e=Wn.ResourceWizard.getWizard(c[d]),e=new Ui.Button({icon:e.icon,text:e.name,orientation:"horizontal",width:150});this.connect(e,"press",this.onItemPress);e.hostResourceWizardSelector=c[d];b.append(e)}delete a.wizardType},getSelectedType:function(){return this.selectType},
onItemPress:function(a){this.selectType=a.hostResourceWizardSelector;this.fireEvent("done",this)}});
Ui.Dialog.extend("Wn.ResourceWizard",{user:void 0,previousButton:void 0,nextButton:void 0,transBox:void 0,position:0,current:void 0,wizardType:void 0,data:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setFullScrolling(!0);this.setPreferredWidth(450);this.setPreferredHeight(400);this.data={};this.setTitle("Nouvelle ressource");this.setCancelButton(new Ui.DialogCloseButton({text:"Annuler"}));this.previousButton=new Ui.Button({text:"Pr\u00e9c\u00e9dent"});this.previousButton.hide();
this.connect(this.previousButton,"press",this.onPreviousPress);this.nextButton=new Ui.DefaultButton({text:"Suivant"});this.connect(this.nextButton,"press",this.onNextPress);this.setActionButtons([this.previousButton,this.nextButton]);this.transBox=new Ui.TransitionBox;this.setContent(this.transBox);this.current=new Wn.ResourceWizardSelector;this.transBox.replaceContent(this.current);this.connect(this.current,"done",this.onItemDone);this.nextButton.disable();this.nextButton.hide()},onPreviousPress:function(){this.position--;
this.disconnect(this.current,"done",this.onItemDone);this.current.save();0>this.position&&(this.position=0);if(0==this.position)this.setTitle("Nouvelle ressource"),this.current=new Wn.ResourceWizardSelector({wizardType:this.wizardType}),this.nextButton.hide(),this.previousButton.hide();else{var a=Wn.ResourceWizard.getWizard(this.wizardType);this.setTitle(a.name);this.current=new a.array[this.position-1]({data:this.data})}this.nextButton.setText("Suivant");this.connect(this.current,"done",this.onItemDone);
this.transBox.replaceContent(this.current);this.current.getIsDone()?this.nextButton.enable():this.nextButton.disable()},onItemDone:function(){this.nextButton.enable();if(0==this.position)this.onNextPress()},onNextPress:function(){this.position++;this.disconnect(this.current,"done",this.onItemDone);this.current.save();this.nextButton.disable();this.previousButton.show();1==this.position&&(this.nextButton.show(),this.wizardType!=this.current.getSelectedType()&&(this.wizardType=this.current.getSelectedType(),
this.data={}));var a=Wn.ResourceWizard.getWizard(this.wizardType);if(this.position>a.array.length)if(a=new a.creator({user:this.user,data:this.data}),this.disable(),a.getIsDone())this.onCreateDone();else this.connect(a,"done",this.onCreateDone);else this.setTitle(a.name),this.current=new a.array[this.position-1]({data:this.data}),this.position==a.array.length?this.nextButton.setText("Cr\u00e9er"):this.nextButton.setText("Suivant"),this.connect(this.current,"done",this.onItemDone),this.transBox.replaceContent(this.current)},
onCreateDone:function(){this.close()}},{},{apps:void 0,constructor:function(){this.apps={}},register:function(a,b,c,d,e){Wn.ResourceWizard.apps[a]={name:b,icon:c,array:d,creator:e}},getWizardTypes:function(){var a=[],b;for(b in Wn.ResourceWizard.apps)a.push(b);return a},getWizard:function(a){return Wn.ResourceWizard.apps[a]}});Core.Object.extend("Wn.LoginCreator",{data:void 0,session:void 0,isDone:!1,constructor:function(a){this.data=a.data;delete a.data;this.session=a.session;delete a.session;this.addEvents("done","fail")},getIsDone:function(){return this.isDone},getData:function(){return this.data},getSession:function(){return this.session},done:function(a){this.isDone||(this.isDone=!0,this.fireEvent("done",this,a))},fail:function(){this.fireEvent("fail",this)}});Wn.WizardItem.extend("Wn.LoginWizardSelector",{selectItem:void 0,setup:void 0,constructor:function(a){this.addEvents("choose");this.setup=a.setup;delete a.setup;var b=new Ui.VBox({spacing:10});this.setContent(b);b.append(new Wn.RatioImage({src:"img/login_logo.png"}));var c=new Ui.VBox({uniform:!0,spacing:10});b.append(c);for(b=0;b<this.setup.authentication.services.length;b++){var d=this.setup.authentication.services[b],e=Wn.LoginWizard.getWizard(d.type);if(void 0!==e){var f=e.name;void 0!==d.name&&
(f=d.name);e=new Ui.Button({icon:e.icon,text:f,orientation:"horizontal"});this.connect(e,"press",this.onItemPress);e.hostLoginWizardSelector=d.type;c.append(e)}}delete a.wizardType},getSelectedType:function(){return this.selectItem.hostLoginWizardSelector},onItemPress:function(a){this.selectItem=a;this.fireEvent("done",this)}});
Ui.Dialog.extend("Wn.LoginWizard",{previousButton:void 0,nextButton:void 0,transBox:void 0,position:0,current:void 0,wizardType:void 0,data:void 0,setup:void 0,constructor:function(a){this.addEvents("done");this.setup=a.setup;delete a.setup;this.setAutoClose(!1);this.setTitle("Connexion");this.setFullScrolling(!0);this.setPreferredWidth(450);this.setPreferredHeight(450);this.data={};this.previousButton=new Ui.Button({text:"Pr\u00e9c\u00e9dent"});this.previousButton.hide();this.connect(this.previousButton,
"press",this.onPreviousPress);this.nextButton=new Ui.DefaultButton({text:"Suivant"});this.connect(this.nextButton,"press",this.onNextPress);this.transBox=new Ui.TransitionBox;this.setContent(this.transBox);this.current=new Wn.LoginWizardSelector({setup:this.setup});this.transBox.replaceContent(this.current);this.connect(this.current,"done",this.onItemDone);this.nextButton.disable()},onPreviousPress:function(){this.position--;this.disconnect(this.current,"done",this.onItemDone);this.current.save();
0>this.position&&(this.position=0);if(0==this.position)this.setTitle("Connexion"),this.current=new Wn.LoginWizardSelector({wizardType:this.wizardType,setup:this.setup}),this.previousButton.hide(),this.setActionButtons(void 0);else{var a=Wn.LoginWizard.getWizard(this.wizardType);this.setTitle(a.name);this.current=new a.array[this.position-1]({data:this.data})}this.nextButton.setText("Suivant");this.connect(this.current,"done",this.onItemDone);this.transBox.replaceContent(this.current);this.current.getIsDone()?
this.nextButton.enable():this.nextButton.disable()},onItemDone:function(){if(0==this.position)this.onNextPress();this.nextButton.enable()},findSetup:function(a){for(var b=0;b<this.setup.authentication.services.length;b++){var c=this.setup.authentication.services[b];if(c.type===a)return c}},onNextPress:function(){this.position++;this.disconnect(this.current,"done",this.onItemDone);this.current.save();this.nextButton.disable();this.previousButton.show();1==this.position&&(this.setActionButtons([this.previousButton,
this.nextButton]),this.wizardType!=this.current.getSelectedType()&&(this.wizardType=this.current.getSelectedType(),this.data={}));var a=Wn.LoginWizard.getWizard(this.wizardType),b=this.findSetup(this.wizardType);this.position>a.array.length?(a=new a.creator({data:this.data,item:this.current}),this.disable(),this.connect(a,"done",this.onCreatorDone),this.connect(a,"fail",this.onCreatorFail)):(this.setTitle(void 0!==b.name?b.name:a.name),this.current=new a.array[this.position-1]({data:this.data}),this.position==
a.array.length?this.nextButton.setText(a.endlabel):this.nextButton.setText("Suivant"),this.connect(this.current,"done",this.onItemDone),this.transBox.replaceContent(this.current))},onCreatorDone:function(a,b){this.close();this.fireEvent("done",this,b)},onCreatorFail:function(){this.enable();this.position--;this.nextButton.enable()}},{},{apps:void 0,constructor:function(){this.apps={}},register:function(a,b,c,d,e,f){Wn.LoginWizard.apps[a]={name:b,icon:c,array:d,creator:e,endlabel:f}},getWizardTypes:function(){var a=
[],b;for(b in Wn.LoginWizard.apps)a.push(b);return a},getWizard:function(a){return Wn.LoginWizard.apps[a]}});Wn.SelectionButton.extend("Wn.AddContactIcon",{user:void 0,contact:void 0,dialog:void 0,image:void 0,label:void 0,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.dialog=a.dialog;delete a.dialog;a=new Ui.LBox({horizontalAlign:"center"});this.setIcon(a);a.append(new Ui.Rectangle({fill:"#f1f1f1"}));this.image=new Ui.Image({width:64,height:64,src:this.contact.getFaceUrl()});a.append(this.image)},getContact:function(){return this.contact},onContactChange:function(){this.setText(this.contact.getName())}},
{onStyleChange:function(){Wn.AddContactIcon.base.onStyleChange.apply(this,arguments);var a=this.getStyleProperty("iconSize");this.image.setWidth(a);this.image.setHeight(a)},getSelectionActions:function(){return Wn.AddContactIcon.contactActions},onLoad:function(){Wn.AddContactIcon.base.onLoad.call(this);this.connect(this.contact,"change",this.onContactChange);if(this.contact.getIsReady())this.onContactChange()},onUnload:function(){Wn.AddContactIcon.base.onUnload.call(this);this.disconnect(this.contact,
"change",this.onContactChange)}},{contactActions:void 0,constructor:function(){Wn.AddContactIcon.contactActions={profil:{text:"Profil",icon:"person",testRight:Wn.AddContactIcon.testIsAdmin,callback:Wn.AddContactIcon.onContactProfil,multiple:!1},view:{"default":!0,text:"Voir",icon:"eye",callback:Wn.AddContactIcon.onContactView,multiple:!1},add:{text:"Ajouter",icon:"plus",testRight:Wn.AddContactIcon.testAddContactRight,callback:Wn.AddContactIcon.onContactAdd,multiple:!0}}},testAddContactRight:function(){return Ui.App.current.getUser().getId()!==
this.contact.getId()&&void 0===Ui.App.current.getUser().getContact(this.contact.getId())},testIsAdmin:function(){return Ui.App.current.getUser().isAdmin()},onContactAdd:function(a){for(var b=[],c=0;c<a.getElements().length;c++){var d=a.getElements()[c];b.push(d.getContact())}Ui.App.current.getUser().prependContacts(b);void 0!==a.getElements()[0].dialog&&a.getElements()[0].dialog.close()},onContactView:function(a){Ui.App.current.setMainPath("user:"+a.getElements()[0].getContact().getId());a.getElements()[0].dialog.close()},
onContactProfil:function(a){(new Wn.UserProfil({user:a.getElements()[0].getContact()})).open();a.getElements()[0].dialog.close()}});
Wn.AddContactIcon.extend("Wn.AddContactRightIcon",{constructor:function(){}},{getSelectionActions:function(){return Wn.AddContactRightIcon.contactActions}},{contactActions:void 0,constructor:function(){Wn.AddContactRightIcon.contactActions={add:{text:"Ajouter",icon:"plus",callback:Wn.AddContactRightIcon.onContactRightAdd,multiple:!0}}},onContactRightAdd:function(a){for(var b=0;b<a.getElements().length;b++){var c=a.getElements()[b],d=c.dialog.getRights(),e=c.dialog.getResource();d.user_id=c.getContact().getId();
e.addRights(d)}a.getElements()[0].dialog.close()}});Wn.SelectionButton.extend("Wn.AddWorldIcon",{user:void 0,dialog:void 0,constructor:function(a){this.user=a.user;delete a.user;this.dialog=a.dialog;delete a.dialog;this.setIcon("earth");this.setText("Tout le monde")},onWorldRightAdd:function(a){a=a.getElements()[0];var b=a.dialog.getRights();a.dialog.getResource().addPublicRights(b);a.dialog.close()}},{getSelectionActions:function(){return{add:{text:"Ajouter",icon:"plus",callback:this.onWorldRightAdd,multiple:!1}}}});Ui.Dialog.extend("Wn.AddContactDialog",{user:void 0,flow:void 0,searchField:void 0,searchRequest:void 0,constructor:function(a){this.addEvents("add");this.user=a.user;delete a.user;this.setFullScrolling(!0);this.setPreferredWidth(500);this.setPreferredHeight(500);this.setTitle("Rechercher des contacts");this.setCancelButton(new Ui.DialogCloseButton);this.searchField=new Ui.TextButtonField({buttonIcon:"search",width:150});Ui.Box.setResizable(this.searchField,!0);this.setActionButtons([this.searchField]);
this.connect(this.searchField,"validate",this.onSearchValidate);this.flow=new Ui.Flow({uniform:!0,verticalAlign:"top"});this.setContent(this.flow)},onSearchValidate:function(){void 0!==this.searchRequest&&(this.disconnect(this.searchRequest,"done",this.onSearchDone),this.disconnect(this.searchRequest,"error",this.onSearchError),this.searchRequest.abort());for(;void 0!=this.flow.getFirstChild();)this.flow.remove(this.flow.getFirstChild());this.searchField.disable();this.flow.disable();this.searchRequest=
new Core.HttpRequest({method:"GET",url:"/cloud/user?query="+encodeURIComponent(this.searchField.getValue())});this.connect(this.searchRequest,"done",this.onSearchDone);this.connect(this.searchRequest,"error",this.onSearchError);this.searchRequest.send()},onSearchDone:function(a){a=a.getResponseJSON();for(var b=0;b<a.length;b++)this.flow.append(new Wn.AddContactIcon({user:this.user,contact:new Wn.Contact({contact:a[b],user:this.user}),dialog:this,margin:5}));this.searchField.enable();this.flow.enable();
this.searchRequest=void 0},onSearchError:function(){this.searchField.enable();this.flow.enable();this.searchRequest=void 0}});Ui.Dialog.extend("Wn.AddContactRightDialog",{user:void 0,resource:void 0,flow:void 0,mainVbox:void 0,searchField:void 0,searchRequest:void 0,shareField:void 0,writeField:void 0,constructor:function(a){this.addEvents("add");this.user=a.user;delete a.user;this.resource=a.resource;delete a.resource;this.setFullScrolling(!0);this.setPreferredWidth(400);this.setPreferredHeight(400);this.setTitle("Ajouter des partages");this.setCancelButton(new Ui.DialogCloseButton);this.mainVbox=new Ui.VBox;this.setContent(this.mainVbox);
this.searchField=new Ui.TextButtonField({buttonIcon:"search"});this.mainVbox.append(this.searchField);this.connect(this.searchField,"validate",this.onSearchValidate);a=new Ui.HBox({uniform:!0});this.mainVbox.append(a);this.writeField=new Ui.CheckBox({text:"Ecriture"});this.resource.canWrite()&&(a.append(this.writeField),this.writeField.setValue(this.user.getData().default_write_right));this.shareField=new Ui.CheckBox({text:"Partage"});this.shareField.setValue(this.user.getData().default_share_right);
a.append(this.shareField);this.flow=new Ui.Flow({uniform:!0});this.mainVbox.append(this.flow);this.resource.getPublicRights().read||this.flow.append(new Wn.AddWorldIcon({user:this.user,dialog:this}))},onSearchValidate:function(){void 0!==this.searchRequest&&(this.disconnect(this.searchRequest,"done",this.onSearchDone),this.disconnect(this.searchRequest,"error",this.onSearchError),this.searchRequest.abort());for(;void 0!=this.flow.getFirstChild();)this.flow.remove(this.flow.getFirstChild());this.mainVbox.disable();
this.searchRequest=new Core.HttpRequest({method:"GET",url:"/cloud/user?query="+encodeURIComponent(this.searchField.getValue())});this.connect(this.searchRequest,"done",this.onSearchDone);this.connect(this.searchRequest,"error",this.onSearchError);this.searchRequest.send()},onSearchDone:function(a){a=a.getResponseJSON();for(var b=0;b<a.length;b++){for(var c=a[b],d=this.resource.getOwnerId()===c.id,e=0;!d&&e<this.resource.getRights().length;e++)d=this.resource.getRights()[e].user_id===c.id;d||this.flow.append(new Wn.AddContactRightIcon({user:this.user,
contact:new Wn.Contact({contact:c,user:this.user}),dialog:this}))}this.mainVbox.enable();this.searchRequest=void 0},onSearchError:function(){this.mainVbox.enable();this.searchRequest=void 0},getResource:function(){return this.resource},getRights:function(){return{read:!0,write:this.writeField.getValue(),share:this.shareField.getValue()}},onAddPress:function(){for(var a=[],b=[],c=0;c<this.flow.getChildren().length;c++){var d=this.flow.getChildren()[c];d.getIsSelected()&&(Wn.AddWorldIcon.hasInstance(d)?
this.resource.addPublicRights({read:!0,write:this.writeField.getValue(),share:this.shareField.getValue()}):a.push(d.getContact()),b.push(d))}for(c=0;c<a.length;c++)this.resource.addRights({user_id:a[c].getId(),read:!0,write:this.writeField.getValue(),share:this.shareField.getValue()});for(c=0;c<b.length;c++)this.flow.remove(b[c])}});Ui.Dialog.extend("Wn.CommentEditDialog",{comment:void 0,storage:void 0,file:void 0,textField:void 0,constructor:function(a){this.comment=a.comment;delete a.comment;this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.setFullScrolling(!0);this.setPreferredWidth(400);this.setPreferredHeight(300);this.setTitle("Edition de commentaire");this.setCancelButton(new Ui.DialogCloseButton);this.textField=new Ui.TextAreaField({value:this.comment.content});this.setContent(this.textField);
a=new Wn.AlertButton({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);var b=new Ui.DefaultButton({text:"Enregistrer"});this.connect(b,"press",this.onSavePress);this.setActionButtons([a,b])},onSavePress:function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/comments/"+this.comment.id,content:JSON.stringify({user:this.comment.user,content:this.textField.getValue()})})).send();this.close()},onDeletePress:function(){(new Core.HttpRequest({method:"DELETE",
url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/comments/"+this.comment.id})).send();this.close()}});Ui.Rectangle.extend("Wn.CommentSeparator",{constructor:function(){this.setHeight(1);this.setFill("#999999")}});
Wn.SelectionButton.extend("Wn.CommentView",{user:void 0,comment:void 0,storage:void 0,file:void 0,contactface:void 0,dateLabel:void 0,commentText:void 0,owner:void 0,constructor:function(a){this.user=a.user;delete a.user;this.comment=a.comment;delete a.comment;this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.contactface=new Ui.Image({width:32,height:32,verticalAlign:"top"});this.setIcon(this.contactface);this.comment.user===this.user.getId()?this.owner=this.user:this.owner=
Wn.Contact.getContact(this.comment.user);a=new Ui.VBox({spacing:2});this.setText(a);this.dateLabel=new Ui.Text({opacity:0.8,fontSize:10});a.append(this.dateLabel);this.commentText=new Wn.ImprovedText({text:this.comment.content});this.commentText.measureCore=function(a,c){return Wn.ImprovedText.prototype.measureCore.apply(this,arguments)};this.commentText.arrangeCore=function(a,c){Wn.ImprovedText.prototype.arrangeCore.apply(this,arguments)};a.append(this.commentText);if(this.owner.getIsReady())this.onOwnerReady();
else this.connect(this.owner,"ready",this.onOwnerReady)},onOwnerReady:function(){this.contactface.setSrc(this.owner.getFaceUrl());var a=(this.comment.user===this.user.getId()?"Moi":this.owner.getName())+", ",b=new Date-new Date(1E3*this.comment.ctime);if(604800>b)var c=Math.floor(b/864E5),d=Math.floor(b/36E5),b=Math.floor(b/6E4),a=a+"il y a ",a=0<c?a+(c+" jours"):0<d?a+(d+" heures"):a+(b+" minutes");else c=new Date(1E3*this.comment.ctime),a=a+"le "+(c.getDate()-1+"/"+(c.getMonth()+1)+"/"+c.getFullYear());
this.dateLabel.setText(a)},getComment:function(){return this.comment},onCommentDelete:function(){(new Core.HttpRequest({method:"DELETE",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/comments/"+this.comment.id})).send()},onCommentEdit:function(a){(new Wn.CommentEditDialog({comment:a.getElements()[0].getComment(),storage:this.storage,file:this.file})).open()},testCommentEditRight:function(){return Ui.App.current.getUser().isAdmin()||Ui.App.current.getUser().getId()==this.comment.user}},{onStyleChange:function(){Wn.CommentView.base.onStyleChange.apply(this,
arguments);var a=this.getStyleProperty("iconSize");this.contactface.setWidth(a);this.contactface.setHeight(a)},getSelectionActions:function(){return{"delete":{text:"Supprimer",icon:"trash",color:"#d02020",testRight:this.testCommentEditRight,scope:this,callback:this.onCommentDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",testRight:this.testCommentEditRight,scope:this,callback:this.onCommentEdit,multiple:!1}}}});
Ui.VBox.extend("Wn.CommentViewer",{user:void 0,resource:void 0,storage:void 0,file:void 0,vbox:void 0,updateRequest:void 0,textField:void 0,commentsBox:void 0,submitButton:void 0,commentsLoaded:!1,constructor:function(a){this.user=a.user;delete a.user;this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.resource=a.resource;delete a.resource;this.setSpacing(5);this.textField=new Ui.TextAreaField({textHolder:"Un commentaire ?",margin:4});this.append(this.textField);this.connect(this.textField.textarea,
"focus",this.onEntryFocus);this.connect(this.textField.textarea,"blur",this.onEntryBlur);this.commentsBox=new Ui.VBox({spacing:10});this.append(this.commentsBox);this.submitButton=new Ui.DefaultButton({text:"Valider",horizontalAlign:"right"});this.connect(this.submitButton,"press",this.onCommentValidate);this.updateFile(this.file)},getComments:function(){return this.file.comments},onEntryFocus:function(){void 0==this.submitButton.getParent()&&this.insertAt(this.submitButton,1)},onEntryBlur:function(){void 0!==
this.submitButton.getParent()&&""===this.textField.getValue()&&this.remove(this.submitButton)},onCommentValidate:function(){var a=this.textField.getValue();this.textField.setValue("");a=new Core.HttpRequest({method:"POST",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/comments",content:JSON.stringify({user:this.user.getId(),content:a})});this.connect(a,"error",this.onCreateCommentError);a.send()},onCreateCommentError:function(){var a=new Ui.Dialog,b=new Ui.Button({text:"Fermer"});a.connect(b,
"press",function(){this.close()});a.setActionButtons([b]);a.setContent(new Ui.Text({width:200,text:"Une erreur est survenue lors de la publication de votre commentaire. Il n'a pas pu \u00eatre pris en compte."}));a.open()},updateFile:function(a){for(;void 0!=this.commentsBox.getFirstChild();)this.commentsBox.remove(this.commentsBox.getFirstChild());this.file=a;for(a=0;a<this.file.comments.length;a++){var b=new Wn.CommentView({storage:this.storage,file:this.file,user:this.user,comment:this.file.comments[a]});
this.commentsBox.append(b)}}});Ui.CanvasElement.extend("Wn.PosButton",{},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b/2,c/2);a.fillStyle=Ui.Color.create(this.getStyleProperty("foreground")).getCssRgba();a.beginPath();a.arc(b/2,c/2,d-2*this.getStyleProperty("borderWidth"),0,2*Math.PI,!1);a.closePath();a.fill()},measureCore:function(a,b){return{width:30,height:30}},onStyleChange:function(){this.invalidateDraw()}},{style:{borderWidth:2,backgroundBorder:"#444444",foreground:"rgb(240,240,240)"}});
Ui.CanvasElement.extend("Wn.PosBar",{currentPos:0,loadPos:0,setCurrentPos:function(a){a!=this.currentPos&&(this.currentPos=a,this.invalidateDraw())},getCurrentPos:function(){return this.currentPos},setLoadPos:function(a){a!=this.loadPos&&(this.loadPos=a,this.invalidateDraw())},getLoadPos:function(){return this.loadPos},drawBar:function(a,b,c,d,e){a.beginPath();a.arc(b,c,e,0,2*Math.PI,!1);a.closePath();a.fill();a.rect(b,c-e,d,2*e);a.fill();a.beginPath();a.arc(b+d,c,e,0,2*Math.PI,!1);a.closePath();
a.fill()}},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(this.getStyleProperty("radius"),Math.min(b/2,c/2));a.fillStyle=Ui.Color.create(this.getStyleProperty("background")).getCssRgba();a.beginPath();a.roundRect(0,0,b,c,d,d,d,d);a.closePath();a.fill();a.fillStyle=Ui.Color.create(this.getStyleProperty("load")).getCssRgba();0<this.loadPos&&(a.beginPath(),a.roundRect(0,0,b*this.loadPos,c,d,d,d,d),a.closePath(),a.fill());a.fillStyle=Ui.Color.create(this.getStyleProperty("current")).getCssRgba();
0<this.currentPos&&(a.beginPath(),a.roundRect(0,0,b*this.currentPos,c,d,d,d,d),a.closePath(),a.fill())},measureCore:function(a,b){return{width:20,height:7}},onStyleChange:function(){this.invalidateDraw()}},{style:{radius:4,current:"#ffc30b",load:"#888888",background:"#aaaaaa"}});
Ui.Container.extend("Wn.MediaProgressBar",{posButton:void 0,posBar:void 0,pos:0,constructor:function(a){this.addEvents("up","down","move");this.posBar=new Wn.PosBar({verticalAlign:"center"});this.appendChild(this.posBar);a=new Wn.PosButton({margin:10});this.posButton=new Ui.Movable({moveVertical:!1,horizontalAlign:"left",verticalAlign:"center"});this.connect(this.posButton,"move",this.onButtonMove);this.connect(this.posButton,"up",this.onButtonUp);this.connect(this.posButton,"down",this.onButtonDown);
this.posButton.setContent(a);this.appendChild(this.posButton)},getCurrentPos:function(){return this.posBar.getCurrentPos()},getLoadPos:function(){return this.posBar.getLoadPos()},setLoadPos:function(a){this.posBar.setLoadPos(a)},onButtonMove:function(a){this.pos=Math.min(1,Math.max(0,a.getPositionX()/(this.getLayoutWidth()-a.getLayoutWidth())));this.updatePos();this.fireEvent("move",this)},onButtonUp:function(a){this.fireEvent("up",this)},onButtonDown:function(a){this.fireEvent("down",this)},updatePos:function(){this.disconnect(this.posButton,
"move",this.onButtonMove);this.posButton.setPosition((this.getLayoutWidth()-this.posButton.getLayoutWidth())*this.pos,void 0);this.connect(this.posButton,"move",this.onButtonMove);this.posBar.setCurrentPos(this.pos)},setPos:function(a){this.pos!=a&&(this.pos=a,this.invalidateArrange())}},{measureCore:function(a,b){var c=this.posBar.measure(a,b),d=this.posButton.measure(a,b);return{width:Math.max(c.width,d.width),height:Math.max(c.height,d.height)}},arrangeCore:function(a,b){this.posBar.arrange(b/
2,0,a-b,b);this.posButton.arrange(0,0,a,b);this.updatePos()}});
Ui.CanvasElement.extend("Wn.PlayButton",{mode:"play",clock:void 0,backgroundVisible:!0,constructor:function(a){},setMode:function(a){a!=this.mode&&(this.mode=a,this.invalidateDraw(),"load"==a?(this.clock=new Anim.Clock({duration:"forever"}),this.connect(this.clock,"timeupdate",function(a,c){this.invalidateDraw()}),this.getIsVisible()&&this.clock.begin()):void 0!==this.clock&&(this.clock.stop(),this.clock=void 0))},setBackgroundVisible:function(a){this.backgroundVisible!=a&&(this.backgroundVisible=
a,this.invalidateDraw())}},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b/2,c/2);this.backgroundVisible&&(a.fillStyle=Ui.Color.create(this.getStyleProperty("background")).getCssRgba(),a.beginPath(),a.arc(b/2,c/2,d,0,2*Math.PI,!1),a.closePath(),a.fill());a.fillStyle=Ui.Color.create(this.getStyleProperty("foreground")).getCssRgba();if("play"==this.mode)a.save(),a.translate(0.1*b,0.1*b),Ui.Icon.drawIcon(a,"play",0.8*b,a.fillStyle),a.restore();else if("pause"==
this.mode)a.save(),a.translate(0.1*b,0.1*b),Ui.Icon.drawIcon(a,"pause",0.8*b,a.fillStyle),a.restore();else{a.translate(b/2,c/2);b=this.clock.getTime()%1;for(c=0;8>c;c++)a.save(),a.rotate(2*Math.PI*c/8+0.5*2*Math.PI*b),a.beginPath(),a.arc(0,d/2,5,0,2*Math.PI,!1),a.closePath(),a.fill(),a.restore()}},measureCore:function(a,b){return{width:20,height:20}},onVisible:function(){void 0!=this.clock&&this.clock.begin()},onHidden:function(){void 0!=this.clock&&this.clock.stop()},onStyleChange:function(){this.invalidateDraw()}},
{style:{background:"rgba(221,221,221,0.6)",foreground:"#444444"}});
Ui.LBox.extend("Wn.MediaPlayBar",{bg:void 0,media:void 0,progressBar:void 0,playButton:void 0,posLabel:void 0,totalLabel:void 0,seeking:!1,constructor:function(a){this.media=a.media;delete a.media;this.connect(this.media,"ready",this.onMediaReady);this.connect(this.media,"timeupdate",this.onMediaTimeUpdate);this.connect(this.media,"bufferingupdate",this.onMediaBufferingUpdate);this.connect(this.media,"statechange",this.onMediaStateChange);this.bg=new Ui.Rectangle;this.append(this.bg);a=new Ui.HBox({margin:0});
this.append(a);var b=new Ui.Pressable;this.connect(b,"press",this.onPlayPress);this.playButton=new Wn.PlayButton({mode:"play",backgroundVisible:!1,width:60,height:60});b.setContent(this.playButton);("playing"==this.media.getState()||"buffering"==this.media.getState())&&this.playButton.setMode("pause");a.append(b);b=new Ui.LBox;a.append(b,!0);a=new Ui.HBox({marginLeft:10,marginRight:10,marginBottom:4,verticalAlign:"bottom"});b.append(a);this.posLabel=new Ui.Label({text:""});this.totalLabel=new Ui.Label({text:""});
a.append(this.posLabel);a.append(new Ui.Element,!0);a.append(this.totalLabel);this.progressBar=new Wn.MediaProgressBar({height:30,verticalAlign:"center"});this.connect(this.progressBar,"down",this.onProgressBarDown);this.connect(this.progressBar,"up",this.onProgressBarUp);b.append(this.progressBar,!0);this.media.getIsReady()||this.progressBar.disable()},updateLabels:function(){var a=this.media.getDuration();if(void 0==a)this.totalLabel.setText("");else{var b=Math.round(a%60),a=Math.floor(a/60),a=
10>a?"0"+a+":":a+":";this.totalLabel.setText(10>b?a+("0"+b):a+b)}a=this.media.getCurrentTime();void 0==a?this.posLabel.setText(""):(b=Math.round(a%60),a=Math.floor(a/60),a=10>a?"0"+a+":":a+":",a=10>b?a+("0"+b):a+b,this.posLabel.setText(a))},updatePos:function(){if(void 0!=this.media.getDuration()){var a=this.media.getCurrentTime();void 0==a&&(a=0);this.seeking||this.progressBar.setPos(a/this.media.getDuration())}else this.progressBar.setPos(0)},onPlayPress:function(){var a=this.media.getState();"initial"==
a?this.media.play():"paused"==a?this.media.play():"playing"==a?this.media.pause():"buffering"==a&&this.media.pause()},onProgressBarDown:function(){this.seeking=!0},onProgressBarMove:function(){this.media.setCurrentTime(this.progressBar.getCurrentPos()*this.media.getDuration())},onProgressBarUp:function(){this.seeking=!1;this.media.setCurrentTime(this.progressBar.getCurrentPos()*this.media.getDuration())},onMediaStateChange:function(a,b){"playing"==b||"buffering"==b?this.playButton.setMode("pause"):
("initial"==b||"paused"==b)&&this.playButton.setMode("play")},onMediaReady:function(){this.progressBar.enable();this.updatePos();this.updateLabels()},onMediaTimeUpdate:function(){this.updatePos();this.updateLabels()},onMediaBufferingUpdate:function(){this.progressBar.setLoadPos((this.media.getCurrentTime()+this.media.getCurrentBufferSize())/this.media.getDuration())}},{onStyleChange:function(){this.bg.setFill(this.getStyleProperty("background"));var a=this.getStyleProperty("foreground");this.posLabel.setColor(a);
this.totalLabel.setColor(a)}},{style:{foreground:"#444444",background:"rgba(241,241,241,0.7)"}});
Ui.LBox.extend("Wn.AudioPlayer",{media:void 0,playButton:void 0,mediaBar:void 0,label:void 0,constructor:function(a){this.addEvents("end");this.media=new Ui.Audio;this.append(this.media);this.connect(this.media,"statechange",this.onMediaStateChange);this.connect(this.media,"ended",this.onMediaEnded);a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});this.append(a);var b=new Ui.Icon({icon:"note",horizontalAlign:"center",width:150,height:150});a.append(b);this.label=new Ui.Text({textAlign:"center",
fontSize:20,width:300});a.append(this.label);a=new Ui.Pressable({verticalAlign:"center",horizontalAlign:"center"});this.connect(a,"press",this.onPlayButtonPress);this.playButton=new Wn.PlayButton({mode:"play",width:80,height:80});a.setContent(this.playButton);this.append(a);this.mediaBar=new Wn.MediaPlayBar({media:this.media,verticalAlign:"bottom"});this.append(this.mediaBar)},setSrc:function(a){this.media.setSrc(a)},setText:function(a){this.label.setText(a)},pause:function(){this.media.pause()},
play:function(){this.media.play()},onMediaEnded:function(a){this.fireEvent("end",this)},onMediaStateChange:function(a,b){"playing"==b?this.playButton.setMode("pause"):"paused"==b||"initial"==b?this.playButton.setMode("play"):"buffering"==b&&this.playButton.setMode("load")},onPlayButtonPress:function(){var a=this.media.getState();"playing"==a?this.media.pause():"paused"==a?this.media.play():"buffering"==a?this.media.pause():"initial"==a&&this.media.play()}});Ui.LBox.extend("Wn.VideoPlayer",{media:void 0,playButton:void 0,mediaBar:void 0,controlsVisible:!0,constructor:function(a){this.addEvents("statechange","end");a=new Storage.Transformable;this.append(a);this.media=new Ui.Video;a.setContent(this.media);this.connect(this.media,"statechange",this.onMediaStateChange);this.connect(this.media,"ended",this.onMediaEnd);a=new Ui.Pressable({verticalAlign:"center",horizontalAlign:"center"});this.connect(a,"press",this.onPlayButtonPress);this.playButton=new Wn.PlayButton({mode:"play",
width:80,height:80});a.setContent(this.playButton);this.append(a);this.mediaBar=new Wn.MediaPlayBar({media:this.media,verticalAlign:"bottom"});this.append(this.mediaBar)},setSrc:function(a){this.media.setSrc(a)},setPoster:function(a){this.media.setPoster(a)},pause:function(){this.media.pause()},play:function(){this.media.play()},getState:function(){return this.media.getState()},getIsControlsVisible:function(){return this.controlsVisible},showControls:function(){this.controlsVisible=!0;this.playButton.show();
this.mediaBar.show()},hideControls:function(){this.controlsVisible=!1;this.playButton.hide();this.mediaBar.hide()},onMediaEnd:function(a){this.fireEvent("end",this)},onMediaStateChange:function(a,b){"playing"==b?(this.hideControls(),this.playButton.setMode("pause")):"paused"==b||"initial"==b?(this.showControls(),this.playButton.setMode("play")):"buffering"==b&&(this.showControls(),this.playButton.setMode("load"));this.fireEvent("statechange",this,b)},onPlayButtonPress:function(){var a=this.media.getState();
"playing"===a?this.media.pause():"paused"===a?this.media.play():"buffering"===a?this.media.pause():"initial"===a&&this.media.play()}});Wn.ResourceViewer.extend("Radio.App",{audio:void 0,constructor:function(a){a=new Ui.VBox({horizontalAlign:"center",verticalAlign:"center"});this.setContent(a);a.append(new Ui.Label({text:this.getResource().getName()}));this.audio=new Ui.Audio({src:this.getResource().getData()});a.append(this.audio);var b=new Ui.Button({text:"Jouer"});a.append(b);this.connect(b,"press",this.onPlayPress)},onPlayPress:function(){this.audio.play()}},{},{constructor:function(){this.register("radio",this)}});Wn.ResourceView.extend("Radio.Preview",{constructor:function(a){this.getGraphic().setIcon("radio")}},{},{constructor:function(){this.register("radio",this)}});Wn.ResourceCreator.extend("Radio.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"radio",name:this.getData().name,data:this.getData().url});this.done()}});Wn.WizardItem.extend("Radio.Wizard",{nameField:void 0,urlField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);this.nameField=new Wn.TextField({title:"Nom de la ressource"});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);this.urlField=new Wn.TextField({title:"URL du flux MP3"});this.connect(this.urlField,"change",this.onChange);a.append(this.urlField);a=this.getData();void 0!=a.name&&this.nameField.setValue(a.name);void 0!=a.url&&this.urlField.setValue(a.url);
this.onChange()},onChange:function(){""!=this.urlField.getValue()&&(""!=this.nameField.getValue()&&this.urlField.getValue().match(/^http(s){0,1}:\/\/.*$/))&&this.done()}},{onSave:function(){var a=this.getData();a.name=this.nameField.getValue();a.url=this.urlField.getValue()}});Ui.Dialog.extend("Calendar.EventDetail",{event:void 0,constructor:function(a){this.event=a.event;delete a.event;this.setCancelButton(new Ui.DialogCloseButton);this.setTitle("D\u00e9tail");this.setFullScrolling(!0);this.setPreferredWidth(500);this.setPreferredHeight(500);a=new Ui.SFlow({itemAlign:"stretch",stretchMaxRatio:10,spacing:10});this.setContent(a);var b=!0===this.event.day;a.append(new Wn.TextField({title:"Titre",value:this.event.summary,width:400,disabled:!0}));a.append(new Wn.DateField({title:"D\u00e9but",
value:this.event.start,width:150,disabled:!0,displayHours:!b}));var c=this.event.end;b&&(c=new Date(c.getTime()-864E5));a.append(new Wn.DateField({title:"Fin",value:c,width:150,disabled:!0,displayHours:!b}));a.append(new Ui.CheckBox({text:"Toute la journ\u00e9e",value:b,width:300,disabled:!0}));a.append(new Wn.TextAreaField({title:"Lieu",value:this.event.location,width:400,disabled:!0}));a.append(new Wn.TextAreaField({title:"Description",value:this.event.description,width:400,disabled:!0}))}});
Ui.Pressable.extend("Calendar.DayViewItem",{event:void 0,text:void 0,constructor:function(a){this.event=a.event;delete a.event;this.setClipToBounds(!0);this.setMargin(2);this.event.end<new Date&&this.setOpacity(0.5);this.append(new Ui.Rectangle({fill:"#2fc6f3"}));a=this.event.summary;void 0==a&&(a="");this.text=new Ui.CompactLabel({text:a,margin:5});this.append(this.text)},getEvent:function(){return this.event}},{onPress:function(){Calendar.DayViewItem.base.onPress.apply(this,arguments);(new Calendar.EventDetail({event:this.event})).open()}});
Ui.Container.extend("Calendar.DaysEvents",{start:void 0,count:1,uniformItemHeight:0,maxRow:0,constructor:function(a){this.start=a.start;delete a.start;this.count=a.count;delete a.count},setData:function(a){for(var b=0;b<this.getChildren().length;b++){var c=this.getChildren()[b];this.removeChild(c)}for(b=0;b<a.length;b++){var c=a[b],d=Math.round((c.start.getTime()-this.start.getTime())/864E5),e=Math.round((c.end.getTime()-c.start.getTime())/864E5),e=d+e-1;if(0<=d&&d<this.count||0<=e&&e<this.count||
0>d&&e>=this.count)c=new Calendar.DayViewItem({event:c}),this.appendChild(c)}this.updateGrid()},updateGrid:function(){this.maxRow=0;for(var a=[],b=0;b<this.count;b++){a.push([]);for(var c=0;c<this.getChildren().length;c++)a[b].push(!0)}for(b=0;b<this.getChildren().length;b++){for(var c=this.getChildren()[b],d=c.getEvent(),e=Math.round((d.start.getTime()-this.start.getTime())/864E5),d=Math.round((d.end.getTime()-d.start.getTime())/864E5),f=e+d,e=Math.max(0,e),f=Math.min(this.count,f),d=f-e,g=0;g<this.getChildren().length;g++){for(var k=
!0,h=e;k&&h<f;h++)k=a[h][g];if(k)break}for(h=e;h<f;h++)a[h][g]=!1;g>this.maxRow&&(this.maxRow=g);c["Calendar.DaysEvents.attach"]={startx:e,endx:f,lengthx:d,row:g}}}},{measureCore:function(a,b){for(var c=0,d=0;d<this.getChildren().length;d++){var e=this.getChildren()[d].measure(a,0);e.height>c&&(c=e.height)}this.uniformItemHeight=c;return{width:0,height:c*(this.maxRow+1)}},arrangeCore:function(a,b){for(var c=(a-5*(this.count-1))/this.count,d=0;d<this.getChildren().length;d++){var e=this.getChildren()[d],
f=e["Calendar.DaysEvents.attach"];e.arrange(f.startx*c+5*f.startx,f.row*this.uniformItemHeight,c*f.lengthx+5*(f.lengthx-1),this.uniformItemHeight)}}});
Ui.CanvasElement.extend("Calendar.WeekGraphHeader",{weekStart:void 0,measureColWidth:0,now:void 0,constructor:function(a){this.weekStart=a.weekStart;delete a.weekStart;this.now=a.now;delete a.now},getMeasureColWidth:function(){return this.measureColWidth}},{measureCore:function(a,b){for(var c=this.getStyleProperty("fontSize"),d=0,e=new Date(this.weekStart.getTime()),f=0;7>f;f++){var g=e.getDate()+" "+Calendar.WeekGraphHeader.dayToShort[f],k="normal";this.now>=e&&this.now.getTime()<e.getTime()+864E5&&
(k="bold");g=Ui.Label.measureText(g,c,"sans-serif",k);g.width>d&&(d=g.width);e=new Date(e.getTime()+864E5)}this.measureColWidth=d;return{width:d+30,height:1.3*c}},updateCanvas:function(a){var b=this.getLayoutWidth();this.getLayoutHeight();for(var c=this.getStyleProperty("fontSize"),b=(b-30)/7,d=new Date(this.weekStart.getTime()),e=0,f=0;7>f;f++){var g="normal";this.now>=d&&this.now.getTime()<d.getTime()+864E5&&(g="bold");a.font="default "+g+" "+Math.round(c)+"px sans-serif";a.fillStyle="rgba(50,50,50,1)";
a.fillText(d.getDate()+" "+Calendar.WeekGraphHeader.dayToShort[f],e,c);a.fillStyle="rgba(200,200,200,1)";a.fillRect(e,1.3*c-2,b,2);e+=b+5;d=new Date(d.getTime()+864E5)}}},{dayToShort:{"0":"lun.",1:"mar.",2:"mer.",3:"jeu.",4:"ven.",5:"sam.",6:"dim."},style:{color:"#000000",fontSize:16}});
Ui.Container.extend("Calendar.DayGraphItems",{day:void 0,colsCount:void 0,constructor:function(a){this.day=new Date(a.day.getFullYear(),a.day.getMonth(),a.day.getDate(),0,0,0,0);delete a.day},setData:function(a){for(var b=0;b<this.getChildren().length;b++){var c=this.getChildren()[b];this.removeChild(c)}for(b=0;b<a.length;b++)c=new Calendar.DayViewItem({event:a[b]}),this.appendChild(c);this.updateGrid()},updateGrid:function(){this.colsCount=[];for(var a=[],b=0;48>b;b++){this.colsCount.push(0);a.push([]);
for(var c=0;c<this.getChildren().length;c++)a[b].push(!0)}for(b=0;b<this.getChildren().length;b++){for(var c=this.getChildren()[b],d=c.getEvent(),e=Math.round(48*(d.start.getTime()-this.day.getTime())/864E5),e=Math.max(0,e),d=Math.round(48*(d.end.getTime()-this.day.getTime())/864E5),d=Math.min(48,d),f=d-e,g=0;g<this.getChildren().length;g++){for(var k=!0,h=e;k&&h<d;h++)k=a[h][g];if(k)break}for(h=e;h<d;h++)a[h][g]=!1,this.colsCount[h]++;c["Calendar.DayGraphItems.attach"]={starty:e,endy:d,lengthy:f,
col:g}}}},{measureCore:function(a,b){for(var c=0;c<this.getChildren().length;c++){for(var d=this.getChildren()[c],e=d["Calendar.DayGraphItems.attach"],f=0,g=e.starty;g<e.endy;g++)this.colsCount[g]>f&&(f=this.colsCount[g]);d.measure(a/f,b/48*e.lengthy)}return{width:0,height:0}},arrangeCore:function(a,b){for(var c=0;c<this.getChildren().length;c++){for(var d=this.getChildren()[c],e=d["Calendar.DayGraphItems.attach"],f=e.starty*b/48,g=e.endy*b/48,k=0,h=e.starty;h<e.endy;h++)this.colsCount[h]>k&&(k=this.colsCount[h]);
k=a/k;d.arrange(e.col*k,f,k,g-f)}}});
Ui.CanvasElement.extend("Calendar.DayClocks",{},{measureCore:function(a,b){for(var c=this.getStyleProperty("fontSize"),d=0,e=0;24>e;e++){var f=e.toString();2>f.length&&(f="0"+f);f+=":00";f=Ui.Label.measureText(f,c,"sans-serif","normal");f.width>d&&(d=f.width)}return{width:d+10,height:1.5*c+1E3+c/2}},updateCanvas:function(a){var b=this.getLayoutWidth();this.getLayoutHeight();var c=this.getStyleProperty("fontSize");a.font="default normal "+Math.round(c)+"px sans-serif";a.fillStyle="rgba(50,50,50,1)";
for(var d=0;24>d;d++){var e=d.toString();2>e.length&&(e="0"+e);var e=e+":00",f=a.measureText(e);a.fillText(e,b-f.width-2,1E3*d/24+2+0.66*c)}}},{style:{color:"#000000",fontSize:12}});
Ui.Container.extend("Calendar.DaysBox",{title:void 0,titleWidth:0,days:void 0,constructor:function(a){this.title=a.title;delete a.title;this.appendChild(this.title);this.days=a.days;delete a.days;for(a=0;a<this.days.length;a++)this.appendChild(this.days[a])},setTitleWidth:function(a){this.titleWidth=a},getMeasureTitleWidth:function(){return this.title.getMeasureWidth()}},{measureCore:function(a,b){for(var c=0,d=0,e=this.title.measure(0,b),f=0;f<this.days.length;f++){var g=this.days[f].measure(0,b);
g.height>c&&(c=g.height);g.width>d&&(d=g.width)}return{width:e.width+d*this.days.length+5*(this.days.length-1),height:c}},arrangeCore:function(a,b){this.title.arrange(0,0,this.titleWidth,b);for(var c=(a-this.titleWidth-5*(this.days.length-1))/this.days.length,d=this.titleWidth,e=0;e<this.days.length;e++)this.days[e].arrange(d,0,c,b),d+=c+5}});
Ui.Container.extend("Calendar.WeekView",{date:void 0,weekStart:void 0,header:void 0,daysEvents:void 0,dayLabel:void 0,separator:void 0,graph:void 0,graphItems:void 0,daysBox:void 0,scroll:void 0,measureTitleWidth:0,measureColWidth:0,now:void 0,firstArrangeDone:!1,constructor:function(a){this.date=a.date;delete a.date;this.now=a.now;delete a.now;a=(this.date.getDay()-1)%7;this.weekStart=new Date(this.date.getTime()-864E5*a);this.weekStart=new Date(this.weekStart.getFullYear(),this.weekStart.getMonth(),
this.weekStart.getDate(),0,0,0,0);this.header=new Calendar.WeekGraphHeader({weekStart:this.weekStart,now:this.now});this.appendChild(this.header);this.dayLabel=new Ui.Label({text:"journ\u00e9e",fontSize:12,margin:5,marginLeft:10});this.appendChild(this.dayLabel);this.daysEvents=new Calendar.DaysEvents({start:this.weekStart,count:7});this.appendChild(this.daysEvents);this.separator=new Ui.Rectangle({fill:"rgba(200,200,200,1)",height:2});this.appendChild(this.separator);this.scroll=new Ui.ScrollingArea;
this.appendChild(this.scroll);this.graphItems=[];a=[];for(var b=this.weekStart,c=0;7>c;c++){var d=new Ui.LBox;a.push(d);var e=this.now>=b&&this.now.getTime()<b.getTime()+864E5;d.append(new Calendar.DayGraph({currentDay:e}));this.graphItems.push(new Calendar.DayGraphItems({day:b}));d.append(this.graphItems[c]);b=new Date(b.getTime()+864E5)}this.daysBox=new Calendar.DaysBox({title:new Calendar.DayClocks,days:a});this.scroll.setContent(this.daysBox)},setData:function(a){for(var b=new Date(this.weekStart.getTime()),
c=0;7>c;c++){for(var d=b,e=new Date(d.getTime()+864E5),f=this.graphItems[c],g=[],k=0;k<a.length;k++){var h=a[k];!0!==h.day&&(h.start>=d&&h.start<=e||h.end>=d&&h.end<=e||h.start<=d&&h.end>=e)&&g.push(h)}f.setData(g);b=new Date(b.getTime()+864E5)}b=[];for(c=0;c<a.length;c++)!0===a[c].day&&b.push(a[c]);this.daysEvents.setData(b)}},{measureCore:function(a,b){var c=this.header.measure(a,b),d=this.dayLabel.measure(a,b),e=this.daysEvents.measure(a,b),f=this.separator.measure(a,b),g=Math.max(e.height,d.height),
k=this.scroll.measure(a,b-(c.height+g+f.height));this.measureColWidth=this.header.getMeasureColWidth();this.measureTitleWidth=Math.max(d.width,this.daysBox.getMeasureTitleWidth());return{width:Math.max(this.measureTitleWidth+7*this.measureColWidth+30,c.width,e.width,f.width,k.width),height:c.height+g+f.height+k.height}},arrangeCore:function(a,b){var c=0;this.header.arrange(this.measureTitleWidth,0,a-this.measureTitleWidth,this.header.getMeasureHeight());var c=c+this.header.getMeasureHeight(),d=Math.max(this.dayLabel.getMeasureHeight(),
this.daysEvents.getMeasureHeight());this.dayLabel.arrange(0,c,this.measureTitleWidth,d);this.daysEvents.arrange(this.measureTitleWidth,c,a-this.measureTitleWidth,d);c+=d;this.separator.arrange(this.measureTitleWidth,c,a-this.measureTitleWidth,this.separator.getMeasureHeight());c+=this.separator.getMeasureHeight();this.daysBox.setTitleWidth(this.measureTitleWidth);this.scroll.arrange(0,c,a,b-c);!1===this.firstArrangeDone&&(this.firstArrangeDone=!0,this.scroll.setOffset(void 0,312.5,!0))}});
Ui.CanvasElement.extend("Calendar.DayGraph",{currentDay:!1,constructor:function(a){this.currentDay=!0===a.currentDay;delete a.currentDay}},{measureCore:function(){return{width:10,height:1E3}},updateCanvas:function(a){var b=this.getLayoutWidth();this.getLayoutHeight();this.currentDay&&(a.fillStyle="rgba(199,199,255,0.3)",a.fillRect(0,0,b,1E3));a.fillStyle="rgba(219,219,219,1)";for(var c=0;24>c;c++)a.fillRect(0,1E3*c/24,b,1);a.fillStyle="rgba(219,219,219,0.4)";for(c=0;24>c;c++)a.fillRect(0,1E3*c/24+
1E3/48,b,1)}});
Ui.Container.extend("Calendar.DayView",{date:void 0,dayStart:void 0,header:void 0,daysEvents:void 0,dayLabel:void 0,separator:void 0,graph:void 0,graphItems:void 0,scroll:void 0,daysBox:void 0,measureTitleWidth:0,measureColWidth:0,now:void 0,firstArrangeDone:!1,constructor:function(a){this.date=a.date;delete a.date;this.now=a.now;delete a.now;this.dayStart=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate(),0,0,0,0);a=this.now>=this.dayStart&&this.now.getTime()<this.dayStart.getTime()+
864E5;this.header=new Ui.Rectangle({fill:"rgba(200,200,200,1)",height:2});this.appendChild(this.header);this.dayLabel=new Ui.Label({text:"journ\u00e9e",fontSize:12,margin:5,marginLeft:10});this.appendChild(this.dayLabel);this.daysEvents=new Calendar.DaysEvents({start:this.dayStart,count:1});this.appendChild(this.daysEvents);this.separator=new Ui.Rectangle({fill:"rgba(200,200,200,1)",height:2});this.appendChild(this.separator);this.scroll=new Ui.ScrollingArea;this.appendChild(this.scroll);var b=new Ui.LBox;
this.graph=new Calendar.DayGraph({currentDay:a});b.append(this.graph);this.graphItems=new Calendar.DayGraphItems({day:this.dayStart});b.append(this.graphItems);this.daysBox=new Calendar.DaysBox({title:new Calendar.DayClocks,days:[b]});this.scroll.setContent(this.daysBox)},setData:function(a){for(var b=[],c=[],d=0;d<a.length;d++)!0===a[d].day?b.push(a[d]):c.push(a[d]);this.graphItems.setData(c);this.daysEvents.setData(b)}},{measureCore:function(a,b){var c=this.header.measure(a,b),d=this.dayLabel.measure(a,
b),e=this.daysEvents.measure(a,b),f=this.separator.measure(a,b),g=Math.max(e.height,d.height),k=this.scroll.measure(a,b-(c.height+g+f.height));this.measureTitleWidth=Math.max(d.width,this.daysBox.getMeasureTitleWidth());return{width:Math.max(this.measureTitleWidth,c.width,e.width,f.width,k.width),height:c.height+g+f.height+k.height}},arrangeCore:function(a,b){var c=0;this.header.arrange(this.measureTitleWidth,0,a-this.measureTitleWidth,this.header.getMeasureHeight());var c=c+this.header.getMeasureHeight(),
d=Math.max(this.dayLabel.getMeasureHeight(),this.daysEvents.getMeasureHeight());this.dayLabel.arrange(0,c,this.measureTitleWidth,d);this.daysEvents.arrange(this.measureTitleWidth,c,a-this.measureTitleWidth,d);c+=d;this.separator.arrange(this.measureTitleWidth,c,a-this.measureTitleWidth,this.separator.getMeasureHeight());c+=this.separator.getMeasureHeight();this.daysBox.setTitleWidth(this.measureTitleWidth);this.scroll.arrange(0,c,a,b-c);!1===this.firstArrangeDone&&(this.firstArrangeDone=!0,this.scroll.setOffset(void 0,
312.5,!0))}});
Ui.VBox.extend("Calendar.MonthView",{data:void 0,date:void 0,selectedDate:void 0,grid:void 0,constructor:function(a){"date"in a?(this.date=new Date(a.date.getTime()),delete a.date):this.date=new Date;this.data=a.data;delete a.data;this.selectedDate=this.date;this.grid=new Ui.Grid({cols:"auto,auto,auto,auto,auto,auto,auto",rows:"auto,auto,auto,auto,auto,auto,auto",horizontalAlign:"center"});this.append(this.grid);this.updateDate()},updateDate:function(){for(var a,b=[6,0,1,2,3,4,5],c="Lu Ma Me Je Ve Sa Di".split(" ");void 0!==
this.grid.getFirstChild();)this.grid.detach(this.grid.getFirstChild());for(a=0;7>a;a++)this.grid.attach(new Ui.Label({text:c[a],fontWeight:"bold",margin:5}),a,0);var c=this.date.getMonth(),d=new Date(this.date.getTime());d.setDate(1);var e=1,f=new Date;do{var g=new Ui.Pressable;g.monthCalendarDate=d;this.connect(g,"press",this.onDaySelect);d.getFullYear()==f.getFullYear()&&d.getMonth()==f.getMonth()&&d.getDate()==f.getDate()?(g.monthCalendarCurrent=!0,a=new Ui.Rectangle({fill:new Ui.Color({r:0.2,
g:0.4,b:1,a:0.4}),margin:1})):a=new Ui.Rectangle({fill:new Ui.Color({r:0.8,g:0.8,b:0.8,a:0.4}),margin:1});g.append(a);void 0!==this.selectedDate&&(d.getFullYear()===this.selectedDate.getFullYear()&&d.getMonth()===this.selectedDate.getMonth()&&d.getDate()===this.selectedDate.getDate())&&g.append(new Ui.Frame({frameWidth:3,fill:"red",radius:0}));var k=!1;if(void 0!==this.dayFilter){var h=d.getDay();for(a=0;a<this.dayFilter.length&&!k;a++)h==this.dayFilter[a]&&(k=!0)}if(void 0!==this.dateFilter){h=d.getFullYear()+
"/";10>d.getMonth()+1&&(h+="0");h+=d.getMonth()+1+"/";10>d.getDate()&&(h+="0");h+=d.getDate();for(a=0;a<this.dateFilter.length&&!k;a++)RegExp(this.dateFilter[a]).test(h)&&(k=!0)}k&&(g.disable(),g.setOpacity(0.2));g.append(new Ui.Label({text:d.getDate(),margin:5}));this.grid.attach(g,b[d.getDay()],e);d=new Date(d.getTime()+864E5);0===b[d.getDay()]&&e++}while(c==d.getMonth());this.onStyleChange()}});
Core.Object.extend("Calendar.Data",{events:void 0,event:void 0,constructor:function(a){var b=a.text;delete a.text;this.events=[];a=b.split("\n");for(var b="",c=0;c<a.length;c++)" "===a[c].charAt(0)?b+=a[c].substr(1):(""!==b&&this.parseLine(b),b=a[c]),"\r"==b.charAt(b.length-1)&&(b=b.substr(0,b.length-1));""!==b&&this.parseLine(b)},parseLine:function(a){var b=a.indexOf(":");if(!(0>b)){var c=a.substr(0,b);a=a.substr(b+1);var d={},b=c.indexOf(";");if(-1!==b)for(var e=c.substr(b+1).split(";"),c=c.substr(0,
b),f=0;f<e.length;f++)b=e[f].indexOf("="),-1!==b&&(d[e[f].substr(0,b)]=e[f].substr(b+1));"BEGIN"===c?"VEVENT"===a&&(this.event={},this.events.push(this.event)):"END"===c?"VEVENT"===a&&(this.event=void 0):void 0!==event&&("DTSTART"==c?(this.event.start=this.parseDate(a,d),"DATE"===d.VALUE&&(this.event.day=!0)):"DTEND"==c?this.event.end=this.parseDate(a,d):"SUMMARY"==c?this.event.summary=this.parseText(a):"DESCRIPTION"==c?this.event.description=this.parseText(a):"LOCATION"==c&&(this.event.location=
this.parseText(a)))}},parseText:function(a){return a.replace(/\\\\/g,"\\").replace(/\\;/g,";").replace(/\\,/g,",").replace(/\\N/g,"\n").replace(/\\n/g,"\n")},parseDate:function(a,b){var c=parseInt(a.substr(0,4)),d=parseInt(a.substr(4,2))-1,e=parseInt(a.substr(6,2)),f=0,g=0,k=0,h;8<a.length?(f=parseInt(a.substr(9,2)),g=parseInt(a.substr(11,2)),k=parseInt(a.substr(13,2)),h=new Date,h.setUTCFullYear(c),h.setUTCMonth(d),h.setUTCDate(e),h.setUTCHours(f),h.setUTCMinutes(g),h.setUTCSeconds(k)):h=new Date(c,
d,e,0,0,0);return h},search:function(a,b){for(var c=[],d=0;d<this.events.length;d++){var e=this.events[d];void 0!==e.start&&void 0!==e.end&&(e.start>=a&&e.start<b||e.end>a&&e.end<b||e.start<=a&&e.end>=b)&&c.push(e)}c.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});return c},searchDay:function(a){a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0);var b=new Date(a.getTime()+864E5);return this.search(a,b)},searchWeek:function(a){a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),
0,0,0,0);var b=(a.getDay()-1)%7;a=new Date(a.getTime()-864E5*b);b=new Date(a.getTime()+6048E5);return this.search(a,b)}});
Ui.CarouselableLoader.extend("Ui.DayViewDataLoader",{data:void 0,date:void 0,now:void 0,constructor:function(a){this.data=a.data;delete a.data;this.date=new Date;this.now=a.now;delete a.now},getReferenceDate:function(){return this.date},dayToLocaleString:function(a){var b="",b=1===a.getDay()?b+"lundi":2===a.getDay()?b+"mardi":3===a.getDay()?b+"mercredi":4===a.getDay()?b+"jeudi":5===a.getDay()?b+"vendredi":6===a.getDay()?b+"samedi":b+"dimanche",b=b+(" "+a.getDate()+" "),b=0===a.getMonth()?b+"janvier":
1===a.getMonth()?b+"fevrier":2===a.getMonth()?b+"mars":3===a.getMonth()?b+"avril":4===a.getMonth()?b+"mai":5===a.getMonth()?b+"juin":6===a.getMonth()?b+"juillet":7===a.getMonth()?b+"ao\u00fbt":8===a.getMonth()?b+"septembre":9===a.getMonth()?b+"octobre":10===a.getMonth()?b+"novembre":b+"d\u00e9cembre";return b+=" "+a.getFullYear()},buildUi:function(a,b){var c=this.data.searchDay(a),d=new Ui.ScrollingArea({margin:10}),e=new Ui.VBox({spacing:10});d.setContent(e);var f=new Date(a.getFullYear(),a.getMonth(),
a.getDate(),0,0,0,0),g="normal";this.now>=f&&this.now.getTime()<f.getTime()+864E5&&(g="bold");e.append(new Ui.Label({horizontalAlign:"center",fontSize:20,fontWeight:g,margin:10,text:this.dayToLocaleString(a)}));c=new Calendar.DayView({date:a,data:c,now:this.now});e.append(c,!0);return d}},{getMin:function(){return Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:-9007199254740991},getMax:function(){return Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:9007199254740991},getElementAt:function(a){var b=
new Date(this.date.getTime()+864E5*a);return this.buildUi(b,a)}});
Ui.CarouselableLoader.extend("Ui.WeekViewDataLoader",{data:void 0,date:void 0,now:void 0,constructor:function(a){this.data=a.data;delete a.data;this.date=new Date;this.now=a.now;delete a.now},getReferenceDate:function(){return this.date},weekToLocaleString:function(a){a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0);var b=(a.getDay()-1)%7;a=new Date(a.getTime()-864E5*b);var b=new Date(a.getTime()+5184E5),c="";a.getFullYear()===b.getFullYear()?(c=a.getMonth()===b.getMonth()?a.getDate()+
" - "+b.getDate()+" "+Ui.WeekViewDataLoader.monthToString[a.getMonth()]:a.getDate()+" "+Ui.WeekViewDataLoader.monthToString[a.getMonth()]+" - "+b.getDate()+" "+Ui.WeekViewDataLoader.monthToString[b.getMonth()],c+=" "+a.getFullYear()):c=a.getDate()+" "+Ui.WeekViewDataLoader.monthToString[a.getMonth()]+" "+a.getFullYear()+" - "+b.getDate()+" "+Ui.WeekViewDataLoader.monthToString[b.getMonth()]+" "+b.getFullYear();return c},buildUi:function(a,b){var c=this.data.searchWeek(a),d=new Date(a.getFullYear(),
a.getMonth(),a.getDate(),0,0,0,0),e=(d.getDay()-1)%7,f=new Date(d.getTime()-864E5*e),g=new Date(f.getTime()+5184E5),d=new Ui.ScrollingArea({margin:10}),e=new Ui.VBox({spacing:10});d.setContent(e);var k="normal";this.now>=f&&this.now<g&&(k="bold");e.append(new Ui.Label({horizontalAlign:"center",fontSize:20,fontWeight:k,margin:10,text:this.weekToLocaleString(a)}));c=new Calendar.WeekView({date:a,data:c,now:this.now});e.append(c,!0);return d}},{getMin:function(){return Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:
-9007199254740991},getMax:function(){return Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:9007199254740991},getElementAt:function(a){var b=new Date(this.date.getTime()+6048E5*a);return this.buildUi(b,a)}},{monthToString:{"0":"janvier",1:"f\u00e9vrier",2:"mars",3:"avril",4:"mai",5:"juin",6:"juillet",7:"ao\u00fbt",8:"septembre",9:"octobre",10:"novembre",11:"d\u00e9cembre"}});
Ui.CarouselableLoader.extend("Ui.MonthViewDataLoader",{data:void 0,date:void 0,constructor:function(a){this.data=a.data;delete a.data;this.date=new Date},getReferenceDate:function(){return this.date},buildUi:function(a,b){return new Ui.Rectangle({fill:"red",margin:10})}},{getMin:function(){return Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:-9007199254740991},getMax:function(){return Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:9007199254740991},getElementAt:function(a){var b=new Date(this.date.getTime()+
864E5*a);return this.buildUi(b,a)}});
Wn.ResourceViewer.extend("Calendar.App",{data:void 0,scroll:void 0,viewBar:void 0,dayview:void 0,currentDay:void 0,dateLabel:void 0,tools:void 0,carousel:void 0,loader:void 0,contentBox:void 0,bg:void 0,now:void 0,constructor:function(a){this.tools=[];this.now=new Date;this.bg=new Ui.Rectangle;this.append(this.bg);this.contentBox=new Ui.LBox;this.append(this.contentBox);a=new Ui.Button({text:"Aujourd'hui"});this.tools.push(a);this.connect(a,"press",this.onTodayPress);this.viewBar=new Ui.SegmentBar({margin:5,
field:"text",data:[{text:"Jour"},{text:"Semaine"}]});this.viewBar.setCurrentPosition(1);this.connect(this.viewBar,"change",this.onViewBarChange);this.tools.push(this.viewBar);a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Chargement en cours... Veuillez patienter",textAlign:"center"}));this.contentBox.setContent(a);this.request=new Core.HttpRequest({url:"/cloud/proxy?url="+encodeURIComponent(this.getResource().getData().data)});
this.connect(this.request,"done",this.onGetCalendarDone);this.connect(this.request,"error",this.onGetCalendarError);this.request.send();this.setActionButtons(this.tools)},onGetCalendarDone:function(a){a=a.getResponseText();this.data=new Calendar.Data({text:a});0===this.viewBar.getCurrentPosition()?this.loader=new Ui.DayViewDataLoader({data:this.data,now:this.now}):this.loader=new Ui.WeekViewDataLoader({data:this.data,now:this.now});this.carousel=new Ui.Carousel3({loader:this.loader});this.contentBox.setContent(this.carousel)},
onGetCalendarError:function(a){},setCurrentDate:function(a){a=Math.floor((a.getTime()-this.loader.getReferenceDate().getTime())/864E5);this.carousel.setCurrentAt(a)},onPreviousPress:function(){this.carousel.previous()},onNextPress:function(){this.carousel.next()},onTodayPress:function(){this.setCurrentDate(new Date)},onViewBarChange:function(){0===this.viewBar.getCurrentPosition()?this.loader=new Ui.DayViewDataLoader({data:this.data,now:this.now}):this.loader=new Ui.WeekViewDataLoader({data:this.data,
now:this.now});this.carousel=new Ui.Carousel3({loader:this.loader});this.contentBox.setContent(this.carousel)}},{onStyleChange:function(){this.bg.setFill(this.getStyleProperty("background"))}},{constructor:function(){this.register("calendar",this)}});Wn.ResourceView.extend("Calendar.Preview",{constructor:function(a){this.getGraphic().setIcon("calendar")}},{},{constructor:function(){this.register("calendar",this)}});Wn.ResourceCreator.extend("Calendar.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"calendar",name:this.getData().name,data:this.getData().url});this.done()}});Wn.WizardItem.extend("Calendar.Wizard",{nameField:void 0,urlField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);this.nameField=new Wn.TextField({title:"Nom de la ressource"});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);this.urlField=new Wn.TextField({title:"URL du flux ICAL du calendrier"});this.connect(this.urlField,"change",this.onChange);a.append(this.urlField);a=this.getData();void 0!==a.name&&this.nameField.setValue(a.name);void 0!==
a.url&&this.urlField.setValue(a.url);this.onChange()},onChange:function(){""!=this.urlField.getValue()&&(""!=this.nameField.getValue()&&this.urlField.getValue().match(/^http(s){0,1}:\/\/.*$/))&&this.done()}},{onSave:function(){var a=this.getData();a.name=this.nameField.getValue();a.url=this.urlField.getValue()}});Wn.ResourceWizard.register("calendar","Calendrier","calendar",[Calendar.Wizard],Calendar.Creator);Ui.ScrollingArea.extend("Storage.Transformable",{constructor:function(a){this.setMaxScale(4)}});Ui.Dialog.extend("Storage.TextEditor",{storage:void 0,file:void 0,textField:void 0,updateRequest:void 0,saveRequest:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.setTitle("Edition de texte");this.setFullScrolling(!0);this.setPreferredWidth(600);this.setPreferredHeight(600);this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.DefaultButton({text:"Enregistrer & Fermer"});this.connect(a,"press",this.onSaveQuitPress);this.setActionButtons([a]);
a=new Ui.LBox;a.append(new Storage.PageBackgroundGraphic);this.setContent(a);this.textField=navigator.isIE7||navigator.isIE8?new Ui.TextArea({margin:10}):new Ui.ContentEditable({margin:10});a.append(this.textField);this.updateText()},updateText:function(){void 0===this.updateRequest&&(this.updateRequest=new Core.HttpRequest({url:"/cloud/storage/"+this.storage+"/"+this.file+"/content"}),this.connect(this.updateRequest,"done",this.onUpdateTextDone),this.connect(this.updateRequest,"error",this.onUpdateTextError),
this.updateRequest.send())},onUpdateTextDone:function(){var a=this.updateRequest.getResponseText();""===a&&(a="\n");navigator.isIE7||navigator.isIE8?this.textField.setValue(a):this.textField.setText(a);this.updateRequest=void 0},onUpdateTextError:function(){this.updateRequest=void 0},onSaveQuitPress:function(){var a;a=navigator.isIE7||navigator.isIE8?this.textField.getValue():this.textField.getText();for(var b="----",c=0;16>c;c++)b+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(62*
Math.random())];b+="----";this.saveRequest=new Core.HttpRequest({method:"PUT",url:"/cloud/storage/"+this.storage+"/"+this.file});this.saveRequest.setRequestHeader("Content-Type","multipart/form-data; boundary="+b);this.saveRequest.setContent("--"+b+'\r\nContent-Disposition: form-data; name="file"; filename="noname"\r\nContent-Type: text/plain; charset=UTF-8\r\n\r\n'+a+"\r\n--"+b+"--\r\n");this.connect(this.saveRequest,"done",this.onSaveTextDone);this.connect(this.saveRequest,"error",this.onSaveTextError);
this.saveRequest.send()},onSaveTextDone:function(){this.close()},onSaveTextError:function(){this.close()}});Ui.CanvasElement.extend("Storage.CurrentArrow",{},{updateCanvas:function(a){a.fillStyle=Ui.Color.create(this.getStyleProperty("color")).getCssRgba();a.fillRect(0,0,this.getLayoutWidth(),this.getLayoutHeight())}},{style:{color:"#e20045"}});
Ui.Image.extend("Storage.FilePreviewImage",{squareSize:void 0,setSquareSize:function(a){this.squareSize=a;this.invalidateMeasure()}},{measureCore:function(a,b){if(this.getIsReady()){var c=this.getNaturalWidth()/this.getNaturalHeight();return 1<c?{width:this.squareSize,height:this.squareSize/c}:{width:this.squareSize*c,height:this.squareSize}}return{width:this.squareSize,height:this.squareSize}}});
Ui.Button.extend("Storage.FilePreview",{resource:void 0,storage:void 0,file:void 0,uploader:void 0,content:void 0,label:void 0,shadow:void 0,progressbar:void 0,needUpdate:!1,isCurrent:!1,image:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.storage=a.storage;delete a.storage;"uploader"in a&&(this.uploader=a.uploader,delete a.uploader);void 0!==this.uploader?(a=new Ui.LBox,this.setIcon(a),a.append(new Ui.Icon({icon:"uploadfile",width:48,height:48,verticalAlign:"bottom",
horizontalAlign:"center"})),this.progressbar=new Ui.ProgressBar({verticalAlign:"bottom",horizontalAlign:"center",margin:5,width:50}),a.append(this.progressbar),this.connect(this.uploader,"progress",this.onUploaderProgress),this.connect(this.uploader,"complete",this.onUploaderComplete),void 0!=this.uploader.getFile().getFileName()&&this.setText(this.uploader.getFile().getFileName())):"file"in a&&(this.update(a.file),delete a.file);this.arrow=new Storage.CurrentArrow({height:4,verticalAlign:"bottom"});
this.arrow.hide();this.getDropBox().append(this.arrow)},current:function(){this.isCurrent=!0;this.arrow.show()},uncurrent:function(){this.isCurrent=!1;this.arrow.hide()},update:function(a){if(void 0==this.file||this.needUpdate||JSON.stringify(this.file)!==JSON.stringify(a))this.file=a,a=new Ui.LBox({verticalAlign:"bottom",horizontalAlign:"center"}),this.setIcon(a),this.image=new Storage.FilePreviewImage({src:"/cloud/preview/"+this.storage+"/"+this.file.id+"?rev="+this.file.rev,margin:3,squareSize:this.getStyleProperty("iconSize")-
6}),this.setDownloadUrl("/cloud/storage/"+this.storage+"/"+this.file.id+"/content",this.file.mimetype,this.file.name),this.setMimetype("application/x-wn2-file"),this.setDraggableData(this.storage+":"+this.file.id),this.connect(this.image,"error",this.onPreviewError),a.append(this.image),this.setText(this.file.name)},getStorage:function(){return this.storage},getFile:function(){return this.file},getUploader:function(){return this.uploader},onPreviewError:function(a){this.disconnect(a,"error",this.onPreviewError);
a="file";"application/x-directory"===this.file.mimetype&&(a="folder");this.setIcon(a)},deleteFile:function(){void 0!=this.uploader&&(this.uploader.abort(),this.uploader=void 0);void 0!=this.file&&(new Core.HttpRequest({method:"DELETE",url:"/cloud/storage/"+this.storage+"/"+this.file.id})).send()},onUploaderProgress:function(a,b,c){void 0!==this.progressbar&&this.progressbar.setValue(b/c)},onUploaderComplete:function(){var a=this.uploader.getResponseJSON();this.update(a);this.needUpdate=!0},onFileDelete:function(){this.deleteFile()},
onFileProperties:function(){(new Storage.FilePropertiesDialog({resource:this.resource,storage:this.storage,file:this.file})).open()}},{onStyleChange:function(){Storage.FilePreview.base.onStyleChange.apply(this,arguments);var a=this.getStyleProperty("iconSize");void 0!==this.image&&this.image.setSquareSize(a-4)},getSelectionActions:function(){return{remove:{text:"Supprimer",icon:"trash",scope:this,callback:this.onFileDelete,multiple:!1},edit:{"default":!0,text:"Propri\u00e9t\u00e9s",icon:"filetools",
scope:this,callback:this.onFileProperties,multiple:!1}}}});Ui.Dialog.extend("Storage.FilePropertiesDialog",{resource:void 0,file:void 0,storage:void 0,deleteButton:void 0,modifyButton:void 0,nameField:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.file=a.file;delete a.file;this.storage=a.storage;delete a.storage;this.setPreferredWidth(500);this.setPreferredHeight(500);this.setFullScrolling(!0);this.setTitle("Propri\u00e9t\u00e9s du fichier");this.setCancelButton(new Ui.DialogCloseButton);a=new Ui.VBox({});this.setContent(a);
var b=new Ui.VBox({uniform:!0});a.append(b);var c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Nom",width:100,textAlign:"right",verticalAlign:"center"}));this.nameField=new Ui.TextField({value:this.file.name,verticalAlign:"center"});c.append(this.nameField,!0);c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Type",width:100,textAlign:"right",verticalAlign:"center"}));c.append(new Ui.Text({text:this.file.mimetype,verticalAlign:"center"}),!0);c=new Ui.HBox({spacing:10});
b.append(c);c.append(new Ui.Text({text:"Taille",width:100,textAlign:"right",verticalAlign:"center"}));c.append(new Ui.Text({text:this.formatSize(this.file.size),verticalAlign:"center"}),!0);c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Cr\u00e9ation",width:100,textAlign:"right",verticalAlign:"center"}));c.append(new Ui.Text({text:this.formatDate(new Date(1E3*this.file.ctime)),verticalAlign:"center"}),!0);c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Modification",
width:100,textAlign:"right",verticalAlign:"center"}));c.append(new Ui.Text({text:this.formatDate(new Date(1E3*this.file.mtime)),verticalAlign:"center"}),!0);var b=Ui.App.current.getUser(),c="resource:"+this.resource.getId()+":"+this.file.id,d=b.getRfidsFromPath(c),b=new Wn.RfidSection({user:b,tags:d,path:c});a.append(b);Ui.App.current.getUser().isAdmin()||this.resource.canWrite()?(this.deleteButton=new Wn.AlertButton({text:"Supprimer"}),this.connect(this.deleteButton,"press",this.onDeletePress),this.saveButton=
new Ui.DefaultButton({text:"Enregistrer"}),this.connect(this.saveButton,"press",this.onSavePress),this.setActionButtons([this.deleteButton,this.saveButton])):this.nameField.disable()},formatSize:function(a){return 1E9<a?(a/1E9).toFixed(2)+" Go":1E6<a?(a/1E6).toFixed(2)+" Mo":1E3<a?(a/1E3).toFixed(2)+" ko":a+" octets"},formatDate:function(a){var b="",b=10>a.getDate()?b+("0"+a.getDate()):b+a.getDate(),b=b+"/",b=10>a.getMonth()+1?b+("0"+(a.getMonth()+1)):b+(a.getMonth()+1),b=b+("/"+a.getFullYear()+" "),
b=10>a.getHours()?b+("0"+a.getHours()):b+a.getHours(),b=b+":",b=10>a.getMinutes()?b+("0"+a.getMinutes()):b+a.getMinutes(),b=b+":";return b=10>a.getSeconds()?b+("0"+a.getSeconds()):b+a.getSeconds()},onSavePress:function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/storage/"+this.storage+"/"+this.file.id,content:JSON.stringify({name:this.nameField.getValue()})})).send();this.close()},onDeletePress:function(){(new Core.HttpRequest({method:"DELETE",url:"/cloud/storage/"+this.storage+"/"+this.file.id})).send();
this.close()}});Wn.ResourceView.extend("Storage.Preview",{storage:void 0,progressBar:void 0,constructor:function(a){this.getGraphic().setIcon("files");this.storage=this.getResource().getStorageId();void 0!==this.getResource().getPreviewImageUrl()?this.getGraphic().setPreviewImage(this.getResource().getPreviewImageUrl()):(a=new Core.HttpRequest({url:"/cloud/storage/"+this.storage+"/0?depth=1"}),this.connect(a,"done",this.onInfoFileDone),a.send());this.getResource().canWrite()&&(this.getDropBox().addMimetype("files"),
this.connect(this.getDropBox(),"dropfile",this.onUploadFile),this.progressBar=new Ui.ProgressBar({verticalAlign:"bottom",margin:5}),this.progressBar.setStyleProperty("color","white"),this.progressBar.hide(),this.getIconBox().append(this.progressBar),this.connect(this.resource,"uploadstart",function(){this.progressBar.setValue(0);this.progressBar.show()}),this.connect(this.resource,"uploadprogress",function(a,c){this.progressBar.setValue(c)}),this.connect(this.resource,"uploadcomplete",function(){this.progressBar.hide()}))},
onUploadFile:function(a,b){var c=new Wn.FilePostUploader({file:b,service:"/cloud/storage/"+this.storage+"/0",resource:this.getResource()});c.setField("define",JSON.stringify({position:0}));c.hostStorage=this.storage;Ui.App.current.addUploader(c);c.send()},onInfoFileDone:function(a){a=a.getResponseJSON();"children"in a&&0<a.children.length&&(a=a.children[0],this.getGraphic().setPreviewImage("/cloud/previewhigh/"+this.storage+"/"+a.id+"?rev="+a.rev))}},{onResourceChange:function(){Storage.Preview.base.onResourceChange.apply(this,
arguments);void 0!==this.getResource().getPreviewImageUrl()&&this.getResource().getPreviewImageUrl()!==this.getGraphic().getPreviewImage()&&this.getGraphic().setPreviewImage(this.getResource().getPreviewImageUrl())}},{constructor:function(){this.register("storage",this)}});Ui.LBox.extend("Wn.DetailsBox",{bg:void 0,scroll:void 0,constructor:function(){this.bg=new Ui.Rectangle;this.append(this.bg);this.scroll=new Ui.ScrollingArea;this.append(this.scroll)},getScroll:function(){return this.scroll}},{setContent:function(a){this.scroll.setContent(a)},onStyleChange:function(){this.bg.setFill(this.getStyleProperty("background"))}},{style:{background:"rgba(241,241,241,0.5)"}});
Ui.LBox.extend("Wn.NavigationBox",{bg:void 0,scroll:void 0,constructor:function(){this.bg=new Ui.Rectangle;this.append(this.bg);this.scroll=new Ui.ScrollingArea({scrollHorizontal:!0,scrollVertical:!1});this.append(this.scroll)},getScroll:function(){return this.scroll}},{setContent:function(a){this.scroll.setContent(a)},onStyleChange:function(){this.bg.setFill(this.getStyleProperty("background"))}},{style:{background:"rgba(241,241,241,0.5)"}});
Ui.ScrollingArea.extend("Storage.FileViewer",{uploader:void 0,file:void 0,storage:void 0,updateNeeded:!1,viewer:void 0,tools:void 0,contentViewerBox:void 0,commentViewer:void 0,detailsBox:void 0,isDetailsBoxVisible:!0,playing:!1,contentViewer:void 0,box:void 0,timer:void 0,fileToolsBox:void 0,filePropertiesButton:void 0,fileDownloadButton:void 0,fileDeleteButton:void 0,constructor:function(a){this.addEvents("toolschange","end");this.storage=a.storage;delete a.storage;this.viewer=a.viewer;delete a.viewer;
this.tools=[];this.box=new Ui.Box({orientation:"horizontal"});this.setContent(this.box);this.contentViewerBox=new Ui.LBox;this.box.append(this.contentViewerBox,!0);"uploader"in a?(this.uploader=a.uploader,delete a.uploader):"file"in a&&(this.update(a.file),delete a.file);this.connect(this,"visible",this.onFileViewerVisible);this.connect(this,"hidden",this.onFileViewerHidden);this.connect(Ui.App.current,"resize",this.onAppResize)},setShowDetails:function(a){this.isDetailsBoxVisible=!0===a;void 0!==
this.detailsBox&&(this.isDetailsBoxVisible?this.detailsBox.show():this.detailsBox.hide(!0))},showProperties:function(){(new Storage.FilePropertiesDialog({resource:this.viewer.getResource(),storage:this.storage,file:this.file})).open()},getDownloadUrl:function(){return void 0!==this.uploader?void 0:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?attachment=true&rev="+this.file.rev},update:function(a){if(void 0===this.file||this.updateNeeded||JSON.stringify(this.file)!==JSON.stringify(a))this.file=
a,this.updateNeeded=!1,this.getIsLoaded()&&this.buildContent(),this.commentViewer&&this.commentViewer.updateFile(this.file)},removeContent:function(){this.contentViewerBox.setContent()},buildContent:function(){if(void 0!==this.uploader)this.contentViewerBox.setContent(new Storage.UploaderViewer({storage:this.storage,uploader:this.uploader,fileViewer:this}));else{this.tools=[];"image/gif"==this.file.mimetype?this.contentViewer=new Storage.GifImageFileViewer({storage:this.storage,file:this.file,fileViewer:this}):
0==this.file.mimetype.indexOf("image/")?this.contentViewer=new Storage.ImageFileViewer({storage:this.storage,file:this.file,fileViewer:this}):"text/uri-list"==this.file.mimetype?this.contentViewer=new Storage.SiteFileViewer({storage:this.storage,file:this.file,fileViewer:this}):"application/x-webnapperon2-rss-item"==this.file.mimetype?this.contentViewer=new Storage.RssItemFileViewer({storage:this.storage,file:this.file,fileViewer:this}):!navigator.isIE7&&!navigator.isIE8&&0==this.file.mimetype.indexOf("video/")?
this.contentViewer=new Storage.VideoFileViewer({storage:this.storage,file:this.file,fileViewer:this}):!navigator.isIE7&&!navigator.isIE8&&0==this.file.mimetype.indexOf("audio/")?this.contentViewer=new Storage.AudioFileViewer({storage:this.storage,file:this.file,fileViewer:this}):0==this.file.mimetype.indexOf("text/plain")&&5E4>this.file.size?this.contentViewer=new Storage.TextFileViewer({storage:this.storage,file:this.file,fileViewer:this}):0==this.file.mimetype.indexOf("application/pdf")||0==this.file.mimetype.indexOf("application/vnd.oasis.opendocument.text")||
0==this.file.mimetype.indexOf("application/vnd.oasis.opendocument.presentation")||0==this.file.mimetype.indexOf("application/vnd.oasis.opendocument.graphics")||0==this.file.mimetype.indexOf("application/vnd.sun.xml.writer")||0==this.file.mimetype.indexOf("application/vnd.ms-powerpoint")||0==this.file.mimetype.indexOf("application/msword")||0==this.file.mimetype.indexOf("application/vnd.openxmlformats-officedocument.wordprocessingml.document")||0==this.file.mimetype.indexOf("text/richtext")?this.contentViewer=
new Storage.PdfFileViewer({storage:this.storage,file:this.file,fileViewer:this}):this.contentViewer=new Storage.GenericFileViewer({storage:this.storage,file:this.file,fileViewer:this});this.contentViewerBox.setContent(this.contentViewer);this.playing&&this.play();if(void 0===this.detailsBox){this.detailsBox=new Wn.DetailsBox({width:250});this.box.append(this.detailsBox);var a=new Ui.VBox({spacing:5,marginRight:5});this.detailsBox.setContent(a);this.fileToolsBox=new Wn.OptionSection({isFolded:!0});
a.append(this.fileToolsBox);this.filePropertiesButton=new Ui.Button({icon:"filetools",text:"Propri\u00e9t\u00e9s"});this.connect(this.filePropertiesButton,"press",this.showProperties);this.appendTool(this.filePropertiesButton);this.fileDownloadButton=new Ui.DownloadButton({icon:"savedisk",text:"T\u00e9l\u00e9charger",src:this.getDownloadUrl()});this.appendTool(this.fileDownloadButton);this.viewer.getResource().canWrite()&&(this.fileDeleteButton=new Ui.Button({icon:"trash",text:"Supprimer"}),this.connect(this.fileDeleteButton,
"press",this.deleteFile),this.appendTool(this.fileDeleteButton));this.commentViewer=new Wn.CommentViewer({user:Ui.App.current.getUser(),resource:this.viewer.getResource(),storage:this.storage,file:this.file});a.append(this.commentViewer);this.isDetailsBoxVisible||this.detailsBox.hide(!0)}else this.appendTool(this.filePropertiesButton),this.appendTool(this.fileDownloadButton),this.viewer.getResource().canWrite()&&this.appendTool(this.fileDeleteButton);this.onAppResize(Ui.App.current,Ui.App.current.getLayoutWidth(),
Ui.App.current.getLayoutHeight())}},getFile:function(){return this.file},getUploader:function(){return this.uploader},getViewer:function(){return this.viewer},getCommentsCount:function(){return void 0!==this.file?this.file.comments.length:0},getTools:function(){return this.tools},appendTool:function(a){this.tools.push(a);this.fireEvent("toolschange",this,this.tools);if(void 0!==this.fileToolsBox){this.fileToolsBox.setTitle(this.file.name);a=new Ui.VBox({spacing:5});a.append(new Ui.Separator({marginBottom:10}));
for(var b=0;b<this.tools.length;b++)a.append(this.tools[b]);this.fileToolsBox.setContent(a)}},play:function(){this.playing||(this.playing=!0,void 0!==this.contentViewer&&"play"in this.contentViewer?(this.connect(this.contentViewer,"end",this.onPlayEnd),this.contentViewer.play()):this.timer=new Core.DelayedTask({scope:this,delay:5,callback:this.onPlayEnd}))},current:function(){0<this.contentViewerBox.getChildren().length&&"current"in this.contentViewerBox.getChildren()[0]&&this.contentViewerBox.getChildren()[0].current()},
uncurrent:function(){0<this.contentViewerBox.getChildren().length&&"uncurrent"in this.contentViewerBox.getChildren()[0]&&this.contentViewerBox.getChildren()[0].uncurrent()},onPlayEnd:function(){this.timer=void 0;this.playing=!1;this.fireEvent("end",this)},deleteFile:function(){var a=new Ui.Dialog({cancelButton:new Ui.DialogCloseButton,content:new Ui.Text({width:300,text:"Voulez vous vraiment supprimer ce fichier. Il sera d\u00e9finitivement perdu."})}),b=new Ui.DefaultButton({text:"Supprimer"});this.connect(b,
"press",function(){void 0!==this.file?(new Core.HttpRequest({method:"DELETE",url:"/cloud/storage/"+this.storage+"/"+this.file.id})).send():void 0!==this.uploader&&this.uploader.abort();a.close()});a.setActionButtons([b]);a.open()},onFileViewerVisible:function(){this.buildContent()},onFileViewerHidden:function(){this.removeContent()},onAppResize:function(a,b,c){void 0!==this.detailsBox&&(700>b?(this.box.setOrientation("vertical"),this.detailsBox.getScroll().setScrollVertical(!1),Ui.Box.setResizable(this.detailsBox,
!0),this.contentViewerBox.setHeight(400)):(this.box.setOrientation("horizontal"),this.detailsBox.getScroll().setScrollVertical(!0),Ui.Box.setResizable(this.detailsBox,!1),this.contentViewerBox.setHeight(void 0)))},showDetails:function(){this.setShowDetails(!0)},hideDetails:function(){this.setShowDetails(!1)}},{onUnload:function(){Storage.FileViewer.base.onUnload.apply(this,arguments);void 0!==this.timer&&(this.timer.abort(),this.timer=void 0)}});
Ui.LBox.extend("Storage.UploaderViewer",{storage:void 0,uploader:void 0,progressbar:void 0,label:void 0,fileViewer:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.uploader=a.uploader;delete a.uploader;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center"});this.setContent(a);a.append(new Ui.Icon({icon:"uploadfile",fill:"#3f3f3f",width:256,height:256,horizontalAlign:"center"}));this.progressbar=new Ui.ProgressBar({width:120,
height:10});a.append(this.progressbar);void 0!=this.uploader.getFile().getFileName()&&a.append(new Ui.CompactLabel({width:256,maxLine:3,textAlign:"center",text:this.uploader.getFile().getFileName()}));this.connect(this.uploader,"progress",this.onUploaderProgress)},onUploaderProgress:function(a,b,c){this.progressbar.setValue(b/c)}});
Storage.Transformable.extend("Storage.ImageFileViewer",{storage:void 0,file:void 0,image:void 0,values:void 0,quality:!1,fileViewer:void 0,lbox:void 0,loading:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.setFocusable(!1);this.lbox=new Ui.LBox;this.setContent(this.lbox);this.image=new Wn.ScaledImage2;this.image.setSrc("/cloud/previewhigh/"+this.storage+"/"+this.file.id+"?rev="+this.file.rev);
this.lbox.append(this.image);this.image.getIsReady()||(this.loading=new Ui.Loading({width:50,height:50,verticalAlign:"center",horizontalAlign:"center"}),this.lbox.append(this.loading),this.connect(this.image,"ready",function(){this.lbox.remove(this.loading)}))},current:function(){}},{onHidden:function(){}});
Ui.LBox.extend("Storage.GifImageFileViewer",{storage:void 0,file:void 0,image:void 0,values:void 0,fileViewer:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.image=new Wn.ScaledImage2;this.image.setSrc("/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev);this.setContent(this.image)}});
Ui.LBox.extend("Storage.SiteFileViewer",{storage:void 0,file:void 0,text:void 0,fileViewer:void 0,linkButton:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev});this.connect(a,"done",this.onContentLoaded);a.send();a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});
this.setContent(a);var b=new Ui.LBox({verticalAlign:"bottom",horizontalAlign:"center"});a.append(b);var c=new Ui.Image({src:"/cloud/previewhigh/"+this.storage+"/"+this.file.id+"?rev="+this.file.rev,width:128,margin:3});b.append(c);this.connect(c,"error",function(){b.setContent(new Ui.Icon({icon:"earth",verticalAlign:"bottom",horizontalAlign:"center",width:128,height:128}))});this.text=new Ui.Text({textAlign:"center",text:this.file.name,fontSize:20});a.append(this.text);this.linkButton=new Ui.LinkButton({text:"Ouvrir le site",
horizontalAlign:"center"});this.linkButton.disable();a.append(this.linkButton)},onContentLoaded:function(a){void 0!==this.file.meta&&"true"===this.file.meta.iframe?(a=new Ui.IFrame({src:a.getResponseText()}),this.setContent(a)):(this.linkButton.setSrc(a.getResponseText()),this.linkButton.enable())}});
Ui.LBox.extend("Storage.AudioFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,player:void 0,request:void 0,checkTask:void 0,playing:!1,constructor:function(a){this.addEvents("end");this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer},checkReady:function(){void 0!==this.checkTask&&(this.checkTask=void 0);void 0!==this.player||void 0!==this.request||(this.request=new Core.HttpRequest({method:"GET",url:"/cloud/audio/"+this.storage+
"/"+this.file.id+"/info"}),this.connect(this.request,"done",this.onCheckDone),this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();"ready"==a.status[a.support]?(this.player=new Wn.AudioPlayer({src:"/cloud/audio/"+this.storage+"/"+this.file.id,text:this.file.name}),this.setContent(this.player),this.connect(this.player,"end",this.onMediaEnd),this.playing&&this.play()):"building"==a.status[a.support]?this.checkTask=new Core.DelayedTask({delay:2,
scope:this,callback:this.checkReady}):this.setContent(new Ui.Text({text:"Impossible d'\u00e9couter ce fichier son"}));this.request=void 0},onCheckError:function(){this.setContent(new Ui.Text({text:"Impossible d'\u00e9couter ce fichier son",verticalAlign:"center"}));this.request=void 0},uncurrent:function(){void 0!==this.player&&this.player.pause()},play:function(){this.playing=!0;var a=!navigator.iOs&&!navigator.Android;void 0!==this.player&&a&&this.player.play()},onMediaEnd:function(){this.fireEvent("end",
this)}},{onVisible:function(){if(void 0===this.player){var a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",textAlign:"center"}));this.setContent(a);this.checkReady()}},onHidden:function(){void 0!==this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0);void 0!==this.player&&this.player.pause()},onUnload:function(){Storage.AudioFileViewer.base.onUnload.apply(this,
arguments);this.onHidden()}});
Ui.Pressable.extend("Storage.VideoFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,player:void 0,request:void 0,checkTask:void 0,playing:!1,constructor:function(a){this.addEvents("end");this.setFocusable(!1);this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.setLock(!0);this.connect(this,"press",this.onVideoPress)},checkReady:function(){void 0!==this.checkTask&&(this.checkTask=void 0);void 0!==this.player||void 0!==
this.request||(this.request=new Core.HttpRequest({method:"GET",url:"/cloud/video/"+this.storage+"/"+this.file.id+"/info"}),this.connect(this.request,"done",this.onCheckDone),this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();"ready"==a.status[a.support]?(this.player=new Wn.VideoPlayer({src:"/cloud/video/"+this.storage+"/"+this.file.id,poster:"/cloud/previewhigh/"+this.storage+"/"+this.file.id+"?rev="+this.file.rev}),
this.connect(this.player,"statechange",this.onVideoStateChange),this.connect(this.player,"end",this.onVideoEnd),this.setContent(this.player),this.playing&&this.play()):"building"==a.status[a.support]?this.checkTask=new Core.DelayedTask({delay:2,scope:this,callback:this.checkReady}):this.setContent(new Ui.Text({text:"Impossible de lire ce fichier vid\u00e9o",verticalAlign:"center",textAlign:"center"}));this.request=void 0},onCheckError:function(){this.setContent(new Ui.Text({text:"Impossible de lire ce fichier vid\u00e9o",
verticalAlign:"center",textAlign:"center"}));this.request=void 0},onVideoEnd:function(a){this.playing=!1;this.fireEvent("end",this)},onVideoStateChange:function(a){this.setLock(this.player.getIsControlsVisible())},onVideoPress:function(){void 0!==this.player&&"playing"==this.player.getState()&&this.player.pause()},uncurrent:function(){void 0!==this.player&&this.player.pause()},play:function(){this.playing=!0;var a=!navigator.iOs&&!navigator.Android;void 0!==this.player&&a&&this.player.play()}},{onVisible:function(){if(void 0===
this.player){var a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",textAlign:"center"}));this.setContent(a);this.checkReady()}},onHidden:function(){void 0!==this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0);void 0!==this.request&&(this.request.abort(),this.request=void 0);void 0!==this.player&&this.player.pause()},onUnload:function(){Storage.VideoFileViewer.base.onUnload.apply(this,
arguments);this.onHidden()}});
Storage.Transformable.extend("Storage.TextFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,text:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.LBox;a.append(new Storage.PageBackgroundGraphic);this.setContent(a);this.text=new Wn.ImprovedText({margin:30,style:{"Wn.ImprovedText":{fontSize:20}}});a.append(this.text);a=new Ui.Button({icon:"fileedit",text:"\u00c9diter"});this.connect(a,
"press",function(){(new Storage.TextEditor({storage:this.storage,file:this.file.id})).open()});this.fileViewer.appendTool(a);a=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev});this.connect(a,"done",this.onTextLoaded);a.send()},onTextLoaded:function(a){this.text.setText(a.getResponseText())}});Ui.Rectangle.extend("Storage.PageBackgroundGraphic",{},{onStyleChange:function(){this.setFill(this.getStyleProperty("background"))}},{style:{background:"#ffffff"}});
Storage.Transformable.extend("Storage.RssItemFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,title:void 0,content:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.setSelectable(!1);a=new Ui.LBox;a.append(new Storage.PageBackgroundGraphic);this.setContent(a);var b=new Ui.VBox({margin:20,spacing:10});a.append(b);this.title=new Ui.Text({text:this.file.name,fontWeight:"bold",fontSize:24,
marginTop:20});b.append(this.title);this.content=new Ui.Html;this.connect(this.content,"link",this.onContentLink);b.append(this.content);a=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev});this.connect(a,"done",this.onTextLoaded);a.send()},onTextLoaded:function(a){var b='<div style="word-wrap: break-word; font-family: '+this.getStyleProperty("fontFamily")+";font-size: "+this.getStyleProperty("fontSize")+"px;font-weight: "+this.getStyleProperty("fontWeight")+
';">',b=b+((new Date(this.file.meta.pubDate)).toLocaleString()+"&nbsp;&nbsp;");void 0!=this.file.meta.link&&(b+='<a href="'+this.file.meta.link+'" style="cursor: pointer; text-decoration: underline">article complet</a><br>');b=b+"<br>"+a.getResponseText();b+="</div>";this.content.setHtml(b);a=this.content.getElements("IMG");for(b=0;b<a.length;b++)a[b].style.maxWidth="90%",a[b].style.height="auto",Ui.Element.setSelectable(a[b],!1),a[b].setAttribute("draggable",!1);this.onStyleChange()},onContentLink:function(a,
b){window.open(b,"_blank")}},{onStyleChange:function(){for(var a=Ui.Color.create(this.getStyleProperty("linkColor")).getCssHtml(),b=this.content.getElements("A"),c=0;c<b.length;c++){var d=b[c];d.style.color=a;d.style.textDecoration="none"}}},{style:{linkColor:"#4d4d4d"}});Ui.Image.extend("Storage.PdfPageGraphic",{constructor:function(a){this.ratio=a.ratio;delete a.ratio}});
Ui.LBox.extend("Storage.PdfPage",{storage:void 0,file:void 0,page:void 0,ratio:void 0,graphic:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.page=a.page;delete a.page;this.ratio=a.ratio;delete a.ratio;this.append(new Storage.PdfPageGraphic({ratio:this.ratio,src:"/cloud/pdf/"+this.storage+"/"+this.file.id+"/pages/"+this.page+"/image?rev="+this.file.rev}))}},{measureCore:function(a,b){return{width:a,height:(a-20)/this.ratio+20}},onChildInvalidateMeasure:function(a,
b){a.measure(this.getLayoutWidth(),this.getLayoutHeight());a.arrange(0,0,this.getLayoutWidth(),this.getLayoutHeight())}});
Ui.ScrollLoader.extend("Storage.PdfPageLoader",{storage:void 0,file:void 0,data:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.data=a.data;delete a.data}},{getMin:function(){return 0},getMax:function(){return this.data.length-1},getElementAt:function(a){return new Storage.PdfPage({storage:this.storage,file:this.file,page:a,ratio:this.data[a].width/this.data[a].height,marginBottom:20})}});
Ui.LBox.extend("Storage.PdfFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,pages:void 0,data:void 0,isCurrent:!1,checkTask:void 0,request:void 0,relativeOffset:0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.setContent(new Ui.Element)},checkReady:function(){void 0!==this.checkTask&&(this.checkTask=void 0);void 0===this.request&&(this.request=new Core.HttpRequest({method:"GET",url:"/cloud/pdf/"+
this.storage+"/"+this.file.id}),this.connect(this.request,"done",this.onCheckDone),this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();"ready"==a.status?(this.data=a,this.onDataDone()):"building"==a.status?this.checkTask=new Core.DelayedTask({delay:2,scope:this,callback:this.checkReady}):this.setContent(new Ui.Text({text:"Impossible de lire ce fichier PDF",verticalAlign:"center"}));this.request=void 0},onCheckError:function(){this.setContent(new Ui.Text({text:"Impossible de lire ce fichier vid\u00e9o",
verticalAlign:"center"}));this.request=void 0},onDataDone:function(a){a=new Storage.PdfPageLoader({storage:this.storage,file:this.file,data:this.data.pages});this.pages=new Ui.VBoxScrollingArea({loader:a,maxScale:4});this.setContent(this.pages)},current:function(){this.isCurrent=!0},uncurrent:function(){this.isCurrent=!1}},{onVisible:function(){if(void 0===this.pages){var a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",
textAlign:"center"}));this.setContent(a);this.checkReady()}},onHidden:function(){void 0!=this.request&&(this.request.abort(),this.request=void 0);void 0!=this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0)}});
Ui.LBox.extend("Storage.GenericFileViewer",{storage:void 0,file:void 0,text:void 0,fileViewer:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});this.setContent(a);a.append(new Ui.Icon({icon:"file",width:128,height:128,horizontalAlign:"center"}));this.text=new Ui.Text({textAlign:"center",text:this.file.name,fontSize:20});a.append(this.text);
var b=new Ui.DownloadButton({text:"T\u00e9l\u00e9charger",horizontalAlign:"center"});b.setSrc("/cloud/storage/"+this.storage+"/"+this.file.id+"/content?attachment=true&rev="+this.file.rev);a.append(b)}});
Ui.Container.extend("Storage.ScaledImage",{image:void 0,src:void 0,ratio:1,constructor:function(a){this.setClipToBounds(!0);"src"in a?(this.src=a.src,delete a.src,this.image=new Ui.Image({src:this.src})):this.image=new Ui.Image;this.appendChild(this.image);"ratio"in a&&(this.ratio=a.ratio,delete a.ratio);this.connect(this.image,"ready",this.onReady);this.addEvents("ready")},setSrc:function(a){this.removeChild(this.image);this.src=a;this.image=void 0==this.src?new Ui.Image:new Ui.Image({src:this.src});
this.appendChild(this.image)},getIsReady:function(){return this.image.getIsReady()},onReady:function(){this.invalidateMeasure();this.fireEvent("ready",this)}},{measureCore:function(a,b){if(this.getIsReady()){var c=this.image.getNaturalWidth(),d=this.image.getNaturalHeight();return{width:a,height:d*a/c}}return{width:a,height:a/this.ratio}},arrangeCore:function(a,b){this.image.arrange(0,0,a,b)}});
Ui.Dialog.extend("Storage.NewDialog",{viewer:void 0,constructor:function(a){this.viewer=a.viewer;delete a.viewer;this.setFullScrolling(!0);this.setPreferredWidth(300);this.setPreferredHeight(350);a=new Ui.VBox({uniform:!0,spacing:8});this.setContent(a);var b;b=navigator.iOs?new Ui.UploadButton({icon:"camera",text:"Photo ou vid\u00e9o",orientation:"horizontal"}):new Ui.UploadButton({icon:"uploadfile",text:"Fichier local",orientation:"horizontal"});this.connect(b,"file",function(a,b){this.viewer.onUploadFile(a,
b,0);this.close()});a.append(b);b=new Ui.Button({icon:"text",text:"Fichier texte",orientation:"horizontal"});this.connect(b,"press",function(){this.close();this.viewer.onNewTextPress()});a.append(b);b=new Ui.Button({icon:"earth",text:"Lien vers un site Web",orientation:"horizontal"});this.connect(b,"press",function(){this.close();this.viewer.onNewUriPress()});a.append(b);this.setTitle("Nouveau fichier");this.setCancelButton(new Ui.DialogCloseButton)}});
Ui.Button.extend("Storage.UploadView",{progressBar:void 0,resource:void 0,uploadIcon:void 0,uploadText:void 0,constructor:function(a){this.addEvents("end");this.resource=a.resource;delete a.resource;a=new Ui.VBox({spacing:5});this.setIcon(a);this.uploadIcon=new Ui.Icon({icon:"uploadfiles",horizontalAlign:"center",verticalAlign:"center"});a.append(this.uploadIcon);this.progressBar=new Ui.ProgressBar;this.progressBar.hide();a.append(this.progressBar);this.setText("Cliquez pour cr\u00e9er un nouveau fichier ou glissez et d\u00e9posez vos fichiers ici");
this.connect(this.resource,"uploadstart",function(){this.progressBar.setValue(0);this.progressBar.show()});this.connect(this.resource,"uploadprogress",function(a,c){this.progressBar.setValue(c)});this.connect(this.resource,"uploadcomplete",function(){this.progressBar.hide()})},current:function(){},uncurrent:function(){},getFile:function(){}},{onStyleChange:function(){Storage.UploadView.base.onStyleChange.apply(this,arguments);var a=this.getStyleProperty("iconSize");this.uploadIcon.setWidth(a);this.uploadIcon.setHeight(a)},
updateColors:function(){var a=this.getForeground();Storage.UploadView.base.updateColors.apply(this,arguments);this.uploadIcon.setFill(a);this.progressBar.setStyleProperty("color",a)}});
Ui.CarouselableLoader.extend("Storage.FileDataLoader",{viewer:void 0,storage:void 0,files:void 0,isDetailsVisible:!0,constructor:function(a){this.viewer=a.viewer;delete a.viewer;this.storage=a.storage;delete a.storage;this.files=[]},setFiles:function(a){this.files=void 0===a?[]:a},setShowDetails:function(a){this.isDetailsVisible=a}},{getMin:function(){return this.viewer.canAddFile()||0===this.files.length?-1:0},getMax:function(){return this.files.length-1},getElementAt:function(a){return-1===a?this.viewer.canAddFile()?
(a=new Storage.UploadView({resource:this.viewer.getResource(),verticalAlign:"center",horizontalAlign:"center",width:300,height:300}),this.connect(a,"press",function(){(new Storage.NewDialog({viewer:this.viewer})).open()}),a):new Ui.Text({fontSize:20,text:"Il n'y a pas encore de fichier. Revenez plus tard.",textAlign:"center",verticalAlign:"center",margin:20,interLine:1.4}):new Storage.FileViewer({storage:this.storage,file:this.files[a],viewer:this.viewer,showDetails:this.isDetailsVisible})}});
Ui.CarouselableLoader.extend("Storage.LoadingDataLoader",{setShowDetails:function(a){}},{getMin:function(){return-1},getMax:function(){return-1},getElementAt:function(a){return new Ui.Text({fontSize:20,text:"Chargement en cours...",textAlign:"center",verticalAlign:"center",margin:20,interLine:1.4})}});
Wn.ResourceViewer.extend("Storage.BaseViewer",{storage:void 0,navigation:void 0,flow:void 0,updateRequest:void 0,mainVbox:void 0,toolsBox:void 0,showNavigation:!1,carousel:void 0,firstUpdate:!0,tools:void 0,current:void 0,currentPreview:void 0,files:void 0,autoplay:!1,resourceRev:0,isDetailsVisible:!0,uploadView:void 0,loader:void 0,constructor:function(a){this.mainVbox=new Ui.VBox},setStorage:function(a){this.storage=a;this.canAddFile()&&(this.setAllowedMode("copy"),this.addMimetype("files"));this.connect(this,
"dropfile",function(a,c){this.onUploadFile(a,c,0)});this.setContent(this.mainVbox);this.loader=new Storage.LoadingDataLoader;this.carousel=new Ui.Carousel3({loader:this.loader,bufferingSize:1});this.mainVbox.prepend(this.carousel,!0);this.connect(this.carousel,"change",this.onCarouselChange);this.tools=[];this.connect(this.getDrawing(),"keyup",this.onKeyUp);this.update()},canAddFile:function(){return this.getResource().canWrite()},canDeleteFile:function(){return this.getResource().canWrite()},canModifyFile:function(){return this.getResource().canWrite()},
getStorage:function(){return this.storage},play:function(){this.setAutoPlay(!0)},setAutoPlay:function(a){this.autoplay!==a&&(this.autoplay=a,void 0!==this.current&&this.autoplay&&this.current.play())},onFileDropAt:function(a,b,c,d){if(-1!=c.indexOf(":")&&(b=c.split(":"),2==b.length)){a=b[0];b=parseInt(b[1]);for(var e=void 0,f=-1,g=0;g<this.flow.getLogicalChildren().length&&void 0===e;g++){var k=this.flow.getLogicalChildren()[g];k.getStorage()+":"+k.getFile().id==c&&(e=k,f=g)}void 0!==e&&(f!=d&&f+
1!=d)&&(f<d&&d--,this.flow.moveAt(e,d),(new Core.HttpRequest({method:"PUT",url:"/cloud/storage/"+a+"/"+b,content:JSON.stringify({position:d})})).send())}},update:function(){void 0===this.updateRequest&&(this.updateRequest=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/0?depth=1"}),this.connect(this.updateRequest,"done",this.onUpdateDone),this.connect(this.updateRequest,"error",this.onUpdateError),this.updateRequest.send())},deleteCurrent:function(){if(this.getResource().canWrite()){var a=
this.carousel.getCurrent();void 0!==a&&Storage.FileViewer.hasInstance(a)&&a.deleteFile()}},addNavigation:function(){if(void 0===this.navigation){this.navigation=new Wn.NavigationBox;var a=new Ui.HBox({spacing:10});this.navigation.setContent(a);this.flow=new Wn.HDropBox({spacing:10,margin:2});if(this.canAddFile()){var b=new Wn.ListAddButton;this.connect(b,"press",function(){(new Storage.NewDialog({viewer:this})).open()});a.append(b);this.flow.addMimetype("application/x-wn2-file");this.flow.setAllowedMode("copy");
this.flow.addMimetype("files");this.connect(this.flow,"dropat",this.onFileDropAt);this.connect(this.flow,"dropfileat",this.onUploadFile)}a.append(this.flow);this.mainVbox.append(this.navigation);this.updatePreviews(this.files);this.updatePreviewCurrent()}},removeNavigation:function(){void 0!==this.navigation&&(this.mainVbox.remove(this.navigation),this.navigation=void 0)},showThumbs:function(){this.showNavigation=!0;this.addNavigation()},hideThumbs:function(){this.showNavigation=!1;this.removeNavigation()},
showDetails:function(){this.isDetailsVisible=!0;this.loader.setShowDetails(this.isDetailsVisible);for(var a=0;a<this.carousel.getLogicalChildren().length;a++)Storage.FileViewer.hasInstance(this.carousel.getLogicalChildren()[a])&&this.carousel.getLogicalChildren()[a].showDetails()},hideDetails:function(){this.isDetailsVisible=!1;this.loader.setShowDetails(this.isDetailsVisible);for(var a=0;a<this.carousel.getLogicalChildren().length;a++)Storage.FileViewer.hasInstance(this.carousel.getLogicalChildren()[a])&&
this.carousel.getLogicalChildren()[a].hideDetails()},onCarouselChange:function(a,b){void 0!==this.current&&Storage.FileViewer.hasInstance(this.current)&&(this.current.uncurrent(),this.disconnect(this.current,"end",this.onCurrentEnd));var c=this.carousel.getCurrent();void 0!==c&&Storage.FileViewer.hasInstance(c)&&(c.current(),void 0!==c.getFile()&&(this.path=c.getFile().id,Ui.App.current.notifyMainPath("resource:"+this.getResource().getId()+":"+c.getFile().id)),this.connect(c,"end",this.onCurrentEnd),
this.autoplay&&c.play());this.current=c;this.updatePreviewCurrent()},updatePreviewCurrent:function(){void 0!==this.currentPreview&&(this.currentPreview.uncurrent(),this.currentPreview=void 0);if(void 0!==this.navigation&&void 0!==this.current&&Storage.FileViewer.hasInstance(this.current)&&void 0!==this.current.getFile())for(var a=0;a<this.flow.getLogicalChildren().length;a++){var b=this.flow.getLogicalChildren()[a];if(void 0!==b.getFile()&&b.getFile().id==this.current.getFile().id){b.scrollIntoView();
this.currentPreview=b;this.currentPreview.current();break}}},updatePreviews:function(a){if(void 0!==this.navigation){for(var b=[],c=0;c<this.flow.getLogicalChildren().length;c++){var d=this.flow.getLogicalChildren()[c],e=d.getFile();if(void 0!=e){var f=void 0;if(void 0!==e&&void 0!==a)for(var g=0;void 0===f&&g<a.length;g++)a[g].id==e.id&&(f=a[g]);void 0!==f?(f.hostResourceViewerSeen=!0,d.update(f)):b.push(d)}}for(c=0;c<b.length;c++)this.flow.remove(b[c]);if(void 0!==a)for(c=0;c<a.length;c++)a[c].hostResourceViewerSeen?
delete a[c].hostResourceViewerSeen:(e=a[c],b=new Storage.FilePreview({resource:this.getResource(),storage:this.storage,file:e}),this.connect(b,"press",this.onPreviewPress),this.flow.insertAt(b,e.position))}},onUpdateDone:function(){var a=this.updateRequest.getResponseJSON();this.storageRev=a.storage_rev;this.updatePreviews(a.children);this.files=void 0!==a.children?a.children:[];this.loader=new Storage.FileDataLoader({viewer:this,storage:this.storage,files:this.files,showDetails:this.isDetailsVisible});
this.carousel.setLoader(this.loader);this.updateRequest=void 0;if(this.firstUpdate){this.firstUpdate=!1;var b=this.getPath();if(void 0!==b)for(a=0;a<this.files.length;a++){if(this.files[a].id==b){this.carousel.setCurrentAt(a,!0);break}}else this.carousel.setCurrentAt(0,!0)}else{b=!1;if(void 0!==this.current&&Storage.FileViewer.hasInstance(this.current)&&void 0!==this.current.getFile())for(a=0;a<this.files.length;a++)if(this.files[a].id===this.current.getFile().id){b=!0;this.carousel.setCurrentAt(a,
!0);break}if(!b)this.onCarouselChange(this.carousel,this.carousel.getCurrentPosition())}},onUpdateError:function(){this.updateRequest=void 0},onPreviousPress:function(){this.carousel.previous()},onNextPress:function(){this.carousel.next()},onPreviewPress:function(a){for(var b=0;b<this.files.length&&this.files[b].id!==a.getFile().id;b++);this.carousel.setCurrentAt(b)},onKeyUp:function(a){46==a.which&&this.carousel.getHasFocus()&&(a.stopPropagation(),a.preventDefault(),this.onDeletePress())},onUploadFile:function(a,
b,c){if(this.getResource().canWrite())a=new Wn.FilePostUploader({file:b,service:"/cloud/storage/"+this.storage+"/0",resource:this.getResource()}),a.setField("define",JSON.stringify({position:void 0!==c?c:0})),a.hostStorage=this.storage,this.carousel.setCurrentAt(0),Ui.App.current.addUploader(a),a.send();else{var d=new Ui.Dialog({title:"Probl\u00e8me de droit",fullScrolling:!0,preferredWidth:300,preferredHeight:300});c=new Ui.Button({text:"Fermer"});d.setContent(new Ui.Text({text:"Vous n'avez pas le droit d'\u00e9crire sur cette resource"}));
d.setActionButtons([c]);d.open();this.connect(c,"press",function(){d.close()})}},onUploadError:function(a){var b=void 0;if(void 0!==this.flow){for(var c=0;void 0===b&&c<this.flow.getLogicalChildren().length;c++)this.flow.getLogicalChildren()[c].getUploader()==a&&(b=this.flow.getLogicalChildren()[c]);void 0!=b&&this.flow.remove(b)}b=void 0;for(c=0;void 0==b&&c<this.carousel.getLogicalChildren().length;c++)Storage.FileViewer.hasInstance(this.carousel.getLogicalChildren()[c])&&this.carousel.getLogicalChildren()[c].getUploader()==
a&&(b=this.carousel.getLogicalChildren()[c]);void 0!=b&&this.carousel.remove(b)},onNewTextPress:function(){var a=new Ui.Dialog({title:"Nouveau fichier texte",fullScrolling:!0,preferredWidth:300,preferredHeight:300});a.setCancelButton(new Ui.DialogCloseButton);var b=new Ui.VBox({spacing:10});a.setContent(b);b.append(new Ui.Label({text:"Nom du fichier",horizontalAlign:"left"}));var c=new Ui.TextField({marginLeft:20});b.append(c);b=new Ui.DefaultButton({text:"Cr\u00e9er"});a.setActionButtons([b]);this.connect(b,
"press",function(){a.disable();var b=new Core.HttpRequest({method:"POST",url:"/cloud/storage/"+this.storage+"/0"});b.setRequestHeader("Content-Type","application/json");b.setContent(JSON.stringify({name:c.getValue(),mimetype:"text/plain",position:0}));this.connect(b,"done",function(){a.close()});this.connect(b,"error",function(){a.close()});b.send()});a.open()},onNewUriPress:function(){var a=new Ui.Dialog({title:"Nouveau lien vers un site",fullScrolling:!0,preferredWidth:400,preferredHeight:300});
a.setCancelButton(new Ui.DialogCloseButton);var b=new Ui.VBox({spacing:10});a.setContent(b);var c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Nom",textAlign:"right",verticalAlign:"center",width:100}));var d=new Ui.TextField({verticalAlign:"center"});c.append(d,!0);c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Adresse",textAlign:"right",verticalAlign:"center",width:100}));var e=new Ui.TextField({verticalAlign:"center"});c.append(e,!0);c=new Ui.HBox({spacing:10});
b.append(c);c.append(new Ui.Text({text:"Options",textAlign:"right",verticalAlign:"center",width:100}));var f=new Ui.CheckBox({verticalAlign:"center",text:'int\u00e9gration "iframe"'});c.append(f,!0);b=new Ui.DefaultButton({text:"Cr\u00e9er"});a.setActionButtons([b]);this.connect(b,"press",function(){a.disable();for(var b="----",c=0;16>c;c++)b+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(62*Math.random())];b+="----";c=new Core.HttpRequest({method:"POST",url:"/cloud/storage/"+
this.storage+"/0"});c.setRequestHeader("Content-Type","multipart/form-data; boundary="+b);c.setContent("--"+b+'\r\nContent-Disposition: form-data; name="define"\r\nContent-Type: application/json; charset=UTF-8\r\n\r\n'+JSON.stringify({name:d.getValue(),mimetype:"text/uri-list",position:0,meta:{iframe:f.getValue().toString()}})+"\r\n--"+b+'\r\nContent-Disposition: form-data; name="file"; filename="noname"\r\nContent-Type: text/plain; charset=UTF-8\r\n\r\n'+e.getValue()+"\r\n--"+b+"--\r\n");this.connect(c,
"done",function(){a.close()});this.connect(c,"error",function(){a.close()});c.send()});a.open()},onAutoPlayToggle:function(){this.autoplay=!0;void 0!==this.current&&this.current.play()},onAutoPlayUntoggle:function(){this.autoplay=!1},onCurrentEnd:function(a){this.disconnect(a,"end",this.onCurrentEnd);this.autoplay&&this.carousel.next()},onPropertiesPress:function(){void 0!==this.current&&this.current.showProperties()}},{onResourceChange:function(){Storage.BaseViewer.base.onResourceChange.apply(this,
arguments);void 0!==this.storage&&this.resourceRev!==this.getResource().getData().rev&&(this.resourceRev=this.getResource().getData().rev,this.update())},onDeletePress:function(){if(this.canDeleteFile()){if(0==this.carousel.getLogicalChildren().length){var a=new Ui.Dialog({title:"Suppression",preferredWidth:400,fullScrolling:!1,cancelButton:new Ui.DialogCloseButton({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous d\u00e9finitivement supprimer cette ressource ?"})}),b=new Ui.DefaultButton({text:"Supprimer"});
this.connect(b,"press",function(){a.close();this.deleteResource()});a.setActionButtons([b])}else{var a=new Ui.Dialog({title:"Suppression",preferredWidth:400,fullScrolling:!1,cancelButton:new Ui.DialogCloseButton({text:"Annuler"}),content:new Ui.Text({text:"Que voulez vous d\u00e9finitivement supprimer ? Le fichier actuel ou la ressource et l'ensemble des fichiers ?"})}),c=new Ui.DefaultButton({text:"Le fichier"});this.connect(c,"press",function(){this.deleteCurrent();a.close()});b=new Wn.AlertButton({text:"Tout"});
this.connect(b,"press",function(){a.close();var b=new Ui.Dialog({title:"Suppression",preferredWidth:400,fullScrolling:!1,cancelButton:new Ui.DialogCloseButton,content:new Ui.Text({text:"Voulez vraiment vous d\u00e9finitivement supprimer cette ressource et TOUS les fichiers ?"})}),c=new Ui.DefaultButton({text:"Supprimer"});this.connect(c,"press",function(){b.close();this.deleteResource()});b.setActionButtons([c]);b.open()});a.setActionButtons([b,c])}a.open()}else Storage.BaseViewer.base.onDeletePress.call(this)},
onPathChange:function(a,b){console.log(this+".onPathChange newPath: "+b);if(void 0!==b)for(var c=0;c<this.carousel.getLogicalChildren().length;c++)if(Storage.FileViewer.hasInstance(this.carousel.getLogicalChildren()[c])&&this.carousel.getLogicalChildren()[c].getFile().id==b){this.carousel.setCurrentAt(c);break}}});
Storage.BaseViewer.extend("Storage.Viewer",{constructor:function(a){this.setStorage(this.getResource().getStorageId())}},{},{constructor:function(){Wn.ResourceViewer.register("storage",this)}});Wn.ResourceCreator.extend("Storage.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"storage",name:this.getData().name});this.done()}});Wn.WizardItem.extend("Storage.Wizard",{nameField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);this.nameField=new Wn.TextField({title:"Nom de la ressource"});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);a=this.getData();void 0!==a.name&&this.nameField.setValue(a.name);this.onChange()},onChange:function(){""!=this.nameField.getValue()&&this.done()}},{onSave:function(){this.getData().name=this.nameField.getValue()}});
Wn.ResourceWizard.register("storage","Fichiers","files",[Storage.Wizard],Storage.Creator);Storage.BaseViewer.extend("Picasa.Viewer",{loadText:void 0,constructor:function(a){a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));this.loadText=new Ui.Text({text:"Chargement en cours... Veuillez patienter",textAlign:"center"});a.append(this.loadText);this.setContent(a)}},{canAddFile:function(){return!1},canDeleteFile:function(){return!1},onResourceChange:function(){Picasa.Viewer.base.onResourceChange.apply(this,arguments);
if(void 0===this.getStorage()){var a=this.getResource().getData();0==a.utime&&0==a.failcount?this.loadText.setText("Synchronisation Picasa en cours... Veuillez patienter"):0==a.utime&&0<a.failcount?this.setContent(new Ui.Text({text:"Echec de la synchronisation Picasa (nombre d'\u00e9chec: "+a.failcount+"). Il y a s\u00fbrement un probl\u00e8me sur cet album.",textAlign:"center",verticalAlign:"center"})):0<a.utime&&0<a.failcount&&604800<a.delta?this.setContent(new Ui.Text({text:"Echec de la synchronisation Picasa depuis une semaine. L'album a peut \u00eatre \u00e9t\u00e9 supprim\u00e9...",
textAlign:"center",verticalAlign:"center"})):this.setStorage(this.getResource().getStorageId())}},onLoad:function(){Picasa.Viewer.base.onLoad.call(this);if(this.resource.getIsReady())this.onResourceChange()}},{constructor:function(){Wn.ResourceViewer.register("picasa",this)}});Storage.Preview.extend("Picasa.Preview",{picasa:void 0,constructor:function(a){this.getGraphic().setIcon("picasa")}},{},{constructor:function(){this.register("picasa",this)}});Wn.ResourceCreator.extend("Picasa.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"picasa",name:this.getData().name,url:this.getData().url});this.done()}});Wn.WizardItem.extend("Picasa.Wizard",{nameField:void 0,urlField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);this.nameField=new Wn.TextField({title:"Nom de la ressource"});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);this.urlField=new Wn.TextField({title:"URL du flux RSS de l'album"});this.connect(this.urlField,"change",this.onChange);a.append(this.urlField);a=this.getData();void 0!=a.name&&this.nameField.setValue(a.name);void 0!=a.url&&
this.urlField.setValue(a.url);this.onChange()},onChange:function(){""!=this.urlField.getValue()&&(""!=this.nameField.getValue()&&this.urlField.getValue().match(/^http(s){0,1}:\/\/.*google.*$/))&&this.done()}},{onSave:function(){var a=this.getData();a.name=this.nameField.getValue();a.url=this.urlField.getValue()}});Wn.ResourceWizard.register("picasa","Picasa","picasa",[Picasa.Wizard],Picasa.Creator);Storage.BaseViewer.extend("Podcast.Viewer",{loadText:void 0,constructor:function(a){a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));this.loadText=new Ui.Text({text:"Chargement en cours... Veuillez patienter",textAlign:"center"});a.append(this.loadText);this.setContent(a)}},{canAddFile:function(){return!1},canDeleteFile:function(){return!1},onResourceChange:function(){Podcast.Viewer.base.onResourceChange.apply(this,arguments);
if(void 0===this.getStorage()){var a=this.getResource().getData();0==a.utime&&0==a.failcount?this.loadText.setText("Synchronisation Podcast en cours... Veuillez patienter"):0==a.utime&&0<a.failcount?this.setContent(new Ui.Text({text:"Echec de la synchronisation du Podcast (nombre d'\u00e9chec: "+a.failcount+"). Il y a s\u00fbrement un probl\u00e8me sur cet album.",textAlign:"center",verticalAlign:"center"})):0<a.utime&&0<a.failcount&&604800<a.delta?this.setContent(new Ui.Text({text:"Echec de la synchronisation du Podcast depuis une semaine. L'album a peut \u00eatre \u00e9t\u00e9 supprim\u00e9...",
textAlign:"center",verticalAlign:"center"})):this.setStorage(this.getResource().getStorageId())}},onLoad:function(){Podcast.Viewer.base.onLoad.call(this);if(this.resource.getIsReady())this.onResourceChange()}},{constructor:function(){Wn.ResourceViewer.register("podcast",this)}});Storage.Preview.extend("Podcast.Preview",{constructor:function(a){this.getGraphic().setIcon("note")}},{},{constructor:function(){this.register("podcast",this)}});Wn.ResourceCreator.extend("Podcast.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"podcast",name:this.getData().name,url:this.getData().url});this.done()}});Wn.WizardItem.extend("Podcast.Wizard",{nameField:void 0,urlField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);this.nameField=new Wn.TextField({title:"Nom de la ressource"});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);this.urlField=new Wn.TextField({title:"URL du flux RSS du Podcast"});this.connect(this.urlField,"change",this.onChange);a.append(this.urlField);a=this.getData();void 0!=a.name&&this.nameField.setValue(a.name);void 0!=a.url&&
this.urlField.setValue(a.url);this.onChange()},onChange:function(){""!=this.urlField.getValue()&&(""!=this.nameField.getValue()&&this.urlField.getValue().match(/^http(s){0,1}:\/\/.*$/))&&this.done()}},{onSave:function(){var a=this.getData();a.name=this.nameField.getValue();a.url=this.urlField.getValue()}});Wn.ResourceWizard.register("podcast","Podcast","note",[Podcast.Wizard],Podcast.Creator);Storage.BaseViewer.extend("News.Viewer",{loadText:void 0,constructor:function(a){a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));this.loadText=new Ui.Text({text:"Chargement en cours... Veuillez patienter",textAlign:"center"});a.append(this.loadText);this.setContent(a)}},{canAddFile:function(){return!1},canDeleteFile:function(){return!1},onResourceChange:function(){News.Viewer.base.onResourceChange.apply(this,arguments);if(void 0===
this.getStorage()){var a=this.getResource().getData();0==a.utime&&0==a.failcount?this.loadText.setText("Synchronisation des news en cours... Veuillez patienter"):0==a.utime&&0<a.failcount?this.setContent(new Ui.Text({text:"Echec de la synchronisation des news (nombre d'\u00e9chec: "+a.failcount+"). Il y a s\u00fbrement un probl\u00e8me sur cet album.",textAlign:"center",verticalAlign:"center"})):0<a.utime&&0<a.failcount&&604800<a.delta?this.setContent(new Ui.Text({text:"Echec de la synchronisation des news depuis une semaine. L'album a peut \u00eatre \u00e9t\u00e9 supprim\u00e9...",
textAlign:"center",verticalAlign:"center"})):this.setStorage(this.getResource().getStorageId())}},onLoad:function(){News.Viewer.base.onLoad.call(this);if(this.resource.getIsReady())this.onResourceChange()}},{constructor:function(){Wn.ResourceViewer.register("news",this)}});Wn.ResourceView.extend("News.Preview",{request:void 0,constructor:function(a){this.getGraphic().setIcon("newspaper")}},{},{constructor:function(){this.register("news",this)}});Wn.ResourceCreator.extend("News.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"news",name:this.getData().name,url:this.getData().url,fullcontent:this.getData().fullcontent,originalarticle:this.getData().originalarticle});this.done()}});Wn.WizardItem.extend("News.Wizard",{nameField:void 0,urlField:void 0,fullContentField:void 0,originalArticleField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);this.nameField=new Wn.TextField({title:"Nom de la ressource"});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);this.urlField=new Wn.TextField({title:"URL du flux RSS du journal"});this.connect(this.urlField,"change",this.onChange);a.append(this.urlField);var b=new Ui.HBox({spacing:10});
a.append(b);this.fullContentField=new Ui.CheckBox({text:"R\u00e9cup\u00e9rer le contenu complet"});b.append(this.fullContentField,!0);var c=new Ui.Pressable;this.connect(c,"press",this.onHelpPress);b.append(c);c.setContent(new Ui.Icon({icon:"help",width:24,height:24,verticalAlign:"center"}));this.originalArticleField=new Ui.CheckBox({text:"Afficher l'article d'origine"});Ui.App.current.getUser().isAdmin()&&a.append(this.originalArticleField);a=this.getData();void 0!=a.name&&this.nameField.setValue(a.name);
void 0!=a.url&&this.urlField.setValue(a.url);void 0!=a.fullcontent&&this.fullContentField.setValue(a.fullcontent);this.onChange()},onHelpPress:function(){var a=new Ui.Dialog({title:"Mise en garde",preferredWidth:300,preferredHeight:350,fullScrolling:!0});a.setContent(new Ui.Text({text:"ATTENTION, cette option va essayer de r\u00e9cup\u00e9rer le contenu complet des articles r\u00e9f\u00e9renc\u00e9s dans le flux RSS. Cela veux dire qu'il va modifier le flux RSS.\nCela peut \u00eatre inutile voir poser des probl\u00e8mes avec certains flux RSS.\nMais surtout, cela peut \u00eatre contraire au droit d'auteur. Vous engager votre responsabilit\u00e9 en le faisant. V\u00e9rifiez donc que vous avez bien le droit de le faire."}));
var b=new Ui.DefaultButton({text:"Fermer"});this.connect(b,"press",function(){a.close()});a.setActionButtons([b]);a.setCancelButton(new Ui.DialogCloseButton);a.open()},onChange:function(){""!=this.urlField.getValue()&&(""!=this.nameField.getValue()&&this.urlField.getValue().match(/^http(s){0,1}:\/\/.*$/))&&this.done()}},{onSave:function(){var a=this.getData();a.name=this.nameField.getValue();a.url=this.urlField.getValue();a.fullcontent=this.fullContentField.getValue();a.originalarticle=this.originalArticleField.getValue()}});
Wn.ResourceWizard.register("news","Journal","newspaper",[News.Wizard],News.Creator);Wn.LoginCreator.extend("Wn.Local.Creator",{item:void 0,constructor:function(a){this.item=a.item;delete a.item;a=new Core.HttpRequest({method:"POST",url:"/cloud/user/login",content:JSON.stringify({login:this.getData().login,password:this.getData().password})});this.connect(a,"done",this.onLoginBasicDone);this.connect(a,"error",this.onLoginBasicFails);a.send()},onLoginBasicDone:function(a){"localStorage"in window&&(this.data.localstore?(localStorage.setItem("login",this.data.login),localStorage.setItem("password",
this.data.password)):(localStorage.removeItem("login"),localStorage.removeItem("password")));this.done()},onLoginBasicFails:function(){this.fail();this.item.showError()}});
Wn.WizardItem.extend("Wn.Local.Wizard",{loginField:void 0,passwordField:void 0,localStoreField:void 0,errorMessage:void 0,errorTimeout:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);this.loginField=new Wn.TextField({title:"Identifiant"});this.connect(this.loginField,"change",this.onChange);a.append(this.loginField);this.passwordField=new Wn.TextField({title:"Mot de passe",passwordMode:!0});this.connect(this.passwordField,"change",this.onChange);a.append(this.passwordField);
this.localStoreField=new Ui.CheckBox({text:"Se souvenir de moi"});"localStorage"in window&&a.append(this.localStoreField);this.errorMessage=new Ui.Text({text:"Echec: Identifiant ou mot de passe incorrect",color:"red"});this.errorMessage.hide();a.append(this.errorMessage);a=this.getData();void 0!=a.login?this.loginField.setValue(a.login):"localStorage"in window&&void 0!=localStorage.getItem("login")&&this.loginField.setValue(localStorage.getItem("login"));void 0!=a.password?this.passwordField.setValue(a.password):
"localStorage"in window&&void 0!=localStorage.getItem("password")&&this.passwordField.setValue(localStorage.getItem("password"));void 0!=a.localstore?this.localStoreField.setValue(a.localstore):"localStorage"in window&&(void 0!=localStorage.getItem("password")||void 0!=localStorage.getItem("login"))&&this.localStoreField.setValue(!0);this.onChange()},showError:function(){void 0!=this.errorTimeout&&this.errorTimeout.abort();this.errorMessage.show();this.errorTimeout=new Core.DelayedTask({scope:this,
delay:4,callback:this.onShowErrorTimeout})},onShowErrorTimeout:function(){this.errorTimeout=void 0;this.errorMessage.hide()},onChange:function(){void 0!=this.errorTimeout&&(this.errorTimeout.abort(),this.errorTimeout=void 0,this.errorMessage.hide());""!=this.loginField.getValue()&&""!=this.passwordField.getValue()&&this.done()}},{onSave:function(){var a=this.getData();a.login=this.loginField.getValue();a.password=this.passwordField.getValue();a.localstore=this.localStoreField.getValue()}});
Wn.LoginWizard.register("local","HOST","localaccount",[Wn.Local.Wizard],Wn.Local.Creator,"Connecter");Wn.WizardItem.extend("Wn.Google.Wizard",{constructor:function(a){this.setContent(new Ui.Text({text:"Redirection en cours...",textAlign:"center",verticalAlign:"center"}));location="/cloud/googleoauth2/redirect?state=create"}});Wn.LoginWizard.register("googleoauth2","Google","google",[Wn.Google.Wizard]);Wn.WizardItem.extend("Wn.Facebook.Wizard",{constructor:function(a){this.setContent(new Ui.Text({text:"Redirection en cours...",textAlign:"center",verticalAlign:"center"}));location="/cloud/facebookoauth2/redirect?state=create"}});Wn.LoginWizard.register("facebookoauth2","Facebook","facebook",[Wn.Facebook.Wizard]);Wn.LoginCreator.extend("Wn.Create.Creator",{item:void 0,newuser:void 0,newresources:void 0,resources:void 0,constructor:function(a){this.item=a.item;delete a.item;a=new Core.HttpRequest({method:"POST",url:"/cloud/user",content:JSON.stringify({login:this.getData().login,password:this.getData().password,firstname:this.getData().firstname,lastname:this.getData().lastname})});this.connect(a,"done",this.onCreateUserDone);this.connect(a,"error",this.onCreateUserError);a.send()},onCreateUserError:function(a){var b=
a.getStatus(),c="Echec de la cr\u00e9ation. V\u00e9rifier vos donn\u00e9es";409==b?c="Echec: l'identifiant existe d\u00e9j\u00e0":403==b&&1==a.getResponseJSON().code&&(c="Echec: mot de passe trop faible");this.item.showError(c);this.fail()},onCreateUserDone:function(){var a=new Core.HttpRequest({method:"POST",url:"/cloud/user/login",content:JSON.stringify({login:this.getData().login,password:this.getData().password})});this.connect(a,"done",this.onLoginBasicDone);this.connect(a,"error",this.onLoginBasicFails);
a.send()},onLoginBasicDone:function(){this.done()},onLoginBasicFails:function(){this.fail()}});
Wn.WizardItem.extend("Wn.Create.Wizard",{firstnameField:void 0,lastnameField:void 0,loginField:void 0,passwordField:void 0,errorMessage:void 0,errorTimeout:void 0,constructor:function(a){a=new Ui.SFlow({spacing:10,itemAlign:"stretch",stretchMaxRatio:5});this.setContent(a);this.firstnameField=new Wn.TextField({title:"Pr\u00e9nom",width:200});this.connect(this.firstnameField,"change",this.onChange);a.append(this.firstnameField);this.lastnameField=new Wn.TextField({title:"Nom",width:200});this.connect(this.lastnameField,
"change",this.onChange);a.append(this.lastnameField);this.loginField=new Wn.TextField({title:"Identifiant",width:400});this.connect(this.loginField,"change",this.onChange);a.append(this.loginField);this.passwordField=new Wn.TextField({passwordMode:!0,width:400,title:"Mot de passe",desc:"8 caract\u00e8res minium avec chiffre et lettre"});this.connect(this.passwordField,"change",this.onChange);a.append(this.passwordField);this.errorMessage=new Ui.Label({text:"Echec de la cr\u00e9ation. V\u00e9rifier vos donn\u00e9es",
color:"red"});this.errorMessage.hide();a.append(this.errorMessage);a=this.getData();void 0!=a.login&&this.loginField.setValue(a.login);void 0!=a.password&&this.passwordField.setValue(a.password);this.onChange()},showError:function(a){void 0!=this.errorTimeout&&this.errorTimeout.abort();this.errorMessage.setText(a);this.errorMessage.show();this.errorTimeout=new Core.DelayedTask({scope:this,delay:4,callback:this.onShowErrorTimeout})},onShowErrorTimeout:function(){void 0!=this.errorTimeout&&(this.errorTimeout.abort(),
this.errorTimeout=void 0,this.errorMessage.hide());this.errorTimeout=void 0;this.errorMessage.hide()},onChange:function(){""!=this.firstnameField.getValue()&&(""!=this.lastnameField.getValue()&&""!=this.loginField.getValue()&&""!=this.passwordField.getValue())&&this.done()}},{onSave:function(){var a=this.getData();a.firstname=this.firstnameField.getValue();a.lastname=this.lastnameField.getValue();a.login=this.loginField.getValue();a.password=this.passwordField.getValue()}});
Wn.LoginWizard.register("create","Nouveau compte","plus",[Wn.Create.Wizard],Wn.Create.Creator,"Cr\u00e9er");Ui.Icon.register("person","M 22.9375 2.78125 C 10.795889 2.78125 1.09375 12.63708 1.09375 24.625 C 1.09375 30.61896 3.5665269 35.842659 7.5625 39.53125 C 11.558474 43.066149 17.097232 45.21875 22.9375 45.21875 C 26.626091 45.21875 30.905159 44.456502 34.59375 41.84375 C 37.513884 39.538381 39.822735 35.983179 40.4375 31.21875 L 44.4375 31.21875 C 45.052265 31.21875 45.663926 30.929823 46.125 30.46875 C 46.586073 30.007676 46.90625 29.364765 46.90625 28.75 C 46.90625 22.909731 45.061032 16.634312 41.21875 11.5625 C 37.376468 6.4906875 31.083138 2.78125 22.9375 2.78125 z M 23.0625 7.5625 C 29.824916 7.5625 34.457425 10.316526 37.53125 14.3125 C 40.144002 17.693708 41.507676 22.162836 41.96875 26.3125 L 38.28125 26.3125 C 37.666485 26.3125 37.054823 26.601426 36.59375 27.0625 C 36.132676 27.523573 35.84375 28.135234 35.84375 28.75 C 35.690059 33.514429 33.992869 35.999454 31.6875 37.84375 C 29.228439 39.688045 26.011326 40.4375 22.9375 40.4375 C 13.25495 40.283809 5.875 33.846477 5.875 24.625 C 6.0286913 15.249832 13.533641 7.7161913 23.0625 7.5625 z M 24 14.46875 C 22.002014 14.46875 20.46875 16.002014 20.46875 18 C 20.46875 19.997987 22.002014 21.53125 24 21.53125 C 25.997987 21.53125 27.53125 19.997987 27.53125 18 C 27.53125 16.002014 25.997987 14.46875 24 14.46875 z");
Ui.Icon.override("exit","M 23.71875,0.5 C 22.384749,0.5 21.375,1.5409995 21.375,2.875 l 0,22.09375 c 0,1.334001 1.009749,2.375 2.34375,2.375 1.334001,0 2.375,-1.189222 2.375,-2.375 l 0,-22.09375 c 0,-1.3340005 -1.040999,-2.375 -2.375,-2.375 z m -7.0625,5.5625 c -0.312656,0.00926 -0.641055,0.070528 -0.9375,0.21875 C 11.123859,8.3563619 7.7045762,12.212244 5.6294643,16.955357 1.0345736,27.330917 5.4994404,39.334582 15.875,43.78125 c 2.668003,1.185778 5.340027,1.78125 8.15625,1.78125 2.519779,0 5.034694,-0.431194 7.40625,-1.46875 5.039558,-1.92689 9.057916,-5.772942 11.28125,-10.8125 4.446668,-10.227337 -0.147663,-22.248859 -10.375,-26.84375 -1.185778,-0.5928891 -2.532111,0.00172 -3.125,1.1875 -0.592889,1.1857782 0.0017,2.532111 1.1875,3.125 7.707559,3.409112 11.252862,12.581719 7.84375,20.4375 -1.630445,3.853779 -4.739971,6.830277 -8.59375,8.3125 -4.002002,1.482223 -8.146219,1.317945 -12,-0.3125 -7.8557808,-3.409112 -11.4091124,-12.737969 -8,-20.59375 1.630445,-3.557335 4.442665,-6.369555 8,-8 1.18578,-0.444667 1.780389,-1.9392218 1.1875,-3.125 C 18.510249,6.5794163 17.594219,6.0347083 16.65625,6.0625 z");
Ui.Icon.register("chathistory","M 21.84375 0.75 C 20.46107 0.75 19.375 1.8673201 19.375 3.25 C 19.236732 4.7709479 20.46107 5.75 21.84375 5.75 L 27.8125 5.75 C 29.19518 5.75 30.28125 4.63268 30.28125 3.25 C 30.28125 1.8673201 29.19518 0.75 27.8125 0.75 L 21.84375 0.75 z M 24.75 7.40625 C 14.379901 7.40625 5.8125 15.692401 5.8125 26.0625 C 5.8125 30.072272 7.0556942 34.216658 9.40625 36.84375 L 6.09375 36.84375 C 4.9876061 36.84375 4.03125 37.956356 4.03125 39.0625 C 4.03125 40.168644 4.9876061 41.28125 6.09375 41.28125 L 16.75 41.28125 L 16.75 30.34375 C 16.75 29.237606 15.918644 28.28125 14.8125 28.28125 C 13.706356 28.28125 12.875 29.237606 12.875 30.34375 L 12.875 34.5 C 10.662712 32.149444 10.53125 29.247378 10.53125 26.34375 C 10.53125 18.462475 17.024975 12.09375 24.90625 12.09375 C 32.787525 12.09375 39.28125 18.462475 39.28125 26.34375 C 39.28125 34.225025 32.912525 40.59375 25.03125 40.59375 C 23.786838 40.59375 22.6875 41.55482 22.6875 42.9375 C 22.6875 44.32018 23.64857 45.28125 25.03125 45.28125 C 35.401349 45.28125 43.96875 36.852117 43.96875 26.34375 C 43.692214 15.973651 35.258367 7.40625 24.75 7.40625 z M 32.84375 17.5625 C 32.325245 17.5625 31.821054 17.772696 31.40625 18.1875 L 24.34375 25.375 L 19.65625 20.65625 C 18.826642 19.826642 17.579608 19.826642 16.75 20.65625 C 15.920392 21.485858 15.920392 22.732892 16.75 23.5625 L 22.8125 29.65625 C 23.227304 30.071054 23.803946 30.21875 24.21875 30.21875 C 24.633554 30.21875 25.442214 30.071054 25.71875 29.65625 L 34.3125 21.09375 C 35.142108 20.264142 35.142108 19.017108 34.3125 18.1875 C 33.897696 17.772696 33.362255 17.5625 32.84375 17.5625 z");
Ui.Icon.register("bubble","m 27.435251,33.062801 c 0.429406,0 0.858812,0.143136 1.288219,0.286271 0.572541,0.286271 1.001948,0.858813 1.145083,1.57449 0.143136,0.858813 0.286271,1.717625 0.286271,2.433302 1.145083,-1.145083 1.860761,-2.576438 2.290167,-4.437198 0.143135,-0.715677 0.572542,-1.288219 1.145083,-1.57449 l 3.005845,-1.717625 c 3.005844,-2.147032 4.580333,-4.72347 4.580333,-8.15872 0,-6.584231 -7.729313,-12.0233767 -17.319387,-12.0233767 -9.446939,0 -17.319388,5.4391457 -17.319388,12.0233767 0,6.58423 7.729314,12.023377 16.889981,12.023377 l 0.429407,0 c 1.717625,0 2.290167,-0.143136 3.005844,-0.286271 0.143135,-0.143136 0.286271,-0.143136 0.572542,-0.143136 M 26.147032,44.08423 c -0.858813,0 -1.57449,-0.429407 -2.003896,-1.145084 -0.572542,-0.858812 -0.429407,-2.003896 0.286271,-2.862708 0.429406,-0.572542 0.715677,-1.288219 0.858812,-2.003897 -0.429406,0 -0.858812,0 -1.288219,0 l -0.429406,0 C 11.690352,38.072541 1.9571431,30.486363 1.9571431,21.18256 1.9571431,11.878757 11.833488,4.4357143 24,4.4357143 c 12.166512,0 22.042857,7.5861777 22.042857,16.7468457 0,5.00974 -2.290167,9.160668 -6.727365,12.166512 0,0 -0.143136,0.143136 -0.143136,0.143136 l -2.290167,1.145083 c -1.431354,5.00974 -4.580334,7.872449 -10.01948,9.160668 -0.286271,0.286271 -0.429406,0.286271 -0.715677,0.286271");
Ui.Icon.override("phone","m 15.551684,8.0422078 c -1.344156,0.5974026 -4.33117,3.1363632 -4.928572,4.0324672 -0.597403,1.493507 -0.597403,2.987014 1.194805,6.72078 2.090909,5.077922 10.155844,14.935065 14.487013,17.772727 2.987014,2.24026 4.48052,2.837663 6.272727,2.38961 0.896104,-0.298701 3.435065,-2.688311 4.181818,-4.032467 -1.045454,-1.642857 -4.331168,-4.928571 -5.675324,-5.227273 -0.597403,0.149351 -1.941559,1.792208 -2.538962,2.538962 -0.448052,0.448051 -0.746753,0.896103 -1.045454,1.344155 -0.448052,0.448052 -1.194805,0.746754 -1.941558,0.746754 -0.597403,0 -1.194805,-0.298702 -1.642857,-0.746754 l -0.149352,-0.149351 c -0.597402,-0.448051 -1.493506,-1.344156 -2.688311,-2.53896 -0.298702,-0.298702 -0.597402,-0.746755 -1.045455,-1.045455 -0.448051,-0.448052 -1.045454,-1.045455 -1.493506,-1.493507 0,0 -0.149351,-0.14935 -0.298702,-0.448051 -0.44805,-0.597403 -1.493506,-2.240261 -1.941558,-2.837663 -1.194804,-1.493507 -1.792207,-3.285714 -2.090908,-4.181818 l -0.14935,-0.298702 c -0.298702,-0.448051 -0.298702,-0.896104 -0.298702,-1.493506 0.14935,-0.746753 0.448052,-1.344155 1.045454,-1.642857 0.448052,-0.298702 0.896104,-0.597403 1.493506,-0.896104 0.896104,-0.448052 2.837663,-1.642857 2.987014,-2.240259 0,-1.344156 -2.389611,-4.9285724 -3.733766,-6.2727282 M 31.681553,44.035714 c -3.285714,0 -5.974026,-1.792207 -8.214286,-3.435065 C 18.389345,37.165584 9.7270078,26.561689 7.3373974,20.737014 5.8438909,17.600649 4.499735,14.016234 5.9932415,10.133117 6.8893454,8.1915585 12.116618,2.9642857 15.999735,2.9642857 c 1.194805,0 2.240259,0.7467532 3.584416,2.3896104 0.746753,0.8961039 4.62987,5.5259739 4.331169,9.1103899 -0.298702,2.837662 -2.688312,4.480519 -4.779221,5.824675 0.298701,0.597403 0.597401,1.194806 0.896103,1.642857 0.448053,0.597403 1.642857,2.389611 2.090909,2.987014 l 0.149351,0.14935 c 0.298702,0.448052 0.746753,0.896104 1.194805,1.194806 0.448053,0.448051 0.896105,0.896103 1.194805,1.344155 0.298702,0.298702 0.448052,0.597403 0.746754,0.746753 1.493507,-1.792207 3.285714,-3.584415 5.675325,-3.584415 0,0 0.298701,0 0.448051,0 3.435065,0.298701 7.467533,5.077922 8.363637,6.123377 1.792207,2.090909 2.090909,3.136363 1.941559,4.181817 -0.746754,3.733767 -6.123377,8.363637 -8.363637,8.662339 -0.448052,0.2987 -1.194806,0.2987 -1.792208,0.2987");
Ui.Icon.override("home","M 41.638179,43.542993 H 29.741054 c -2.213419,0 -3.873482,-1.798402 -3.873482,-3.873482 v -5.256869 h -3.873483 v 5.256869 c 0,2.213418 -1.798402,3.873482 -3.873482,3.873482 H 6.2234827 c -2.2134185,0 -3.8734824,-1.798402 -3.8734824,-3.873482 V 20.578776 c 0,-1.660064 0.9683707,-3.596805 2.2134185,-4.565175 L 21.302396,3.70146 c 1.521725,-1.1067091 3.873482,-1.1067091 5.395207,0 L 43.436581,16.013601 C 44.819968,16.981971 45.65,18.918712 45.65,20.578776 v 19.090735 c 0,2.07508 -1.798403,3.873482 -4.011821,3.873482 z M 30.432748,38.977818 h 10.790415 v -18.53738 c 0,-0.276678 -0.276678,-0.691694 -0.415016,-0.830032 L 24.069169,7.2982652 7.330192,19.472067 C 7.1918534,19.610406 6.9151761,20.16376 6.9151761,20.302099 v 18.53738 H 17.705591 V 33.58261 c 0,-2.213418 1.798403,-3.873483 3.873482,-3.873483 h 4.980192 c 2.213418,0 3.873483,1.798404 3.873483,3.873483 v 5.395208 z");
Ui.Icon.register("thumb","m 6.3770116,3.5491067 c -1.2056381,0 -2.113617,0.907979 -2.113617,2.1136167 l 0,35.2459826 c 0,1.205638 0.9079789,2.113617 2.113617,2.113617 l 35.2459824,0 c 1.205634,0 2.113611,-0.907979 2.113611,-2.113617 l 0,-35.2459826 c 0,-1.2056377 -0.907977,-2.1136167 -2.113611,-2.1136167 l -35.2459824,0 z m 2.113616,4.2272334 30.8759324,0 0,31.0187489 -30.8759325,0 0,-31.0187489 z M 26.25643,10.632579 c -0.452115,0 -0.742623,0.290508 -0.742623,0.742621 l 0,9.339901 c 0,0.452114 0.290508,0.771183 0.742623,0.771183 l 9.3399,0 c 0.452113,0 0.771183,-0.319069 0.771183,-0.771183 l 0,-9.339901 c 0,-0.452113 -0.31907,-0.742621 -0.771183,-0.742621 l -9.3399,0 z m -14.166944,0.285624 c -0.452113,0 -0.742621,0.31907 -0.742621,0.771184 l 0,9.3399 c 0,0.452114 0.290508,0.742622 0.742621,0.742622 l 9.339901,0 c 0.452114,0 0.771184,-0.290508 0.771184,-0.742622 l 0,-9.3399 c 0,-0.452114 -0.31907,-0.771184 -0.771184,-0.771184 l -9.339901,0 z M 26.25643,24.799521 c -0.452115,0 -0.742623,0.290508 -0.742623,0.742623 l 0,9.339899 c 0,0.452114 0.290508,0.771184 0.742623,0.771184 l 9.3399,0 c 0.452113,0 0.771183,-0.31907 0.771183,-0.771184 l 0,-9.339899 c 0,-0.452115 -0.31907,-0.742623 -0.771183,-0.742623 l -9.3399,0 z m -14.166944,0.285624 c -0.452113,0 -0.742621,0.31907 -0.742621,0.771184 l 0,9.3399 c 0,0.452114 0.290508,0.742622 0.742621,0.742622 l 9.339901,0 c 0.452114,0 0.771184,-0.290508 0.771184,-0.742622 l 0,-9.3399 c 0,-0.452114 -0.31907,-0.771184 -0.771184,-0.771184 l -9.339901,0 z");
Ui.Icon.register("filetools","M 9.40625 3.5 C 8.2027653 3.5 7.3125 4.421516 7.3125 5.625 L 7.3125 33.75 C 7.6133715 33.75 7.7616288 33.7558 8.0625 33.90625 L 11.6875 30.28125 L 11.6875 7.71875 L 35.90625 7.71875 L 35.90625 38.5625 L 15.28125 38.5625 L 14.09375 39.78125 C 14.39462 40.834298 14.369186 41.878637 14.21875 42.78125 L 38 42.78125 C 39.203484 42.78125 40.09375 41.859734 40.09375 40.65625 L 40.09375 5.625 C 40.244186 4.421516 39.203484 3.5 38 3.5 L 9.40625 3.5 z M 22.6875 18.75 C 21.371189 18.862827 20.071581 19.446952 19.09375 20.5 C 17.46241 22.131341 17.097851 24.487358 17.8125 26.59375 L 8.59375 36.3125 C 6.3962488 35.408926 3.8251714 35.768579 2.09375 37.5 C 0.13808837 39.455662 -0.16060504 42.618467 1.34375 44.875 L 5.125 41.09375 C 5.5763065 40.642444 6.3299441 40.642444 6.78125 41.09375 C 7.2325568 41.545057 7.2325568 42.298693 6.78125 42.75 L 3 46.53125 C 5.2565328 48.035605 8.4193384 47.887348 10.375 45.78125 C 12.012262 44.143988 12.381635 41.768366 11.65625 39.65625 L 20.875 29.90625 C 23.074822 30.815224 25.640835 30.515413 27.375 28.78125 C 29.330661 26.825588 29.473105 23.506533 27.96875 21.25 L 24.375 25.15625 C 23.941201 25.62441 23.170057 25.607557 22.71875 25.15625 C 22.267443 24.704943 22.267443 23.951307 22.71875 23.5 L 26.46875 19.75 C 25.340483 18.997822 24.003811 18.637173 22.6875 18.75 z");
Ui.Icon.register("fullscreen","M 6.4375 3.46875 C 5.2405534 3.46875 4.34375 4.3655534 4.34375 5.5625 L 4.34375 40.5625 C 4.34375 41.759447 5.2405534 42.65625 6.4375 42.65625 L 41.4375 42.65625 C 42.634446 42.65625 43.53125 41.759447 43.53125 40.5625 L 43.53125 5.5625 C 43.53125 4.3655534 42.634446 3.46875 41.4375 3.46875 L 6.4375 3.46875 z M 8.53125 7.65625 L 39.1875 7.65625 L 39.1875 38.46875 L 8.53125 38.46875 L 8.53125 7.65625 z M 23.9375 9.75 C 22.740553 9.75 21.84375 10.646804 21.84375 11.84375 C 21.84375 13.040697 22.740553 13.9375 23.9375 13.9375 L 32.59375 13.9375 L 32.59375 23.0625 C 32.59375 24.259446 33.490554 25.15625 34.6875 25.15625 C 35.884447 25.15625 36.930868 24.259446 36.78125 23.0625 L 36.78125 12.3125 C 36.78125 12.226678 36.75901 12.145024 36.75 12.0625 C 36.756936 11.989821 36.78125 11.918939 36.78125 11.84375 C 36.78125 10.646804 35.884447 9.75 34.6875 9.75 L 23.9375 9.75 z M 13 20.96875 C 11.803053 20.96875 10.90625 21.865553 10.90625 23.0625 L 10.90625 33.84375 C 10.90625 34.185871 10.992294 34.501998 11.125 34.78125 C 11.337136 35.71921 12.133184 36.375 13.15625 36.375 L 23.9375 36.375 C 25.134447 36.375 26.03125 35.478196 26.03125 34.28125 C 26.03125 33.084303 25.134447 32.1875 23.9375 32.1875 L 15.09375 32.1875 L 15.09375 23.0625 C 15.09375 21.865553 14.196946 20.96875 13 20.96875 z");
Ui.Icon.register("newfile","M 9.46875 3.4375 C 8.2630789 3.4375 7.375 4.3568292 7.375 5.5625 L 7.375 20.78125 C 8.7313797 20.027705 10.086661 19.556959 11.59375 19.40625 L 11.59375 7.65625 L 35.84375 7.65625 L 35.84375 38.5625 L 25.46875 38.5625 C 24.564498 40.220297 23.507088 41.726288 22 42.78125 L 38.125 42.78125 C 39.330671 42.78125 40.21875 41.861921 40.21875 40.65625 L 40.21875 5.5625 C 40.21875 4.3568292 39.330671 3.4375 38.125 3.4375 L 9.46875 3.4375 z M 12.65625 21.375 C 12.354832 21.393839 12.051418 21.455895 11.75 21.53125 C 10.242911 21.832668 8.7369209 22.433956 7.53125 23.1875 C 4.5170729 25.146715 2.40625 28.618361 2.40625 32.6875 C 2.40625 38.866563 7.5396869 43.96875 13.71875 43.96875 C 15.376548 43.96875 16.86237 43.665336 18.21875 43.0625 C 20.328673 42.158248 21.981829 40.652256 23.1875 38.84375 C 24.242462 37.035243 25 35.073133 25 32.8125 C 24.849291 26.482728 19.741563 21.375 13.5625 21.375 C 13.261083 21.375 12.957668 21.356161 12.65625 21.375 z M 13.71875 25 C 14.773712 25 15.5 25.757538 15.5 26.8125 L 15.5 30.875 L 19.59375 30.875 C 20.498003 30.875 21.375 31.632538 21.375 32.6875 C 21.375 33.742461 20.648712 34.46875 19.59375 34.46875 L 15.5 34.46875 L 15.5 38.5625 L 15.5 38.71875 C 15.047873 39.623003 14.466753 40.21875 13.5625 40.21875 C 12.658247 40.21875 11.90625 39.472294 11.90625 38.71875 L 11.75 38.71875 L 11.75 34.46875 L 7.8125 34.46875 L 7.53125 34.46875 C 6.7777058 34.318041 6.15625 33.566043 6.15625 32.8125 C 6.15625 31.908247 6.7777058 31.306959 7.53125 31.15625 L 7.8125 31.15625 L 11.75 31.15625 L 11.90625 31.15625 L 11.90625 26.8125 C 11.90625 25.908246 12.663788 25 13.71875 25 z");
Ui.Icon.register("uploadfile","M 9.65625 3.53125 C 8.455474 3.53125 7.40625 4.424224 7.40625 5.625 L 7.40625 21.375 C 8.757122 20.624515 10.249029 20.044041 11.75 19.59375 L 11.75 7.59375 L 35.78125 7.59375 L 35.78125 38.5 L 26.1875 38.5 C 25.286918 40.151067 24.225873 41.486724 22.875 42.6875 L 38.03125 42.6875 C 39.232026 42.6875 40.28125 41.794526 40.28125 40.59375 L 40.28125 5.46875 C 40.28125 4.418071 39.232026 3.53125 38.03125 3.53125 L 9.65625 3.53125 z M 14.59375 21.65625 C 12.942683 21.65625 11.444623 21.962112 10.09375 22.5625 C 7.9923923 23.463082 6.357026 24.948836 5.15625 26.75 C 4.105571 28.401067 3.34375 30.498545 3.34375 32.75 C 3.493847 38.903977 8.5960233 43.875 14.75 43.875 C 15.650582 43.875 16.562015 43.712597 17.3125 43.5625 C 18.963568 43.112209 20.455475 42.519429 21.65625 41.46875 C 24.207899 39.367392 25.875 36.352328 25.875 32.75 C 25.875 29.147672 24.201746 26.007608 21.5 23.90625 C 20.749515 23.305862 19.994332 22.862694 19.09375 22.5625 C 17.742876 21.962112 16.244817 21.65625 14.59375 21.65625 z M 14.59375 25.40625 C 15.044041 25.40625 15.356056 25.543556 15.65625 25.84375 C 15.65625 25.84375 15.8125 25.84995 15.8125 26 L 16.71875 26.90625 L 17.3125 27.5 L 20.59375 30.96875 C 21.194138 31.569138 21.194138 32.462112 20.59375 33.0625 C 19.993362 33.662888 19.100388 33.662888 18.5 33.0625 L 17.15625 31.71875 L 15.96875 30.5 L 15.96875 36.8125 L 15.96875 38.625 C 15.96875 39.375485 15.369332 40.125 14.46875 40.125 C 13.718265 40.125 12.9375 39.525582 12.9375 38.625 L 12.9375 36.65625 L 12.9375 30.21875 L 10.5625 32.625 C 9.9621123 33.225388 9.037888 33.225388 8.4375 32.625 C 8.137306 32.174709 8.149612 31.106541 8.75 30.65625 L 12.5 26.90625 L 13.5625 25.84375 C 13.862694 25.543556 14.143459 25.40625 14.59375 25.40625 z");
Ui.Icon.register("savedisk","M 9.65625 3.59375 C 8.4554743 3.59375 7.40625 4.4867241 7.40625 5.6875 L 7.40625 21.4375 C 8.7571226 20.687015 10.249029 20.106541 11.75 19.65625 L 11.75 7.65625 L 35.78125 7.65625 L 35.78125 38.5625 L 26.1875 38.5625 C 25.286918 40.213567 24.225873 41.549224 22.875 42.75 L 38.03125 42.75 C 39.232026 42.75 40.28125 41.857026 40.28125 40.65625 L 40.28125 5.53125 C 40.28125 4.4805711 39.232026 3.59375 38.03125 3.59375 L 9.65625 3.59375 z M 14.46875 21.59375 C 13.568168 21.59375 12.656735 21.756153 11.90625 21.90625 C 10.255182 22.356541 8.7632756 22.949321 7.5625 24 C 5.010851 26.101358 3.34375 29.116422 3.34375 32.71875 C 3.34375 36.321078 5.017004 39.461142 7.71875 41.5625 C 8.4692349 42.162888 9.2244184 42.606056 10.125 42.90625 C 11.475874 43.506638 12.973933 43.8125 14.625 43.8125 C 16.276067 43.8125 17.774127 43.506638 19.125 42.90625 C 21.226358 42.005668 22.861724 40.519914 24.0625 38.71875 C 25.113179 37.067683 25.875 34.970205 25.875 32.71875 C 25.724903 26.564773 20.622727 21.59375 14.46875 21.59375 z M 14.75 25.34375 C 15.500485 25.34375 16.28125 25.943168 16.28125 26.84375 L 16.28125 28.8125 L 16.28125 35.25 L 18.65625 32.84375 C 19.256638 32.243362 20.180862 32.243362 20.78125 32.84375 C 21.081444 33.294041 21.069138 34.362209 20.46875 34.8125 L 16.71875 38.5625 L 15.65625 39.625 C 15.356056 39.925194 15.075291 40.0625 14.625 40.0625 C 14.174709 40.0625 13.862694 39.925194 13.5625 39.625 C 13.5625 39.625 13.40625 39.618847 13.40625 39.46875 L 12.5 38.5625 L 11.90625 37.96875 L 8.625 34.5 C 8.0246124 33.899612 8.0246124 33.006638 8.625 32.40625 C 9.225388 31.805862 10.118362 31.805862 10.71875 32.40625 L 12.0625 33.75 L 13.25 34.96875 L 13.25 28.65625 L 13.25 26.84375 C 13.25 26.093265 13.849418 25.34375 14.75 25.34375 z");
Ui.Icon.register("fileedit","M 9.40625 3.5625 C 8.208003 3.5625 7.3125 4.4580028 7.3125 5.65625 L 7.3125 26.46875 L 11.5 22.28125 L 11.5 7.90625 L 35.625 7.90625 L 35.625 38.59375 L 19.15625 38.59375 L 14.9375 42.78125 L 37.875 42.78125 C 39.073248 42.78125 39.96875 41.885747 39.96875 40.6875 L 39.96875 5.65625 C 39.96875 4.4580028 39.073248 3.5625 37.875 3.5625 L 9.40625 3.5625 z M 26.46875 18.8125 C 26.337692 18.8125 26.212281 18.837555 26.0625 18.875 L 17.96875 19.46875 C 17.669188 19.46875 17.362062 19.606688 17.0625 19.90625 L 0.59375 36.375 C -0.0053736 36.974123 -0.0053736 37.869627 0.59375 38.46875 L 7.46875 45.375 C 8.0678736 45.974123 8.9633765 45.974123 9.5625 45.375 L 26.0625 28.90625 C 26.362062 28.756469 26.5 28.455812 26.5 28.15625 L 27.84375 20.65625 L 27.84375 20.34375 C 27.84375 19.894407 27.705811 19.612062 27.40625 19.3125 C 27.181578 18.975493 26.861925 18.8125 26.46875 18.8125 z M 22 22.15625 C 22.149781 23.204717 22.895503 23.943969 24.09375 24.09375 L 24.25 24.09375 L 23.8125 27.25 L 11.53125 39.53125 L 9.5625 37.59375 L 20.5 26.65625 C 20.649781 26.506469 20.65625 26.337281 20.65625 26.1875 C 20.65625 26.037719 20.649781 25.899781 20.5 25.75 C 20.200438 25.450438 19.768312 25.450438 19.46875 25.75 L 8.53125 36.6875 L 6.59375 34.75 L 18.875 22.46875 L 22 22.15625 z");
Ui.Icon.register("chronoplay","M 6.375 3.5625 C 5.1693619 3.5625 4.25 4.4506123 4.25 5.65625 L 4.25 40.90625 C 4.25 42.111888 5.1693619 43.03125 6.375 43.03125 L 41.625 43.03125 C 42.830634 43.03125 43.75 42.111888 43.75 40.90625 L 43.75 5.65625 C 43.75 4.4506123 42.830634 3.5625 41.625 3.5625 L 6.375 3.5625 z M 8.5 7.78125 L 39.375 7.78125 L 39.375 38.78125 L 8.5 38.78125 L 8.5 7.78125 z M 14.84375 10.65625 C 14.402336 10.734408 14.354456 11.258973 14.375 11.90625 C 14.407877 12.941894 14.20387 33.513825 14.25 34.375 C 14.296131 35.236177 14.557349 35.911863 15.9375 35.21875 C 17.317653 34.525638 33.105831 24.725843 33.96875 24.03125 C 34.831675 23.336657 34.851998 22.87337 33.90625 21.96875 C 32.960503 21.064131 21.854085 14.224813 16.125 11.0625 C 15.521138 10.729182 15.108598 10.609355 14.84375 10.65625 z");
Ui.Icon.override("star","m 35.780543,45.563436 c -0.495873,0 -1.157037,-0.16529 -1.818202,-0.495873 L 24.21016,39.943536 c -0.165292,0 -1.157038,0 -1.157038,0 l -9.752181,5.124027 C 11.813321,45.894019 10.160408,45.563436 9.3339521,44.57169 8.6727875,43.910526 8.5074966,42.918778 8.6727875,41.76174 L 10.490991,30.852521 c 0,-0.330583 -0.165291,-0.991748 -0.330583,-1.157039 L 2.2264306,21.926795 C 1.2346835,20.935049 0.90410054,19.77801 1.2346835,18.620971 1.5652662,17.463934 2.5570133,16.637477 4.0446339,16.472186 L 14.953854,14.819274 c 0.330581,0 0.826454,-0.495873 0.991746,-0.661164 l 4.958736,-9.9174728 c 0.661165,-1.1570384 1.652912,-1.9834944 2.80995,-1.9834944 1.157039,0 2.314077,0.6611648 2.809952,1.9834944 l 4.958735,9.9174728 c 0.165292,0.330581 0.661165,0.661164 0.991747,0.661164 l 10.909219,1.652912 c 1.32233,0.165291 2.314077,0.991748 2.809951,2.148785 0.330582,1.157039 0,2.314078 -0.991748,3.305824 l -7.933977,7.768687 c -0.165292,0.165291 -0.495874,0.826456 -0.330583,1.157039 l 1.818203,10.909219 c 0.165291,1.157038 0,2.148786 -0.661164,2.80995 -0.661165,0.495873 -1.487621,0.991746 -2.314078,0.991746 z M 23.548996,35.150092 c 0.661164,0 1.818202,0.165291 2.644659,0.661164 l 7.438103,3.966989 -1.48762,-8.26456 c -0.330583,-1.818203 0.330582,-3.96699 1.652911,-5.124027 l 5.950484,-5.785192 -8.26456,-1.157039 C 29.66477,19.116845 27.846566,17.794515 27.02011,16.306894 L 23.383705,8.8687904 19.747298,16.306894 c -0.826457,1.652913 -2.64466,2.975243 -4.462863,3.140533 l -8.2645589,1.157039 6.1157739,5.785192 c 1.32233,1.322329 1.983495,3.471115 1.652912,5.124027 l -1.487621,8.26456 7.438104,-3.966989 c 1.157039,-0.495873 2.148786,-0.661164 2.809951,-0.661164 z");
Ui.Icon.register("tools","m 44.203582,6.3087023 c 0,0 0,0 0,0 l -4.847475,4.8474727 c -0.334308,0.334308 -0.668617,0.501463 -1.170079,0.501463 -0.501463,0 -0.835771,-0.167155 -1.17008,-0.501463 -0.668618,-0.668618 -0.668618,-1.6715419 0,-2.3401585 l 4.847473,-4.8474752 c 0,0 0,0 0.167156,0 C 38.854643,1.7955355 34.341479,1.9626906 31.499854,4.971468 28.992541,7.4787813 28.491078,11.490483 29.995467,14.49926 L 14.450118,29.877456 C 11.44134,28.373068 7.5967914,28.874531 4.9223215,31.381845 2.0806982,34.223467 1.7463895,38.569479 3.9193954,41.745411 l 5.3489374,-5.348938 c 0.6686175,-0.668616 1.6715432,-0.668616 2.3401612,0 0.668616,0.668618 0.668616,1.671544 0,2.340162 L 6.2595558,44.085571 C 9.435487,46.258577 13.781499,45.924268 16.623123,43.082646 19.130437,40.57533 19.6319,36.730782 18.127512,33.554851 L 33.672861,18.176655 c 3.008778,1.504388 6.853326,1.002926 9.527795,-1.504389 2.67447,-2.841622 3.008777,-7.1876329 1.002926,-10.3635637 z");
Ui.Icon.register("pen","m 44.223571,44.898392 c -0.506117,0.337411 -1.012233,0.674822 -1.51835,0.674822 -0.168705,0 -0.337411,0 -0.337411,0 L 30.558426,43.548748 c -0.506116,0 -0.843527,-0.337411 -1.180938,-0.674822 L 3.5655476,17.061987 c -0.8435275,-0.843527 -0.8435275,-2.361877 0,-3.205404 L 14.362699,3.0594315 c 0.843527,-0.8435275 2.361877,-0.8435275 3.205404,0 L 43.380043,28.87137 c 0.337411,0.337411 0.674822,0.843528 0.674822,1.518349 l 1.012233,12.821618 c 0,0.506116 -0.337411,1.180938 -0.843527,1.687055 m -4.386343,-8.435275 -0.337411,-4.892459 -19.232426,-19.232425 -3.036699,3.036699 17.20796,17.207959 c 0.506117,0.506116 0.506117,1.180938 0,1.518349 -0.168705,0.168706 -0.506116,0.337411 -0.843527,0.337411 -0.337411,0 -0.506117,-0.168705 -0.843528,-0.337411 l -17.20796,-17.207958 -3.036699,3.036697 19.232426,19.232426 4.89246,0.843527 c 0,-0.168705 0,-0.168705 0,-0.337411 0.168705,-1.85576 1.518349,-3.205404 3.205404,-3.205404");
Ui.Icon.register("earth","m 24.09375,1.828125 c -8.764839,0 -16.8378144,5.248848 -20.34375,13.3125 -4.9083099,11.218994 0.1872558,24.21669 11.40625,29.125 2.980045,1.227078 5.957455,1.90625 8.9375,1.90625 8.764839,0 16.650315,-5.248848 20.15625,-13.3125 4.90831,-11.043697 -0.187256,-24.1854403 -11.40625,-29.09375 -2.804748,-1.2270775 -5.769954,-1.9375 -8.75,-1.9375 z m -1.84375,5.1875 0,5.84375 -4.25,0 c 1.020756,-2.711829 2.351783,-4.7217457 3.75,-5.78125 0.165984,-0.022714 0.332801,-0.0446 0.5,-0.0625 z m 3.5,0 c 0.165144,0.017938 0.334856,0.039557 0.5,0.0625 1.378048,1.0603232 2.646566,3.072169 3.65625,5.78125 l -4.15625,0 0,-5.84375 z m 6.21875,1.84375 c 1.985371,1.0362172 3.698326,2.395344 5.09375,4 l -3.46875,0 c -0.460396,-1.455972 -0.999773,-2.810709 -1.625,-4 z m -15.9375,0.0625 c -0.613947,1.174508 -1.138512,2.511348 -1.59375,3.9375 l -3.3125,0 c 1.393142,-1.604956 3.056253,-2.9499649 4.90625,-3.9375 z m -7.28125,7.46875 4.78125,0 c -0.360838,1.821573 -0.595904,3.749185 -0.6875,5.78125 l -5.90625,0 c 0.1912096,-1.659221 0.6563211,-3.305556 1.375,-4.90625 0.1333622,-0.300065 0.2893601,-0.585428 0.4375,-0.875 z m 8.1875,0 5.3125,0 0,5.78125 -6.09375,0 c 0.110202,-2.089186 0.386808,-4.026544 0.78125,-5.78125 z m 8.8125,0 5.21875,0 c 0.399336,1.754706 0.706817,3.692064 0.84375,5.78125 l -6.0625,0 0,-5.78125 z m 8.75,0 4.96875,0 c 0.914675,1.808231 1.486309,3.769478 1.71875,5.78125 l -6.03125,0 C 35.066914,20.13742 34.853036,18.203396 34.5,16.390625 z m -27.5625,9.28125 5.875,0 c 0.0759,2.100578 0.331709,4.099257 0.6875,5.96875 l -4.875,0 C 7.7056495,29.7787 7.1367799,27.739643 6.9375,25.671875 z m 9.21875,0 6.09375,0 0,5.96875 -5.4375,0 c -0.36347,-1.81031 -0.583629,-3.823453 -0.65625,-5.96875 z m 9.59375,0 6.09375,0 c -0.07563,2.145195 -0.281476,4.158509 -0.65625,5.96875 l -5.4375,0 0,-5.96875 z m 9.40625,0 6.09375,0 c -0.166882,1.774971 -0.606312,3.537921 -1.375,5.25 -0.108616,0.244385 -0.225297,0.481302 -0.34375,0.71875 l -5.09375,0 c 0.372749,-1.868548 0.61454,-3.869406 0.71875,-5.96875 z m -24.1875,9.46875 3.375,0 c 0.461579,1.495493 1.022339,2.8739 1.65625,4.09375 -1.978681,-1.063995 -3.652234,-2.462385 -5.03125,-4.09375 z m 6.78125,0 4.5,0 0,6.03125 c -0.385729,-0.04371 -0.770875,-0.118391 -1.15625,-0.1875 -1.290016,-1.215979 -2.454312,-3.239861 -3.34375,-5.84375 z m 8,0 4.46875,0 c -0.929129,2.662245 -2.189123,4.698089 -3.5,5.90625 -0.32245,0.04967 -0.641642,0.12489 -0.96875,0.15625 l 0,-6.0625 z m 7.8125,0 3.6875,0 c -1.51839,1.803577 -3.392311,3.268497 -5.46875,4.3125 0.681181,-1.273705 1.282811,-2.727646 1.78125,-4.3125 z");
Ui.Icon.override("arrowleft","m 32.076087,45.710486 c -0.60789,0 -1.418408,-0.20263 -1.823669,-0.810519 L 14.042039,25.650141 c -0.810519,-1.013149 -0.810519,-2.228927 0,-3.242076 L 30.252418,3.1582395 c 0.81052,-1.0131487 2.431558,-1.2157784 3.444707,-0.2026297 1.013148,0.810519 1.215778,2.4315569 0.20263,3.4447057 L 19.107783,24.029103 33.899755,41.657891 c 0.810518,1.013148 0.810518,2.634186 -0.20263,3.444706 -0.40526,0.405259 -1.013149,0.607889 -1.621038,0.607889 z");
Ui.Icon.override("arrowright","m 15.923912,45.710486 c 0.60789,0 1.418408,-0.20263 1.823669,-0.810519 L 33.95796,25.650141 c 0.810519,-1.013149 0.810519,-2.228927 0,-3.242076 L 17.747581,3.1582395 C 16.937061,2.1450908 15.316023,1.9424611 14.302874,2.9556098 13.289726,3.7661288 13.087096,5.3871667 14.100244,6.4003155 L 28.892216,24.029103 14.100244,41.657891 c -0.810518,1.013148 -0.810518,2.634186 0.20263,3.444706 0.40526,0.405259 1.013149,0.607889 1.621038,0.607889 z");
Ui.Icon.override("arrowtop","m 7.28125,33.953987 c -1.2017566,0.05041 -2.3857156,-0.454908 -3.15625,-1.5 -1.2328551,-1.672147 -0.8908967,-4.017145 0.78125,-5.25 L 21.75,14.766487 c 0.06967,-0.05137 0.146891,-0.07912 0.21875,-0.125 0.114195,-0.07452 0.223262,-0.157709 0.34375,-0.21875 0.05009,-0.02483 0.105457,-0.04009 0.15625,-0.0625 0.203278,-0.09175 0.410195,-0.164834 0.625,-0.21875 0.23748,-0.05961 0.474193,-0.08145 0.71875,-0.09375 0.240401,-0.01209 0.478565,-0.0034 0.71875,0.03125 0.592639,0.08558 1.201255,0.274707 1.71875,0.65625 l 16.84375,12.4375 c 1.672147,1.232855 2.014105,3.577853 0.78125,5.25 -1.232855,1.672147 -3.577853,2.014105 -5.25,0.78125 L 24,22.422737 9.375,33.235237 c -0.627055,0.462321 -1.372696,0.688501 -2.09375,0.71875 z");
Ui.Icon.override("arrowbottom","m 7.28125,14.046013 c -1.2017566,-0.05041 -2.3857156,0.454908 -3.15625,1.5 -1.2328551,1.672147 -0.8908967,4.017145 0.78125,5.25 L 21.75,33.233513 c 0.06967,0.05137 0.146891,0.07912 0.21875,0.125 0.114195,0.07452 0.223262,0.157709 0.34375,0.21875 0.05009,0.02483 0.105457,0.04009 0.15625,0.0625 0.203278,0.09175 0.410195,0.164834 0.625,0.21875 0.23748,0.05961 0.474193,0.08145 0.71875,0.09375 0.240401,0.01209 0.478565,0.0034 0.71875,-0.03125 0.592639,-0.08558 1.201255,-0.274707 1.71875,-0.65625 l 16.84375,-12.4375 c 1.672147,-1.232855 2.014105,-3.577853 0.78125,-5.25 -1.232855,-1.672147 -3.577853,-2.014105 -5.25,-0.78125 L 24,25.577263 9.375,14.764763 C 8.747945,14.302442 8.002304,14.076262 7.28125,14.046013 z");
Ui.Icon.override("close","m 14.580508,8.4186811 c -0.781701,0.093804 -1.532133,0.4690203 -2.032421,1.0943808 L 3.3240208,22.02027 c -1.2409583,1.747482 -0.9676595,2.758029 -0.07817,3.830333 l 9.3022362,12.507208 c 0.750432,0.750433 1.500865,1.250721 2.501441,1.250721 0.500289,0 1.219453,-0.281412 1.719741,-0.7817 1.250721,-1.000577 1.469597,-2.970462 0.469021,-4.221183 l -5.550074,-7.504325 30.564491,0 c 1.751009,0 3.048632,-1.297623 3.048632,-3.048632 0,-1.75101 -1.297623,-2.970462 -3.048632,-2.970462 l -30.720831,0 5.784584,-7.817006 C 18.317037,12.014504 18.09816,9.9664482 16.84744,8.9658715 16.222079,8.4655832 15.362209,8.3248771 14.580508,8.4186811 z");
Ui.Icon.override("trash","M 21.40625 7.90625 C 20.70625 7.90625 20.1875 8.19375 20.1875 8.59375 C 20.1875 8.99375 19.7 9.40625 19 9.40625 L 9.59375 9.40625 C 8.89375 9.40625 8.40625 9.89375 8.40625 10.59375 L 8.40625 12.40625 C 8.40625 13.10625 8.89375 13.59375 9.59375 13.59375 L 37.90625 13.59375 C 38.60625 13.59375 39.09375 13.10625 39.09375 12.40625 L 39.09375 10.59375 C 39.09375 9.89375 38.60625 9.40625 37.90625 9.40625 L 28.40625 9.40625 C 27.70625 9.40625 27.1875 9.0875 27.1875 8.6875 C 27.1875 8.2875 26.7 7.90625 26 7.90625 L 21.40625 7.90625 z M 11.59375 15.5 C 11.19375 15.5 10.8 15.7 10.5 16 C 10.2 16.3 10.09375 16.69375 10.09375 17.09375 L 11 42.1875 C 11 42.9875 11.7 43.59375 12.5 43.59375 L 34.8125 43.59375 C 35.6125 43.59375 36.3125 42.9875 36.3125 42.1875 L 37.1875 17.09375 C 37.2875 16.69375 37.20625 16.3 36.90625 16 C 36.60625 15.7 36.2125 15.5 35.8125 15.5 L 11.59375 15.5 z M 13.1875 18.5 L 34.3125 18.5 L 33.5 40.59375 L 32 40.59375 L 32 25 C 32 24 31.19375 23.1875 30.09375 23.1875 C 28.99375 23.1875 28.1875 24 28.1875 25 L 28.1875 40.59375 L 25.5 40.59375 L 25.5 25 C 25.5 24 24.69375 23.1875 23.59375 23.1875 C 22.59375 23.1875 21.6875 24 21.6875 25 L 21.6875 40.59375 L 19 40.59375 L 19 25 C 19 24 18.19375 23.1875 17.09375 23.1875 C 15.99375 23.1875 15.1875 24 15.1875 25 L 15.1875 40.59375 L 14 40.59375 L 13.1875 18.5 z");
Ui.Icon.register("group","m 29.474906,24.210337 c 3.575731,-2.103371 6.099776,-5.889439 6.099776,-10.306518 0,-6.520451 -5.258428,-11.778879 -11.778878,-11.778879 -6.520451,0 -11.778878,5.258428 -11.778878,11.778879 0,4.627416 2.734382,8.623821 6.52045,10.516855 C 9.0722066,26.734383 5.0758013,34.516856 4.44479,38.933936 c -0.2103371,1.682696 0.2103371,3.575731 1.2620227,4.837753 1.0516856,1.262023 2.7343825,2.103371 4.4170793,2.103371 h 27.343824 c 1.682697,0 3.365394,-0.631011 4.627417,-1.893034 1.051686,-1.262022 1.682697,-2.944719 1.47236,-4.627416 C 43.146819,34.516856 39.571088,26.313708 29.474906,24.210337 z M 16.854679,13.903819 c 0,-3.786068 3.155057,-6.9411253 6.941125,-6.9411253 3.786068,0 6.941125,3.1550573 6.941125,6.9411253 0,3.786068 -3.155057,6.941124 -6.941125,6.941124 -3.786068,0 -6.941125,-3.155056 -6.941125,-6.941124 z m 21.454386,26.712813 c -0.210337,0.210338 -0.420674,0.420675 -0.841349,0.420675 H 10.123892 c -0.4206741,0 -0.6310112,0 -0.8413483,-0.210337 -0.2103371,-0.210338 -0.2103371,-0.420675 -0.2103371,-0.841349 0,-0.420674 2.1033704,-11.147867 15.1442714,-11.147867 12.620227,0 14.092587,9.885844 14.302924,10.93753 0.210337,0.210337 0,0.631011 -0.210337,0.841348 z");
Ui.Icon.override("calendar","M 17.8125 2.90625 C 17.5125 2.90625 17.29375 3 17.09375 3 C 16.39375 3.3 15.90625 3.9875 15.90625 4.6875 L 15.90625 8.1875 L 15.90625 12.40625 C 15.90625 13.20625 16.39375 13.89375 17.09375 14.09375 C 17.29375 14.19375 17.6125 14.1875 17.8125 14.1875 C 18.8125 14.1875 19.6875 13.4125 19.6875 12.3125 L 19.6875 8.3125 L 19.6875 4.8125 C 19.6875 3.7125 18.9125 2.90625 17.8125 2.90625 z M 30.1875 2.90625 C 29.1875 2.90625 28.3125 3.7125 28.3125 4.8125 L 28.3125 8.3125 L 28.3125 12.5 C 28.3125 13.5 29.0875 14.40625 30.1875 14.40625 C 31.1875 14.40625 32.09375 13.6 32.09375 12.5 L 32.09375 8.3125 L 32.09375 4.8125 C 32.09375 3.7125 31.2875 2.90625 30.1875 2.90625 z M 8.59375 8.3125 C 7.59375 8.3125 6.6875 9.0875 6.6875 10.1875 L 6.6875 41.1875 C 6.6875 42.1875 7.49375 43.09375 8.59375 43.09375 L 39.59375 43.09375 C 40.59375 43.09375 41.5 42.2875 41.5 41.1875 L 41.5 10.1875 C 41.5 9.1875 40.59375 8.3125 39.59375 8.3125 L 34 8.3125 L 34 12.5 C 34 14.6 32.2875 16.3125 30.1875 16.3125 C 28.0875 16.3125 26.40625 14.6 26.40625 12.5 L 26.40625 8.3125 L 23.8125 8.3125 L 21.90625 8.3125 L 21.5 8.3125 L 21.5 12.5 C 21.5 13.7 20.9 14.8 20 15.5 C 19.4 16 18.6125 16.3125 17.8125 16.3125 C 17.6125 16.3125 17.29375 16.2875 17.09375 16.1875 C 16.39375 16.0875 15.6875 15.6875 15.1875 15.1875 C 14.4875 14.4875 14 13.6 14 12.5 L 14 8.3125 L 13.3125 8.3125 L 8.59375 8.3125 z M 10.40625 18.09375 L 37.6875 18.09375 L 37.6875 39.3125 L 10.40625 39.3125 L 10.40625 18.09375 z M 14.1875 20.1875 C 13.5875 20.1875 13.1875 20.6875 13.1875 21.1875 L 13.1875 25.90625 C 13.1875 26.40625 13.5875 26.90625 14.1875 26.90625 L 21.5 26.90625 C 22.1 26.90625 22.5 26.40625 22.5 25.90625 L 22.5 21.1875 C 22.5 20.6875 22 20.1875 21.5 20.1875 L 14.1875 20.1875 z M 26.59375 20.1875 C 25.99375 20.1875 25.59375 20.6875 25.59375 21.1875 L 25.59375 25.90625 C 25.59375 26.40625 25.99375 26.90625 26.59375 26.90625 L 33.90625 26.90625 C 34.50625 26.90625 34.90625 26.40625 34.90625 25.90625 L 34.90625 21.1875 C 34.90625 20.6875 34.50625 20.1875 33.90625 20.1875 L 26.59375 20.1875 z M 14.1875 29.8125 C 13.5875 29.8125 13.1875 30.3125 13.1875 30.8125 L 13.1875 35.5 C 13.1875 36 13.5875 36.5 14.1875 36.5 L 21.5 36.5 C 22 36.5 22.5 36 22.5 35.5 L 22.5 30.8125 C 22.5 30.3125 22 29.8125 21.5 29.8125 L 14.1875 29.8125 z M 26.59375 29.8125 C 25.99375 29.8125 25.59375 30.3125 25.59375 30.8125 L 25.59375 35.5 C 25.59375 36 25.99375 36.5 26.59375 36.5 L 33.90625 36.5 C 34.40625 36.5 34.90625 36 34.90625 35.5 L 34.90625 30.8125 C 34.90625 30.3125 34.40625 29.8125 33.90625 29.8125 L 26.59375 29.8125 z");
Ui.Icon.register("camera","M 9.40625 6 C 8.30625 6 7.40625 6.9 7.40625 8 C 7.40625 9.1 8.30625 10 9.40625 10 L 14.8125 10 C 15.9125 10 16.6875 9.1 16.6875 8 C 16.6875 6.9 15.7875 6 14.6875 6 L 9.40625 6 z M 4.09375 11 C 2.99375 11 2.09375 11.9 2.09375 13 L 2.09375 38.90625 C 2.09375 40.00625 2.99375 40.90625 4.09375 40.90625 L 44 40.90625 C 45.1 40.90625 46 40.00625 46 38.90625 L 46 13 C 46 11.9 45.1 11 44 11 L 4.09375 11 z M 6.09375 15 L 42 15 L 42 36.90625 L 6.09375 36.90625 L 6.09375 15 z M 30.6875 16.3125 C 25.1875 16.3125 20.6875 20.8125 20.6875 26.3125 C 20.6875 31.8125 25.1875 36.3125 30.6875 36.3125 C 36.1875 36.3125 40.6875 31.8125 40.6875 26.3125 C 40.6875 20.8125 36.1875 16.3125 30.6875 16.3125 z M 9.40625 16.59375 C 8.70625 16.59375 8.09375 17.2 8.09375 18 L 8.09375 24.59375 C 8.09375 25.39375 8.70625 26 9.40625 26 L 14.8125 26 C 15.5125 26 16.1 25.39375 16 24.59375 L 16 18 C 16 17.2 15.3875 16.59375 14.6875 16.59375 L 9.40625 16.59375 z M 10.8125 19.5 L 13.5 19.5 L 13.5 23.3125 L 10.8125 23.3125 L 10.8125 19.5 z M 30.6875 20.40625 C 33.9875 20.40625 36.6875 23.10625 36.6875 26.40625 C 36.6875 29.70625 33.9875 32.40625 30.6875 32.40625 C 27.3875 32.40625 24.6875 29.70625 24.6875 26.40625 C 24.6875 23.10625 27.3875 20.40625 30.6875 20.40625 z");
Ui.Icon.register("files","m 40,9.3 -4.4,0 0,-4.4 c 0,-1 -0.8,-1.8 -1.8,-1.8 l -25.3,0 c -1,0 -1.8,0.8 -1.8,1.8 l 0,31.2 c 0,1 0.8,1.8 1.8,1.8 l 4.5,0 0,4.4 c 0,1 0.8,1.8 1.8,1.8 l 13.9,0 c 0.2,0 0.5,0 0.7,-0.1 0.2,-0.1 0.4,-0.2 0.6,-0.4 L 41.4,32.2 c 0.2,-0.2 0.3,-0.3 0.3,-0.5 0,-0.1 0,-0.1 0.1,-0.2 0.1,-0.1 0.1,-0.3 0.1,-0.5 l 0,-0.1 0,-19.8 C 41.8,10.1 41,9.3 40,9.3 z m -27,1.8 0,23.3 -2.6,0 0,-27.7 21.7,0 0,2.6 -17.4,0 c -0.9,0 -1.7,0.8 -1.7,1.8 z m 22.6,21.7 0,0 -5.1,5.1 0,0 -0.1,0.1 0,-0.1 c 0,-1.733333 0,-3.466667 0,-5.2 1.733333,0 3.466667,0 5.2,0 l 0.1,0 z m 2.6,-3.6 c -3.243145,0 -6.755307,0 -9.6,0 -0.5,0 -0.9,0.2 -1.3,0.5 -0.3,0.3 -0.5,0.8 -0.5,1.3 0,3.523616 0,6.209238 0,9.6 l -10.3,0 c 0,-9.528113 0,-19.488479 0,-27.7 7.958322,0 14.479147,0 21.7,0 z");
Ui.Icon.override("plus","m 24.015625,6.25 c -9.8,0 -17.8125,8.1125 -17.8125,17.8125 0,9.7 8.0125,17.6875 17.8125,17.6875 9.7,0 17.78125,-7.8875 17.78125,-17.6875 0,-9.8 -7.98125,-17.8125 -17.78125,-17.8125 z m 0,3.5 c 7.8,0 14.1875,6.5125 14.1875,14.3125 0,7.8 -6.2875,14.3125 -14.1875,14.3125 -7.9,0 -14.3125,-6.4125 -14.3125,-14.3125 0,-7.9 6.4125,-14.3125 14.3125,-14.3125 z m 0,3 c -1,0 -1.90625,0.90625 -1.90625,1.90625 l 0,7.40625 -7.40625,0 c -1.1,0 -1.90625,0.90625 -1.90625,1.90625 0,1 0.90625,1.90625 1.90625,1.90625 l 7.40625,0 0,7.375 c 0,1.1 0.90625,1.90625 1.90625,1.90625 1,0 1.875,-0.90625 1.875,-1.90625 l 0,-7.375 7.40625,0 c 1.1,0 1.90625,-0.90625 1.90625,-1.90625 0,-1 -0.90625,-1.90625 -1.90625,-1.90625 l -7.40625,0 0,-7.40625 c 0,-1.1 -0.875,-1.90625 -1.875,-1.90625 z");
Ui.Icon.override("eye","M 24.90625 11.59375 C 18.00625 11.59375 13.1 14.8125 10 17.8125 C 6.9 20.9125 5.6 23.9 5.5 24 C 5.3 24.4 5.20625 24.90625 5.40625 25.40625 C 5.40625 25.50625 6.40625 28.5875 9.40625 31.6875 C 12.30625 34.7875 17.2875 37.9 24.6875 38 L 24.8125 38 C 32.0125 38 37 34.9125 40 31.8125 C 43.1 28.7125 44.2125 25.7 44.3125 25.5 C 44.5125 25 44.5125 24.49375 44.3125 24.09375 C 44.3125 23.89375 43.1875 20.9125 40.1875 17.8125 C 37.1875 14.7125 32.30625 11.59375 24.90625 11.59375 z M 24.8125 15.5 C 31.1125 15.5 34.9125 18 37.3125 20.5 C 38.5125 21.7 39.40625 23.00625 39.90625 23.90625 C 40.10625 24.20625 40.2125 24.4875 40.3125 24.6875 C 39.1125 26.9875 34.8125 34 24.8125 34 C 18.4125 34 14.5875 31.5 12.1875 29 C 10.9875 27.8 10.1875 26.49375 9.6875 25.59375 C 9.5875 25.29375 9.5125 25.1125 9.3125 24.8125 C 10.7125 22.5125 15.4125 15.5 24.8125 15.5 z M 24.8125 17.5 C 20.8125 17.5 17.59375 20.6875 17.59375 24.6875 C 17.59375 28.6875 20.8125 31.90625 24.8125 31.90625 C 28.8125 31.90625 32 28.6875 32 24.6875 C 32.1 20.7875 28.8125 17.5 24.8125 17.5 z M 24.8125 21.40625 C 26.6125 21.40625 28.09375 22.8875 28.09375 24.6875 C 28.09375 26.5875 26.6125 28 24.8125 28 C 23.0125 28 21.5 26.4875 21.5 24.6875 C 21.5 22.8875 23.0125 21.40625 24.8125 21.40625 z");
Ui.Icon.register("play","m 15.871909,41.106922 c -0.3,0 -0.7,-0.1 -0.9,-0.2 -0.6,-0.3 -1,-1 -1,-1.7 l 0,-30.4000001 c 0,-0.7 0.4,-1.4 1,-1.7 0.6,-0.3 1.4,-0.3 2,0.1 l 24.3,15.4000001 c 0.6,0.4 0.9,1 0.9,1.7 0,0.7 -0.4,1.3 -0.9,1.6 l -24.3,14.9 c -0.4,0.2 -0.7,0.3 -1.1,0.3 z m 2,-28.7 -0.07191,23.3 18.77191,-11.4 z");Ui.Icon.register("pause","m 16.796875,6.703125 c -1.1,0 -2,0.9 -2,2 l 0,30.59375 c 0,1.1 0.9,2 2,2 1.1,0 2,-0.9 2,-2 l 0,-30.59375 c 0,-1.1 -0.9,-2 -2,-2 z m 14.40625,0 c -1.1,0 -2,0.9 -2,2 l 0,30.59375 c 0,1.1 0.9,2 2,2 1.1,0 2,-0.9 2,-2 l 0,-30.59375 c 0,-1.1 -0.9,-2 -2,-2 z");
Ui.Icon.register("note","M 36.598875,8.9280908 C 36.598875,8.4280908 36.3,8 35.9,7.7 35.5,7.4 35,7.2 34.5,7.3 l -19.5,4 c -0.8,0.2 -1.4,0.9 -1.4,1.7 l 0,7.3 0,12.9 c -0.3,-0.1 -0.7,-0.1 -1,-0.1 -2.5,0 -4.5,2 -4.5,4.5 0,2.5 2,4.5 4.5,4.5 2.5,0 4.5,-2 4.5,-4.5 0,-8.473471 0,-23.2 0,-23.2 l 16,-3.3 0,16.5 c -0.3,-0.1 -0.7,-0.1 -1,-0.1 -2.5,0 -4.5,2 -4.5,4.5 0,2.5 2,4.5 4.5,4.5 2.5,0 4.5,-2 4.5,-4.5 0,-0.1 0,-0.2 0,-0.3 0,-7.566667 0,-15.133333 0,-22.7 z");Ui.Icon.register("newspaper","M 11.1875 6.3125 C 10.1875 6.3125 9.40625 7.09375 9.40625 8.09375 L 9.40625 39.3125 C 9.40625 40.3125 10.1875 41.09375 11.1875 41.09375 L 36.5 41.09375 C 37.5 41.09375 38.3125 40.3125 38.3125 39.3125 L 38.3125 8.09375 C 38.3125 7.09375 37.5 6.3125 36.5 6.3125 L 11.1875 6.3125 z M 13 9.8125 L 34.6875 9.8125 L 34.6875 37.5 L 13 37.5 L 13 9.8125 z M 17.1875 11.8125 C 16.6875 11.8125 16.1875 12.3125 16.1875 12.8125 L 16.1875 20.09375 C 16.1875 20.69375 16.6875 21.09375 17.1875 21.09375 L 24.5 21.09375 C 25.1 21.09375 25.5 20.69375 25.5 20.09375 L 25.5 12.8125 C 25.5 12.2125 25.1 11.8125 24.5 11.8125 L 17.1875 11.8125 z M 18 24.40625 C 17 24.40625 16.1875 25.1875 16.1875 26.1875 C 16.1875 27.1875 17 28 18 28 L 29.40625 28 C 30.40625 28 31.1875 27.1875 31.1875 26.1875 C 31.1875 25.1875 30.40625 24.40625 29.40625 24.40625 L 18 24.40625 z M 18 30.40625 C 17 30.40625 16.1875 31.1875 16.1875 32.1875 C 16.1875 33.1875 17 34 18 34 L 29.40625 34 C 30.40625 34 31.1875 33.1875 31.1875 32.1875 C 31.1875 31.1875 30.40625 30.40625 29.40625 30.40625 L 18 30.40625 z");
Ui.Icon.register("file","M 10.8125 6.3125 C 9.8125 6.3125 9 7.09375 9 8.09375 L 9 39.3125 C 9 40.3125 9.8125 41.09375 10.8125 41.09375 L 24.34375 41.09375 L 24.6875 41.09375 C 24.8125 41.09375 24.948438 41.0875 25.0625 41.0625 C 25.166094 41.04125 25.277841 40.976813 25.375 40.9375 C 25.620755 40.838062 25.83875 40.715 26 40.5 L 37.40625 29.1875 C 37.50708 29.05306 37.550559 28.919487 37.625 28.78125 C 37.772043 28.50819 37.90625 28.2382 37.90625 27.90625 L 37.90625 8.09375 C 37.90625 7.09375 37.09375 6.3125 36.09375 6.3125 L 10.8125 6.3125 z M 12.59375 9.8125 L 34.3125 9.8125 L 34.3125 26.1875 L 24.6875 26.1875 C 24.1875 26.1875 23.70625 26.3875 23.40625 26.6875 C 23.10625 27.0875 22.90625 27.5 22.90625 28 L 22.90625 37.5 L 12.59375 37.5 L 12.59375 9.8125 z M 26.5 29.6875 L 31.8125 29.6875 L 26.5 35 L 26.5 29.6875 z");
Ui.Icon.override("search","M 17.1875 6.1875 C 10.9875 6.1875 6 11.20625 6 17.40625 C 6 23.60625 10.9875 28.59375 17.1875 28.59375 C 18.6875 28.59375 20.19375 28.2875 21.59375 27.6875 C 22.29375 27.3875 22.9 27.0875 23.5 26.6875 C 24.1 26.2875 24.59375 25.90625 25.09375 25.40625 C 25.59375 24.90625 26.00625 24.4125 26.40625 23.8125 C 26.80625 23.2125 27.20625 22.60625 27.40625 21.90625 C 28.00625 20.60625 28.3125 19.1 28.3125 17.5 C 28.4125 11.2 23.3875 6.1875 17.1875 6.1875 z M 17.1875 10.40625 C 21.0875 10.40625 24.1875 13.50625 24.1875 17.40625 C 24.1875 17.90625 24.1 18.40625 24 18.90625 C 23.8 19.60625 23.5875 20.2125 23.1875 20.8125 C 22.5875 21.9125 21.69375 22.80625 20.59375 23.40625 C 20.09375 23.80625 19.3875 23.9875 18.6875 24.1875 C 18.1875 24.2875 17.6875 24.40625 17.1875 24.40625 C 13.2875 24.40625 10.1875 21.30625 10.1875 17.40625 C 10.1875 13.50625 13.2875 10.40625 17.1875 10.40625 z M 27.90625 25.09375 C 27.50625 25.69375 26.99375 26.1875 26.59375 26.6875 C 26.09375 27.1875 25.6 27.6 25 28 L 37.40625 40.40625 C 37.80625 40.80625 38.30625 41 38.90625 41 C 39.50625 41 40.00625 40.80625 40.40625 40.40625 C 41.20625 39.70625 41.2125 38.3 40.3125 37.5 L 27.90625 25.09375 z");
Ui.Icon.register("mask","M 42.3,14.4 C 42.2,10.1 38.7,8.5 38,8.1 36.8,7.6 35.5,7.2 34,7.2 c -0.1,0 -0.2,0 -0.3,0 -4.2,0.1 -6.5,2.4 -8.7,2.4 -2.1,0 -4.5,-2.2 -8.7,-2.4 -0.1,0 -0.2,0 -0.3,0 -1.5,0 -2.9,0.3 -4,0.9 0.2,-0.2 -4.1,2 -4.3,6.1 0.01999,0.643458 0.030428,1.335342 0,1.9 l 0,24.2 c 0,1 0.8,1.9 1.9,1.9 1.1,0 1.9,-0.8 1.9,-1.9 l 0,-19.2 c 1.3,0.7 2.9,1.2 4.6,1.2 0.1,0 0.2,0 0.3,0 3.1,-0.1 5.3,-1.4 7,-2 l 1,-0.3 c 0.5,-0.1 0.7,-0.1 0.7,-0.1 2.1,0 4.4,2.3 8.6,2.4 0.1,0 0.2,0 0.3,0 5,0 8.4,-3.4 8.4,-7.5 -0.1,-0.2 -0.1,-0.3 -0.1,-0.4 z m -25.9,4.2 c -3.1,0 -5.2,-1.6 -5.2,-4 0,-2.4 2.1,-4 5.2,-4 3.2,0 5.9,1.8 5.9,4 0,2.2 -2.7,4 -5.9,4 z m 17.2,0.2 c -3.2,0 -5.9,-1.8 -5.9,-4 0,-2.2 2.7,-4 5.9,-4 3.1,0 5.2,1.6 5.2,4 0,2.3 -2.2,4 -5.2,4 z");
Ui.Icon.register("unfullscreen","M 9.3125 7.1875 C 8.2125 7.1875 7.40625 8.09375 7.40625 9.09375 L 7.40625 40.1875 C 7.40625 41.2875 8.3125 42.09375 9.3125 42.09375 L 40.40625 42.09375 C 41.40625 42.09375 42.3125 41.1875 42.3125 40.1875 L 42.3125 9.09375 C 42.3125 7.99375 41.40625 7.1875 40.40625 7.1875 L 9.3125 7.1875 z M 11.1875 11 L 38.5 11 L 38.5 38.3125 L 11.1875 38.3125 L 11.1875 11 z M 29.40625 18.09375 C 28.90625 18.09375 28.4 18.2875 28 18.6875 L 17.3125 29.40625 L 17.3125 24.5 C 17.3125 23.5 16.50625 22.59375 15.40625 22.59375 C 14.40625 22.59375 13.5 23.4 13.5 24.5 L 13.5 33.5 C 13.3 34.2 13.4125 34.9 13.8125 35.5 C 14.1125 36 14.70625 36.40625 15.40625 36.40625 L 25 36.40625 C 26 36.40625 26.90625 35.6 26.90625 34.5 C 26.90625 33.5 26.1 32.59375 25 32.59375 L 19.8125 32.59375 L 30.6875 21.6875 C 31.4875 20.7875 31.5125 19.4875 30.8125 18.6875 C 30.4125 18.2875 29.90625 18.09375 29.40625 18.09375 z");
Ui.Icon.register("text","M 12.8125 7.5 C 11.7125 7.5 10.8125 8.4 10.8125 9.5 C 10.8125 10.6 11.7125 11.5 12.8125 11.5 L 31.40625 11.5 C 32.50625 11.5 33.40625 10.6 33.40625 9.5 C 33.40625 8.4 32.50625 7.5 31.40625 7.5 L 12.8125 7.5 z M 12.8125 15.09375 C 11.7125 15.09375 10.8125 15.99375 10.8125 17.09375 C 10.8125 18.19375 11.7125 19.09375 12.8125 19.09375 L 38.09375 19.09375 C 39.19375 19.09375 40.09375 18.19375 40.09375 17.09375 C 40.09375 15.99375 39.19375 15.09375 38.09375 15.09375 L 12.8125 15.09375 z M 12.8125 22.8125 C 11.7125 22.8125 10.8125 23.7125 10.8125 24.8125 C 10.8125 25.9125 11.7125 26.8125 12.8125 26.8125 L 38.09375 26.8125 C 39.19375 26.8125 40.09375 25.9125 40.09375 24.8125 C 40.09375 23.7125 39.19375 22.8125 38.09375 22.8125 L 12.8125 22.8125 z M 12.8125 30.40625 C 11.7125 30.40625 10.8125 31.30625 10.8125 32.40625 C 10.8125 33.50625 11.7125 34.40625 12.8125 34.40625 L 38.09375 34.40625 C 39.19375 34.40625 40.09375 33.60625 40.09375 32.40625 C 40.09375 31.30625 39.19375 30.40625 38.09375 30.40625 L 12.8125 30.40625 z M 12.8125 38.09375 C 11.7125 38.09375 10.8125 38.99375 10.8125 40.09375 C 10.8125 41.19375 11.7125 42.09375 12.8125 42.09375 L 24.8125 42.09375 C 25.9125 42.09375 26.8125 41.19375 26.8125 40.09375 C 26.8125 38.99375 25.9125 38.09375 24.8125 38.09375 L 12.8125 38.09375 z");
Ui.Icon.register("resource","M 41.369963,3.4779113 H 6.309238 c -1.1273545,0 -2.1419735,0.9018836 -2.1419735,2.1419735 V 40.68061 c 0,1.127354 0.9018836,2.141972 2.1419735,2.141972 h 35.060725 c 1.127354,0 2.141973,-0.901882 2.141973,-2.141972 V 5.6198848 c 0,-1.1273545 -0.901883,-2.1419735 -2.141973,-2.1419735 z m -2.029238,4.283947 V 31.774509 H 8.4512115 V 7.7618583 H 39.340725 z");Ui.Icon.register("resource-comment","M 8.90625 6.5 C 7.90625 6.5 7 7.30625 7 8.40625 L 7 24.3125 C 8.2 23.7125 9.4125 23.29375 10.8125 23.09375 L 10.8125 10.1875 L 38.09375 10.1875 L 38.09375 31.5 L 26.8125 31.5 C 26.9125 31.9 26.90625 32.40625 26.90625 32.90625 C 26.90625 36.00625 25.5125 38.50625 22.8125 40.40625 C 22.7125 40.40625 22.69375 40.5 22.59375 40.5 L 21.6875 41 C 21.6875 41.1 21.6 41.30625 21.5 41.40625 L 40 41.40625 C 41 41.40625 41.90625 40.6 41.90625 39.5 L 41.90625 8.40625 C 41.90625 7.30625 41.1 6.5 40 6.5 L 8.90625 6.5 z M 13.90625 24.6875 C 12.80625 24.6875 11.8125 24.8 10.8125 25 C 9.4125 25.3 8.1 25.8 7 26.5 C 4.5 28 2.90625 30.30625 2.90625 32.90625 C 2.90625 35.50625 4.5 37.8125 7 39.3125 C 8.8 40.4125 11.09375 41 13.59375 41 L 13.90625 41 L 14.59375 41 L 15.8125 40.90625 L 15.8125 41.3125 L 15.6875 42.09375 C 15.5875 42.69375 15.4 43.3125 15 43.8125 C 14.9 43.9125 14.9 43.9875 15 44.1875 C 15.1 44.2875 15.2125 44.4125 15.3125 44.3125 C 17.3125 43.8125 18.7 42.90625 19.5 41.40625 C 19.7 41.00625 19.89375 40.5 20.09375 40 L 20.1875 39.59375 L 21.8125 38.6875 C 24.0125 37.1875 25 35.30625 25 32.90625 C 24.9 32.40625 24.7875 32 24.6875 31.5 C 23.7875 27.7 19.30625 24.6875 13.90625 24.6875 z");
Ui.Icon.register("resourcetools","M 6.21875 3.53125 C 5.08913 3.53125 4.09375 4.413668 4.09375 5.65625 L 4.09375 34.6875 C 5.32339 34.353305 6.623472 34.337876 7.84375 34.625 L 7.96875 34.65625 L 8 34.65625 L 10.40625 32.40625 L 8.375 32.40625 L 8.375 7.8125 L 39.21875 7.8125 L 39.21875 32.4375 L 20.15625 32.4375 L 19.4375 33.15625 L 12.9375 39.65625 C 13.222767 40.750783 13.335268 41.854188 13.125 42.9375 L 41.375 42.9375 C 42.504622 42.9375 43.5 42.023836 43.5 40.78125 L 43.5 5.65625 C 43.5 4.413668 42.504622 3.53125 41.375 3.53125 L 6.21875 3.53125 z M 22.71875 18.84375 C 21.405566 18.956712 20.116428 19.508572 19.15625 20.46875 C 17.46182 22.16318 17.002553 24.75997 17.90625 26.90625 L 12.625 32.21875 L 8.65625 36.15625 C 8.3173637 36.15625 7.9759239 36.050463 7.75 35.9375 C 5.8296457 35.485653 3.6872566 35.937743 2.21875 37.40625 C 0.18543308 39.439567 -0.05021809 42.490761 1.53125 44.75 L 5.375 40.90625 C 5.8268488 40.454403 6.5169013 40.454403 6.96875 40.90625 C 7.4205977 41.358099 7.4205977 42.048155 6.96875 42.5 L 3.125 46.34375 C 5.3842406 47.812259 8.5483962 47.576604 10.46875 45.65625 C 11.259484 44.865509 11.805325 43.848375 12.03125 42.71875 C 12.257174 41.589133 12.170598 40.34837 11.71875 39.21875 L 18.71875 32.21875 L 21.09375 29.84375 C 23.240029 30.747446 25.836819 30.401143 27.53125 28.59375 C 29.451605 26.786357 29.675219 23.634241 28.09375 21.375 L 24.25 25.21875 C 23.798152 25.670598 23.108099 25.670598 22.65625 25.21875 C 22.204402 24.766901 22.204402 24.076849 22.65625 23.625 L 26.5 19.78125 C 25.370379 19.046997 24.031934 18.730788 22.71875 18.84375 z");
Ui.Icon.register("stats","M 8.4375 6.8125 C 7.9375 6.8125 7.4375 7.2125 7.4375 7.8125 L 7.4375 34.6875 C 7.4375 35.1875 7.9375 35.6875 8.4375 35.6875 L 13.125 35.6875 C 13.625 35.6875 14.125 35.1875 14.125 34.6875 L 14.125 7.8125 C 14.125 7.2125 13.625 6.8125 13.125 6.8125 L 8.4375 6.8125 z M 26.0625 15.59375 C 25.5625 15.59375 25.0625 15.99375 25.0625 16.59375 L 25.0625 34.6875 C 25.0625 35.1875 25.5625 35.6875 26.0625 35.6875 L 30.75 35.6875 C 31.35 35.6875 31.75 35.1875 31.75 34.6875 L 31.75 16.59375 C 31.75 15.99375 31.35 15.59375 30.75 15.59375 L 26.0625 15.59375 z M 17.25 22.5 C 16.75 22.5 16.25 23 16.25 23.5 L 16.25 34.6875 C 16.25 35.1875 16.75 35.6875 17.25 35.6875 L 21.9375 35.6875 C 22.4375 35.6875 22.9375 35.1875 22.9375 34.6875 L 22.9375 23.5 C 22.9375 23 22.4375 22.5 21.9375 22.5 L 17.25 22.5 z M 34.875 26.90625 C 34.375 26.90625 33.875 27.40625 33.875 27.90625 L 33.875 34.6875 C 33.875 35.1875 34.375 35.6875 34.875 35.6875 L 39.5625 35.6875 C 40.0625 35.6875 40.5625 35.1875 40.5625 34.6875 L 40.5625 27.90625 C 40.5625 27.40625 40.0625 26.90625 39.5625 26.90625 L 34.875 26.90625 z M 8.5625 37.8125 C 7.4625 37.8125 6.65625 38.6875 6.65625 39.6875 C 6.65625 40.6875 7.5625 41.59375 8.5625 41.59375 L 39.4375 41.59375 C 40.5375 41.59375 41.34375 40.6875 41.34375 39.6875 C 41.34375 38.6875 40.4375 37.8125 39.4375 37.8125 L 8.5625 37.8125 z");
Ui.Icon.register("done","M 39.9375 6.34375 C 39.4375 6.39375 38.94375 6.64375 38.59375 7.09375 L 35.09375 11.40625 L 31.8125 15.40625 L 23.5 25.40625 L 18.3125 20.1875 C 17.5125 19.3875 16.20625 19.3875 15.40625 20.1875 C 14.60625 20.9875 14.60625 22.29375 15.40625 23.09375 L 22.1875 29.8125 C 22.5875 30.2125 23.09375 30.40625 23.59375 30.40625 L 23.6875 30.40625 C 24.2875 30.40625 24.7875 30.0875 25.1875 29.6875 L 33.6875 19.3125 L 37.6875 14.40625 L 41.59375 9.6875 C 42.39375 8.7875 42.30625 7.5125 41.40625 6.8125 C 40.95625 6.4625 40.4375 6.29375 39.9375 6.34375 z M 10.8125 11.5 C 9.7125 11.5 8.8125 12.4 8.8125 13.5 L 8.8125 38.40625 C 8.8125 39.50625 9.7125 40.40625 10.8125 40.40625 L 35.6875 40.40625 C 36.7875 40.40625 37.6875 39.50625 37.6875 38.40625 L 37.6875 17.59375 L 33.6875 22.5 L 33.6875 36.3125 L 12.8125 36.3125 L 12.8125 21.8125 L 12.8125 21.6875 L 12.8125 15.5 L 29.09375 15.5 L 32.40625 11.5 L 10.8125 11.5 z");
Ui.Icon.register("optionarrow","M12.5 40.3c 0.3 0 -0.7 -0.1 -0.9 -0.2 c -0.6 -0.3 -1 -1 -1 -1.7 V 8 c 0 -0.7 0.4 -1.4 1 -1.7 C 12.2 6 13 6 13.6 6.4 l 24.3 15.4 c0.6 0.4 0.9 1 0.9 1.7 s -0.4 1.3 -0.9 1.6 L 13.6 40 C 13.2 40.2 12.9 40.3 12.5 40.3 z");Ui.Icon.register("menu","M 12.53125 5.71875 C 10.897906 5.71875 9.59375 7.022906 9.59375 8.65625 C 9.59375 10.289594 10.897906 11.59375 12.53125 11.59375 L 35.46875 11.59375 C 37.102094 11.59375 38.40625 10.289594 38.40625 8.65625 C 38.40625 7.022906 37.102094 5.71875 35.46875 5.71875 L 12.53125 5.71875 z M 12.53125 15.9375 C 10.897906 15.9375 9.59375 17.241656 9.59375 18.875 C 9.59375 20.508344 10.897906 21.84375 12.53125 21.84375 L 35.46875 21.84375 C 37.102094 21.84375 38.40625 20.508344 38.40625 18.875 C 38.40625 17.241656 37.102094 15.9375 35.46875 15.9375 L 12.53125 15.9375 z M 12.53125 26.15625 C 10.897906 26.15625 9.59375 27.491656 9.59375 29.125 C 9.59375 30.758344 10.897906 32.0625 12.53125 32.0625 L 35.46875 32.0625 C 37.102094 32.0625 38.40625 30.758344 38.40625 29.125 C 38.40625 27.491656 37.102094 26.15625 35.46875 26.15625 L 12.53125 26.15625 z M 12.53125 36.40625 C 10.897906 36.40625 9.59375 37.710406 9.59375 39.34375 C 9.59375 40.977094 10.897906 42.28125 12.53125 42.28125 L 35.46875 42.28125 C 37.102094 42.28125 38.40625 40.977094 38.40625 39.34375 C 38.40625 37.710406 37.102094 36.40625 35.46875 36.40625 L 12.53125 36.40625 z");
Ui.Icon.register("uploadfiles","M 8.5 3.09375 C 7.5 3.09375 6.6875 3.90625 6.6875 4.90625 L 6.6875 22.4375 C 7.8624429 21.966183 9.1013807 21.64453 10.40625 21.5 L 10.40625 6.6875 L 32.09375 6.6875 L 32.09375 9.3125 L 14.6875 9.3125 C 13.7875 9.3125 13 10.09375 13 11.09375 L 13 21.4375 C 14.216357 21.521458 15.386146 21.755887 16.5 22.125 L 16.5 12.90625 L 38.1875 12.90625 L 38.1875 29.1875 L 28.59375 29.1875 C 28.09375 29.1875 27.7125 29.3875 27.3125 29.6875 C 27.0125 29.9875 26.8125 30.5 26.8125 31 L 26.8125 40.59375 L 25.4375 40.59375 C 24.980181 41.850724 24.365213 43.029373 23.59375 44.09375 L 28.6875 44.09375 C 28.8875 44.09375 29.20625 44.1 29.40625 44 C 29.60625 43.9 29.8 43.79375 30 43.59375 L 41.40625 32.1875 C 41.60625 31.9875 41.6875 31.8875 41.6875 31.6875 C 41.6875 31.5875 41.7125 31.6 41.8125 31.5 C 41.9125 31.4 41.90625 31.2 41.90625 31 L 41.90625 30.90625 L 41.90625 11.09375 C 41.80625 10.09375 41 9.3125 40 9.3125 L 35.59375 9.3125 L 35.59375 4.90625 C 35.59375 3.90625 34.8125 3.09375 33.8125 3.09375 L 8.5 3.09375 z M 10.90625 24.375 C 10.604832 24.39384 10.301418 24.4559 10 24.53125 C 8.492911 24.832668 6.986921 25.433956 5.78125 26.1875 C 2.767073 28.146715 0.65625 31.618361 0.65625 35.6875 C 0.65625 41.866563 5.789687 46.96875 11.96875 46.96875 C 13.626548 46.96875 15.11237 46.665336 16.46875 46.0625 C 18.578673 45.158248 20.231829 43.652256 21.4375 41.84375 C 22.492462 40.035243 23.25 38.073133 23.25 35.8125 C 23.099291 29.482728 17.991563 24.375 11.8125 24.375 C 11.511083 24.375 11.207668 24.35616 10.90625 24.375 z M 11.96875 28 C 13.023712 28 13.75 28.757538 13.75 29.8125 L 13.75 33.875 L 17.84375 33.875 C 18.748003 33.875 19.625 34.632538 19.625 35.6875 C 19.625 36.742461 18.898712 37.46875 17.84375 37.46875 L 13.75 37.46875 L 13.75 41.5625 L 13.75 41.71875 C 13.297873 42.623003 12.716753 43.21875 11.8125 43.21875 C 10.908247 43.21875 10.15625 42.472294 10.15625 41.71875 L 10 41.71875 L 10 37.46875 L 6.0625 37.46875 L 5.78125 37.46875 C 5.027705 37.318041 4.40625 36.566043 4.40625 35.8125 C 4.40625 34.908247 5.027705 34.306959 5.78125 34.15625 L 6.0625 34.15625 L 10 34.15625 L 10.15625 34.15625 L 10.15625 29.8125 C 10.15625 28.908246 10.913788 28 11.96875 28 z M 30.40625 32.6875 L 35.59375 32.6875 L 35.6875 32.6875 L 35.59375 32.8125 L 30.5 37.90625 L 30.40625 38 L 30.40625 37.90625 L 30.40625 32.6875 z");
Ui.Icon.register("savecloud2","M 18.925659,0.85824567 C 18.466137,0.87874855 18.003081,0.91002316 17.536594,0.9650968 13.362924,1.7467762 10.354728,4.6672589 8.5254823,8.3734417 4.0378644,9.813485 0.68973223,13.8927 0.68973223,18.844853 c 0,6.125009 4.99228227,11.127337 11.11251777,11.148135 0.01276,4.3e-5 0.02284,0 0.03562,0 l 4.737067,-4.365632 c -1.582261,0.0085 -3.146117,-0.377948 -4.737067,-0.371435 -3.5744989,0 -6.3754507,-2.836462 -6.3754507,-6.411068 0,-3.132226 2.201163,-5.57977 5.1288547,-6.161749 l 1.282213,-0.284936 0.498639,-1.246597 c 1.233002,-3.2144752 4.272134,-5.5206414 7.942601,-5.5206414 3.23259,0 6.045809,1.7834186 7.515196,4.4165134 l 0.96166,1.709618 c 0.998006,-0.382707 2.139449,-0.642362 3.098683,-0.747958 2.071738,0 3.76846,1.379977 4.202811,3.276768 l 0.391788,1.780852 1.816469,0.106851 c 2.418062,0.128106 4.202812,1.997185 4.202812,4.452131 0,2.539231 -1.948541,4.487748 -4.487748,4.487748 -1.033002,0 -2.035388,-0.0019 -3.063066,0 l 4.630216,4.630215 c 4.364358,-0.748996 7.728899,-4.549598 7.728899,-9.117963 0,-4.362392 -3.120225,-7.864218 -7.194643,-8.833027 -1.389825,-3.245245 -4.507316,-5.5918757 -8.227538,-5.5918757 -0.31137,0 -0.585584,0.1113395 -0.890426,0.1424682 C 28.564553,3.0571996 24.70393,0.85824567 20.314724,0.85824567 c -0.50564,-0.0269379 -0.929544,-0.0205029 -1.389065,0 z M 24.731237,20.80379 13.333783,32.201245 l 3.811024,3.84664 3.775406,-3.84664 0,15.244095 7.622048,0 0,-15.244095 3.775407,3.84664 3.811024,-3.84664 z");
Ui.Icon.register("share","M 35.15625 1.4375 C 31.014114 1.4375 27.65625 4.795364 27.65625 8.9375 C 27.65625 9.2720571 27.676295 9.5832816 27.71875 9.90625 L 14.15625 18.03125 C 12.898871 17.079306 11.354924 16.5 9.65625 16.5 C 5.5141144 16.5 2.15625 19.857864 2.15625 24 C 2.15625 28.142136 5.5141144 31.5 9.65625 31.5 C 11.354924 31.5 12.898871 30.920694 14.15625 29.96875 L 27.78125 38.15625 C 27.738909 38.478794 27.71875 38.82215 27.71875 39.15625 C 27.71875 43.298386 31.076614 46.65625 35.21875 46.65625 C 39.360886 46.65625 42.71875 43.298386 42.71875 39.15625 C 42.71875 35.014114 39.360886 31.65625 35.21875 31.65625 C 33.599996 31.65625 32.10059 32.159189 30.875 33.03125 L 17.09375 24.78125 C 17.119355 24.529122 17.15625 24.258883 17.15625 24 C 17.15625 23.741117 17.119355 23.470878 17.09375 23.21875 L 30.78125 15.03125 C 32.00986 15.910429 33.530263 16.4375 35.15625 16.4375 C 39.298386 16.4375 42.65625 13.079636 42.65625 8.9375 C 42.65625 4.795364 39.298386 1.4375 35.15625 1.4375 z");
Ui.Icon.register("radio","m 46.189099,43.018201 0,-25.871376 c 0,-0.737199 -0.629619,-1.335089 -1.404991,-1.335089 l -6.638682,0 -24.631551,-8.7174923 c 0.0352,-0.1799619 0.05453,-0.365873 0.05453,-0.5562458 0,-1.5968517 -1.294437,-2.8917839 -2.891784,-2.8917839 -1.5973475,0 -2.891784,1.2949322 -2.891784,2.8917839 0,1.5968517 1.2944365,2.8917838 2.891784,2.8917838 0.993508,0 1.870016,-0.5017118 2.390567,-1.2651864 l 20.02931,7.6466447 -29.880606,0 c -0.7758687,0 -1.4049915,0.597889 -1.4049915,1.335585 l 0,25.871872 c 0,0.737695 0.6291228,1.335584 1.4049915,1.335089 l 41.568711,0 c 0.775373,0 1.404992,-0.597889 1.404496,-1.335585 z m -5.613026,-5.766215 -21.317796,0 c -0.410987,0 -0.743644,-0.444204 -0.743644,-0.991031 0,-0.547321 0.332657,-0.990533 0.743644,-0.990533 l 21.317796,0 c 0.410492,0 0.743644,0.443212 0.743644,0.990533 0,0.547323 -0.333152,0.991031 -0.743644,0.991031 z m 0,-4.456411 -21.317796,0 c -0.410987,0 -0.743644,-0.444204 -0.743644,-0.991031 0,-0.547321 0.332657,-0.990533 0.743644,-0.990533 l 21.317796,0 c 0.410492,0 0.743644,0.443707 0.743644,0.990533 0,0.546827 -0.333152,0.991031 -0.743644,0.991031 z m 0,-4.454924 -21.317796,0 c -0.410987,0 -0.743644,-0.443708 -0.743644,-0.991526 0,-0.547322 0.332657,-0.990534 0.743644,-0.990534 l 21.317796,0 c 0.410492,-4.95e-4 0.743644,0.443708 0.743644,0.990534 0,0.547818 -0.333152,0.991526 -0.743644,0.991526z");
Ui.Icon.register("help","M 24 2.375 C 12.051981 2.375 2.375 12.051981 2.375 24 C 2.375 35.94802 12.051981 45.625 24 45.625 C 35.948019 45.625 45.625 35.94802 45.625 24 C 45.625 12.051981 35.948019 2.375 24 2.375 z M 24.46875 5.9375 C 26.596734 5.9375354 28.337399 6.2464518 29.71875 6.84375 C 31.100063 7.403784 32.184728 8.1101166 32.96875 8.96875 C 33.752727 9.8274482 34.29506 10.767198 34.59375 11.8125 C 34.929726 12.820529 35.093725 13.785445 35.09375 14.71875 C 35.093725 15.801443 34.885476 16.791525 34.4375 17.6875 C 34.02681 18.583523 33.484477 19.434772 32.8125 20.21875 C 32.177812 21.002771 31.465396 21.759437 30.71875 22.46875 C 29.972064 23.140769 29.265731 23.796768 28.59375 24.46875 C 27.959066 25.140767 27.416733 25.853183 26.96875 26.5625 C 26.558067 27.271848 26.374984 27.997264 26.375 28.78125 L 20.09375 28.78125 C 20.05641 28.594597 20.03124 28.310847 20.03125 27.9375 C 20.03124 26.444182 20.43474 25.031517 21.21875 23.6875 C 22.002739 22.306186 23.011904 21.107854 24.28125 20.0625 C 25.139902 19.353189 25.940818 18.596523 26.6875 17.8125 C 27.43415 16.991192 27.812483 16.120859 27.8125 15.1875 C 27.812483 14.067528 27.408983 13.216279 26.625 12.65625 C 25.840985 12.058946 24.882152 11.75003 23.6875 11.75 C 22.492821 11.75003 21.307489 11.939197 20.1875 12.3125 C 19.067491 12.648529 17.869159 13.146612 16.5625 13.78125 L 14.65625 8.53125 C 15.962911 7.7099503 17.495326 7.0730343 19.25 6.625 C 21.004656 6.1770352 22.751404 5.9375354 24.46875 5.9375 z M 23.6875 32.8125 C 24.28482 32.812509 24.846236 32.932259 25.40625 33.15625 C 25.966235 33.342925 26.464317 33.651842 26.875 34.0625 C 27.322983 34.435841 27.67615 34.902674 27.9375 35.5 C 28.198816 36.060006 28.312482 36.696922 28.3125 37.40625 C 28.312482 38.862253 27.845649 39.991169 26.875 40.8125 C 25.941651 41.633834 24.882152 42.0625 23.6875 42.0625 C 23.090154 42.0625 22.497488 41.94275 21.9375 41.71875 C 21.377489 41.532084 20.88549 41.223167 20.4375 40.8125 C 19.989491 40.401835 19.636324 39.935002 19.375 39.375 C 19.113658 38.815003 18.968742 38.15292 18.96875 37.40625 C 18.968742 36.696922 19.113658 36.060006 19.375 35.5 C 19.636324 34.902674 19.989491 34.435841 20.4375 34.0625 C 20.88549 33.651842 21.377489 33.342925 21.9375 33.15625 C 22.497488 32.932259 23.090154 32.812509 23.6875 32.8125 z");
Ui.Icon.register("rfidtag","M 12.5625 2.4375 C 9.037028 2.4375 6.15625 5.3182785 6.15625 8.84375 L 6.15625 38.28125 C 6.15625 41.806721 9.0370277 44.71875 12.5625 44.71875 L 35.5625 44.71875 C 39.087972 44.71875 42 41.806722 42 38.28125 L 42 8.84375 C 42 5.318278 39.087971 2.4375 35.5625 2.4375 L 12.5625 2.4375 z M 12.5625 6.125 L 35.5625 6.125 C 37.102171 6.125 38.28125 7.304079 38.28125 8.84375 L 38.28125 38.28125 C 38.28125 39.82092 37.10217 41 35.5625 41 L 12.5625 41 C 11.022828 41 9.84375 39.820921 9.84375 38.28125 L 9.84375 8.84375 C 9.84375 7.3040785 11.022828 6.125 12.5625 6.125 z M 24.21875 11.84375 C 19.573065 11.846643 14.910493 13.647585 11.375 17.1875 L 13.0625 18.84375 C 19.231188 12.667346 29.198595 12.643787 35.375 18.8125 C 35.39567 18.833137 35.416945 18.885493 35.4375 18.90625 L 37.09375 17.21875 C 37.070119 17.194883 37.055011 17.179982 37.03125 17.15625 C 33.491335 13.620756 28.864435 11.840847 24.21875 11.84375 z M 24.21875 16.59375 C 20.807024 16.595679 17.375852 17.902152 14.78125 20.5 L 16.46875 22.15625 C 20.755657 17.86398 27.67648 17.869341 31.96875 22.15625 C 31.983104 22.17057 31.985728 22.173132 32 22.1875 L 33.6875 20.53125 C 33.670147 20.513748 33.642449 20.486156 33.625 20.46875 C 31.027152 17.874147 27.630476 16.591619 24.21875 16.59375 z M 24.21875 21.5 C 22.040983 21.501446 19.872462 22.344218 18.21875 24 L 19.875 25.65625 C 22.280126 23.248113 26.154365 23.251098 28.5625 25.65625 C 28.570538 25.664254 28.554506 25.679448 28.5625 25.6875 L 30.25 24.03125 C 30.23893 24.020064 30.229883 23.97984 30.21875 23.96875 C 28.562969 22.315037 26.396517 21.49864 24.21875 21.5 z M 24.21875 25.78125 C 21.746052 25.78125 19.75 27.777303 19.75 30.25 C 19.75 32.722698 21.746052 34.71875 24.21875 34.71875 C 26.691447 34.71875 28.6875 32.722698 28.6875 30.25 C 28.6875 27.777303 26.691447 25.78125 24.21875 25.78125 z");
Ui.Icon.register("rfidreader","m 5.125,4.9375 c 0,12.414096 0,24.157202 0,35 l 3.125,3.15625 c 12.072033,0 24.512164,0 34.875,0 0,-12.126444 0,-24.621857 0,-35.03125 L 40,4.9375 l -1.5,0 c -11.125,0 -22.25,0 -33.375,0 z M 36.84375,7.84375 C 37.028224,17.742761 37.007516,28.002562 37,36.9375 27.341523,36.9811 17.621811,36.91937 8.0625,36.875 8.11322,27.008331 8.12731,16.54436 8.125,7.9375 18.624437,7.98052 26.931042,7.84375 36.84375,7.84375 z m -13.65625,3.375 c -4.645685,0.0029 -9.308257,1.803835 -12.84375,5.34375 l 1.6875,1.65625 c 6.168688,-6.176404 16.136095,-6.199963 22.3125,-0.03125 0.02067,0.02064 0.04194,0.07299 0.0625,0.09375 l 1.65625,-1.6875 C 36.03887,16.56988 36.02376,16.55498 36,16.53125 32.460085,12.995756 27.833185,11.215847 23.1875,11.21875 z m 0,4.75 c -3.411726,0.0019 -6.842898,1.308402 -9.4375,3.90625 l 1.6875,1.65625 c 4.286907,-4.29227 11.20773,-4.286909 15.5,0 0.01435,0.01432 0.01698,0.01688 0.03125,0.03125 l 1.6875,-1.65625 c -0.01735,-0.0175 -0.04505,-0.04509 -0.0625,-0.0625 -2.597848,-2.594603 -5.994524,-3.877131 -9.40625,-3.875 z m 0,4.90625 c -2.177767,0.0014 -4.346288,0.844218 -6,2.5 l 1.65625,1.65625 c 2.405126,-2.408137 6.279365,-2.405152 8.6875,0 0.008,0.008 -0.008,0.0232 0,0.03125 l 1.6875,-1.65625 c -0.01107,-0.01119 -0.02012,-0.05141 -0.03125,-0.0625 -1.655781,-1.653713 -3.822233,-2.47011 -6,-2.46875 z m 0,4.28125 c -2.472698,0 -4.46875,1.996053 -4.46875,4.46875 0,2.472698 1.996052,4.46875 4.46875,4.46875 2.472697,0 4.46875,-1.996052 4.46875,-4.46875 0,-2.472697 -1.996053,-4.46875 -4.46875,-4.46875 z");
Ui.Icon.register("screen","M 6 7.5 C 4.0869362 7.5 2.5 9.0869 2.5 11 L 2.5 32 C 2.5 33.9131 4.0869362 35.5 6 35.5 L 14.25 35.5 C 13.294006 35.941056 12.75 36.453943 12.75 37 C 12.75 38.656854 17.786797 40 24 40 C 30.213203 40 35.25 38.656854 35.25 37 C 35.25 36.453943 34.705994 35.941056 33.75 35.5 L 42 35.5 C 43.913064 35.5 45.5 33.9131 45.5 32 L 45.5 11 C 45.5 9.0869 43.913064 7.5 42 7.5 L 6 7.5 z M 6 10.5 L 42 10.5 C 42.302955 10.5 42.5 10.697 42.5 11 L 42.5 32 C 42.5 32.303 42.302955 32.5 42 32.5 L 6 32.5 C 5.6970445 32.5 5.5 32.303 5.5 32 L 5.5 11 C 5.5 10.697 5.6970445 10.5 6 10.5 z");
Ui.Icon.register("localaccount","m 22.466621,46.6976 c -2.349425,-0.3728 -4.427252,-1.3173 -5.91476,-2.6885 -0.543299,-0.5007 -0.585998,-0.5155 -1.852096,-0.636 -3.678121,-0.3505 -6.8501795,-2.3789 -8.7341395,-5.5855 -0.9508544,-1.6182 -1.5199382,-3.4804 -1.5199382,-4.9733 0,-0.3917 -0.071526,-0.7591 -0.1665583,-0.8556 -2.2685614,-2.3032 -3.47636073,-5.7811 -3.1554094,-9.086 0.2391828,-2.4628 1.1049401,-4.4844 2.7667476,-6.4608 0.4937168,-0.5871 0.5552201,-0.7314 0.5552201,-1.3034 0,-1.5582 0.7539431,-3.841 1.7899023,-5.4188 1.9543946,-2.9772 5.0847364,-4.8353 8.7042014,-5.1667 0.850471,-0.078 1.025439,-0.1412 1.535723,-0.5564 1.509799,-1.2284 2.700748,-1.8713 4.442292,-2.3983 1.000533,-0.3026 1.33664,-0.3403 3.044353,-0.3421 1.574329,0 2.101021,0.048 2.927879,0.2744 1.668727,0.4573 3.574419,1.4822 4.686742,2.5201 0.386617,0.3608 0.570534,0.43 1.34376,0.5053 2.14713,0.2085 3.881677,0.8356 5.712754,2.065 0.678473,0.4555 1.516685,1.1285 1.862694,1.4955 1.760692,1.8676 2.82967,4.2588 3.061181,6.8478 0.08079,0.9034 0.129343,1.0332 0.578741,1.5457 2.761054,3.1502 3.551671,7.7082 2.022352,11.6591 -0.402926,1.0409 -1.35575,2.6106 -2.069102,3.4086 -0.395835,0.4427 -0.45458,0.603 -0.530778,1.4481 -0.281754,3.124 -1.997768,6.3499 -4.175012,7.8482 -2.559308,1.7614 -3.765735,2.2582 -6.136118,2.5267 -1.08329,0.1227 -1.244385,0.1765 -1.663906,0.5555 -1.187576,1.0731 -3.135754,2.0938 -4.805697,2.5184 -1.178142,0.2996 -3.251242,0.4214 -4.311028,0.253 z m -7.634647,-14.1036 c 0.372164,-0.5631 0.768742,-1.1143 0.881292,-1.225 0.112548,-0.1111 1.097274,-1.5448 2.188277,-3.1867 l 1.983639,-2.9852 0.064,3.4716 0.06399,3.4717 1.269938,0.7742 c 0.698461,0.4257 1.310617,0.7294 1.360332,0.6747 0.04971,-0.055 1.335505,-1.971 2.857315,-4.2584 l 2.766925,-4.159 0,3.4026 0,3.4024 1.286872,0.7885 c 0.707777,0.4336 1.334646,0.7884 1.393029,0.7884 0.0584,0 1.797278,-2.5318 3.864197,-5.6262 2.066916,-3.0944 3.811086,-5.6284 3.87593,-5.6311 0.06486,0 0.208823,0.072 0.319946,0.1662 0.11112,0.094 0.41801,0.3003 0.681964,0.4584 l 0.479912,0.2876 -0.0012,-2.858 0,-2.8579 -1.183187,-0.7679 c -0.650736,-0.4224 -1.240758,-0.7819 -1.311148,-0.799 -0.07039,-0.018 -1.193383,1.5602 -2.495547,3.5055 l -2.367573,3.5367 -0.064,-3.499 -0.06398,-3.4991 -1.192001,-0.7423 c -0.655615,-0.4084 -1.231508,-0.7408 -1.279771,-0.7386 -0.04827,0 -1.383545,1.9357 -2.967246,4.2969 l -2.879414,4.2933 -0.03511,-3.5613 -0.03511,-3.5611 -1.177462,-0.7038 c -0.647603,-0.387 -1.219275,-0.722 -1.270379,-0.7444 -0.05111,-0.022 -1.391511,1.9067 -2.978681,4.287 l -2.885767,4.3274 0,-3.5552 c 0,-3.2834 -0.01734,-3.5622 -0.226867,-3.6471 -0.124777,-0.05 -0.734752,-0.4011 -1.355499,-0.7794 -0.946023,-0.5763 -1.155149,-0.659 -1.292515,-0.5118 -0.09014,0.097 -1.045116,1.5235 -2.122179,3.1709 l -1.9582968,2.9953 0.37424,0.3039 c 0.2058304,0.1671 0.7629668,0.5457 1.2380808,0.8413 l 0.863844,0.5378 0,4.8807 0,4.8809 1.247776,0.7693 c 0.686275,0.4232 1.283114,0.7331 1.326308,0.6888 0.04319,-0.045 0.383029,-0.5413 0.755191,-1.1045 z");
Ui.Icon.register("folder","m 4,7 0,35 40,0 0,-25 -34,0 0,21 -2,0 0,-23 32,0 0,-4 -21,0 0,-4 z");Ui.Icon.register("picasa","m 24.044065,1.2054636 c -3.683387,0 -7.140941,0.8842703 -10.215992,2.4429546 L 34.074984,18.565248 38.257618,6.1654017 C 34.371993,3.0409341 29.418138,1.2054636 24.044065,1.2054636 z M 11.97735,4.6848231 C 5.618278,8.7008337 1.391213,15.781289 1.391213,23.858316 c 0,1.291582 0.1256694,2.54288 0.3331302,3.775475 L 22.304385,12.642933 11.97735,4.6848231 z M 40.071327,7.794038 c -1.150472,3.393746 -5.433262,15.926968 -8.180196,24.133431 l 13.362221,-0.111044 c 0.934433,-2.483233 1.480579,-5.148174 1.480579,-7.958109 0,-6.279417 -2.538197,-11.958518 -6.662604,-16.064278 z M 13.050769,21.859534 2.1685168,29.743615 C 4.4704985,38.302387 11.666595,44.832301 20.564705,46.215051 L 13.050769,21.859534 z M 44.40202,33.815206 c -3.774474,0.0027 -16.828153,0.03701 -25.465952,0.03701 l 4.108606,12.621932 c 0.337346,0.0149 0.658371,0.07403 0.999391,0.07403 8.941546,0 16.667186,-5.213673 20.357955,-12.732976 z");
Ui.Icon.register("twitter","M 14.461732,39.914886 C 10.071167,38.992913 6.5495922,37.142869 3.2204514,34.009333 2.5838669,33.41015 1.7583132,32.534692 1.385888,32.06387 L 0.70875479,31.207832 1.7474522,31.921654 c 4.8015164,3.299739 10.4033288,3.205609 15.0304198,-0.252563 l 1.176779,-0.879496 -1.144837,-0.257839 c -1.440857,-0.32451 -2.050462,-0.905059 -2.050462,-1.952734 0,-0.60638 0.140455,-0.901263 0.606138,-1.272586 0.696494,-0.555366 0.614812,-0.643571 -0.783672,-0.846293 -1.163736,-0.168693 -2.84796,-1.223604 -3.366458,-2.108575 -0.317047,-0.541138 -0.312391,-0.614582 0.06544,-1.032083 0.223729,-0.247217 0.831039,-0.556314 1.349579,-0.686886 l 0.942799,-0.2374 -1.232884,-0.50108 C 10.833066,21.281534 9.5743131,20.094399 9.091495,18.830153 8.6873491,17.771915 8.8391158,17.511822 9.881572,17.476128 c 0.296768,-0.01013 0.719523,-0.08926 0.939457,-0.175781 0.343847,-0.135264 0.27557,-0.239568 -0.487282,-0.7444 -1.4153354,-0.936624 -2.2533124,-2.27021 -2.7031275,-4.301856 -0.1893921,-0.855408 0.267032,-0.789993 3.5013655,0.501822 5.47833,2.188082 9.395285,4.253136 11.256225,5.934382 l 0.876351,0.791733 0.455458,-1.050976 c 2.032166,-4.68924 3.379403,-6.939615 5.266251,-8.796557 0.632971,-0.6229412 1.209731,-1.1607725 1.889862,-1.4049485 -0.159253,0.2899797 -0.269642,0.4266676 -0.324194,0.5750155 -0.116522,0.3168623 0.07048,0.2955969 1.084398,-0.215832 0.566606,-0.285803 1.728237,-0.5859722 2.661004,-0.6008624 -0.688242,0.3888564 -0.953288,0.5309353 -1.208661,0.7768018 -0.25537,0.2458655 -0.403488,0.5209182 -0.403488,0.5209182 l 1.013725,-0.3454114 c 1.094809,-0.3730375 2.082375,-0.263868 2.082375,0.2301974 0,0.4061483 -0.788209,0.9443134 -1.726648,1.1789034 -0.415475,0.103856 -1.046779,0.260082 -1.4029,0.347159 -0.568836,0.13909 -0.459401,0.191322 0.900833,0.429955 0.85158,0.149398 2.094332,0.521601 2.761668,0.827117 2.278759,1.043251 4.508082,3.821054 5.307768,6.61364 0.152968,0.534182 0.370135,1.092644 0.482593,1.241028 0.28615,0.37756 2.854336,0.345723 4.164145,-0.05163 0.582724,-0.176773 1.086275,-0.322459 1.118999,-0.323745 0.03273,-0.0013 -0.08232,0.271925 -0.255666,0.607132 -0.398861,0.771309 -1.770753,1.686276 -3.035634,2.024581 -0.537298,0.143706 -0.976905,0.326123 -0.976905,0.405369 0,0.239342 1.254235,0.413878 2.97415,0.413878 l 1.625204,0 -0.411155,0.454628 c -0.64857,0.717146 -1.998131,1.307828 -3.607689,1.579032 l -1.483007,0.249877 -0.378928,1.0705 c -2.462943,6.957975 -9.391366,12.328731 -17.794875,13.79418 -2.68789,0.468729 -7.045334,0.415475 -9.581512,-0.117095 z");
Ui.Icon.register("facebook","M 7.15625 2.15625 C 4.94025 2.15625 3.15625 3.94025 3.15625 6.15625 L 3.15625 42.15625 C 3.15625 44.37225 4.94025 46.15625 7.15625 46.15625 L 42.15625 46.15625 C 44.37225 46.15625 46.15625 44.37225 46.15625 42.15625 L 46.15625 6.15625 C 46.15625 3.94025 44.37225 2.15625 42.15625 2.15625 L 7.15625 2.15625 z M 37.03125 9.1875 C 37.68801 9.1927408 38.391498 9.1964286 39.15625 9.21875 L 39.15625 13.6875 C 37.567149 13.6875 35.637808 13.576474 34.90625 14.59375 C 34.174693 15.611021 34.15625 16.46148 34.15625 21.15625 L 39.15625 21.15625 L 39.15625 26.15625 L 34.15625 26.15625 L 34.15625 43.15625 L 28.15625 43.15625 L 28.15625 26.15625 L 23.15625 26.15625 L 23.15625 21.15625 L 28.15625 21.15625 C 28.15625 14.805452 28.130229 13.408331 29.3125 11.375 C 30.346992 9.5958355 32.433931 9.1508144 37.03125 9.1875 z");
Ui.Icon.register("google","M 7.03125 2 C 4.81525 2 3.03125 3.784 3.03125 6 L 3.03125 12.25 C 3.1302477 11.866836 3.238964 11.490393 3.40625 11.125 C 3.912429 10.019382 4.587611 9.094808 5.34375 8.25 C 6.099889 7.405191 7.044629 6.642653 7.9375 6 C 8.830372 5.357348 9.325384 5.078791 10.65625 4.6875 C 11.6544 4.394032 13.184548 4.16305 14.65625 4.15625 C 15.146817 4.154 15.631404 4.20302 16.09375 4.25 C 17.94313 4.437959 19.823803 5.200897 21.125 5.9375 C 22.426196 6.674105 23.360273 7.363239 24.125 8.375 C 24.889727 9.38676 25.411077 10.762961 25.71875 11.96875 C 26.026426 13.17454 25.974063 14.30012 25.8125 15.53125 C 25.650937 16.762381 24.857498 18.352498 24.15625 19.46875 C 23.455001 20.585001 22.13826 21.559565 21.28125 22.40625 C 20.424239 23.252936 20.314504 23.389945 19.90625 24.09375 C 19.498062 24.797557 19.41406 25.233687 19.5 25.75 C 19.585938 26.266313 19.891888 26.531749 20.34375 27.03125 C 20.795611 27.530752 21.107652 27.715 21.9375 28.46875 C 22.767347 29.222501 24.495602 30.176141 25.53125 31.34375 C 26.566897 32.511358 27.371051 33.75443 27.84375 35.28125 C 28.316442 36.808068 28.29653 38.631069 27.90625 40.0625 C 27.515971 41.49393 26.699792 43.22593 25.9375 44.0625 C 25.280282 44.78376 24.578382 45.425825 23.8125 46 L 42.03125 46 C 44.24725 46 46.03125 44.216 46.03125 42 L 46.03125 6 C 46.03125 3.784 44.24725 2 42.03125 2 L 7.03125 2 z M 12.46875 6.1875 C 12.101083 6.206124 11.717862 6.280756 11.28125 6.4375 C 10.408027 6.750991 9.724957 7.132817 9.0625 7.9375 C 8.400044 8.742184 7.928805 9.809566 7.6875 11 C 7.446197 12.190436 7.590794 13.622757 7.875 14.90625 C 8.159205 16.189743 8.613326 17.286769 9.3125 18.4375 C 10.011674 19.588229 11.119377 20.968676 12.0625 21.6875 C 13.005624 22.406325 13.734674 22.715243 14.65625 22.875 C 15.577826 23.034757 16.58934 22.955681 17.4375 22.625 C 18.28566 22.294319 18.981405 21.915834 19.53125 21.34375 C 20.081095 20.771666 20.405645 20.275214 20.75 19.1875 C 21.094356 18.099787 20.95477 15.934293 20.75 14.53125 C 20.545232 13.128206 20.245037 12.116328 19.6875 10.96875 C 19.129962 9.821173 18.340739 8.515394 17.59375 7.78125 C 16.846761 7.047108 16.282709 6.756004 15.65625 6.5625 C 15.02979 6.368997 14.023783 6.17364 13.46875 6.1875 C 13.191234 6.1945 12.836418 6.16888 12.46875 6.1875 z M 3.03125 17.65625 L 3.03125 35.0625 C 3.5490608 34.410928 4.1847785 33.90628 4.8125 33.46875 C 5.703009 32.848054 6.895613 32.151116 8.09375 31.71875 C 9.291886 31.286385 9.990597 30.955339 11.375 30.65625 C 12.759402 30.357152 16.09375 30.34375 16.09375 30.34375 C 16.09375 30.34375 15.695985 30.051675 15.375 29.71875 C 15.054016 29.385827 14.474793 28.954401 14.21875 28.3125 C 13.962705 27.6706 14.02848 26.625972 14.0625 26 C 14.096515 25.374027 14.28125 24.59375 14.28125 24.59375 C 14.28125 24.59375 12.264623 24.766414 10.84375 24.5 C 9.422876 24.233586 8.515258 23.885412 7.5 23.34375 C 6.484743 22.802088 5.628774 21.920741 4.8125 21.0625 C 3.996227 20.204259 3.621516 19.682342 3.1875 18.25 C 3.1209161 18.030258 3.0810785 17.854931 3.03125 17.65625 z M 14.65625 32.34375 C 13.604496 32.387205 12.182232 32.405853 10.875 32.84375 C 9.567768 33.281652 8.016124 34.118997 7 35.0625 C 5.983877 36.006002 5.131522 37.029519 4.875 38.25 C 4.618478 39.47048 4.799362 40.853463 5.3125 41.9375 C 5.825634 43.021536 6.646935 43.89795 7.59375 44.59375 C 8.540566 45.28955 9.282534 45.642071 10.78125 45.96875 C 10.845188 45.982687 10.932438 45.987169 11 46 L 18.15625 46 C 19.273668 45.842863 20.347335 45.592306 21.0625 45.28125 C 22.13198 44.816088 22.595862 44.476174 23.21875 43.6875 C 23.841639 42.898826 24.240608 41.703023 24.375 40.75 C 24.509392 39.796977 24.396703 38.696229 24.21875 38.03125 C 24.040799 37.366272 23.270015 36.297243 22.5 35.4375 C 21.729984 34.577757 20.542988 33.721469 19.625 33.25 C 18.707014 32.778531 18.020888 32.646687 17.1875 32.5 C 16.354112 32.353337 15.708004 32.3003 14.65625 32.34375 z");Ui.Button.extend("Wn.InfoButton");Ui.Button.extend("Wn.AlertButton");
Ui.LBox.extend("Wn.Error",{clock:void 0,progressbar:void 0,constructor:function(a){a=new Ui.VBox({verticalAlign:"center"});this.setContent(a);a.append(new Ui.Text({text:"La ressource recherch\u00e9e n'a pas \u00e9t\u00e9 trouv\u00e9e",margin:20,fontSize:20,textAlign:"center"}));this.progressbar=new Ui.ProgressBar({value:1,horizontalAlign:"center",width:100});a.append(this.progressbar)},onProgressComplete:function(){Ui.App.current.setMainPath("")}},{onLoad:function(){Wn.Error.base.onLoad.apply(this,
arguments);this.clock=new Anim.Clock({duration:5});this.connect(this.clock,"timeupdate",function(a,b){this.progressbar.setValue(1-b)});this.connect(this.clock,"complete",this.onProgressComplete);this.clock.begin()},onUnload:function(){Wn.Error.base.onUnload.apply(this,arguments);void 0!==this.clock&&(this.disconnect(this.clock,"complete",this.onProgressComplete),this.clock.stop(),this.clock=void 0)}});
Ui.LBox.extend("Wn.MenuUser",{app:void 0,user:void 0,image:void 0,msglabel:void 0,uploaders:void 0,progressbar:void 0,button:void 0,constructor:function(a){this.app=a.app;delete a.app;this.uploaders=[];this.button=new Ui.Button({icon:"home",text:"Accueil"});this.connect(this.button,"press",this.onPress);this.append(this.button);this.progressbar=new Ui.ProgressBar({margin:10,marginBottom:2,verticalAlign:"bottom",horizontalAlign:"center",width:40});this.progressbar.hide(!0);this.append(this.progressbar)},
onPress:function(){app.setMainPath("user:"+this.user.getId())},setCurrent:function(a){this.button.setIsActive(a)},setUser:function(a){this.user=a;this.connect(this.user,"order",this.onUserOrder);this.connect(this.user,"call",this.onUserCall);this.onUserMessagesChange()},getUploaders:function(){return this.uploaders},addUploader:function(a){this.uploaders.push(a);1===this.uploaders.length&&this.progressbar.show();this.connect(a,"complete",this.onUploaderCompleteError);this.connect(a,"error",this.onUploaderCompleteError);
this.connect(a,"progress",this.updateUploaders);this.updateUploaders()},updateUploaders:function(){for(var a=0,b=0,c=0,d=0,e=0;e<this.uploaders.length;e++){var f=this.uploaders[e];void 0!=f.getTotal()&&(c+=f.getTotal(),d+=f.getIsCompleted()?f.getTotal():f.getLoaded(),b++);a++}this.progressbar.setValue(d/c)},onUploaderCompleteError:function(a){a=!0;for(var b=0;a&&b<this.uploaders.length;b++)a=this.uploaders[b].getIsCompleted();this.updateUploaders();a&&(this.uploaders=[],this.progressbar.hide(!0))},
onUserOrder:function(a,b){Ui.App.current.setMainPath(b.content)},onUserCall:function(a,b,c){(new Wn.ContactMessagesDialog({user:this.user,contact:b,message:c})).open()},onUserMessagesChange:function(){Ui.App.current.updateMessagesSeen()}});Ui.CanvasElement.extend("Wn.ContactArrow",{},{updateCanvas:function(a){a.fillStyle=Ui.Color.create(this.getStyleProperty("color")).getCssRgba();a.fillRect(0,0,this.getLayoutWidth(),this.getLayoutHeight())},onStyleChange:function(){this.invalidateDraw()}},{style:{color:"#e20045"}});
Ui.LBox.extend("Wn.MenuContactIcon",{user:void 0,contact:void 0,image:void 0,statusRect:void 0,newicon:void 0,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.append(new Ui.Rectangle({fill:"#f1f1f1",margin:2}));this.image=new Ui.Image({width:64,height:64,margin:2});this.append(this.image);this.statusRect=new Ui.Rectangle({fill:"#13d774",width:10,height:10,radius:5,marginTop:5,marginRight:5,horizontalAlign:"right",verticalAlign:"top"});this.append(this.statusRect);
this.newicon=new Wn.NewRibbon({width:32,height:32,verticalAlign:"top",horizontalAlign:"left",margin:1});this.append(this.newicon)},getContact:function(){return this.contact},onContactChange:function(){this.contact.getIsOnline()?this.statusRect.show():this.statusRect.hide();this.image.setSrc(this.contact.getFaceUrl())},onUserMessagesChange:function(){for(var a=this.user.getMessages(),b=!1,c=0;!b&&c<a.length;c++)b=a[c],b=!b.getSeen()&&b.getOrigin()===this.contact.getId()&&"resource"===b.getType();b?
this.newicon.show():this.newicon.hide()}},{onLoad:function(){Wn.MenuContactIcon.base.onLoad.call(this);this.connect(this.contact,"change",this.onContactChange);this.connect(this.user,"messageschange",this.onUserMessagesChange);if(this.contact.getIsReady())this.onContactChange();this.onUserMessagesChange()},onUnload:function(){Wn.MenuContactIcon.base.onUnload.call(this);this.disconnect(this.contact,"change",this.onContactChange);this.disconnect(this.user,"messageschange",this.onUserMessagesChange)}});
Wn.SelectionButton.extend("Wn.MenuContact",{user:void 0,contact:void 0,arrow:void 0,isCurrent:!1,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.setDraggableData(this);this.getDropBox().addMimetype(Wn.ResourceView);this.connect(this.getDropBox(),"drop",this.onDrop);this.arrow=new Wn.ContactArrow({width:4,horizontalAlign:"right"});this.arrow.hide();this.getDropBox().append(this.arrow);a=new Wn.MenuContactIcon({horizontalAlign:"center",contact:this.contact,
user:this.user});this.setIcon(a);Ui.App.current.getMainPath()==="user:"+this.contact.getId()&&this.setCurrent(!0)},setCurrent:function(a){(this.isCurrent=a)?this.arrow.show():this.arrow.hide()},getContact:function(){return this.contact},onContactChange:function(){this.setText(this.contact.getName())},onDrop:function(a,b,c){a=Wn.Resource.getResource(c);if(a.getIsReady())this.onResourceReady(a);else this.connect(a,"ready",this.onResourceReady)},onResourceReady:function(a){if(a.canShare()){var b={user_id:this.contact.getId(),
read:!0,share:this.user.getData().default_share_right};a.canWrite()&&this.user.getData().default_write_right&&(b.write=!0);a.addRights(b)}},onContactDelete:function(){var a=new Ui.Dialog({title:"Enlever un contact",fullScrolling:!0,preferredWidth:300,preferredHeight:300,cancelButton:new Ui.DialogCloseButton({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous supprimer ce contact de votre liste de contact ?\n\nCela ne vous emp\u00eachera pas de le remettre plus tard si vous changez d'avis."})}),
b=new Ui.DefaultButton({text:"Enlever"});this.connect(b,"press",function(){this.user.removeContact(this.contact);a.close()});a.setActionButtons([b]);a.open()},onContactEdit:function(){(new Wn.UserProfil({user:this.contact})).open()}},{updateColors:function(){Wn.MenuContact.base.updateColors.apply(this,arguments)},onPress:function(){app.setMainPath("user:"+this.contact.getId())},getSelectionActions:function(){return{"delete":{text:"Enlever",icon:"trash",scope:this,callback:this.onContactDelete,multiple:!1},
edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onContactEdit,multiple:!1}}},onStyleChange:function(){Wn.MenuContact.base.onStyleChange.apply(this,arguments);this.setCurrent(this.isCurrent)},onLoad:function(){Wn.MenuContact.base.onLoad.call(this);this.connect(this.contact,"change",this.onContactChange);if(this.contact.getIsReady())this.onContactChange()},onUnload:function(){Wn.MenuContact.base.onUnload.call(this);this.disconnect(this.contact,"change",this.onContactChange)}},
{style:{active:"red",color:"black"}});Ui.Button.extend("Wn.MenuNewContact",{user:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setIcon("plus")}},{onPress:function(){Wn.MenuNewContact.base.onPress.apply(this,arguments);(new Wn.AddContactDialog({user:this.user})).open()}});
Ui.LBox.extend("Wn.Menu",{user:void 0,menuUser:void 0,contactsWatcher:void 0,resourcesWatcher:void 0,messageBox:void 0,bg:void 0,resources:void 0,contacts:void 0,constructor:function(a){this.addEvents("launch");this.user=a.user;delete a.user;this.bg=new Ui.Rectangle;this.append(this.bg);a=new Ui.ScrollingArea({scrollHorizontal:!1});this.append(a);var b=new Ui.VBox({marginTop:20,spacing:5});a.setContent(b);b.append(new Wn.MenuNewContact({user:this.user}));this.contacts=new Wn.VDropBox({spacing:5});
this.contacts.addMimetype(Wn.MenuContact);this.connect(this.contacts,"dropat",this.onUserDropAt);b.append(this.contacts);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},setCurrentUser:function(a){for(var b=0;b<this.contacts.getLogicalChildren().length;b++)this.contacts.getLogicalChildren()[b].getContact().getId()==a?(this.contacts.getLogicalChildren()[b].setCurrent(!0),this.contacts.getLogicalChildren()[b].scrollIntoView()):this.contacts.getLogicalChildren()[b].setCurrent(!1)},
onUserChange:function(a){for(var b=[],c=[],d=0;d<this.contacts.getLogicalChildren().length;d++)this.contacts.getLogicalChildren()[d].hostMenuFound=!1;for(a=0;a<this.user.getContacts().length;a++){for(var e=this.user.getContacts()[a],f=void 0,d=0;void 0==f&&d<this.contacts.getLogicalChildren().length;d++)this.contacts.getLogicalChildren()[d].getContact().getId()==e.getId()&&(f=this.contacts.getLogicalChildren()[d]);void 0==f?c.push(e):f.hostMenuFound=!0}for(d=0;d<this.contacts.getLogicalChildren().length;d++)this.contacts.getLogicalChildren()[d].hostMenuFound||
b.push(this.contacts.getLogicalChildren()[d]);for(a=0;a<b.length;a++)this.contacts.remove(b[a]);if(0<c.length)for(a=0;a<c.length;a++)this.contacts.insertAt(new Wn.MenuContact({user:this.user,contact:c[a],width:98}),c[a].getPosition());c=0;do{b=void 0;for(a=0;a<this.contacts.getLogicalChildren().length;a++)if(d=this.contacts.getLogicalChildren()[a].getContact().getPosition(),d!=a){0<d&&d<this.contacts.getLogicalChildren().length&&(b=this.contacts.getLogicalChildren()[a],this.contacts.moveAt(b,d));
break}c++}while(void 0!==b&&c<=this.contacts.getLogicalChildren().length)},onUserDropAt:function(a,b,c,d){a=void 0;b=-1;for(var e=0;e<this.contacts.getLogicalChildren().length&&void 0===a;e++){var f=this.contacts.getLogicalChildren()[e];f.getContact()===c.getContact()&&(a=f,b=e)}void 0!==a&&(b!=d&&b+1!=d)&&(b<d&&d--,this.contacts.moveAt(a,d),this.user.setContactPosition(a.getContact(),d))}},{onStyleChange:function(){Wn.Menu.base.onStyleChange.apply(this,arguments);this.bg.setFill(this.getStyleProperty("background"))}},
{style:{background:"#f1f1f1"}});
Ui.Dialog.extend("Wn.ReloadDialog",{constructor:function(a){this.setTitle("Mise \u00e0 jour de l'application");this.setFullScrolling(!0);this.setPreferredWidth(300);this.setPreferredHeight(300);this.setContent(new Ui.Text({text:"Une mise \u00e0 jour est disponible. Il est souhaitable de recharger l'application.",margin:20}));a=new Ui.Button({text:"Recharger"});this.connect(a,"press",this.onReloadPress);this.setActionButtons([a]);this.setCancelButton(new Ui.Button({text:"Plus tard"}))},onReloadPress:function(){window.location.reload()}});
Ui.Button.extend("Wn.ProfilButton",{user:void 0,image:void 0,userFace:void 0,constructor:function(a){this.user=a.user;delete a.user;this.userFace=new Ui.LBox({verticalAlign:"center"});this.image=new Ui.Image({margin:1,src:this.user.getFaceUrl()});this.userFace.append(this.image);this.setIcon(this.userFace)},onUserChange:function(){this.image.setSrc(this.user.getFaceUrl())}},{updateColors:function(){Wn.ProfilButton.base.updateColors.apply(this,arguments)},onStyleChange:function(){Wn.ProfilButton.base.onStyleChange.apply(this,
arguments);var a=this.getStyleProperty("iconSize");this.image.setWidth(a-2);this.image.setHeight(a-2)},onLoad:function(){Wn.ProfilButton.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},onUnload:function(){Wn.ProfilButton.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange)}});Ui.CompactLabel.extend("Wn.MenuTitle",{});Ui.Button.extend("Wn.BackButton",{constructor:function(){this.setIcon("arrowleft")}});
Wn.MenuToolBar.extend("Wn.AppMenuToolBar",{app:void 0,user:void 0,homeButton:void 0,backbutton:void 0,titleLabel:void 0,viewButton:void 0,historyButton:void 0,profilButton:void 0,constructor:function(a){this.app=a.app;delete a.app;this.user=a.user;delete a.user;this.homeButton=new Wn.MenuUser({user:this.user,app:this.app,width:98});this.append(this.homeButton);this.backButton=new Wn.BackButton;this.connect(this.backButton,"press",this.onBackPress);this.append(this.backButton);this.titleLabel=new Wn.MenuTitle({width:100,
verticalAlign:"center",maxLine:2});this.append(this.titleLabel,!0);this.viewButton=new Ui.Button({icon:"eye",text:"Affichage"});this.connect(this.viewButton,"press",this.onViewPress);this.append(this.viewButton);this.historyButton=new Ui.Button({icon:"chathistory",text:"Historique"});this.connect(this.historyButton,"press",this.onChatHistoryPress);this.append(this.historyButton);this.profilButton=new Wn.ProfilButton({user:this.user,horizontalAlign:"center"});this.connect(this.profilButton,"press",
this.onProfilPress);this.append(this.profilButton)},setCurrent:function(a){this.homeButton.setCurrent(a)},setTitle:function(a){this.titleLabel.setText(a)},setActions:function(a){for(var b=0,c=[],b=0;b<this.getLogicalChildren().length&&this.getLogicalChildren()[b]!==this.titleLabel;b++);var d;for(d=b+1;d<this.getLogicalChildren().length&&this.getLogicalChildren()[d]!==this.viewButton;d++)c.push(this.getLogicalChildren()[d]);for(d=0;d<c.length;d++)this.remove(c[d]);for(d=a.length-1;0<=d;d--)this.insertAt(a[d],
b+1,!1)},getUploaders:function(){return this.homeButton.getUploaders()},addUploader:function(a){this.homeButton.addUploader(a)},onBackPress:function(){this.app.backHistory()},onViewPress:function(a){var b=new Ui.MenuPopup,c=new Ui.VBox;b.setContent(c);var d=new Ui.ToggleButton({icon:"menu",text:"Contacts"});"false"!==localStorage.getItem("showContactBar")&&d.toggle();this.connect(d,"toggle",function(){localStorage.setItem("showContactBar","true");this.app.getMenu().show()});this.connect(d,"untoggle",
function(){localStorage.setItem("showContactBar","false");this.app.getMenu().hide(!0)});c.append(d);d=new Ui.ToggleButton({icon:"bubble",text:"D\u00e9tails"});"false"!==localStorage.getItem("showDetails")&&d.toggle();this.connect(d,"toggle",function(){localStorage.setItem("showDetails","true");this.app.showDetails()});this.connect(d,"untoggle",function(){localStorage.setItem("showDetails","false");this.app.hideDetails()});c.append(d);d=new Ui.ToggleButton({icon:"thumb",text:"Vignettes"});"false"!==
localStorage.getItem("thumbsVisible")&&d.toggle();this.connect(d,"toggle",function(){this.app.showThumbs()});this.connect(d,"untoggle",function(){this.app.hideThumbs()});c.append(d);var e=new Ui.ToggleButton({icon:"chronoplay",text:"Diaporama"});c.append(e);"true"===localStorage.getItem("autoPlay")&&e.toggle();this.connect(e,"toggle",function(){this.app.setAutoPlay(!0)});this.connect(e,"untoggle",function(){this.app.setAutoPlay(!1)});e=new Ui.ToggleButton({icon:"fullscreen",text:"Plein \u00e9cran"});
"true"===localStorage.getItem("fullscreen")&&e.toggle();c.append(e);this.connect(e,"toggle",function(){this.app.fullscreen()});this.connect(d,"untoggle",function(){this.app.unfullscreen()});b.show(a,"bottom")},onChatHistoryPress:function(a){(new Wn.HistoryMessagesPopup({user:this.user})).show(a,"bottom")},onProfilPress:function(a){var b=new Ui.MenuPopup,c=new Ui.VBox;b.setContent(c);var d=new Ui.Button({icon:"person",text:"Profil"});this.connect(d,"press",function(){(new Wn.UserProfil({user:this.user})).open()});
c.append(d);c.append(new Ui.MenuPopupSeparator);d=new Ui.Button({icon:"exit",text:"D\u00e9connexion"});this.connect(d,"press",this.onExitPress);c.append(d);b.show(a,"bottom")},onExitPress:function(){if(void 0!==Ui.App.current.getArguments().user){var a=new Ui.Dialog({title:"D\u00e9connexion",fullScrolling:!1,preferredWidth:350,cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous vraiment vous fermer votre session sur ce compte utilisateur ?"})}),b=new Wn.AlertButton({text:"Fermer"});
this.connect(b,"press",function(){window.close()})}else a=new Ui.Dialog({title:"D\u00e9connexion",fullScrolling:!1,preferredWidth:300,cancelButton:new Ui.DialogCloseButton({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous vraiment vous d\u00e9connecter ?"})}),b=new Ui.DefaultButton({text:"D\u00e9connecter"}),this.connect(b,"press",function(){"localStorage"in window&&(localStorage.removeItem("login"),localStorage.removeItem("password"),localStorage.removeItem("currentPath"),localStorage.removeItem("authsession"));
document.cookie="HOST_AUTH=; expires=Thu, 01-Jan-1970 00:00:01 GMT";var a=new Core.HttpRequest({method:"DELETE",url:"/cloud/authsession/current"});this.connect(a,"done",this.onAuthSessionDelete);this.connect(a,"error",this.onAuthSessionDelete);a.send()});a.setActionButtons([b]);a.open()},onAuthSessionDelete:function(){var a=window.location.href;-1!=a.lastIndexOf("#")&&(a=a.substring(0,a.lastIndexOf("#")));window.location.replace(a)},onUserMessagesChange:function(){for(var a=0,b=0;b<this.user.getMessages().length;b++){var c=
this.user.getMessages()[b];c.getDestination()==this.user.getId()&&!c.getSeen()&&a++}0===a?this.historyButton.setBadge(void 0):this.historyButton.setBadge(a)}},{onLoad:function(){Wn.AppMenuToolBar.base.onLoad.call(this);this.connect(this.user,"messageschange",this.onUserMessagesChange);this.onUserMessagesChange()},onUnload:function(){Wn.AppMenuToolBar.base.onUnload.call(this);this.disconnect(this.user,"messageschange",this.onUserMessagesChange)}});
Ui.App.extend("Wn.App",{loginDialog:void 0,user:void 0,deviceQueue:void 0,contentswitch:void 0,hbox:void 0,menu:void 0,mainbox:void 0,main:void 0,isFullscreen:!1,isThumbsVisible:!1,currentPath:void 0,resource:void 0,contact:void 0,rfidReader:void 0,reloadDialog:void 0,selection:void 0,menuBox:void 0,actionBox:void 0,contextBox:void 0,pathHistory:void 0,backgroundBox:void 0,backgroundImage:void 0,unfullscreenButton:void 0,setup:void 0,constructor:function(a){this.pathHistory=[];this.backgroundBox=
new Ui.LBox;this.setContent(this.backgroundBox);this.backgroundImage=new Wn.ScaledImage2({mode:"crop"});this.backgroundBox.append(this.backgroundImage);this.backgroundBox.append(new Ui.VBox);this.connect(window,"hashchange",this.onHashChange);this.rfidReader=new Wn.RfidReader;this.connect(this.rfidReader,"enter",this.onRfidEnter);a=new Core.HttpRequest({url:"/cloud/setup"});this.connect(a,"done",function(a){this.setup=a.getResponseJSON();if("icons"in this.setup)for(var c in this.setup.icons)Ui.Icon.override(c,
this.setup.icons[c]);this.setTheme("default");void 0!=this.getArguments().user?(a=new Core.HttpRequest({url:"/cloud/user/"+this.getArguments().user}),this.connect(a,"done",this.onGetUserDone),this.connect(a,"error",this.onGetUserError),a.send()):this.sendGetAuthSession()});a.send();this.connect(this.getDrawing(),"keyup",this.onKeyUp)},getSetup:function(){return this.setup},getSelectionHandler:function(){return this.selection},getRfidReader:function(){return this.rfidReader},sendGetAuthSession:function(){var a;
"localStorage"in window&&(a=localStorage.getItem("authsession"));var b="/cloud/authsession/",b=void 0!==a&&null!==a?b+encodeURIComponent(a):b+"current";a=new Core.HttpRequest({method:"GET",url:b+"?setcookie=1"});this.connect(a,"done",this.onGetAuthSessionDone);this.connect(a,"error",this.onGetAuthSessionError);a.send()},onGetAuthSessionError:function(a){"localStorage"in window&&localStorage.removeItem("authsession");this.basicLogin()},onGetAuthSessionDone:function(a){a=a.getResponseJSON();"localStorage"in
window&&localStorage.setItem("authsession",a.id);a=new Core.HttpRequest({url:"/cloud/user/"+a.user});this.connect(a,"done",this.onGetUserDone);this.connect(a,"error",this.onGetUserError);a.send()},onGetUserDone:function(a){this.onLoginDone(a.getResponseJSON())},onGetUserError:function(a){"localStorage"in window&&localStorage.removeItem("authsession");this.basicLogin()},getUser:function(){return this.user},basicLogin:function(){this.loginDialog=new Wn.LoginWizard({setup:this.setup});this.connect(this.loginDialog,
"done",this.onBasicLoginDone);this.loginDialog.open()},onBasicLoginDone:function(a){a.close();this.sendGetAuthSession()},setBackgroundImage:function(a){this.backgroundImage.setSrc(a)},onLoginDone:function(a){this.user=new Wn.User({user:a});this.connect(this.user,"delete",this.onUserDelete);this.connect(this.user,"change",this.onUserChange);this.connect(this.user,"serverchange",this.onServerChange);this.setTheme(this.user.getTheme());this.selection=new Ui.Selection;this.connect(this.selection,"change",
this.onSelectionChange);this.backgroundBox.remove(this.backgroundBox.getLastChild());a=new Ui.VBox;this.backgroundBox.append(a);this.menu=new Wn.Menu({user:this.user,width:98});"false"===localStorage.getItem("showContactBar")&&this.menu.hide(!0);this.menuBox=new Ui.LBox;this.menuBox.append(new Ui.Rectangle({fill:"#f1f1f1"}));a.append(this.menuBox);this.actionBox=new Wn.AppMenuToolBar({user:this.user,app:this});this.menuBox.append(this.actionBox);this.contextBox=new Ui.ContextBar({selection:this.selection});
this.contextBox.hide();this.menuBox.append(this.contextBox);var b=new Ui.HBox;a.append(b,!0);b.append(this.menu);this.contentswitch=new Ui.TransitionBox;b.append(this.contentswitch,!0);a="";a="location"in window&&"hash"in location&&void 0!=location.hash&&""!=location.hash&&"#"!=location.hash&&"#_=_"!=location.hash?location.hash.substring(1):"user:"+this.user.getId();this.setMainPath(a);"localStorage"in window&&(void 0!==localStorage.getItem("deviceId")&&null!==localStorage.getItem("deviceId"))&&(this.deviceQueue=
new Wn.Queue({channel:localStorage.getItem("deviceId")}),this.connect(this.deviceQueue,"message",this.onDeviceMessage));"true"===localStorage.getItem("fullscreen")&&this.fullscreen()},getMenu:function(){return this.menu},getDeviceId:function(){if("localStorage"in window&&void 0!==localStorage.getItem("deviceId"))return localStorage.getItem("deviceId")},setDeviceId:function(a){"localStorage"in window&&(void 0===a||null===a?localStorage.removeItem("deviceId"):(localStorage.setItem("deviceId",a),void 0!==
this.deviceQueue?this.deviceQueue.setChannel(a):(this.deviceQueue=new Wn.Queue({channel:a}),this.connect(this.deviceQueue,"message",this.onDeviceMessage))))},updateMessagesSeen:function(){var a=this.getMainPath();if(void 0===a)return 0;var b=0,c=this.user.getMessages();if(0===a.indexOf("user:"))for(var d=0;d<c.length;d++){var e=c[d];e.getSeen()||e.getDestination()!=this.user.getId()||("contact"===e.getType()&&a==="user:"+e.getContent()?e.markSeen():b++)}else if(0===a.indexOf("resource:"))for(d=0;d<
c.length;d++)e=c[d],e.getSeen()||e.getDestination()!=this.user.getId()||("comment"===e.getType()&&"resource:"+e.getContent().resource.id+":"+e.getContent().file===a||"resource"===e.getType()&&"resource:"+e.getContent().id===a?e.markSeen():b++);return b},getMainPath:function(){return this.currentPath},notifyMainPath:function(a){if(a===this.currentPath)return!1;this.currentPath=a;"location"in window&&"hash"in location&&(location.hash="#"+a);(new Core.HttpRequest({method:"POST",url:"/cloud/pathlog",
content:JSON.stringify({owner:Ui.App.current.getUser().getId(),path:a})})).send();this.updateMessagesSeen();return!0},backHistory:function(){1<this.pathHistory.length?(this.pathHistory.pop(),this.setMainPath(this.pathHistory.pop())):(this.pathHistory=[],this.setMainPath("user:"+this.user.getId()))},setMainPath:function(a){if(this.notifyMainPath(a)){this.pathHistory.push(a);20<this.pathHistory.length&&this.pathHistory.shift();void 0!==this.resource&&(this.disconnect(this.resource,"error",this.onResourceError),
this.disconnect(this.resource,"delete",this.onResourceError),this.disconnect(this.resource,"ready",this.onResourceReady),this.resource=void 0);void 0!==this.contact&&(this.disconnect(this.contact,"error",this.onContactError),this.disconnect(this.contact,"delete",this.onContactError),this.disconnect(this.contact,"ready",this.onContactReady),this.contact=void 0);if(""===a)app.setMain(new Wn.UserView({user:this.user})),this.menu.setCurrentUser(this.user.getId()),this.actionBox.setCurrent(!0);else{var b=
a.indexOf(":");if(-1===b){this.setMain(new Wn.Error);return}var c=a.substring(0,b);a=a.substring(b+1);switch(c){case "rfid":b=this.user.getRfidPath(a);void 0===b?(b=new Core.HttpRequest({method:"GET",url:"/cloud/rfid/"+a}),this.connect(b,"done",function(a){a=a.getResponseJSON();void 0!==a&&void 0!==a.path&&Ui.App.current.setMainPath(a.path)}),this.connect(b,"error",function(){this.setMain(new Wn.Error)}),b.send()):this.setMainPath(b);return;case "user":this.menu.setCurrentUser(a);if(a===this.user.getId())app.setMain(new Wn.UserView({user:this.user})),
this.actionBox.setCurrent(!0);else{this.actionBox.setCurrent(!1);this.contact=Wn.Contact.getContact(a);if(void 0===this.contact){this.setMain(new Wn.Error);return}if(this.contact.getIsReady())this.onContactReady();else this.connect(this.contact,"ready",this.onContactReady),this.connect(this.contact,"error",this.onContactError),this.connect(this.contact,"delete",this.onContactError)}break;case "resource":b=a.indexOf(":");-1!==b?(c=a.substring(0,b),this.resourceSubpath=b=a.substring(b+1)):(c=a,this.resourceSubpath=
void 0);this.resource=Wn.Resource.getResource(c,this.user);if(void 0===this.resource){this.setMain(new Wn.Error);return}if(this.resource.getIsReady())this.onResourceReady();else this.connect(this.resource,"ready",this.onResourceReady),this.connect(this.resource,"error",this.onResourceError),this.connect(this.resource,"delete",this.onResourceError);break;case "error":this.setMain(new Wn.Error);break;default:this.setMain(new Wn.Error)}}this.isFullscreen&&"fullscreen"in this.getMain()&&this.getMain().fullscreen()}},
onSelectionChange:function(a){0===a.getElements().length?(this.contextBox.hide(),this.actionBox.show()):(this.contextBox.show(),this.actionBox.hide())},onContactError:function(){this.disconnect(this.contact,"error",this.onContactError);this.disconnect(this.contact,"delete",this.onContactError);this.disconnect(this.contact,"ready",this.onContactReady);this.contact=void 0;this.setMain(new Wn.Error)},onContactReady:function(){this.disconnect(this.contact,"error",this.onContactError);this.disconnect(this.contact,
"delete",this.onContactError);this.disconnect(this.contact,"ready",this.onContactReady);this.setMain(new Wn.ContactView({user:this.user,contact:this.contact}));this.contact=void 0},onResourceError:function(){this.disconnect(this.resource,"error",this.onResourceError);this.disconnect(this.resource,"delete",this.onResourceError);this.disconnect(this.resource,"ready",this.onResourceReady);this.resource=void 0;this.setMain(new Wn.Error)},onResourceReady:function(){this.disconnect(this.resource,"error",
this.onResourceError);this.disconnect(this.resource,"delete",this.onResourceError);this.disconnect(this.resource,"ready",this.onResourceReady);if(Wn.ResourceViewer.hasInstance(this.main)&&this.main.getResource()===this.resource)console.log("onResourceReady resource is current"),void 0!==this.resourceSubpath&&this.main.setPath(this.resourceSubpath);else{var a=Wn.ResourceViewer.getApplication(this.resource.getType());if(void 0===a)this.setMain(new Wn.Error);else{this.menu.setCurrentUser(this.resource.getOwnerId());
this.actionBox.setCurrent(this.resource.getOwnerId()===this.user.getId());if(this.resource.getOwnerId()==this.user.getId())a=new a({user:this.user,contact:void 0,resource:this.resource,path:this.resourceSubpath});else var b=Wn.Contact.getContact(this.resource.getOwnerId()),a=new a({user:this.user,contact:b,resource:this.resource,path:this.resourceSubpath});this.setMain(a);this.resource=void 0}}},getMain:function(){return this.main},setMain:function(a){void 0!==this.main&&(this.main.disable(),this.mainbox.append(new Ui.Rectangle({fill:"white",
opacity:0.5})),this.mainbox.append(new Ui.Loading({width:50,height:50,verticalAlign:"center",horizontalAlign:"center"})));this.mainbox=new Ui.LBox;this.main=a;this.mainbox.setContent(this.main);this.contentswitch.replaceContent(this.mainbox);"getTitle"in this.main&&this.actionBox.setTitle(this.main.getTitle());"getActions"in this.main&&this.actionBox.setActions(this.main.getActions());"false"!==localStorage.getItem("thumbsVisible")&&"showThumbs"in this.main&&this.main.showThumbs();"false"===localStorage.getItem("showDetails")&&
"hideDetails"in this.main&&this.main.hideDetails();"true"===localStorage.getItem("fullscreen")&&"fullscreen"in this.main&&this.main.fullscreen();this.getAutoPlay()&&"play"in this.main&&this.main.play()},setDefaultMain:function(){this.setMainPath("")},getUploaders:function(){return this.menu.getUploaders()},addUploader:function(a){this.actionBox.addUploader(a)},showThumbs:function(){localStorage.setItem("thumbsVisible","true");"showThumbs"in this.main&&this.main.showThumbs()},hideThumbs:function(){localStorage.setItem("thumbsVisible",
"false");"hideThumbs"in this.main&&this.main.hideThumbs()},showDetails:function(){localStorage.setItem("showDetails","true");"showDetails"in this.main&&this.main.showDetails()},hideDetails:function(){localStorage.setItem("showDetails","false");"hideDetails"in this.main&&this.main.hideDetails()},fullscreen:function(){localStorage.setItem("fullscreen","true");console.log(this+".fullscreen");this.menuBox.hide(!0);this.menu.hide(!0);void 0!==this.main&&"fullscreen"in this.main&&this.main.fullscreen();
this.unfullscreenButton=new Ui.Button({verticalAlign:"top",horizontalAlign:"right",icon:"unfullscreen"});this.connect(this.unfullscreenButton,"press",this.unfullscreen);this.backgroundBox.append(this.unfullscreenButton);var a=document.body;"requestFullscreen"in a?a.requestFullscreen():"mozRequestFullScreen"in a?a.mozRequestFullScreen():"webkitRequestFullScreen"in a&&a.webkitRequestFullScreen()},unfullscreen:function(){localStorage.setItem("fullscreen","false");console.log(this+".unfullscreen");this.menuBox.show();
this.menu.show();void 0!==this.main&&"fullscreen"in this.main&&this.main.unfullscreen();void 0!==this.unfullscreenButton&&(this.disconnect(this.unfullscreenButton,"press",this.unfullscreen),this.backgroundBox.remove(this.unfullscreenButton),this.unfullscreenButton=void 0);"exitFullscreen"in document?document.exitFullscreen():"mozCancelFullScreen"in document?document.mozCancelFullScreen():"webkitCancelFullScreen"in document&&document.webkitCancelFullScreen()},onContentFullscreen:function(){if(!this.isFullscreen){this.isFullscreen=
!0;this.hbox.remove(this.menu);var a=document.documentElement;"requestFullscreen"in a?a.requestFullscreen():"mozRequestFullScreen"in a?a.mozRequestFullScreen():"webkitRequestFullScreen"in a&&a.webkitRequestFullScreen()}},onContentUnfullscreen:function(){this.isFullscreen&&(this.isFullscreen=!1,this.hbox.append(this.menu),"exitFullscreen"in document?document.exitFullscreen():"mozCancelFullScreen"in document?document.mozCancelFullScreen():"webkitCancelFullScreen"in document&&document.webkitCancelFullScreen())},
getAutoPlay:function(){return"true"===localStorage.getItem("autoPlay")},setAutoPlay:function(a){localStorage.setItem("autoPlay",a?"true":"false");"setAutoPlay"in this.main&&this.main.setAutoPlay(!0===a)},onHashChange:function(a){location.hash.substring(1)!==this.currentPath&&this.setMainPath(location.hash.substring(1))},onServerChange:function(){void 0===this.reloadDialog&&(this.reloadDialog=new Wn.ReloadDialog,this.connect(this.reloadDialog,"close",function(){this.reloadDialog=void 0}),this.reloadDialog.open())},
onUserChange:function(){this.setBackgroundImage("/cloud/wallpaper/"+this.user.getWallpaper())},onUserDelete:function(){var a=new Ui.Dialog({title:"Compte supprim\u00e9",fullScrolling:!0,preferredWidth:300,preferredHeight:300});a.setContent(new Ui.Text({text:"Il semble que votre compte a \u00e9t\u00e9 supprim\u00e9."}));var b=new Ui.DefaultButton({text:"Quitter"});a.setActionButtons([b]);this.connect(b,"press",function(){window.location.reload()});a.open()},onRfidEnter:function(a,b){this.setMainPath("rfid:"+
b);return!0},onDeviceMessage:function(a,b){"rfid"==b.type?this.getRfidReader().fireEnter(b.content):"order"==b.type&&this.setMainPath(b.content)},onKeyUp:function(a){void 0!==this.selection&&0<this.selection.getElements().length&&46===a.which&&(a.stopPropagation(),a.preventDefault(),this.selection.executeDeleteAction())},getThemeWallpaper:function(a){for(var b,c=0;c<this.setup.style.themes.length;c++)if(this.setup.style.themes[c].key===a){a=this.setup.style.themes[c];void 0!==a.wallpaper&&null!==
a.wallpaper&&(b=a.wallpaper);break}return b},setTheme:function(a){var b;if("custom"===a)b=this.user.getCustomTheme();else for(var c=0;c<this.setup.style.themes.length;c++)if(this.setup.style.themes[c].key===a){b=this.setup.style.themes[c];break}void 0===b&&(b=this.setup.style.themes[0]);a=b.palette;b={"Ui.Element":{fontFamily:"Avenir,Segoe UI Semilight,Sans-Serif",fontWeight:100,fontSize:16,linkColor:a["default"]},"Ui.Shape":{color:a.foreground},"Ui.Html":{color:a.foreground},"Ui.ContentEditable":{fontSize:20,
interLine:1.4,color:a.foreground},"Ui.Text":{interLine:1.4,color:a.foreground},"Ui.Label":{color:a.foreground},"Ui.CompactLabel":{color:a.foreground},"Ui.Entry":{color:a.foreground},"Ui.TextArea":{color:a.foreground},"Ui.Separator":{color:a.foreground},"Ui.CheckBox":{borderWidth:b.thickness,color:a.foreground,focusColor:a.focus,checkColor:a["default"]},"Ui.ProgressBar":{color:a.foreground},"Ui.ScrollingArea":{color:a.foreground,showScrollbar:!1,overScroll:!0,radius:b.roundness},"Ui.VBoxScrollingArea":{color:a.foreground,
showScrollbar:!1,overScroll:!0,radius:b.roundness},"Ui.TextBgGraphic":{borderWidth:b.thickness,background:a.foreground,focusBackground:a.focus},"Ui.Button":{radius:b.roundness,borderWidth:b.thickness,background:"rgba(250,250,250,0)",backgroundBorder:a.foreground,foreground:a.foreground,activeForeground:a.active,focusBackground:a.focus,focusBackgroundBorder:a.focus,focusForeground:a.focusInv,focusActiveBackground:a.focus,focusActiveBackgroundBorder:"rgba(250,250,250,0)",focusActiveForeground:a.active,
orientation:"horizontal",badgeColor:a.focus,badgeTextColor:a.focusInv,fontSize:16,iconSize:22,textWidth:60,textHeight:22,padding:b.spacing,spacing:5},"Ui.DefaultButton":{radius:b.roundness,background:a["default"],backgroundBorder:"rgba(250,250,250,0)",foreground:a.defaultInv,focusForeground:a.focusInv,badgeColor:a.focus},"Ui.DragEffectIcon":{stroke:a.focusInv,strokeWidth:2*b.thickness,fill:a.focus},"Wn.SelectionButton":{iconSize:48,orientation:"vertical",textWidth:80,maxTextWidth:80,fontSize:14,whiteSpace:"pre-line",
background:"rgba(250,250,250,0)",backgroundBorder:"rgba(250,250,250,0)",foreground:a.foreground,activeBackground:a.active,activeBackgroundBorder:"rgba(250,250,250,0)",activeForeground:a.focusInv,focusBackground:"rgba(250,250,250,0)",focusBackgroundBorder:a.focus,focusForeground:a.focus,focusActiveBackground:a.active,focusActiveBackgroundBorder:a.focus,focusActiveForeground:a.focusInv},"Wn.OptionOpenButton":{borderWidth:0,iconSize:16,whiteSpace:"pre-line",background:"rgba(250,250,250,0)",foreground:a.foreground,
activeForeground:a.active,focusBackground:"rgba(250,250,250,0)",focusForeground:a.focus,focusActiveBackground:"rgba(250,250,250,0)",focusActiveForeground:a.active},"Ui.SegmentBar":{radius:b.roundness,borderWidth:b.thickness,background:"rgba(250,250,250,0)",backgroundBorder:a.foreground,foreground:a.foreground,focusBackgroundBorder:a.focus,focusBackground:"rgba(250,250,250,0)",focusForeground:a.foreground,activeBackground:a.focus,activeForeground:a.focusInv},"Ui.Slider":{radius:b.roundness,borderWidth:b.thickness,
background:a.foreground,foreground:a.focus},"Wn.ImprovedText":{color:a.foreground},"Wn.UserNotifyView":{background:Ui.Color.create(a.focus).addA(-0.7)},"Ui.ActionButton":{background:"rgba(250,250,250,0)",iconSize:30,spacing:5},"Wn.BarGraph":{foreground:a.foreground,barColor:a["default"]},"Wn.MenuToolBar":{"Ui.Button":{showText:!0,background:"rgba(250,250,250,0)",backgroundBorder:"rgba(250,250,250,0)",foreground:a.foreground,activeBackground:"rgba(250,250,250,0)",activeBackgroundBorder:"rgba(250,250,250,0)",
activeForeground:a.active,focusBackground:"rgba(250,250,250,0)",focusBackgroundBorder:a.focus,focusForeground:a.foreground,focusActiveBackground:"rgba(250,250,250,0)",focusActiveBackgroundBorder:a.focus,focusActiveForeground:a.active,orientation:"horizontal",fontSize:14,iconSize:32,spacing:5,radius:0}},"Ui.MenuPopup":{"Ui.Button":{borderWidth:0,showText:!0,background:Ui.Color.create(a.foreground).addA(-1).addY(0.3),foreground:a.foreground,activeBackground:Ui.Color.create(a.foreground).addA(-1).addY(0.3),
activeForeground:a.active,orientation:"horizontal",iconSize:32,textHeight:32,spacing:10,radius:0}},"Ui.ComboPopup":{"Ui.Button":{borderWidth:0,showText:!0,background:Ui.Color.create(a.foreground).addA(-1).addY(0.3),foreground:a.foreground,activeBackground:Ui.Color.create(a.foreground).addA(-1).addY(0.3),activeForeground:a.active,orientation:"horizontal",iconSize:32,textHeight:32,spacing:10,radius:0}},"Ui.MenuToolBarButton":{"Ui.Button":{borderWidth:0,background:"rgba(250,250,250,0)",foreground:a.menuInv,
spacing:0}},"Ui.MenuPopupSeparator":{color:Ui.Color.create(a.foreground).addA(-0.85)},"Wn.BackButton":{showText:!1,spacing:0},"Wn.DetailsBox":{background:Ui.Color.create(a.background).addA(-0.7),"Ui.Button":{showText:!0,iconSize:22,spacing:5},"Wn.OptionOpenButton":{iconSize:16},"Ui.Text":{wordWrap:"break-word"}},"Wn.NavigationBox":{background:Ui.Color.create(a.background).addA(-0.7)},"Wn.ResourceViewer":{background:Ui.Color.create(a.background).addA(-0.7)},"Wn.ResourceTitle":{fontWeight:400,fontSize:24,
color:"#e1e1e1"},"Wn.ResourceView":{fontSize:14,color:a.files,padding:0,backgroundBorder:"rgba(250,250,250,0)",background:a.background,foreground:a.foreground},"Calendar.Preview":{color:a.calendar},"News.Preview":{color:a.news},"Podcast.Preview":{color:a.podcast},"Wn.ResourceViewerTitle":{fontWeight:400,fontSize:24,color:a.foreground},"Wn.AppView":{iconSize:96,backgroundBorder:"rgba(250,250,250,0)",background:a.background,foreground:a.foreground},"Wn.MenuTitle":{fontWeight:400,fontSize:20,color:a.menuInv},
"Wn.NewRibbon":{background:a.focus},"Ui.ContextBar":{background:a.focus,"Ui.Element":{color:a.focusInv},"Ui.Button":{iconSize:32}},"Ui.ContextBarCloseButton":{borderWidth:0,background:"rgba(250,250,250,0)",foreground:a.focusInv,iconSize:22,fontSize:16,textWidth:5,spacing:5},"Ui.DialogTitle":{color:a.menuInv,fontWeight:"bold",fontSize:18},"Ui.DialogButtonBox":{background:a.menu,"Ui.Button":{borderWidth:b.thickness,backgroundBorder:a.menuInv,foreground:a.menuInv},"Ui.DefaultButton":{borderWidth:b.thickness,
backgroundBorder:a.menuInv,background:a.menuInv,foreground:a.menu},"Ui.SegmentBar":{background:"rgba(250,250,250,0)",backgroundBorder:a.menuInv,foreground:a.menuInv,focusBackground:"rgba(250,250,250,0)",focusBackgroundBorder:a.focus,focusForeground:a.menuInv,activeBackground:a.menuInv,activeForeground:a.menu},"Ui.TextBgGraphic":{borderWidth:b.thickness,background:a.menuInv,focusBackground:a.focus}},"Ui.DialogCloseButton":{showText:!1,background:"rgba(250,250,250,0)",backgroundBorder:"rgba(250,250,250,0)"},
"Ui.Dialog":{background:a.background,shadow:Ui.Color.create(a.foreground).addA(-0.8)},"Ui.Popup":{background:a.background,shadow:Ui.Color.create(a.foreground).addA(-0.8)},"Ui.Selectionable":{borderWidth:b.thickness,background:"rgba(250,250,250,0)",backgroundBorder:"rgba(250,250,250,0)",foreground:a.foreground,activeForeground:a.active,focusBackground:"rgba(250,250,250,0)",focusBackgroundBorder:a.focus,focusForeground:a.focus,focusActiveBackground:a.focus,focusActiveBackgroundBorder:"rgba(250,250,250,0)",
focusActiveForeground:a.active,padding:b.spacing},"Ui.ActionButton":{backgroundBorder:"rgba(250,250,250,0)",background:"rgba(250,250,250,0)",foreground:a.focusInv},"Ui.Carousel":{focusColor:a.focus},"Storage.PageBackgroundGraphic":{background:a.background},"Wn.FlowDropBox":{markerColor:a.focus},"Wn.SFlowDropBox":{markerColor:a.focus},"Wn.HDropBox":{markerColor:a.focus},"Wn.VDropBox":{markerColor:a.focus},"Wn.ListAddButton":{radius:b.roundness,iconSize:48,orientation:"vertical",borderWidth:b.thickness,
background:"rgba(250,250,250,0)",backgroundBorder:"rgba(250,250,250,0)",foreground:a.foreground,focusBackground:"rgba(250,250,250,0)",focusBackgroundBorder:a.focus,focusForeground:a.focus},"Wn.UploadFaceButton":{iconSize:64},"Wn.MediaPlayBar":{background:Ui.Color.create(a.background).addA(-0.5),foreground:a.foreground},"Wn.PlayButton":{background:Ui.Color.create(a.background).addA(-0.5),foreground:a.foreground},"Wn.Menu":{background:Ui.Color.create(a.background).addA(-0.7),"Ui.Button":{radius:0,iconSize:48,
orientation:"vertical",borderWidth:b.thickness,background:"rgba(250,250,250,0)",backgroundBorder:"rgba(250,250,250,0)",foreground:a.foreground,focusBackground:"rgba(250,250,250,0)",focusBackgroundBorder:a.focus,focusForeground:a.foreground}},"Wn.AppMenuToolBar":{background:a.menu,"Ui.ProgressBar":{color:a.menuInv},"Ui.Button":{borderWidth:0,background:Ui.Color.create(a.menuInv).addA(-1).addY(0.4).addS(-1),foreground:a.menuInv,activeBackground:"rgba(250,250,250,0)",activeForeground:a.active,activeBackgroundBorder:"rgba(250,250,250,0)",
badgeTextColor:a.focusInv,iconSize:32,radius:0},"Ui.MenuToolBarButton":{"Ui.Button":{background:"rgba(250,250,250,0)",foreground:a.menuInv,iconSize:28,spacing:0}},"Ui.SegmentBar":{background:"rgba(250,250,250,0)",backgroundBorder:a.menuInv,foreground:a.menuInv,focusBackground:"rgba(250,250,250,0)",focusBackgroundBorder:a.focus,focusForeground:a.menuInv,activeBackground:a.menuInv,activeForeground:a.menu}},"Wn.MenuUser":{"Ui.Button":{borderWidth:0,showText:!1,background:Ui.Color.create(a.menu).addL(-0.2),
foreground:a.menuInv,activeForeground:a.menuInv,activeBackground:Ui.Color.create(a.menu).addL(-0.2),focusForeground:a.focusInv,focusActiveForeground:a.focusInv,focusActiveBackground:a.focus}},"Wn.MenuContact":{fontSize:14},"Wn.ContactArrow":{color:a.focus},"Storage.CurrentArrow":{color:a.focus},"Wn.PosButton":{borderWidth:b.thickness,backgroundBorder:a.foreground,foreground:a.background},"Wn.PosBar":{radius:b.roundness,current:a.focus,load:Ui.Color.create(a.background).addA(-0.5),background:a.foreground},
"Wn.StyleWallpaper":{backgroundBorder:"rgba(250,250,250,0)",padding:b.spacing,activeBackground:"rgba(250,250,250,0)",activeBackgroundBorder:a.active,focusActiveBackgroundBorder:a.focus,focusActiveBackground:Ui.Color.create(a.focus).addA(-0.5),radius:0,background:"rgba(250,250,250,0)",iconSize:64},"Storage.UploadView":{radius:Number.MAX_VALUE,background:a["default"],backgroundBorder:"rgba(250,250,250,0)",foreground:a.defaultInv,focusForeground:a.focusInv,badgeColor:a.focus,orientation:"vertical",whiteSpace:"pre-line",
iconSize:140,interLine:1.4,padding:20,textWidth:160},"Storage.FilePreview":{orientation:"vertical",whiteSpace:"pre-line",textWidth:80,iconSize:64,backgroundBorder:"rgba(250,250,250,0)"},"Calendar.DayGraph":{color:Ui.Color.create(a.foreground).addA(-0.4)},"Calendar.WeekGraph":{color:Ui.Color.create(a.foreground).addA(-0.4)},"Wn.CommentView":{orientation:"horizontal",iconSize:32,maxTextWidth:Number.MAX_VALUE},"Wn.ResourceContactRight":{orientation:"vertical",whiteSpace:"pre-line",textWidth:80},"Wn.AddContactIcon":{whiteSpace:"pre-line",
textWidth:80,maxLine:2}};this.setStyle(b)}});
var themes=[{title:"Elise",key:"elise",thickness:1,roundness:0,spacing:10,palette:{menu:"rgb(0,160,160)",menuInv:"rgb(255,255,255)",background:"rgb(241,241,241)",foreground:"rgb(102,102,102)",focus:"rgb(226,0,69)",focusInv:"rgb(255,255,255)",active:"rgb(33,211,255)","default":"rgb(0,160,160)",defaultInv:"rgb(255,255,255)",files:"rgb(102,102,102)",calendar:"#7A6FAB",news:"#FABB00",podcast:"#85B500"}},{title:"Pink World",key:"pink",thickness:1,roundness:0,spacing:10,palette:{menu:"rgb(220,220,220)",
menuInv:"rgb(80,80,80)",background:"rgb(241,241,241)",foreground:"rgb(102,102,102)",focus:"#ff80b0",focusInv:"rgb(255,255,255)",active:"#0288c9","default":"rgb(102,102,102)",defaultInv:"#ffe3ee",files:"#02a8fc",calendar:"#f7d30f",news:"#f94e81",podcast:"#99cb36"}},{title:"For\u00eat",key:"forest",thickness:1,roundness:0,spacing:10,palette:{menu:"#C2FFB3",menuInv:"#5b5756",background:"#dad9d4",foreground:"#5b5756",focus:"#8FCC48",focusInv:"rgb(255,255,255)",active:"#FF739A","default":"#998782",defaultInv:"#C2FFB3",
files:"#02a8fc",calendar:"#f7d30f",news:"#f94e81",podcast:"#99cb36"}},{title:"Dark Orange",key:"darkorange",thickness:2,roundness:0,spacing:10,palette:{menu:"#5a5a5a",menuInv:"#e4ba77",background:"#525250",foreground:"#dbd3ce",focus:"#ffa500",focusInv:"#ffffff",active:"#ff739a","default":"#ffc355",defaultInv:"#342200",files:"#02a8fc",calendar:"#f7d30f",news:"#f94e81",podcast:"#99cb36"}},{title:"Personnalis\u00e9e",key:"custom",thickness:1,roundness:0,spacing:10,palette:{menu:"#C2FFB3",menuInv:"#5b5756",
background:"#dad9d4",foreground:"#5b5756",focus:"#8FCC48",focusInv:"rgb(255,255,255)",active:"#FF739A","default":"#998782",defaultInv:"#C2FFB3",files:"#02a8fc",calendar:"#f7d30f",news:"#f94e81",podcast:"#99cb36"}}],app=new Wn.App({webApp:!0});
