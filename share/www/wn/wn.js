Core.Object.extend("Wn.RfidReader",{constructor:function(a){this.addEvents("enter")},fireEnter:function(a){this.fireEvent("enter",this,a)}});Core.Object.extend("Wn.RfidEvent",{prevent:!1,preventDefault:function(){this.prevent=!0},getPreventDefault:function(){return this.prevent}});
Core.Object.extend("Wn.Rfid",{constructor:function(a){this.addEvents("enter")},fireEnter:function(a){var b=new Wn.RfidEvent;this.fireEvent("enter",this,a,b)}},{},{supportRfid:!1,current:void 0,constructor:function(){Wn.Rfid.supportRfid="rfid"in window;Wn.Rfid.supportRfid&&window.rfid.setOnRfidEnter("Wn.Rfid.onRfidEnter");Wn.Rfid.current=new Wn.Rfid},onRfidEnter:function(a){Wn.Rfid.current.fireEnter.call(Wn.Rfid.current,a)}});Ui.CanvasElement.extend("Wn.DualIcon",{icon:void 0,fill:"#f1f1f1",stroke:"#000000",strokeWidth:2,constructor:function(a){this.icon=a.icon;delete a.icon},setFill:function(a){this.fill=a;this.invalidateDraw()},setStroke:function(a){this.stroke=a;this.invalidateDraw()},setStrokeWidth:function(a){this.strokeWidth=a;this.invalidateDraw()}},{updateCanvas:function(a){a.save();var b=Math.min(this.getLayoutWidth(),this.getLayoutHeight())/48;a.scale(b,b);a.translate(this.strokeWidth,this.strokeWidth);b=(48-
2*this.strokeWidth)/48;a.scale(b,b);a.svgPath(Ui.Icon.getPath(this.icon));a.strokeStyle=this.stroke;a.lineWidth=2*this.strokeWidth;a.stroke();a.fillStyle=this.fill;a.fill();a.restore()}});Ui.CanvasElement.extend("Wn.NewRibbon",{},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();a.fillStyle="#c240a3";a.beginPath();a.moveTo(0,0);a.lineTo(b/2,0);a.lineTo(b,c/2);a.lineTo(b,c);a.closePath();a.fill();a.translate((b/4+b)/2,3*c/4/2);a.fillStyle="#ffffff";a.rotate(Math.atan2(3*c/4,3*b/4));a.textAlign="center";a.textBaseline="middle";a.font="normal "+0.3*Math.min(b,c)+"px Ubuntu";a.fillText("Nouv.",0,0)}});Ui.Fold.extend("Wn.OptionSection",{title:void 0,arrow:void 0,optionContent:void 0,constructor:function(){this.setOver(!1);this.setIsFolded(!1);var a=new Ui.HBox;this.setHeader(a);this.arrow=new Ui.Icon({icon:"play",fill:"#666666",verticalAlign:"center",width:12,height:12});a.append(this.arrow);this.title=new Ui.Text({fontWeight:"bold",margin:5,color:"#666666",fontSize:20,verticalAlign:"center"});a.append(this.title,!0);this.optionContent=new Ui.LBox({paddingLeft:30});Wn.OptionSection.base.setContent.call(this,
this.optionContent)},setTitle:function(a){this.title.setText(a)}},{setContent:function(a){this.optionContent.setContent(a)},setOffset:function(a){Wn.OptionSection.base.setOffset.call(this,a);void 0!==this.arrow&&this.arrow.setTransform(Ui.Matrix.createRotate(90*a))}});Ui.CanvasElement.extend("Wn.ContentBgGraphic",{color:void 0,setColor:function(a){this.color=Ui.Color.create(a);this.invalidateDraw()}},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();a.roundRectFilledShadow(0,0,b,c,3,3,3,3,!1,2,new Ui.Color({a:0.2}));var d="rgb(240,240,240)";void 0!=this.color&&(d=this.color.getCssRgba());a.fillStyle=d;a.beginPath();a.roundRect(2,2,b-4,c-4,0,0,0,0);a.closePath();a.fill()}});Ui.Container.extend("Wn.ProgressBar",{value:0,bar:void 0,border:void 0,constructor:function(a){this.bar=new Ui.Rectangle({margin:1,height:4});this.appendChild(this.bar);this.border=new Ui.Frame({frameWidth:2});this.appendChild(this.border)},setValue:function(a){a!=this.value&&(this.value=a,a=this.getLayoutWidth()*this.value,2>a?this.bar.hide():(this.bar.show(),this.bar.arrange(0,0,a,this.getLayoutHeight())))},getValue:function(){return this.value}},{measureCore:function(a,b){var c=0,d=0,e;e=this.bar.measure(a,
b);c=Math.max(e.height,c);d=Math.max(e.width,d);e=this.border.measure(a,b);c=Math.max(e.height,c);d=Math.max(e.width,d);return{width:Math.max(d,12),height:c}},arrangeCore:function(a,b){this.border.arrange(0,0,a,b);var c=a*this.value;2>c?this.bar.hide():(this.bar.show(),this.bar.arrange(0,0,c,this.getLayoutHeight()))},onStyleChange:function(){var a=this.getStyleProperty("radius");this.bar.setRadius(a-1);this.bar.setFill(this.getStyleProperty("color"));this.border.setRadius(a);this.border.setFill(this.getStyleProperty("color"))}},
{style:{color:"#999999",radius:4}});Ui.Container.extend("Wn.MediaSlider",{value:0,background:void 0,button:void 0,constructor:function(a){this.addEvents("change");this.lightShadow=new Ui.Rectangle({fill:new Ui.Color({r:1,g:1,b:1,a:0.25}),radius:4});this.appendChild(this.lightShadow);this.darkShadow=new Ui.Rectangle({fill:new Ui.Color({r:0,g:0,b:0,a:0.4}),radius:4});this.appendChild(this.darkShadow);this.background=new Ui.Rectangle({fill:new Ui.Color({r:0.85,g:0.85,b:0.85}),radius:4});this.appendChild(this.background);this.backgroundShadow=
new Ui.Shadow({shadowWidth:2,inner:!0,radius:4,opacity:0.2});this.appendChild(this.backgroundShadow);this.barBox=new Ui.LBox;this.appendChild(this.barBox);this.barBackground=new Ui.Rectangle({radius:3});this.barBox.append(this.barBackground);this.bar=new Ui.Rectangle({margin:1,radius:3});this.barBox.append(this.bar);this.button=new Ui.Movable({moveVertical:!1});this.appendChild(this.button);this.connect(this.button,"move",this.onButtonMove);this.connect(this.button,"focus",this.updateColors);this.connect(this.button,
"blur",this.updateColors);this.connect(this.button,"down",this.updateColors);this.connect(this.button,"up",this.updateColors);this.buttonContent=new Ui.SliderContentDrawing({marginTop:5,marginLeft:10,marginRight:10});this.button.setContent(this.buttonContent)},getValue:function(){return this.value},setValue:function(a){this.value!=a&&(this.value=a,this.updateValue(),this.fireEvent("change",this))},onButtonMove:function(a){a=this.button.getPositionX();var b=this.getLayoutWidth()-44;0>a?a=0:a>b&&(a=
b);var c=this.value;this.value=a/b;this.disconnect(this.button,"move",this.onButtonMove);this.updateValue();this.connect(this.button,"move",this.onButtonMove);c!=this.value&&this.fireEvent("change",this)},updateValue:function(){var a=this.getLayoutWidth(),b=this.getLayoutHeight();this.button.setPosition((a-44)*this.value,void 0);this.barBox.arrange(18,(b-44)/2+18,(a-36)*this.value,9)},getGradient:function(){var a=this.getStyleProperty("color").getYuv();return new Ui.LinearGradient({stops:[{offset:0,
color:new Ui.Color({y:a.y+0.1,u:a.u,v:a.v})},{offset:1,color:new Ui.Color({y:a.y-0.1,u:a.u,v:a.v})}]})},getBarBorderColor:function(){var a=this.getStyleProperty("color").getYuv();return new Ui.Color({y:a.y-0.2,u:a.u,v:a.v})},getContentBorderColor:function(){var a=this.getStyleProperty("color").getYuv();return new Ui.Color({y:a.y-0.4,u:a.u,v:a.v})},getButtonColor:function(){var a=this.getStyleProperty("color").getYuv(),b=0;this.button.getIsDown()?b=-0.3:this.button.getHasFocus()&&(b=0.1);return new Ui.Color({y:a.y+
b,u:a.u,v:a.v})},updateColors:function(){this.bar.setFill(this.getGradient());this.barBackground.setFill(this.getBarBorderColor());this.buttonContent.setFill(this.getButtonColor())}},{measureCore:function(a,b){this.lightShadow.measure(a-34,10);this.darkShadow.measure(a-34,10);this.background.measure(a-36,10);this.backgroundShadow.measure(a-36,10);this.barBox.measure(a-38,9);this.button.measure(40,40);return{width:88,height:44}},arrangeCore:function(a,b){var c=(b-44)/2;this.lightShadow.arrange(17,
c+18,a-34,10);this.darkShadow.arrange(17,c+17,a-34,10);this.background.arrange(18,c+18,a-36,10);this.backgroundShadow.arrange(18,c+18,a-36,10);this.button.arrange(2,c+2,40,40);this.updateValue()},onStyleChange:function(){this.updateColors()},onDisable:function(){Ui.Slider.base.onDisable.call(this);this.button.setOpacity(0.2)},onEnable:function(){Wn.MediaSlider.base.onEnable.call(this);this.button.setOpacity(1)}},{style:{color:new Ui.Color({r:0.31,g:0.66,b:1})}});Ui.Html.extend("Wn.ImproveText",{text:"",constructor:function(){this.connect(this,"link",this.onLink)},generateHtml:function(a){var b=document.createElement("div");"textContent"in b?b.textContent=a:b.innerText=a;a=b.innerHTML;var c;c=navigator.supportRgba?this.getStyleProperty("color").getCssRgba():this.getStyleProperty("color").getCssHtml();var d;d=navigator.supportRgba?this.getStyleProperty("linkColor").getCssRgba():this.getStyleProperty("linkColor").getCssHtml();for(b="";-1!=a.indexOf("http://")||
-1!=a.indexOf("https://");){var e=a.indexOf("http://");-1==e?e=a.indexOf("https://"):-1!=a.indexOf("https://")&&a.indexOf("https://")<e&&(e=a.indexOf("https://"));for(var f=e,f=e;f<a.length&&" "!=a.charAt(f)&&"\t"!=a.charAt(f)&&"\n"!=a.charAt(f)&&'"'!=a.charAt(f)&&"'"!=a.charAt(f)&&"&"!=a.charAt(f);f++);var g=a.substr(e,f-e),b=b+a.substr(0,e),b=b+('<a href="'+g+'" style="cursor: pointer; text-decoration: underline; color: '+d+'">'+g+"</a>");a=a.substr(f)}b=(b+a).replace(RegExp("\n","g"),"<br>");a=
'<div style="word-wrap: break-word; font-family: '+this.getStyleProperty("fontFamily")+";font-size: "+this.getStyleProperty("fontSize")+"px;font-weight: "+this.getStyleProperty("fontWeight")+";color: "+c+';">';a+=b;return a+"</div>"},onLink:function(a,b){var c=b,d=c.lastIndexOf("#");-1!=d&&(c=c.substring(0,d));var e=(new Core.Uri).toString(),d=e.lastIndexOf("#");-1!=d&&(e=e.substring(0,d));c==e?(d=b.lastIndexOf("#"),-1!=d&&(c=b.substr(d+1),Ui.App.current.setMainPath(c))):window.open(b,"_blank")}},
{getText:function(){return this.text},setText:function(a){this.text=a;this.setHtml(this.generateHtml(this.text));this.invalidateMeasure()},onStyleChange:function(){this.setText(this.text)}},{style:{color:new Ui.Color({r:0,g:0,b:0}),fontSize:18,fontFamily:"Sans-serif",fontWeight:"normal",linkColor:new Ui.Color({r:0.3,g:0.3,b:0.3})}});Ui.DropBox.extend("Wn.FlowDropBox",{flow:void 0,fixed:void 0,marker:void 0,hideTimeout:void 0,constructor:function(a){this.addEvents("dropat");this.fixed=new Ui.Fixed;Wn.FlowDropBox.base.append.call(this,this.fixed);this.marker=new Ui.Frame({margin:2,frameWidth:2,radius:2,width:6,height:6,fill:new Ui.Color({r:0.4,g:0,b:0.35,a:0.8})});this.marker.hide();this.fixed.append(this.marker);this.flow=new Ui.Flow({uniform:!0});Wn.FlowDropBox.base.append.call(this,this.flow);this.connect(this,"dragover",this.onBoxDragOver);
this.connect(this,"drop",this.onBoxDrop)},setMarkerPos:function(a){void 0!=this.hideTimeout&&this.hideTimeout.abort();this.hideTimeout=new Core.DelayedTask({delay:1,scope:this,callback:this.markerHide});this.marker.show();if(a<this.flow.getChildren().length){var b=this.flow.getChildren()[a];a=b.getLayoutX()-b.getMarginLeft()-(this.marker.getLayoutWidth()+this.marker.getMarginLeft()+this.marker.getMarginRight())/2;var c=b.getLayoutY(),b=b.getLayoutHeight();this.marker.setHeight(b);this.fixed.setPosition(this.marker,
a,c)}else 0<this.flow.getChildren().length?(b=this.flow.getChildren()[this.flow.getChildren().length-1],a=b.getLayoutX()+b.getLayoutWidth()-this.marker.getLayoutWidth()/2,c=b.getLayoutY(),b=b.getLayoutHeight(),this.marker.setHeight(b),this.fixed.setPosition(this.marker,a,c)):this.markerHide()},markerHide:function(a){this.hideTimeout=void 0;this.marker.hide()},findPosition:function(a){for(var b=[],c=this.flow.getChildren(),d=0;d<c.length;d++)a.y>=c[d].getLayoutY()&&a.y<c[d].getLayoutY()+c[d].getLayoutHeight()&&
b.push(c[d]);for(var e=void 0,f=Number.MAX_VALUE,d=0;d<b.length;d++){var g=b[d].getLayoutX()+b[d].getLayoutWidth()/2,g=Math.abs(a.x-g);g<f&&(f=g,e=b[d])}void 0===e&&0<b.length&&(e=b[b.length-1]);d=c.length;if(void 0!==e){b=-1;for(d=0;-1==b&&d<c.length;d++)c[d]==e&&(b=d);d=a.x<e.getLayoutX()+e.getLayoutWidth()/2?b:b+1}return d},insertAt:function(a,b){this.flow.insertAt(a,b)},moveAt:function(a,b){this.flow.moveAt(a,b)},getLogicalChildren:function(){return this.flow.getChildren()},onBoxDragOver:function(a,
b,c){a=this.findPosition({x:b,y:c});this.checkPosition(a)?this.setMarkerPos(a):this.markerHide()},onBoxDrop:function(a,b,c,d,e){this.markerHide();a=this.findPosition({x:d,y:e});this.checkPosition(a)&&this.fireEvent("dropat",this,b,c,a)},checkPosition:function(a){return!0}},{setContent:function(a){this.flow.setContent(a)},append:function(a){this.flow.append(a)},remove:function(a){this.flow.remove(a)}});Ui.DropBox.extend("Wn.VDropBox",{vbox:void 0,fixed:void 0,marker:void 0,hideTimeout:void 0,constructor:function(a){this.addEvents("dropat");this.fixed=new Ui.Fixed;Wn.VDropBox.base.append.call(this,this.fixed);this.marker=new Ui.Frame({margin:2,frameWidth:2,radius:2,width:6,height:6,fill:new Ui.Color({r:0.4,g:0,b:0.35,a:0.8})});this.marker.hide();this.fixed.append(this.marker);this.vbox=new Ui.VBox({uniform:!0});Wn.VDropBox.base.append.call(this,this.vbox);this.connect(this,"dragover",this.onBoxDragOver);
this.connect(this,"drop",this.onBoxDrop)},setSpacing:function(a){this.vbox.setSpacing(a)},setMarkerPos:function(a){void 0!=this.hideTimeout&&this.hideTimeout.abort();this.hideTimeout=new Core.DelayedTask({delay:1,scope:this,callback:this.markerHide});this.marker.show();if(a<this.vbox.getChildren().length){a=this.vbox.getChildren()[a];var b=a.getLayoutX(),c=a.getLayoutY()-a.getMarginTop()-(this.marker.getLayoutHeight()+this.marker.getMarginTop()+this.marker.getMarginBottom())/2-this.vbox.getSpacing()/
2;this.marker.setWidth(a.getLayoutWidth());this.fixed.setPosition(this.marker,b,c)}else 0<this.vbox.getChildren().length?(a=this.vbox.getChildren()[this.vbox.getChildren().length-1],b=a.getLayoutX(),c=a.getLayoutY()+a.getLayoutHeight()-this.marker.getLayoutHeight()/2,this.marker.setWidth(a.getLayoutWidth()),this.fixed.setPosition(this.marker,b,c)):this.markerHide()},markerHide:function(a){this.hideTimeout=void 0;this.marker.hide()},findPosition:function(a){for(var b=this.vbox.getChildren(),c=void 0,
d=Number.MAX_VALUE,e=0;e<b.length;e++){var f=b[e].getLayoutY()+b[e].getLayoutHeight()/2,f=Math.abs(a.y-f);f<d&&(d=f,c=b[e])}void 0===c&&0<b.length&&(c=b[b.length-1]);e=b.length;if(void 0!==c){d=-1;for(e=0;-1===d&&e<b.length;e++)b[e]===c&&(d=e);e=a.y<c.getLayoutY()+c.getLayoutHeight()/2?d:d+1}return e},insertAt:function(a,b,c){this.vbox.insertAt(a,b,c)},moveAt:function(a,b){this.vbox.moveAt(a,b)},getLogicalChildren:function(){return this.vbox.getChildren()},onBoxDragOver:function(a,b,c){a=this.findPosition({x:b,
y:c});this.checkPosition(a)?this.setMarkerPos(a):this.markerHide()},onBoxDrop:function(a,b,c,d,e){this.markerHide();this.fireEvent("dropat",this,b,c,this.findPosition({x:d,y:e}))},checkPosition:function(a){return!0}},{setContent:function(a){this.vbox.setContent(a)},append:function(a,b){this.vbox.append(a,b)},remove:function(a){this.vbox.remove(a)}});Ui.DropBox.extend("Wn.HDropBox",{hbox:void 0,fixed:void 0,marker:void 0,hideTimeout:void 0,constructor:function(a){this.addEvents("dropat","dropfileat");this.fixed=new Ui.Fixed;Wn.HDropBox.base.append.call(this,this.fixed);this.marker=new Ui.Frame({margin:2,frameWidth:2,radius:2,width:6,height:6,fill:new Ui.Color({r:0.4,g:0,b:0.35,a:0.8})});this.marker.hide();this.fixed.append(this.marker);this.hbox=new Ui.HBox({uniform:!0});Wn.HDropBox.base.append.call(this,this.hbox);this.connect(this,"dragover",
this.onBoxDragOver);this.connect(this,"drop",this.onBoxDrop);this.connect(this,"dropfile",this.onBoxDropFile)},setSpacing:function(a){this.hbox.setSpacing(a)},setMarkerPos:function(a){void 0!=this.hideTimeout&&this.hideTimeout.abort();this.hideTimeout=new Core.DelayedTask({delay:1,scope:this,callback:this.markerHide});this.marker.show();if(a<this.hbox.getChildren().length){a=this.hbox.getChildren()[a];var b=a.getLayoutX()-a.getMarginLeft()-(this.marker.getLayoutWidth()+this.marker.getMarginLeft()+
this.marker.getMarginRight())/2-this.hbox.getSpacing()/2,c=a.getLayoutY();this.marker.setHeight(a.getLayoutHeight());this.fixed.setPosition(this.marker,b,c)}else 0<this.hbox.getChildren().length?(a=this.hbox.getChildren()[this.hbox.getChildren().length-1],b=a.getLayoutX()+a.getLayoutWidth()-this.marker.getLayoutWidth()/2,c=a.getLayoutY(),this.marker.setHeight(a.getLayoutHeight()),this.fixed.setPosition(this.marker,b,c)):this.markerHide()},markerHide:function(a){this.hideTimeout=void 0;this.marker.hide()},
findPosition:function(a){for(var b=this.hbox.getChildren(),c=void 0,d=Number.MAX_VALUE,e=0;e<b.length;e++){var f=b[e].getLayoutX()+b[e].getLayoutWidth()/2,f=Math.abs(a.x-f);f<d&&(d=f,c=b[e])}void 0===c&&0<b.length&&(c=b[b.length-1]);e=b.length;if(void 0!==c){d=-1;for(e=0;-1===d&&e<b.length;e++)b[e]===c&&(d=e);e=a.x<c.getLayoutX()+c.getLayoutWidth()/2?d:d+1}return e},insertAt:function(a,b,c){this.hbox.insertAt(a,b,c)},moveAt:function(a,b){this.hbox.moveAt(a,b)},getLogicalChildren:function(){return this.hbox.getChildren()},
onBoxDragOver:function(a,b,c){a=this.findPosition({x:b,y:c});this.checkPosition(a)?this.setMarkerPos(a):this.markerHide()},onBoxDrop:function(a,b,c,d,e){this.markerHide();this.fireEvent("dropat",this,b,c,this.findPosition({x:d,y:e}))},onBoxDropFile:function(a,b,c,d){this.markerHide();this.fireEvent("dropfileat",this,b,this.findPosition({x:c,y:d}))},checkPosition:function(a){return!0}},{setContent:function(a){this.hbox.setContent(a)},append:function(a,b){this.hbox.append(a,b)},remove:function(a){this.hbox.remove(a)}});Ui.Movable.extend("Wn.CarouselContent",{constructor:function(a){this.setInertia(!1);this.setMoveVertical(!1);this.setDirectionRelease(!0);this.setFocusable(!1);this.setLock(!0)}});
Ui.Container.extend("Wn.Carouselable",{alignClock:void 0,speed:0,ease:void 0,transition:void 0,transitionClock:void 0,position:-1,startTime:void 0,lastTime:void 0,itemWidth:0,itemHeight:0,current:void 0,nextItem:void 0,nextPosition:void 0,delta:0,startDelta:0,endDelta:0,constructor:function(a){this.addEvents("change","press","activate");this.setClipToBounds(!0);this.setFocusable(!0);this.connect(this.getDrawing(),"keydown",this.onKeyDown);this.connect(this.getDrawing(),"keyup",this.onKeyUp);this.transition=
Ui.Transition.create("fade");this.ease=Anim.EasingFunction.create({type:Anim.PowerEase,mode:"out"})},getCurrent:function(){return-1==this.position?void 0:this.items[this.getCurrentPosition()]},getCurrentPosition:function(){return this.position},setCurrentAt:function(a){console.log(this+".setCurrentAt("+a+")");a=Math.min(this.getChildren().length-1,Math.max(0,a));var b=this.getChildren()[a];-1==this.position?(b.show(),this.current=b,this.position=a,this.connect(this.current,"down",this.onDown),this.connect(this.current,
"move",this.onMove),this.connect(this.current,"up",this.onUp),this.current.setLock(!1),this.updateShow()):a===this.position+1?this.next():a===this.position-1?this.previous():(this.nextItem=this.getChildren()[a],this.nextItem.show(),this.nextPosition=a,this.transition.run(this.current,this.nextItem,0),this.transitionClock=new Anim.Clock({duration:0.5,scope:this,onTimeupdate:this.onTransitionTick,ease:this.ease}),this.connect(this.transitionClock,"complete",this.onTransitionComplete),this.transitionClock.begin())},
setCurrent:function(a){for(var b=0;b<this.getChildren().length;b++)if(this.getChildren()[b].getContent()==a){this.setCurrentAt(b);break}},next:function(){void 0===this.alignClock&&this.position+1<this.getChildren().length&&this.startAnimation(-1,-1)},previous:function(){void 0===this.alignClock&&0<this.position&&this.startAnimation(1,1)},setEase:function(a){this.ease=Anim.EasingFunction.create(a)},append:function(a){var b=new Wn.CarouselContent;b.setContent(Ui.Element.create(a));b.hide();this.appendChild(b)},
remove:function(a){for(var b=0;b<this.getChildren().length;b++)if(this.getChildren()[b].getChildren()[0]==a){this.getChildren()[b].remove(a);this.removeChild(this.getChildren()[b]);break}},insertAt:function(a,b){var c=new Wn.CarouselContent;c.setContent(Ui.Element.create(a));c.hide();this.insertChildAt(c,b)},moveAt:function(a,b){for(var c=0;c<this.getChildren().length;c++)if(this.getChildren()[c].getChildren()[0]==a){this.moveChildAt(this.getChildren()[c],b);break}},getLogicalChildren:function(){for(var a=
[],b=0;b<this.getChildren().length;b++)a.push(this.getChildren()[b].getContent());console.log(this+".getLogicalChildren length: "+a.length);return a},onKeyDown:function(a){if(!this.getIsDisabled()){var b=a.which;if(32==b||37==b||39==b)a.stopPropagation(),a.preventDefault();32==b?this.next():37==b?this.previous():39==b&&this.next()}},onKeyUp:function(a){this.getIsDisabled()||13!=a.which||(a.stopPropagation(),a.preventDefault(),this.fireEvent("activate",this))},onMove:function(a){this.disconnect(a,
"move",this.onMove);var b=a.getPositionX()/a.getLayoutWidth();-1>b?(a.setPosition(-a.getLayoutWidth(),void 0),b=-1):1<b&&(a.setPosition(a.getLayoutWidth(),void 0),b=1);0==this.position&&0<b?(a.setPosition(0,void 0),b=0):this.position==this.getChildren().length-1&&0>b&&(a.setPosition(0,void 0),b=0);this.delta=b;this.updateShow();this.connect(a,"move",this.onMove)},updateShow:function(){console.log("updateShow");var a=void 0,b=void 0,c=this.getLayoutWidth();0<this.position&&(a=this.getChildren()[this.position-
1]);this.position<this.getChildren().length-1&&(b=this.getChildren()[this.position+1]);this.current.setPosition(this.delta*c);0==this.delta?(void 0!==a&&a.hide(),void 0!==b&&b.hide()):0<this.delta?(void 0!==b&&b.hide(),void 0!==a&&(a.show(),a.setPosition((this.delta-1)*c))):(void 0!==a&&a.hide(),void 0!==b&&(b.show(),b.setPosition((this.delta+1)*c)))},onDown:function(a){this.startTime=(new Date).getTime()/1E3;this.stopAnimation()},onUp:function(a,b,c,d,e,f,g){a=(new Date).getTime()/1E3-this.startTime;
!g&&0.25>a&&10>f&&(this.fireEvent("press",this),this.focus(),f=(new Date).getTime()/1E3,void 0!=this.lastTime&&0.25>f-this.lastTime&&this.fireEvent("activate",this),this.lastTime=f);f=void 0;100>Math.abs(b)?(console.log("too slow"),0<this.delta?0.5<this.delta?(b=400,f=1):(b=-400,f=0):-0.5>this.delta?(b=-400,f=-1):(b=400,f=0)):800>Math.abs(b)&&(b=0>b?-800:800);0!=b&&this.startAnimation(b/this.getLayoutWidth(),f)},onChange:function(){void 0!==this.current&&(this.disconnect(this.current,"down",this.onDown),
this.disconnect(this.current,"move",this.onMove),this.disconnect(this.current,"up",this.onUp));0>this.delta?this.position+1<this.getChildren().length?(this.position++,this.current=this.getChildren()[this.position]):(this.position=-1,this.current=void 0):0<this.delta&&(0<this.position?(this.position--,this.current=this.getChildren()[this.position]):(this.position=-1,this.current=void 0));this.delta=0;console.log("onChange delta: "+this.delta+", new: "+this.current+", pos: "+this.position);void 0!==
this.current&&(this.connect(this.current,"down",this.onDown),this.connect(this.current,"move",this.onMove),this.connect(this.current,"up",this.onUp),this.updateShow(),this.current.setLock(!1));this.fireEvent("change",this,this.getCurrentPosition())},onAlignTick:function(a,b,c){if(0!=c)if(a=a.getTime()*Math.abs(this.speed),1<=a&&(this.alignClock.stop(),this.alignClock=void 0,a=1),a=this.ease.ease(a),this.delta=this.startDelta+a*(this.endDelta-this.startDelta),void 0==this.alignClock)this.onChange();
else this.disconnect(this.current,"move",this.onMove),this.updateShow(),this.connect(this.current,"move",this.onMove)},startAnimation:function(a,b){this.stopAnimation();this.speed=a;this.startDelta=this.delta;this.endDelta=void 0===b?0>this.speed?-1:1:b;console.log("startAnimation("+a+") start: "+this.delta+", end: "+this.endDelta);this.startDelta!=this.endDelta&&(this.alignClock=new Anim.Clock({duration:"forever",scope:this,target:this,onTimeupdate:this.onAlignTick}),this.alignClock.begin())},stopAnimation:function(){void 0!=
this.alignClock&&(this.alignClock.stop(),this.alignClock=void 0)},onTransitionTick:function(a,b){this.transition.run(this.current,this.nextItem,b)},onTransitionComplete:function(a){this.transitionClock=void 0;void 0!=this.current&&this.current.hide();this.current=this.nextItem;this.position=this.nextPosition;this.delta=0;this.position=this.nextPosition;this.updateShow()}},{measureCore:function(a,b){for(var c=0,d=0,e=0;e<this.getChildren().length;e++){var f=this.getChildren()[e].measure(a,b);f.width>
c&&(c=f.width);f.height>d&&(d=f.height)}console.log("measure => "+c+" x "+d);return{width:c,height:d}},arrangeCore:function(a,b){for(var c=0;c<this.getChildren().length;c++)this.getChildren()[c].arrange(0,0,a,b)}});Wn.Carouselable.extend("Wn.Carousel",{constructor:function(a){}});Ui.LBox.extend("Wn.GroupIconView",{label:void 0,constructor:function(a){a=new Wn.DualIcon({icon:"group",width:48,height:48,strokeWidth:2});this.append(a);this.label=new Ui.Label({fontSize:12,fontWeight:"bold",horizontalAlign:"center",verticalAlign:"bottom",marginBottom:12,color:"black"});this.append(this.label)},setValue:function(a){this.label.setText(a.toString())}});Core.Object.extend("Wn.Resource",{id:void 0,ready:!1,data:void 0,deleted:!1,request:void 0,user:void 0,constructor:function(a){this.addEvents("ready","change","delete","error");this.user=a.user;delete a.user;"resource"in a?(this.id=a.resource.id,this.updateData(a.resource),delete a.resource):"id"in a&&(this.id=a.id,delete a.id,this.data={},this.update())},getIsReady:function(){return this.ready},getIsDeleted:function(){return this.deleted},getIsMonitored:function(){if(!("owner_id"in this.data))return!1;
var a=Ui.App.current.getUser().getContact(this.data.owner_id);return void 0===a?!1:a.getResource(this.id)===this},getId:function(){return this.id},getType:function(){return this.data.type},getOwnerId:function(){return this.data.owner_id},getStorageId:function(){return this.data.storage_id},getRights:function(){return this.data.rights},getRev:function(){return this.data.rev},getSeenByMeRev:function(){return this.data.seenByMeRev},addRights:function(a){(new Core.HttpRequest({method:"POST",url:"/cloud/resource/"+
this.id+"/rights",content:JSON.stringify(a)})).send()},getPublicRights:function(){return{read:this.data.public_read,write:this.data.public_write,share:this.data.public_share}},addPublicRights:function(a){(new Core.HttpRequest({method:"PUT",url:"/cloud/resource/"+this.id,content:JSON.stringify({public_read:a.read,public_write:a.write,public_share:a.share})})).send()},changeData:function(a){a=new Core.HttpRequest({method:"PUT",url:"/cloud/resource/"+this.id,content:JSON.stringify(a)});this.connect(a,
"done",this.onChangeDataDone);a.send()},markSeenByMe:function(){if(this.data.rev!=this.data.seenByMeRev){var a=new Core.HttpRequest({method:"PUT",url:"/cloud/resource/"+this.id+"?seenBy="+this.user.getId(),content:JSON.stringify({seenByMeRev:this.data.rev})});this.connect(a,"done",this.onMarkSeenByMeDone);a.send()}},onMarkSeenByMeDone:function(a){this.updateData(a.getResponseJSON())},onChangeDataDone:function(a){this.updateData(a.getResponseJSON())},canShare:function(){var a=this.user.getId();if(this.data.public_share||
this.data.owner_id==a)return!0;for(var b=0;b<this.data.rights.length;b++){var c=this.data.rights[b];if(c.user_id==a)return c.share}return!1},canWrite:function(){var a=this.user.getId();if(this.data.public_write||this.data.owner_id==a)return!0;for(var b=0;b<this.data.rights.length;b++){var c=this.data.rights[b];if(c.user_id==a)return c.write}return!1},getData:function(){return this.data},getName:function(){return this.data.name},getBookmark:function(){for(var a=0;a<this.user.getBookmarks().length;a++)if(this.user.getBookmarks()[a].getId()==
this.getId())return!0;return!1},deleteResource:function(){var a=new Core.HttpRequest({method:"DELETE",url:"/cloud/resource/"+this.id});this.connect(a,"done",function(){this.fireEvent("delete",this)});a.send()},update:function(){void 0===this.request&&(this.request=new Core.HttpRequest({url:"/cloud/resource/"+this.id+"?seenBy="+this.user.getId()}),this.connect(this.request,"done",this.onGetDataDone),this.connect(this.request,"error",this.onGetDataError),this.request.send())},updateData:function(a){if(void 0===
this.data||JSON.stringify(this.data)!=JSON.stringify(a))this.data=a,this.ready||(this.ready=!0,this.fireEvent("ready",this)),this.fireEvent("change",this)},onGetDataError:function(a){this.ready=!0;404==a.getStatus()||403==a.getStatus()?(this.fireEvent("delete",this),this.deleted=!0,this.getBookmark()&&this.user.unbookmarkResource(this)):this.fireEvent("error",this);this.request=void 0},onGetDataDone:function(a){a=a.getResponseJSON();this.updateData(a);this.request=void 0}},{},{getResource:function(a,
b,c){var d=void 0;void 0===b&&(b=Ui.App.current.getUser());d=b.getResource(a);if(void 0===d)for(var e=0;void 0===d&&e<b.getContacts().length;e++)d=b.getContacts()[e].getResource(a);void 0!==d||c||(d=new Wn.Resource({id:a,user:b}));return d}});Ui.Pressable.extend("Wn.UserFace",{user:void 0,image:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setVerticalAlign("center");this.connect(this,"press",this.onUserPress);this.append(new Ui.Rectangle({fill:"#999999"}));this.append(new Ui.Rectangle({fill:"#f1f1f1",margin:1}));this.image=new Ui.Image({width:46,height:46,margin:1,src:this.user.getFaceUrl()});this.append(this.image)},onUserChange:function(){this.image.setSrc(this.user.getFaceUrl())},onUserPress:function(){Ui.App.current.setMainPath("user:"+
this.user.getId())}},{onLoad:function(){Wn.UserFace.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange)},onUnload:function(){Wn.UserFace.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange)}});Ui.CanvasElement.extend("Wn.ResourceViewGraphic",{text:"",icon:void 0,image:void 0,shareMode:"group",shareCount:0,userImage:void 0,constructor:function(a){},setTitle:function(a){this.title=a;this.invalidateDraw()},setShareMode:function(a){this.shareMode=a;this.invalidateDraw()},setShareCount:function(a){this.shareCount=a;this.invalidateDraw()},setIcon:function(a){this.icon=a;this.invalidateDraw()},setPreviewImage:function(a){void 0==this.image&&(this.image=new Ui.Image,this.appendChild(this.image));
this.image.setSrc(a);this.image.getIsReady()?this.invalidateDraw():this.connect(this.image,"ready",this.invalidateDraw)},setUserImage:function(a){void 0===this.userImage?(this.userImage=new Ui.Image({src:a}),this.appendChild(this.userImage),this.connect(this.userImage,"ready",this.invalidateDraw)):this.userImage.getSrc()!==a&&this.userImage.setSrc(a)}},{measureCore:function(a,b){return{width:20,height:44}},updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();a.roundRectFilledShadow(1,
1,b-2,c-2,3,3,3,3,!1,2,new Ui.Color({r:0,g:0,b:0,a:0.2}));a.fillStyle="rgb(240, 240, 240)";a.beginPath();a.rect(3,3,b-6,c-6);a.closePath();a.fill();a.fillStyle="rgb(60, 60, 60)";a.beginPath();a.rect(3,3,b-6,46);a.closePath();a.fill();a.save();a.beginPath();a.rect(3,3,b-6,46);a.closePath();a.clip();a.fillStyle="#f8f8f8";a.textBaseline="alphabetic";a.font="normal 24px Ubuntu";a.fillText(this.title,10,34);a.restore();var d=a.createLinearGradient(b-43,3,b-3,3);d.addColorStop(0,"rgba(60, 60, 60, 0)");
d.addColorStop(0.9,"rgb(60, 60, 60)");d.addColorStop(1,"rgb(60, 60, 60)");a.fillStyle=d;a.beginPath();a.rect(b-43,3,40,46);a.closePath();a.fill();if(void 0!=this.image&&this.image.getIsReady()){a.save();var e=b-6,f=c-52,g=e/f,k=this.image.getNaturalWidth()/this.image.getNaturalHeight(),h=this.image.getNaturalWidth(),l=this.image.getNaturalHeight(),m=0,n=0;k>g?(n=0,l=this.image.getNaturalHeight(),h=l*g,m=(this.image.getNaturalWidth()-h)/2):(m=0,h=this.image.getNaturalWidth(),l=h/g,n=0);a.drawImage(this.image.getDrawing(),
m,n,h,l,5,51,e-4,f-4);a.restore()}else void 0!=this.icon&&(d=Ui.Icon.getPath(this.icon),e=2,a.save(),a.translate((b-96)/2,(46+c-96)/2),a.scale(e,e),a.fillStyle="rgb(60, 60, 60)",a.beginPath(),a.svgPath(d),a.closePath(),a.fill(),a.restore());d=0;void 0!=this.userImage&&this.userImage.getIsReady()&&(a.save(),a.translate(b-56,c-56),f=e=36,g=e/f,k=this.userImage.getNaturalWidth()/this.userImage.getNaturalHeight(),this.userImage.getNaturalWidth(),this.userImage.getNaturalHeight(),a.fillStyle="rgb(60,60,60)",
a.fillRect(2,2,44,44),a.fillStyle="white",a.fillRect(4,4,40,40),k>g?(n=0,l=this.userImage.getNaturalHeight(),h=l*g,m=(this.userImage.getNaturalWidth()-h)/2):(m=0,h=this.userImage.getNaturalWidth(),l=h/g,n=(this.userImage.getNaturalHeight()-l)/2),a.drawImage(this.userImage.getDrawing(),m,n,h,l,6,6,e,f),a.restore(),d+=48);"public"==this.shareMode?(f=2,a.save(),a.translate(b-(56+d),c-56),e=Math.min(48,48)/48,a.scale(e,e),a.translate(f,f),e=(48-2*f)/48,a.scale(e,e),a.svgPath(Ui.Icon.getPath("earth")),
a.strokeStyle="rgb(60,60,60)",a.lineWidth=2*f,a.stroke(),a.fillStyle="white",a.fill(),a.restore()):0<this.shareCount&&(f=2,a.save(),a.translate(b-(56+d),c-56),e=Math.min(48,48)/48,a.scale(e,e),a.translate(f,f),e=(48-2*f)/48,a.scale(e,e),a.svgPath(Ui.Icon.getPath("group")),a.strokeStyle="rgb(60,60,60)",a.lineWidth=2*f,a.stroke(),a.fillStyle="white",a.fill(),a.restore(),a.save(),a.translate(b-8-24-d,c-8-16),a.fillStyle="rgb(60,60,60)",a.textBaseline="middle",a.textAlign="center",a.font="normal 700 12px Ubuntu",
a.fillText(this.shareCount,0,0),a.restore())}});Ui.Selectionable.extend("Wn.ResourceView",{user:void 0,contact:void 0,resource:void 0,contactface:void 0,title:void 0,previewBox:void 0,newicon:void 0,graphic:void 0,constructor:function(a){this.user=a.user;delete a.user;"contact"in a&&(this.contact=a.contact,delete a.contact);this.resource=a.resource;delete a.resource;this.setData(this);a=new Ui.DropBox;a.addMimetype("Wn.MenuContactIcon");this.connect(a,"drop",this.onUserDrop);this.append(a);this.graphic=new Wn.ResourceViewGraphic;a.append(this.graphic);
this.newicon=new Wn.NewRibbon({width:54,height:54,verticalAlign:"top",horizontalAlign:"right",margin:2});this.append(this.newicon);this.connect(this,"press",this.onResourcePress)},getGraphic:function(){return this.graphic},getResource:function(){return this.resource},onUserDrop:function(a,b,c){this.resource.canShare()&&(a={user_id:c.getContact().getId(),read:!0,share:this.user.getData().default_share_right},this.resource.canWrite()&&this.user.getData().default_write_right&&(a.write=!0),this.resource.addRights(a))},
onResourceChange:function(){this.resource.getIsReady()&&(this.resource.getOwnerId()!=this.user.getId()&&(void 0==this.contact&&(this.contact=Wn.Contact.getContact(this.resource.getOwnerId())),this.graphic.setUserImage(this.contact.getFaceUrl())),this.graphic.setTitle(this.resource.getName()),this.resource.getSeenByMeRev()!=this.resource.getRev()?this.newicon.show():this.newicon.hide(),this.graphic.setShareCount(this.resource.getRights().length),this.resource.getPublicRights().read?this.graphic.setShareMode("public"):
this.graphic.setShareMode("group"))},onResourcePress:function(){Ui.App.current.setMainPath("resource:"+this.resource.getId())},onResourceEdit:function(){(new Wn.ResourcePropertiesDialog({user:this.user,resource:this.resource})).open()},onResourceDelete:function(){(new Wn.ResourceDeleteDialog({resource:this.resource})).open()},testDeleteRight:function(){return Ui.App.current.getUser().isAdmin()||this.resource.canWrite()}},{getSelectionActions:function(){return{"delete":{text:"Supprimer",icon:"trash",
color:"#d02020",testRight:this.testDeleteRight,scope:this,callback:this.onResourceDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onResourceEdit,multiple:!1}}},onLoad:function(){Wn.ResourceView.base.onLoad.call(this);this.connect(this.resource,"change",this.onResourceChange);this.onResourceChange()},onUnload:function(){Wn.ResourceView.base.onUnload.call(this);this.disconnect(this.resource,"change",this.onResourceChange)}},{views:void 0,constructor:function(){this.views=
{}},register:function(a,b){Wn.ResourceView.views[a]=b},getView:function(a){return Wn.ResourceView.views[a]}});Ui.CanvasElement.extend("Wn.AppViewGraphic",{icon:void 0,constructor:function(a){},setIcon:function(a){this.icon=a;this.invalidateDraw()}},{measureCore:function(a,b){return{width:120,height:120}},updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();a.roundRectFilledShadow(1,1,b-2,c-2,3,3,3,3,!1,2,new Ui.Color({r:0,g:0,b:0,a:0.2}));a.fillStyle="rgb(240, 240, 240)";a.beginPath();a.roundRect(3,3,b-6,c-6,0,0,0,0);a.closePath();a.fill();if(void 0!==this.icon){var d=Ui.Icon.getPath(this.icon),
e=100/48;a.save();a.translate((b-100)/2,(c-100)/2-1);a.scale(e,e);a.fillStyle="rgb(60, 60, 60)";a.beginPath();a.svgPath(d);a.closePath();a.fill();a.restore()}}});Core.Object.extend("Wn.Contact",{id:void 0,data:void 0,ready:!1,request:void 0,resources:void 0,user:void 0,constructor:function(a){this.addEvents("ready","error","change","delete","resourcechange");this.resources=[];this.user=a.user;delete a.user;"contact"in a?(this.data=a.contact,delete a.contact,this.id=this.data.id,this.updateData(this.data)):"id"in a&&(this.id=a.id,delete a.id,this.update());if(void 0===this.id)throw"Wn.Contact id not set";},getIsReady:function(){return this.ready},getIsMonitored:function(){return Ui.App.current.getUser().getContact(this.id)===
this},setIsOnline:function(a){this.data.online=a;this.fireEvent("change",this)},getIsOnline:function(){return this.data.online},getFirstname:function(){return this.data.firstname},getLastname:function(){return this.data.lastname},update:function(){void 0===this.request&&(this.request=new Core.HttpRequest({url:"/cloud/user/"+this.id+"?seenby="+this.user.getId()}),this.connect(this.request,"done",this.onGetDataDone),this.connect(this.request,"error",this.onGetDataError),this.request.send())},updateData:function(a){for(var b=
[],c=0;c<this.resources.length;c++)delete this.resources[c].wnContactSeen;for(c=0;c<a.resources.length;c++){for(var d=void 0,e=0;void 0===d&&e<this.resources.length;e++)this.resources[e].getId()===a.resources[c].id&&(d=this.resources[e]);void 0!==d?d.updateData(a.resources[c]):(d=new Wn.Resource({resource:a.resources[c],user:this.user}),this.connect(d,"change",this.onResourceChange));d.wnContactSeen=!0;b.push(d)}for(c=0;c<this.resources.length;c++)!0!==this.resources[c].wnContactSeen&&this.disconnect(this.resources[c],
"change",this.onResourceChange);this.resources=b;this.data=a;this.ready||(this.ready=!0,this.fireEvent("ready",this));this.fireEvent("change",this)},getId:function(){return this.id},getData:function(){return this.data},getFaceUrl:function(){return void 0!==this.data&&void 0!==this.data.face_rev?"/cloud/user/"+this.id+"/face?rev="+this.data.face_rev:"/cloud/user/"+this.id+"/face"},getPosition:function(){return this.data.position},getResources:function(){return this.resources},getResource:function(a){for(var b=
0;b<this.resources.length;b++)if(this.resources[b].getId()===a)return this.resources[b]},onGetDataError:function(a){404==a.getStatus()?this.fireEvent("delete",this):this.fireEvent("error",this);this.request=void 0},onGetDataDone:function(a){a=a.getResponseJSON();this.updateData(a);this.request=void 0},onResourceChange:function(a){this.fireEvent("resourcechange",this,a)}},{},{getContact:function(a,b){var c=Ui.App.current.getUser().getContact(a);void 0!==c||b||(c=new Wn.Contact({id:a,user:Ui.App.current.getUser()}));
return c}});Ui.LBox.extend("Wn.ContactNewMessage",{user:void 0,contact:void 0,userface:void 0,textfield:void 0,sendButton:void 0,text:void 0,request:void 0,vbox:void 0,constructor:function(a){this.addEvents("new");this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.append(new Wn.ContentBgGraphic);var b=new Ui.VBox;this.vbox=b;this.append(b);a=new Ui.HBox;b.append(a,!0);b=new Ui.LBox({verticalAlign:"top",horizontalAlign:"right",margin:8});a.append(b);b.append(new Ui.Rectangle({fill:"#999999"}));
b.append(new Ui.Rectangle({fill:"#f1f1f1",margin:1}));this.userface=new Ui.Image({width:32,height:32,margin:1});b.append(this.userface);this.textfield=new Ui.TextAreaField({margin:10,marginLeft:0,textHolder:"Un message ?"});this.connect(this.textfield.textarea,"focus",this.onTextAreaFocus);this.connect(this.textfield.textarea,"blur",this.onTextAreaBlur);this.connect(this.textfield,"change",function(a,b){""==b?this.sendButton.disable():this.sendButton.enable()});a.append(this.textfield,!0);this.sendButton=
new Ui.Button({text:"Envoyer",horizontalAlign:"right",marginBottom:10,marginRight:10});this.sendButton.disable();this.connect(this.sendButton,"press",this.onButtonPress)},onTextAreaFocus:function(){void 0==this.sendButton.getParent()&&this.vbox.append(this.sendButton)},onTextAreaBlur:function(){void 0!==this.sendButton.getParent()&&""===this.textfield.getValue()&&this.vbox.remove(this.sendButton)},onUserChange:function(){void 0!=this.user.getFaceUrl()&&this.userface.setSrc(this.user.getFaceUrl())},
onButtonPress:function(){this.text=this.textfield.getValue();this.request=this.user.sendMessage(this.contact,this.text);this.connect(this.request,"done",this.onRequestDone);this.connect(this.request,"error",this.onRequestError);this.disable()},onRequestDone:function(){console.log(this+".onRequestDone");this.fireEvent("new",this,this.text);this.textfield.setValue("");this.enable();this.request=void 0},onRequestError:function(){console.log(this+".onRequestError");this.textfield.setValue("");this.enable();
this.request=void 0}},{onLoad:function(){Wn.ContactNewMessage.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},onUnload:function(){Wn.ContactNewMessage.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange)}});
Ui.Pressable.extend("Wn.UserMessageView",{user:void 0,userface:void 0,message:void 0,dialog:void 0,contactface:void 0,contact:void 0,previewBox:void 0,label:void 0,dateLabel:void 0,constructor:function(a){this.user=a.user;delete a.user;this.message=a.message;delete a.message;"dialog"in a&&(this.dialog=a.dialog,delete a.dialog);this.append(new Wn.ContentBgGraphic);a=new Ui.VBox;this.append(a);var b=new Ui.HBox;a.append(b);var c=new Ui.LBox({verticalAlign:"top",horizontalAlign:"right",margin:8});b.append(c);
c.append(new Ui.Rectangle({fill:"#999999"}));c.append(new Ui.Rectangle({fill:"#f1f1f1",margin:1}));this.userface=new Ui.Image({width:32,height:32,margin:1});c.append(this.userface);"message"===this.message.getType()||"comment"===this.message.getType()?this.label=new Wn.ImproveText({margin:10,marginRight:0,text:""}):this.label=new Ui.Text({margin:10,marginRight:0,text:""});b.append(this.label,!0);"message"==this.message.getType()&&this.label.setText(this.message.getContent());this.message.getOrigin()===
this.user.getId()?this.contact=Wn.Contact.getContact(this.message.getDestination()):this.contact=Wn.Contact.getContact(this.message.getOrigin());c=new Ui.LBox({verticalAlign:"top",horizontalAlign:"right",margin:8});b.append(c);c.append(new Ui.Rectangle({fill:"#999999"}));c.append(new Ui.Rectangle({fill:"#f1f1f1",margin:1}));this.contactface=new Ui.Image({width:32,height:32,margin:1});c.append(this.contactface);this.contactface.setSrc(this.contact.getFaceUrl());var d=new Date-this.message.getDate(),
b=Math.floor(d/864E5),c=Math.floor(d/36E5),d=Math.floor(d/6E4),e="il y a ";this.dateLabel=new Ui.Label({opacity:0.8,fontSize:10,horizontalAlign:"left",marginLeft:8,marginBottom:8,text:0<b?e+(b+" jours"):0<c?e+(c+" heures"):e+(d+" minutes")});a.append(this.dateLabel);this.setLock("contact"!==this.message.getType()&&"resource"!==this.message.getType()&&"comment"!==this.message.getType());this.connect(this,"press",this.onMessageViewPress);"comment"==this.message.getType()&&(this.resource=this.user.getResourceAndPathFromData(this.message.getContent()).resource)},
onContactChange:function(){var a;if(this.message.getOrigin()==this.user.getId()){var b=this.contact.getFirstname()+" "+this.contact.getLastname()+" ";a="Vous avez ";a="resource"==this.message.getType()?a+('partag\u00e9 la ressouce "'+this.message.getContent().name+'" avec '+b):"contact"==this.message.getType()?a+("ajout\u00e9 "+b+" \u00e0 vos contacts"):"comment"==this.message.getType()?a+(' laiss\u00e9 un commentaire sur la ressource "'+this.message.getContent().resource.name+'"'):this.message.getContent()}else a=
this.contact.getFirstname()+" "+this.contact.getLastname()+" ",a="resource"==this.message.getType()?a+('vous a partag\u00e9 la ressouce "'+this.message.getContent().name+'"'):"contact"==this.message.getType()?a+"vous a ajout\u00e9 \u00e0 ses contacts":"comment"==this.message.getType()?a+('\u00e0 laiss\u00e9 un commentaire sur la ressource "'+this.message.getContent().resource.name+'"'):this.message.getContent();this.label.setText(a)},onMessageViewPress:function(){if("resource"==this.message.getType())Ui.App.current.setMainPath("resource:"+
this.message.getContent().id),void 0!==this.dialog&&this.dialog.close();else if("comment"==this.message.getType()){var a=this.user.getResourceAndPathFromData(this.message.getContent());void 0!=a.resource&&(Ui.App.current.setMainPath("resource:"+a.resource.getId()+":"+a.path),void 0!==this.dialog&&this.dialog.close())}else"contact"==this.message.getType()&&(Ui.App.current.setMainPath("user:"+this.contact.getId()),void 0!==this.dialog&&this.dialog.close())},onUserChange:function(){void 0!=this.user.getFaceUrl()&&
this.userface.setSrc(this.user.getFaceUrl())},getMessage:function(){return this.message}},{onLoad:function(){Wn.UserMessageView.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange();if(void 0!=this.contact){if(this.contact.getIsReady())this.onContactChange();this.connect(this.contact,"change",this.onContactChange)}},onUnload:function(){Wn.UserMessageView.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange);void 0!=this.contact&&this.disconnect(this.contact,
"change",this.onContactChange)}});
Ui.Dialog.extend("Wn.ContactMessagesDialog",{user:void 0,contact:void 0,messagesView:void 0,startMessageId:-1,messageRequest:void 0,messages:void 0,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.setFullScrolling(!0);this.setTitle("Messages");this.setPreferedWidth(600);this.setPreferedHeight(600);a=new Ui.Button({text:"Fermer"});this.connect(a,"press",function(){this.close()});this.setCancelButton(a);a=new Ui.VBox({margin:10,spacing:10});this.setContent(a);
a.append(new Wn.ContactNewMessage({user:this.user,contact:this.contact,marginRight:80}));this.messagesView=new Ui.VBox({spacing:10});a.append(this.messagesView);this.updateMessages()},updateMessages:function(){void 0!==this.messagesRequest&&(this.disconnect(this.messagesRequest,"done",this.onGetMessagesDone),this.disconnect(this.messagesRequest,"error",this.onGetMessagesError),this.messagesRequest.abort());this.messagesRequest=new Core.HttpRequest({url:"/cloud/message?limit=100&user="+this.user.getId()+
"&with="+this.contact.getId()});this.connect(this.messagesRequest,"done",this.onGetMessagesDone);this.connect(this.messagesRequest,"error",this.onGetMessagesError);this.messagesRequest.send()},onGetMessagesDone:function(){var a=this.messagesRequest.getResponseJSON();this.messages=[];for(var b=0;b<a.length;b++)this.messages.push(new Wn.Message({message:a[b]}));this.updateMessagesView();this.messagesRequest=void 0},onGetMessagesError:function(){this.messagesRequest=void 0},findMessageView:function(a){for(var b=
0;b<this.messagesView.getChildren().length;b++)if(Wn.UserMessageView.hasInstance(this.messagesView.getChildren()[b])&&this.messagesView.getChildren()[b].getMessage().getId()==a.getId())return this.messagesView.getChildren()[b]},updateMessagesView:function(){if(void 0!==this.messages){for(var a=[],b=this.messages,c,d=b.length-1;0<=d;d--){var e=void 0,f=b[d].getDate();void 0!==c&&(c.getFullYear()!=f.getFullYear()?(e=new Ui.HBox({spacing:10}),e.append(new Ui.Label({text:c.getFullYear(),fontSize:14,fontWeight:"bold"})),
e.append(new Ui.Separator({verticalAlign:"center"}),!0)):c.getMonth()!=f.getMonth()&&(e=new Ui.HBox({spacing:10}),e.append(new Ui.Separator({verticalAlign:"center",width:10})),e.append(new Ui.Label({text:"Janvier F\u00e9vrier Mars Avril Mai Juin Juillet Ao\u00fbt Septembre Octobre Novembre D\u00e9cembre".split(" ")[c.getMonth()],fontSize:12})),e.append(new Ui.Separator({verticalAlign:"center"}),!0)));c=f;"comment"!=b[d].getType()&&(b[d].getOrigin()==this.user.getId()?b[d].getDestination()==this.contact.getId()&&
(f=this.findMessageView(b[d]),void 0==f&&(void 0!==e&&this.messagesView.prepend(e),f=new Wn.UserMessageView({user:this.user,message:b[d],marginRight:80,dialog:this}),this.messagesView.prepend(f))):b[d].getOrigin()==this.contact.getId()&&(f=this.findMessageView(b[d]),void 0==f&&(void 0!==e&&this.messagesView.prepend(e),f=new Wn.UserMessageView({user:this.user,marginLeft:80,message:b[d],dialog:this}),this.messagesView.prepend(f),b[d].getSeen()||a.push(b[d]))))}for(d=0;d<a.length;d++)a[d].markSeen()}},
onMessagesChange:function(){if(void 0!==this.messages){for(var a=this.user.getMessages(),b=a.length-1;0<=b;b--){for(var c=a[b],d=void 0,e=0;void 0===d&&e<this.messages.length;e++)this.messages[e].getId()===c.getId()&&(d=this.messages[e]);void 0===d&&this.messages.unshift(c)}this.updateMessagesView()}}},{onLoad:function(){Wn.ContactMessagesDialog.base.onLoad.apply(this,arguments);this.connect(this.user,"messageschange",this.onMessagesChange)},onUnload:function(){Wn.ContactMessagesDialog.base.onUnload.apply(this,
arguments);this.disconnect(this.user,"messageschange",this.onMessagesChange)}});Ui.Dialog.extend("Wn.HistoryMessagesDialog",{user:void 0,contact:void 0,messagesView:void 0,startMessageId:-1,messageRequest:void 0,messages:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setFullScrolling(!0);this.setTitle("Messages");this.setPreferedWidth(600);this.setPreferedHeight(600);a=new Ui.Button({text:"Fermer"});this.connect(a,"press",function(){this.close()});this.setCancelButton(a);a=new Ui.VBox({margin:10,spacing:10});this.setContent(a);this.messagesView=new Ui.VBox({spacing:10});
a.append(this.messagesView);this.updateMessages()},updateMessages:function(){void 0!==this.messagesRequest&&(this.disconnect(this.messagesRequest,"done",this.onGetMessagesDone),this.disconnect(this.messagesRequest,"error",this.onGetMessagesError),this.messagesRequest.abort());this.messagesRequest=new Core.HttpRequest({url:"/cloud/message?limit=500&user="+this.user.getId()});this.connect(this.messagesRequest,"done",this.onGetMessagesDone);this.connect(this.messagesRequest,"error",this.onGetMessagesError);
this.messagesRequest.send()},onGetMessagesDone:function(){var a=this.messagesRequest.getResponseJSON();this.messages=[];for(var b=0;b<a.length;b++)this.messages.push(new Wn.Message({message:a[b]}));this.updateMessagesView();this.messagesRequest=void 0},onGetMessagesError:function(){this.messagesRequest=void 0},findMessageView:function(a){for(var b=0;b<this.messagesView.getChildren().length;b++)if(Wn.UserMessageView.hasInstance(this.messagesView.getChildren()[b])&&this.messagesView.getChildren()[b].getMessage().getId()==
a.getId())return this.messagesView.getChildren()[b]},updateMessagesView:function(){if(void 0!==this.messages){for(var a=[],b=this.messages,c,d=b.length-1;0<=d;d--)if("comment"!=b[d].getType()){var e=b[d].getDate();if(void 0!==c)if(c.getFullYear()!=e.getFullYear()){var f=new Ui.HBox({spacing:10});f.append(new Ui.Label({text:c.getFullYear(),fontSize:14,fontWeight:"bold"}));f.append(new Ui.Separator({verticalAlign:"center"}),!0);this.messagesView.prepend(f)}else c.getMonth()!=e.getMonth()&&(f=new Ui.HBox({spacing:10}),
f.append(new Ui.Separator({verticalAlign:"center",width:10})),f.append(new Ui.Label({text:"Janvier F\u00e9vrier Mars Avril Mai Juin Juillet Ao\u00fbt Septembre Octobre Novembre D\u00e9cembre".split(" ")[c.getMonth()],fontSize:12})),f.append(new Ui.Separator({verticalAlign:"center"}),!0),this.messagesView.prepend(f));c=e;b[d].getOrigin()==this.user.getId()?(e=this.findMessageView(b[d]),void 0==e&&(e=new Wn.UserMessageView({user:this.user,message:b[d],marginRight:80,dialog:this}),this.messagesView.prepend(e))):
(e=this.findMessageView(b[d]),void 0==e&&(e=new Wn.UserMessageView({user:this.user,marginLeft:80,message:b[d],dialog:this}),this.messagesView.prepend(e),b[d].getSeen()||a.push(b[d])))}for(d=0;d<a.length;d++)a[d].markSeen()}},onMessagesChange:function(){if(void 0!==this.messages){for(var a=this.user.getMessages(),b=a.length-1;0<=b;b--){for(var c=a[b],d=void 0,e=0;void 0===d&&e<this.messages.length;e++)this.messages[e].getId()===c.getId()&&(d=this.messages[e]);void 0===d&&this.messages.unshift(c)}this.updateMessagesView()}}},
{onLoad:function(){Wn.HistoryMessagesDialog.base.onLoad.apply(this,arguments);this.connect(this.user,"messageschange",this.onMessagesChange)},onUnload:function(){Wn.HistoryMessagesDialog.base.onUnload.apply(this,arguments);this.disconnect(this.user,"messageschange",this.onMessagesChange)}});Ui.CanvasElement.extend("Wn.BarGraph",{data:void 0,xAxis:void 0,minY:void 0,maxY:void 0,xAxisLabel:void 0,yAxisLabel:void 0,constructor:function(a){this.data=a.data;delete a.data;this.xAxis=a.xAxis;delete a.xAxis;this.xAxisLabel=a.xAxisLabel;delete a.xAxisLabel;this.yAxisLabel=a.yAxisLabel;delete a.yAxisLabel;for(a=0;a<this.data.length;a++){var b=this.data[a];if(void 0===this.minY||b<this.minY)this.minY=b;if(void 0===this.maxY||b>this.maxY)this.maxY=b}}},{updateCanvas:function(a){for(var b=this.getLayoutWidth(),
c=this.getLayoutHeight(),d=(b-40)/this.xAxis.length,e=this.maxY,f=0;10<e;)e/=10,f++;e=Math.pow(10,f+1);e>2*this.maxY&&(e/=2);e>2*this.maxY&&(e/=2);a.fillStyle="#444444";a.font="normal 10px Sans-Serif";a.textBaseline="top";a.textAlign="center";a.fillRect(40,c-20,b-40,1);for(f=0;f<this.xAxis.length;f++){var g=this.xAxis[f];a.fillText(g,40+f*d+d/2,c-20+4,d);0<f&&a.fillRect(40+f*d,c-20,1,4)}a.textBaseline="middle";a.textAlign="right";for(f=0;5>f;f++)g=e*f/5,a.fillText(g,36,c-20-(c-40)*f/5),a.fillRect(40,
c-20-(c-40)*f/5,b-40,1);a.fillStyle="#88c888";for(f=0;f<this.data.length;f++)b=(c-40)*this.data[f]/e,g=d/2,a.fillRect(40+d*f+d/2-g/2,20+(c-40)-b,g,b)}});Wn.OptionSection.extend("Wn.UserStatsSection",{contact:void 0,constructor:function(a){this.contact=a.contact;delete a.contact;this.setTitle("Statistiques d'utilisation");this.setContent(new Wn.UserStats({contact:this.contact}))}});
Ui.LBox.extend("Wn.UserStats",{contact:void 0,logs:void 0,cbox:void 0,constructor:function(a){this.contact=a.contact;delete a.contact;a=void 0!==this.contact?new Core.HttpRequest({method:"GET",url:"/cloud/pathlog?user="+this.contact.getId()+"&limit=10000"}):new Core.HttpRequest({method:"GET",url:"/cloud/pathlog?limit=100000"});this.connect(a,"done",this.onRequestDone);this.connect(a,"error",this.onRequestError);a.send()},formatDate:function(a){var b="",b=10>a.getDate()?b+("0"+a.getDate()):b+a.getDate(),
b=b+"/",b=10>a.getMonth()+1?b+("0"+(a.getMonth()+1)):b+(a.getMonth()+1),b=b+("/"+a.getFullYear()+" "),b=10>a.getHours()?b+("0"+a.getHours()):b+a.getHours(),b=b+":",b=10>a.getMinutes()?b+("0"+a.getMinutes()):b+a.getMinutes(),b=b+":";return b=10>a.getSeconds()?b+("0"+a.getSeconds()):b+a.getSeconds()},onRequestDone:function(a){this.logs=a.getResponseJSON();this.cbox=new Ui.VBox({spacing:10});this.setContent(this.cbox);this.cbox.append(new Ui.Text({text:"Les 20 derniers \u00e9v\u00e8nements",fontWeight:"bold",
textAlign:"left"}));a=new Ui.Grid({cols:"auto,*",rows:"auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto,auto",margin:10});for(var b=0;b<Math.min(20,this.logs.length);b++){var c=this.logs[b];a.attach(new Ui.Label({horizontalAlign:"right",text:this.formatDate(new Date(1E3*c.create)),margin:2,marginRight:10}),0,b);a.attach(new Ui.Text({horizontalAlign:"left",text:c.path,margin:2}),1,b)}this.cbox.append(a);this.hourActivity();this.dayActivity();this.monthActivity()},
onRequestError:function(a){this.setContent(new Ui.Text({text:"Erreur lors de la r\u00e9cup\u00e9ration des logs..."}))},hourActivity:function(){for(var a=new Date((new Date).getTime()-6048E5),b=[],c=[],d=0;24>d;d++)b.push(0),c.push(d+"h");for(var e=0,d=0;d<this.logs.length;d++){var f=new Date(1E3*this.logs[d].create);if(f<a)break;b[f.getHours()]++;e++}this.cbox.append(new Ui.Text({text:"Activit\u00e9 par heure sur une semaine glissante ("+e+")",fontWeight:"bold",textAlign:"left"}));this.cbox.append(new Wn.BarGraph({xAxis:c,
data:b,height:250}))},dayToString:function(a){if(0===a)return"dim";if(1===a)return"lun";if(2===a)return"mar";if(3===a)return"mer";if(4===a)return"jeu";if(5===a)return"ven";if(6===a)return"sam"},dayActivity:function(){for(var a=new Date,b=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0),b=new Date(b.getTime()+864E5),c=new Date(b.getTime()-6048E5),b={},d=[],e=[],f=0;7>f;f++){var g=new Date(a.getTime()+864E5*(f-6));b[g.getDay()]=0;e.push(g.getDay());d.push(this.dayToString(g.getDay()))}for(f=
a=0;f<this.logs.length;f++){g=new Date(1E3*this.logs[f].create);if(g<c)break;b[g.getDay()]++;a++}c=[];for(f=0;f<e.length;f++)c.push(b[e[f]]);this.cbox.append(new Ui.Text({text:"Activit\u00e9 par jour sur une semaine glissante ("+a+")",fontWeight:"bold",textAlign:"left"}));this.cbox.append(new Wn.BarGraph({xAxis:d,data:c,height:250}))},monthToString:function(a){if(0===a)return"jan";if(1===a)return"fev";if(2===a)return"mar";if(3===a)return"avr";if(4===a)return"mai";if(5===a||6===a)return"jui";if(7===
a)return"aou";if(8===a)return"sep";if(9===a)return"oct";if(10===a)return"nov";if(11===a)return"dec"},monthActivity:function(){var a=new Date;a.getFullYear();a.getMonth();var b;b=11==a.getMonth()?new Date(a.getFullYear()+1,0,1,0,0,0,0):new Date(a.getFullYear(),a.getMonth()+1,1,0,0,0,0);var c=new Date(b.getTime()-31536E6);b={};for(var d=[],e=[],f=0;12>f;f++){var g=(a.getMonth()-11+f+12)%12;b[g]=0;e.push(g);d.push(this.monthToString(g))}for(f=a=0;f<this.logs.length;f++){g=new Date(1E3*this.logs[f].create);
if(g<c)break;b[g.getMonth()]++;a++}c=[];for(f=0;f<e.length;f++)c.push(b[e[f]]);this.cbox.append(new Ui.Text({text:"Utilisation sur l'ann\u00e9e ("+a+")",fontWeight:"bold",textAlign:"left"}));this.cbox.append(new Wn.BarGraph({xAxis:d,data:c,height:250}))}});
Ui.Dialog.extend("Wn.UserStatsDialog",{constructor:function(a){this.setTitle("Statistiques d'utilisation globales");this.setFullScrolling(!0);this.setPreferedWidth(700);this.setPreferedHeight(600);this.setCancelButton(new Ui.Button({text:"Fermer"}));this.setContent(new Wn.UserStats)}});Ui.Dialog.extend("Wn.VideoConfDialog",{user:void 0,contact:void 0,localVideo:void 0,localStream:void 0,remoteVideo:void 0,remoteStream:void 0,queue:void 0,remoteBox:void 0,peerConnection:void 0,isCaller:!0,message:void 0,channel:void 0,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.setTitle("Appel vid\u00e9o");this.setPreferedWidth(500);this.setPreferedHeight(500);this.connect(this,"unload",this.onVideoConfUnload);if("message"in a){console.log("message");
console.log(a.message);this.message=a.message;delete a.message;this.channel=this.message.content;this.isCaller=!1;a=new Ui.HBox({uniform:!0,verticalAlign:"center",horizontalAlign:"center"});var b=new Wn.AlertButton({text:"Refuser"});a.append(b);var c=new Ui.Button({text:"Accepter",style:{"Ui.Button":{color:"#41fa41"}}});a.append(c);this.setContent(a);this.connect(b,"press",function(){this.close()});this.connect(c,"press",function(){this.disconnect(this.message,"change",this.onMessageChange);this.buildVideoUi()})}else this.buildVideoUi()},
buildRemoteVideo:function(){this.remoteVideo=new Ui.Video({autoplay:!0});this.remoteBox.setContent(this.remoteVideo)},buildVideoUi:function(){this.setCancelButton(new Ui.Button({text:"Fermer"}));var a=new Ui.LBox;this.setContent(a);this.remoteBox=new Ui.LBox;a.append(this.remoteBox);this.remoteBox.setContent(new Ui.Text({text:"Attente d'autorisation",margin:10,textAlign:"center",verticalAlign:"center",fontSize:24}));var b=new Ui.LBox({verticalAlign:"bottom",horizontalAlign:"left"});a.append(b);b.append(new Ui.Rectangle({fill:"#999999"}));
this.localVideo=new Ui.Video({margin:2,width:100,height:100,autoplay:!0});this.connect(this.localVideo,"ready",this.onLocalVideoReady);b.append(this.localVideo);var c=this;navigator.getUserMedia({audio:!0,video:{mandatory:{},optional:[]}},function(a){c.onUserMediaSuccess.call(c,a)},function(a){this.onUserMediaError.call(c,a)})},onUserMediaSuccess:function(a){this.localStream=a;this.localVideo.setSrc(this.localStream);if(this.isCaller)for(this.buildRemoteVideo(),this.channel="",a=0;10>a;a++)this.channel+=
"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()));this.queue=new Wn.Queue({channel:this.channel});this.connect(this.queue,"open",this.onQueueOpen);this.connect(this.queue,"close",this.onQueueClose);this.connect(this.queue,"message",this.onQueueMessage);this.remoteBox.setContent(new Ui.Text({text:"Appel en cours...",margin:10,textAlign:"center",verticalAlign:"center",fontSize:24}))},onUserMediaError:function(a){this.close()},onLocalVideoReady:function(){var a=
this.localVideo.getNaturalWidth(),b=this.localVideo.getNaturalHeight();a>b?(this.localVideo.setWidth(100),this.localVideo.setHeight(100*b/a)):(this.localVideo.setHeight(100),this.localVideo.setWidth(100*a/b))},onQueueOpen:function(){this.isCaller?this.user.sendMessage(this.contact,this.channel,"call"):this.queue.sendMessage({user:this.user.getId(),event:"accept"})},onQueueClose:function(){},onQueueMessage:function(a,b){if(b.user!==this.user.getId())if(console.log("onQueueMessage contact: "+this.contact.getId()),
console.log(b),"accept"===b.event){console.log("contact accept");this.createPeerConnection();var c=this;this.peerConnection.createOffer(function(a){c.onGotDescription.call(c,a)},function(a){console.log("createOffer ERROR");console.log(a)})}else"sdp"===b.event?(void 0===this.peerConnection&&this.createPeerConnection(),this.peerConnection.setRemoteDescription(new RTCSessionDescription(b.sdp)),c=this,this.peerConnection.createAnswer(function(a){c.onGotDescription.call(c,a)},function(a){console.log("createAnswer ERROR");
console.log(a)})):"candidate"===b.event&&null!==b.candidate&&(void 0===this.peerConnection&&this.createPeerConnection(),this.peerConnection.addIceCandidate(new RTCIceCandidate(b.candidate)))},onGotDescription:function(a){this.peerConnection.setLocalDescription(a);this.queue.sendMessage({user:this.user.getId(),event:"sdp",sdp:a})},createPeerConnection:function(){this.peerConnection=new RTCPeerConnection({iceServers:[{url:"stun:stun.services.mozilla.com"}]},{optional:[{DtlsSrtpKeyAgreement:"true"}]});
this.peerConnection.addStream(this.localStream);var a=this;this.peerConnection.onicecandidate=function(b){a.queue.sendMessage({user:a.user.getId(),event:"candidate",candidate:b.candidate})};this.peerConnection.onaddstream=function(b){a.buildRemoteVideo();a.remoteStream=b.stream;a.remoteVideo.setSrc(b.stream)};this.peerConnection.onremovestream=function(b){console.log("onremovestream");a.remoteStream=null;a.close()}},onVideoConfUnload:function(){void 0!==this.localStream&&(this.localStream.stop(),
this.localStream=void 0);void 0!==this.queue&&(this.queue.close(),this.queue=void 0)}});Ui.LBox.extend("Wn.ContactSharesView",{user:void 0,contact:void 0,shares:void 0,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.contact.update()},onContactChange:function(){var a=this.contact.getResources();if(0===a.length)this.setContent(new Ui.Text({fontSize:20,text:"Ce contact ne partage pas de ressources avec vous",margin:20,textAlign:"center",verticalAlign:"center"})),this.shares=void 0;else{void 0===this.shares&&(this.shares=new Ui.Flow({uniform:!0}),
this.setContent(this.shares));for(var b=[],c=[],d=0;d<this.shares.getChildren().length;d++){for(var e=this.shares.getChildren()[d],f=!1,g=0;!1===f&&g<a.length;g++)f=e.getResource().getId()===a[g].getId();f||b.push(e)}for(d=0;d<a.length;d++){e=a[d];f=!1;for(g=0;!1===f&&g<this.shares.getChildren().length;g++)f=e.getId()===this.shares.getChildren()[g].getResource().getId();f||c.push(e)}for(d=0;d<b.length;d++)this.shares.remove(b[d]);if(0<c.length)for(d=0;d<c.length;d++)if(c[d].getIsReady())this.onAddNewResourceReady(c[d]);
else this.connect(c[d],"ready",this.onAddNewResourceReady)}},onAddNewResourceReady:function(a){var b=Wn.ResourceView.getView(a.getType());void 0===b&&(b=Wn.ResourceView);a=new b({user:this.user,contact:this.contact,resource:a,margin:5,width:210,height:244});void 0!==this.shares&&this.shares.append(a)}},{onLoad:function(){Wn.ContactSharesView.base.onLoad.call(this);this.connect(this.contact,"change",this.onContactChange);if(this.contact.getIsReady())this.onContactChange()},onUnload:function(){Wn.ContactSharesView.base.onUnload.call(this);
this.disconnect(this.contact,"change",this.onContactChange)}});
Ui.LBox.extend("Wn.ContactView",{user:void 0,contact:void 0,contactface:void 0,contentbox:void 0,addRemoveButton:void 0,selection:void 0,menuBox:void 0,actionBox:void 0,contextBox:void 0,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;a=new Ui.VBox;this.setContent(a);this.selection=new Ui.Selection;this.connect(this.selection,"change",this.onSelectionChange);this.menuBox=new Ui.LBox;a.append(this.menuBox);this.actionBox=new Ui.MenuToolBar({margin:5,spacing:5});
this.menuBox.append(this.actionBox);this.contactface=new Wn.UserFace({user:this.contact});this.actionBox.append(this.contactface);this.contactlabel=new Wn.UserTitle({text:"",marginLeft:10,marginRight:10,textAlign:"left",verticalAlign:"center"});this.contact.getIsReady()&&this.contactlabel.setText(this.contact.getFirstname()+" "+this.contact.getLastname());this.actionBox.append(this.contactlabel,!0);if(navigator.supportWebRTC){var b=new Ui.Button({icon:"phone"});this.connect(b,"press",this.onPhonePress);
this.actionBox.append(b)}b=new Ui.Button({icon:"bubble"});this.connect(b,"press",this.onMessagesPress);this.actionBox.append(b);b=new Ui.Button({icon:"person"});this.connect(b,"press",this.onProfilPress);this.actionBox.append(b);this.contextBox=new Ui.ContextBar({selection:this.selection});this.contextBox.hide();this.menuBox.append(this.contextBox);b=new Ui.ScrollingArea({scrollHorizontal:!1});a.append(b,!0);b.setContent(new Wn.ContactSharesView({user:this.user,contact:this.contact}),!0)},getSelectionHandler:function(){return this.selection},
onProfilPress:function(){(new Wn.UserProfil({user:this.contact})).open()},onPhonePress:function(){(new Wn.VideoConfDialog({user:this.user,contact:this.contact})).open()},onMessagesPress:function(){(new Wn.ContactMessagesDialog({user:this.user,contact:this.contact})).open()},onContactChange:function(){this.contactlabel.setText(this.contact.getFirstname()+" "+this.contact.getLastname())},onSelectionChange:function(a){0===a.getElements().length?(this.contextBox.hide(),this.actionBox.show()):(this.contextBox.show(),
this.actionBox.hide())}},{onLoad:function(){Wn.ContactView.base.onLoad.call(this);this.connect(this.contact,"change",this.onContactChange);if(this.contact.getIsReady())this.onContactChange()},onUnload:function(){Wn.ContactView.base.onUnload.call(this);this.disconnect(this.contact,"change",this.onContactChange)}});Core.Object.extend("Wn.User",{id:void 0,user:void 0,resources:void 0,contacts:void 0,bookmarks:void 0,userRequest:void 0,userSocket:void 0,userSocketAlive:!1,userRetryTask:void 0,monitor:!0,serverVersion:void 0,watchedResource:void 0,isReady:!1,messages:void 0,messagesRequest:void 0,constructor:function(a){this.addEvents("ready","delete","change","messageschange","serverchange","order","call");this.user=a.user;delete a.user;this.id=this.user.id;"monitor"in a&&(this.monitor=a.monitor,delete a.monitor);
this.resources=[];this.contacts=[];this.bookmarks=[];this.monitor?(this.startUserMonitoring(),this.updateUserData(this.user)):this.updateUser();this.messages=[]},getIsReady:function(){return this.isReady},getUser:function(){return this.user},getData:function(){return this.user},getId:function(){return this.id},getLogin:function(){return this.user.login},getFaceUrl:function(){return"/cloud/user/"+this.id+"/face?rev="+this.user.face_rev},isAdmin:function(){return this.user.admin},getBookmarks:function(){return this.bookmarks},
getResources:function(){return this.resources},getRfidsFromPath:function(a){var b=[];if(void 0!==this.user.rfids)for(var c=0;c<this.user.rfids.length;c++){var d=this.user.rfids[c];d.path==a&&b.push(d.id)}return b},getRfidPath:function(a){if(void 0!==this.user.rfids)for(var b=0;b<this.user.rfids.length;b++){var c=this.user.rfids[b];if(c.id==a)return c.path}},watchResource:function(a){this.watchedResource=a;this.userSocketAlive&&this.userSocket.send(JSON.stringify({type:"watch",resource:this.watchedResource.getId()}))},
getResource:function(a){for(var b=0;b<this.resources.length;b++)if(this.resources[b].getId()===a)return this.resources[b]},getResourceAndPathFromData:function(a){var b=void 0,c=void 0,d=a.indexOf(":");if(-1!==d){c=a.substring(0,d);a=a.substring(d+1);for(var e=d=void 0,f=0;void 0===d&&f<this.resources.length;f++)b=this.resources[f],b.getType()==c&&0==a.search(b.getData())&&(d=b,a.length!=b.getData().length&&(e=a.substring(b.getData().length)));b=d;c=e}return{resource:b,path:c}},getContacts:function(){return this.contacts},
getContact:function(a){for(var b=void 0,c=0;void 0===b&&c<this.contacts.length;c++)this.contacts[c].getId()===a&&(b=this.contacts[c]);return b},addContacts:function(a){for(var b=[],c=0;c<a.length;c++)b.push({id:a[c].getId()});(new Core.HttpRequest({method:"POST",url:"/cloud/user/"+this.id+"/contacts",content:JSON.stringify(b)})).send();this.userSocketAlive||this.updateUser()},prependContacts:function(a){for(var b=[],c=0;c<a.length;c++)b.push({id:a[c].getId(),position:c});(new Core.HttpRequest({method:"POST",
url:"/cloud/user/"+this.id+"/contacts",content:JSON.stringify(b)})).send();this.userSocketAlive||this.updateUser()},prependContact:function(a){this.prependContacts([a])},addContact:function(a){this.addContacts([a])},removeContacts:function(a){for(var b=0;b<a.length;b++)(new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.id+"/contacts/"+a[b].getId()})).send();this.userSocketAlive||this.updateUser()},removeContact:function(a){this.removeContacts([a])},removeResource:function(a){a.deleteResource();
this.userSocketAlive||this.updateUser()},createResource:function(a){(new Core.HttpRequest({method:"POST",url:"/cloud/user/"+this.id+"/resources",content:JSON.stringify(a)})).send();this.userSocketAlive||this.updateUser()},bookmarkResource:function(a){a=Wn.Resource.hasInstance(a)?a.getId():"id"in a?a.id:a;(new Core.HttpRequest({method:"POST",url:"/cloud/user/"+this.id+"/bookmarks",content:JSON.stringify({resource:a})})).send();this.userSocketAlive||this.updateUser()},unbookmarkResource:function(a){a=
Wn.Resource.hasInstance(a)?a.getId():"id"in a?a.id:a;(new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.id+"/bookmarks/"+a})).send();this.userSocketAlive||this.updateUser()},setBookmarkPosition:function(a,b){var c;Wn.Resource.hasInstance(a)?c=a.getId():"id"in a?(c=a.id,void 0==b&&"position"in a&&(b=a.position)):c=a;(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.id+"/bookmarks/"+c,content:JSON.stringify({position:b})})).send();this.userSocketAlive||this.updateUser()},setContactPosition:function(a,
b){var c;Wn.Contact.hasInstance(a)?c=a.getId():"id"in a?(c=a.id,void 0==b&&"position"in a&&(b=a.position)):c=a;(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.id+"/contacts/"+c,content:JSON.stringify({position:b})})).send();this.userSocketAlive||this.updateUser()},updateUser:function(){void 0===this.userRequest&&(this.userRequest=new Core.HttpRequest({url:"/cloud/user/"+this.id}),this.connect(this.userRequest,"done",this.onGetUserDone),this.connect(this.userRequest,"error",this.onGetUserError),
this.userRequest.send())},startUserMonitoring:function(){void 0===this.userSocket&&(this.userSocket=new Core.Socket({service:"/cloud/user/"+this.id}),this.connect(this.userSocket,"message",this.onUserMessageReceived),this.connect(this.userSocket,"open",this.onUserSocketOpen),this.connect(this.userSocket,"error",this.onUserSocketError),this.connect(this.userSocket,"close",this.onUserSocketClose))},onUserSocketOpen:function(){this.userSocketAlive=!0;this.updateUser();void 0!==this.watchedResource&&
this.userSocket.send(JSON.stringify({type:"watch",resource:this.watchedResource.getId()}))},onUserSocketError:function(){this.userSocketAlive=!1;this.userSocket.close()},onUserSocketClose:function(){this.userSocketAlive=!1;this.disconnect(this.userSocket,"open",this.onUserSocketOpen);this.disconnect(this.userSocket,"message",this.onUserMessageReceived);this.disconnect(this.userSocket,"error",this.onUserSocketError);this.disconnect(this.userSocket,"close",this.onUserSocketClose);this.userSocket=void 0;
this.userRetryTask=new Core.DelayedTask({delay:5,scope:this,callback:this.startUserMonitoring})},onUserMessageReceived:function(a,b){b=JSON.parse(b);if("userchanged"===b.event)if(b.user==this.getId())this.updateUser();else{var c=Wn.Contact.getContact(b.user,!0);void 0!==c&&c.update()}else if("resourcechanged"===b.event)c=Wn.Resource.getResource(b.resource,this,!0),void 0!==c&&c.update(),null!==this.watchedResource&&void 0!==this.watchedResource&&c!==this.watchedResource&&this.watchedResource.getId()===
b.resource&&this.watchedResource.update();else if("userdisconnected"===b.event)c=Wn.Contact.getContact(b.user,!0),void 0!==c&&c.setIsOnline(!1);else if("userconnected"===b.event)c=Wn.Contact.getContact(b.user,!0),void 0!==c&&c.setIsOnline(!0);else if("messagereceived"===b.event)this.onMessagesMessageReceived(b.message);else"messagechanged"===b.event?this.updateMessage(b.message):this.updateUser()},onGetUserError:function(a){404==a.getStatus()&&this.fireEvent("delete",this);this.userRequest=void 0},
onGetUserDone:function(a){void 0===this.serverVersion?this.serverVersion=a.getResponseHeader("Server"):this.serverVersion!=a.getResponseHeader("Server")&&(this.serverVersion=a.getResponseHeader("Server"),this.fireEvent("serverchange",this));a=a.getResponseJSON();this.updateUserData(a);this.userRequest=void 0},updateUserData:function(a){for(var b=[],c=0;c<a.resources.length;c++){for(var d=void 0,e=0;void 0===d&&e<this.resources.length;e++)this.resources[e].getId()===a.resources[c].id&&(d=this.resources[e]);
void 0!==d?d.updateData(a.resources[c]):d=new Wn.Resource({resource:a.resources[c],user:this});b.push(d)}this.resources=b;b=[];for(c=0;c<a.contacts.length;c++){d=void 0;for(e=0;void 0===d&&e<this.contacts.length;e++)this.contacts[e].getId()===a.contacts[c].id&&(d=this.contacts[e]);void 0!==d?d.updateData(a.contacts[c]):d=new Wn.Contact({contact:a.contacts[c],user:this});b.push(d)}this.contacts=b;this.user=a;this.bookmarks=[];for(c=0;c<a.bookmarks.length;c++)this.bookmarks.push(Wn.Resource.getResource(a.bookmarks[c].resource,
this));!1===this.isReady&&(this.isReady=!0,this.fireEvent("ready",this));this.fireEvent("change",this)},sendMessage:function(a,b,c){void 0===c&&(c="message");Wn.Contact.hasInstance(a)&&(a=a.getId());a=new Core.HttpRequest({method:"POST",url:"/cloud/message",content:JSON.stringify({content:b,type:c,origin:this.getId(),destination:a})});"message"===c&&this.connect(a,"done",function(a){this.prependMessage(a.getResponseJSON())});a.send();return a},getMessages:function(){return this.messages},updateMessages:function(){void 0===
this.messagesRequest&&(this.messagesRequest=new Core.HttpRequest({url:"/cloud/message?limit=50&user="+this.id}),this.connect(this.messagesRequest,"done",this.onGetMessagesDone),this.connect(this.messagesRequest,"error",this.onGetMessagesError),this.messagesRequest.send())},updateMessage:function(a){for(var b=void 0,c=0;void 0==b&&c<this.messages.length;c++)a.id==this.messages[c].getMessage().id&&(b=this.messages[c]);void 0!==b&&(b.updateData(a),this.fireEvent("messageschange",this))},prependMessage:function(a){for(var b=
void 0,c=0;void 0==b&&c<this.messages.length;c++)a.id==this.messages[c].getMessage().id&&(b=this.messages[c]);void 0!==b?b.updateData(a):this.messages.unshift(new Wn.Message({message:a}));this.fireEvent("messageschange",this)},onMessagesMessageReceived:function(a){"order"==a.type?this.fireEvent("order",this,a):"rfid"==a.type?Ui.App.current.getRfidReader().fireEnter(a.content):"call"==a.type&&a.origin!==this.getId()?this.fireEvent("call",this,Wn.Contact.getContact(a.origin),a):this.prependMessage(a)},
onGetMessagesError:function(a){this.messagesRequest=void 0},onGetMessagesDone:function(a){var b=[];a=a.getResponseJSON();for(var c=0;c<a.length;c++){for(var d=void 0,e=0;void 0==d&&e<this.messages.length;e++)a[c].id==this.messages[e].getMessage().id&&(d=this.messages[e]);void 0==d?d=new Wn.Message({message:a[c]}):d.updateData(a[c]);b.push(d)}this.messages=b;this.fireEvent("messageschange",this);this.messagesRequest=void 0}});Core.Object.extend("Wn.Queue",{channel:void 0,socket:void 0,retryTask:void 0,stopped:!1,constructor:function(a){this.addEvents("open","message","close");this.channel=a.channel;delete a.channel;console.log("new Wn.Queue("+this.channel+")");this.startMonitoring()},getChannel:function(){return this.channel},setChannel:function(a){this.channel!=a&&(this.channel=a,void 0!==this.socket&&(this.socket.close(),void 0!=this.retryTask&&this.retryTask.abort(),this.startMonitoring()))},sendMessage:function(a){this.socket.send(JSON.stringify(a))},
startMonitoring:function(){this.socket=new Core.Socket({service:"/cloud/queue/"+this.channel});this.connect(this.socket,"message",this.onMessageReceived);this.connect(this.socket,"open",this.onSocketOpen);this.connect(this.socket,"error",this.onSocketError);this.connect(this.socket,"close",this.onSocketClose)},onSocketOpen:function(){this.fireEvent("open",this)},onSocketError:function(){this.socket.close()},onSocketClose:function(){this.disconnect(this.socket,"message",this.onMessageReceived);this.disconnect(this.socket,
"error",this.onSocketError);this.disconnect(this.socket,"close",this.onSocketClose);this.socket=void 0;this.stopped?this.fireEvent("close",this):this.retryTask=new Core.DelayedTask({delay:5,scope:this,callback:this.startMonitoring})},onMessageReceived:function(a,b){this.fireEvent("message",this,JSON.parse(b))},close:function(){this.stopped||void 0===this.socket||(this.stopped=!0,this.socket.close())}});Ui.Selectionable.extend("Wn.WebAccount",{label:void 0,accountIcon:void 0,user:void 0,constructor:function(a){this.addEvents("delete");this.user=a.user;delete a.user;a=new Ui.VBox({margin:0});this.setContent(a);this.accountIcon=new Ui.Icon({icon:"google",width:48,height:48,fill:"#444444",horizontalAlign:"center"});a.append(this.accountIcon);this.label=new Ui.CompactLabel({width:80,maxLine:2,textAlign:"center"});a.append(this.label)},getUser:function(){return this.user},setAccountIcon:function(a){this.accountIcon.setIcon(a)},
setText:function(a){this.label.setText(a)},"delete":function(){this.fireEvent("delete",this)},testDeleteRight:function(){var a=this.user.getData(),b=0;null!==a.login&&b++;null!==a.googleid&&b++;null!==a.facebookid&&b++;return 1<b}});
Ui.Dialog.extend("Wn.WebAccountNewDialog",{user:void 0,path:void 0,constructor:function(a){this.addEvents("done");this.user=a.user;delete a.user;this.setTitle("Nouveau compte Web");this.setPreferedWidth(400);this.setPreferedHeight(400);this.setCancelButton(new Ui.Button({text:"Fermer"}));a=new Ui.VBox({spacing:5});this.setContent(a);var b=this.user.getData();if(null===b.login){var c=new Ui.Button({icon:"localaccount",text:"HOST",orientation:"horizontal"});this.connect(c,"press",this.onLocalPress);
a.append(c)}null===b.googleid&&(c=new Ui.Button({icon:"google",text:"Google",orientation:"horizontal"}),this.connect(c,"press",this.onGooglePress),a.append(c));null===b.facebookid&&(c=new Ui.Button({icon:"facebook",text:"Facebook",orientation:"horizontal"}),this.connect(c,"press",this.onFacebookPress),a.append(c))},onLocalPress:function(){var a=new Ui.VBox({spacing:10});this.setContent(a);var b=new Ui.TextField,c=new Ui.HBox({spacing:10});c.append(new Ui.Text({text:"Identifiant",textAlign:"right",
verticalAlign:"center",width:100}));c.append(b,!0);a.append(c);passwordField=new Ui.TextField({passwordMode:!0});c=new Ui.HBox({spacing:10});c.append(new Ui.Text({text:"Mot de passe",textAlign:"right",verticalAlign:"center",width:100}));c.append(passwordField,!0);a.append(c);var d=new Ui.Text({color:"red"});d.hide();a.append(d);var e=void 0,f=new Ui.Button({text:"Cr\u00e9er"});this.connect(f,"press",function(){var a=new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify({login:b.getValue(),
password:passwordField.getValue()})});this.connect(a,"done",function(){this.close();this.user.getData().login=b.getValue();this.fireEvent("done",this,new Wn.LocalAccount({user:this.user}))});this.connect(a,"error",function(a){var b=a.getStatus(),c="Echec de la cr\u00e9ation. V\u00e9rifier vos donn\u00e9es";403==b?1==a.getResponseJSON().code&&(c="Echec: mot de passe trop faible"):409==b&&(c="Echec: identifiant d\u00e9j\u00e0 utilis\u00e9");void 0!==e&&e.abort();d.setText(c);d.show();e=new Core.DelayedTask({scope:this,
delay:4,callback:function(){d.hide()}});this.getContent().enable();f.enable()});this.getContent().disable();f.disable();a.send()});this.setActionButtons([f])},onGooglePress:function(){this.setContent(new Ui.Text({verticalAlign:"center",textAlign:"center",text:"En attente d'authorization..."}));var a=window.open("/cloud/googleoauth2/redirect?state=grant","googleoauth");this.connect(a,"unload",function(){this.close()})},onFacebookPress:function(){this.setContent(new Ui.Text({verticalAlign:"center",
textAlign:"center",text:"En attente d'authorization..."}));var a=window.open("/cloud/facebookoauth2/redirect?state=grant","facebookoauth");this.connect(a,"unload",function(){this.close()})}});
Ui.Dialog.extend("Wn.GoogleAccountDialog",{user:void 0,account:void 0,constructor:function(a){this.user=a.user;delete a.user;this.account=a.account;delete a.account;this.setPreferedWidth(400);this.setTitle("Compte Google");this.setCancelButton(new Ui.Button({text:"Fermer"}));a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);var b=new Ui.VBox({spacing:10});this.setContent(b);var c=new Ui.HBox({spacing:10});c.append(new Ui.Text({text:"Identifiant",textAlign:"right",verticalAlign:"center",
width:100}));c.append(new Ui.Text({text:this.user.getData().googleid}),!0);b.append(c);this.account.testDeleteRight()&&this.setActionButtons([a])},onDeletePress:function(){this.account["delete"]();this.close()}});
Wn.WebAccount.extend("Wn.GoogleAccount",{constructor:function(a){this.setAccountIcon("google");this.setText("Google")},onGoogleEdit:function(){(new Wn.GoogleAccountDialog({user:this.getUser(),account:this})).open()},onGoogleDelete:function(){this["delete"]()}},{"delete":function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.getUser().getId(),content:JSON.stringify({googleid:null})})).send();this.fireEvent("delete",this)},getSelectionActions:function(){return{"delete":{text:"Supprimer",
icon:"trash",color:"#d02020",testRight:this.testDeleteRight,scope:this,callback:this.onGoogleDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onGoogleEdit,multiple:!1}}}});
Ui.Dialog.extend("Wn.FacebookAccountDialog",{user:void 0,account:void 0,constructor:function(a){this.user=a.user;delete a.user;this.account=a.account;delete a.account;this.setPreferedWidth(400);this.setTitle("Compte Facebook");this.setCancelButton(new Ui.Button({text:"Fermer"}));a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);var b=new Ui.VBox({spacing:10});this.setContent(b);var c=new Ui.HBox({spacing:10});c.append(new Ui.Text({text:"Identifiant",textAlign:"right",
verticalAlign:"center",width:100}));c.append(new Ui.Text({text:this.user.getData().facebookid}),!0);b.append(c);this.account.testDeleteRight()&&this.setActionButtons([a])},onDeletePress:function(){this.account["delete"]();this.close()}});
Wn.WebAccount.extend("Wn.FacebookAccount",{constructor:function(a){this.setAccountIcon("facebook");this.setText("Facebook")},onFacebookEdit:function(){(new Wn.FacebookAccountDialog({user:this.getUser(),account:this})).open()},onFacebookDelete:function(){this["delete"]()}},{"delete":function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.getUser().getId(),content:JSON.stringify({facebookid:null})})).send();this.fireEvent("delete",this)},getSelectionActions:function(){return{"delete":{text:"Supprimer",
icon:"trash",color:"#d02020",testRight:this.testDeleteRight,scope:this,callback:this.onFacebookDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onFacebookEdit,multiple:!1}}}});
Ui.Dialog.extend("Wn.LocalAccountDialog",{user:void 0,account:void 0,loginField:void 0,passwordField:void 0,deleteButton:void 0,saveButton:void 0,errorMessage:void 0,errorTimeout:void 0,constructor:function(a){this.user=a.user;delete a.user;this.account=a.account;delete a.account;this.setPreferedWidth(400);this.setTitle("Compte HOST");this.setCancelButton(new Ui.Button({text:"Fermer"}));this.deleteButton=new Ui.Button({text:"Supprimer"});this.connect(this.deleteButton,"press",this.onDeletePress);
this.saveButton=new Ui.Button({text:"Enregistrer"});this.connect(this.saveButton,"press",this.onSavePress);a=new Ui.VBox({spacing:10});this.setContent(a);this.loginField=new Ui.TextField({value:this.user.getData().login});var b=new Ui.HBox({spacing:10});b.append(new Ui.Text({text:"Identifiant",textAlign:"right",verticalAlign:"center",width:100}));b.append(this.loginField,!0);a.append(b);this.passwordField=new Ui.TextField({textHolder:"********",passwordMode:!0});b=new Ui.HBox({spacing:10});b.append(new Ui.Text({text:"Mot de passe",
textAlign:"right",verticalAlign:"center",width:100}));b.append(this.passwordField,!0);a.append(b);this.errorMessage=new Ui.Text({color:"red"});this.errorMessage.hide();a.append(this.errorMessage);this.account.testDeleteRight()?this.setActionButtons([this.deleteButton,this.saveButton]):this.setActionButtons([this.saveButton])},onDeletePress:function(){this.account["delete"]();this.close()},onSavePress:function(){var a={};void 0!=this.passwordField.getValue()&&""!=this.passwordField.getValue()&&(a.password=
this.passwordField.getValue());a.login=this.loginField.getValue();a=new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify(a)});this.connect(a,"done",this.onSaveDone);this.connect(a,"error",this.onSaveError);this.getContent().disable();this.saveButton.disable();this.deleteButton.disable();a.send()},onSaveDone:function(){this.close()},onSaveError:function(a){var b="Echec de la modification. V\u00e9rifier vos donn\u00e9es";403==a.getStatus()&&1==a.getResponseJSON().code&&
(b="Echec: mot de passe trop faible");this.showError(b);this.getContent().enable();this.saveButton.enable();this.deleteButton.enable()},showError:function(a){void 0!=this.errorTimeout&&this.errorTimeout.abort();this.errorMessage.setText(a);this.errorMessage.show();this.errorTimeout=new Core.DelayedTask({scope:this,delay:4,callback:this.onShowErrorTimeout})},onShowErrorTimeout:function(){void 0!==this.errorTimeout&&(this.errorTimeout.abort(),this.errorTimeout=void 0,this.errorMessage.hide());this.errorTimeout=
void 0;this.errorMessage.hide()}});
Wn.WebAccount.extend("Wn.LocalAccount",{constructor:function(a){this.setAccountIcon("localaccount");this.setText("HOST")},onLocalEdit:function(){(new Wn.LocalAccountDialog({user:this.getUser(),account:this})).open()},onLocalDelete:function(){this["delete"]()}},{"delete":function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify({login:null,password:null})})).send();this.fireEvent("delete",this)},getSelectionActions:function(){return{"delete":{text:"Supprimer",icon:"trash",
color:"#d02020",testRight:this.testDeleteRight,scope:this,callback:this.onLocalDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onLocalEdit,multiple:!1}}}});
Wn.OptionSection.extend("Wn.WebAccountSection",{flow:void 0,user:void 0,plus:void 0,googleAccount:void 0,facebookAccount:void 0,localAccount:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setTitle("Comptes Web");this.selection=[];this.flow=new Ui.Flow({uniform:!0});this.setContent(this.flow);this.plus=new Ui.Pressable;this.plus.setContent(new Ui.Icon({icon:"plus",width:48,height:48,fill:"#444444",verticalAlign:"center",horizontalAlign:"center"}));this.flow.append(this.plus);this.connect(this.plus,
"press",this.onPlusPress)},testPlus:function(){4<=this.flow.getChildren().length?this.plus.hide(!0):this.plus.show()},onPlusPress:function(){(new Wn.WebAccountNewDialog({user:this.user})).open()},onUserChange:function(){null!==this.user.getData().googleid&&void 0===this.googleAccount?(this.googleAccount=new Wn.GoogleAccount({user:this.user}),this.flow.prepend(this.googleAccount)):null===this.user.getData().googleid&&void 0!==this.googleAccount&&(this.flow.remove(this.googleAccount),this.googleAccount=
void 0);null!==this.user.getData().facebookid&&void 0===this.facebookAccount?(this.facebookAccount=new Wn.FacebookAccount({user:this.user}),this.flow.prepend(this.facebookAccount)):null===this.user.getData().facebookid&&void 0!==this.facebookAccount&&(this.flow.remove(this.facebookAccount),this.facebookAccount=void 0);null!==this.user.getData().login&&void 0===this.localAccount?(this.localAccount=new Wn.LocalAccount({user:this.user}),this.flow.prepend(this.localAccount)):null===this.user.getData().login&&
void 0!==this.localAccount&&(this.flow.remove(this.localAccount),this.localAccount=void 0);this.testPlus()}},{onLoad:function(){Wn.WebAccountSection.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},onUnload:function(){Wn.WebAccountSection.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange)}});Ui.Dialog.extend("Wn.ReaderEditDialog",{readerUi:void 0,reader:void 0,user:void 0,nameField:void 0,constructor:function(a){this.user=a.user;delete a.user;this.readerUi=a.readerUi;delete a.readerUi;this.reader=this.readerUi.getReader();this.setTitle("Lecteur RFID");this.setPreferedWidth(400);this.setPreferedHeight(300);this.setCancelButton(new Ui.Button({text:"Fermer"}));var b=new Ui.VBox({spacing:10});this.setContent(b);a=new Ui.HBox({spacing:10});b.append(a);a.append(new Ui.Text({text:"Nom",verticalAlign:"center",
width:100}));this.nameField=new Ui.TextField({value:this.reader.name,verticalAlign:"center"});a.append(this.nameField,!0);a=new Ui.HBox({spacing:10});b.append(a);a.append(new Ui.Text({text:"Identifiant",verticalAlign:"center",width:100}));a.append(new Ui.Text({text:this.reader.id,verticalAlign:"center"}),!0);a=new Ui.HBox({spacing:10});b.append(a);a.append(new Ui.Text({text:"URL",verticalAlign:"center",width:100}));b=(new Core.Uri({uri:"/cloud/rfid/"+this.reader.id+"/enter"})).toString();a.append(new Ui.Text({text:b,
verticalAlign:"center",selectable:!0}),!0);a=new Ui.Button({text:"Enregistrer"});this.connect(a,"press",this.onSavePress);b=new Ui.Button({text:"Supprimer"});this.connect(b,"press",this.onDeletePress);this.setActionButtons([b,a])},onSavePress:function(){this.reader.name=this.nameField.getValue();(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId()+"/readers/"+this.reader.id,content:JSON.stringify({name:this.nameField.getValue()})})).send();this.close()},onDeletePress:function(){this.readerUi["delete"]();
this.close()}});
Ui.Dialog.extend("Wn.ReaderNewDialog",{textField:void 0,user:void 0,request:void 0,device:void 0,nameField:void 0,reader:void 0,constructor:function(a){this.user=a.user;delete a.user;this.device=a.device;delete a.device;this.addEvents("done");this.setTitle("Nouveau Lecteur RFID");this.setPreferedWidth(400);this.setPreferedHeight(300);this.setContent(new Ui.Text({textAlign:"center",text:"Cr\u00e9ation en cours..."}));a=new Ui.Button({text:"Fermer"});this.setCancelButton(a);this.request=new Core.HttpRequest({method:"POST",
url:"/cloud/user/"+this.user.getId()+"/readers",content:JSON.stringify({name:"noname",device:this.device})});this.connect(this.request,"done",this.onCreateDone);this.connect(this.request,"error",this.onCreateError);this.request.send();this.connect(this,"close",this.onDialogClose)},onCreateDone:function(a){var b=a.getResponseJSON();this.reader=b;var c=new Ui.VBox({spacing:10});this.setContent(c);a=new Ui.HBox({spacing:10});c.append(a);a.append(new Ui.Text({text:"Nom",verticalAlign:"center",width:100}));
this.nameField=new Ui.TextField({value:b.name,verticalAlign:"center"});a.append(this.nameField,!0);a=new Ui.HBox({spacing:10});c.append(a);a.append(new Ui.Text({text:"Identifiant",verticalAlign:"center",width:100}));a.append(new Ui.Text({text:b.id,verticalAlign:"center"}),!0);a=new Ui.HBox({spacing:10});c.append(a);a.append(new Ui.Text({text:"URL",verticalAlign:"center",width:100}));b=(new Core.Uri({uri:"/cloud/rfid/"+b.id+"/enter"})).toString();a.append(new Ui.Text({text:b,verticalAlign:"center",
selectable:!0}),!0);a=new Ui.Button({text:"Enregistrer"});this.connect(a,"press",this.onSavePress);b=new Ui.Button({text:"Supprimer"});this.connect(b,"press",this.onDeletePress);this.setActionButtons([b,a])},onCreateError:function(){this.setContent(new Ui.Text({textAlign:"center",text:"Echec de la cr\u00e9ation. R\u00e9\u00e9ssayer plus tard."}))},onSavePress:function(){this.reader.name=this.nameField.getValue();(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId()+"/readers/"+
this.reader.id,content:JSON.stringify({name:this.nameField.getValue()})})).send();this.close()},onDeletePress:function(){(new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.user.getId()+"/readers/"+this.reader.id})).send();this.reader=void 0;this.close()},onDialogClose:function(){void 0!==this.reader&&this.fireEvent("done",this,this.reader)}});
Ui.Selectionable.extend("Wn.RfidReaderUi",{user:void 0,reader:void 0,constructor:function(a){this.addEvents("delete");this.user=a.user;delete a.user;this.reader=a.reader;delete a.reader;a=new Ui.VBox;this.setContent(a);a.append(new Ui.Icon({icon:"rfidreader",width:48,height:48,fill:"#444444",horizontalAlign:"center"}));var b=new Ui.CompactLabel({width:80,maxLine:2,textAlign:"center",text:this.reader.name});a.append(b)},getUser:function(){return this.user},getReader:function(){return this.reader},
"delete":function(){request=new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.user.getId()+"/readers/"+this.reader.id});request.send();this.fireEvent("delete",this)}},{getSelectionActions:function(){return Wn.RfidReaderUi.readerActions}},{readerActions:void 0,constructor:function(){Wn.RfidReaderUi.readerActions={"delete":{text:"Supprimer",icon:"trash",color:"#d02020",callback:Wn.RfidReaderUi.onReaderDelete,multiple:!0},edit:{"default":!0,text:"Editer",icon:"pen",callback:Wn.RfidReaderUi.onReaderEdit}}},
onReaderEdit:function(a){a=a.getElements();(new Wn.ReaderEditDialog({readerUi:a[0],user:a[0].getUser()})).open()},onReaderDelete:function(a){for(var b=a.getElements(),c=0;c<b.length;c++)b[c]["delete"]();a.clear()}});
Wn.OptionSection.extend("Wn.ReaderSection",{flow:void 0,user:void 0,device:null,constructor:function(a){this.user=a.user;delete a.user;this.device=a.device;delete a.device;this.setTitle("Lecteurs RFID");this.flow=new Ui.Flow({uniform:!0});this.setContent(this.flow);a=new Ui.Pressable;this.connect(a,"press",this.onReaderNewPress);this.flow.append(a);a.setContent(new Ui.Icon({icon:"plus",width:48,height:48,fill:"#444444",verticalAlign:"center",horizontalAlign:"center"}))},setReaders:function(a){for(var b=
[],c,d=0;d<this.flow.getChildren();d++)c=this.flow.getChildren()[d],Wn.RfidReaderUi.hasInstance(c)&&b.push(c);for(c in b)this.flow.remove(c);for(d=0;d<a.length;d++)a[d].device===this.device&&this.appendReader(a[d])},appendReader:function(a){a=new Wn.RfidReaderUi({user:this.user,reader:a});this.connect(a,"delete",this.onReaderDelete);this.flow.insertAt(a,this.flow.getChildren().length-1)},getReaders:function(){for(var a=[],b=0;b<this.flow.getChildren().length;b++){var c=this.flow.getChildren()[b];
Wn.RfidReaderUi.hasInstance(c)&&a.push(c.getReader())}return a},onReaderDelete:function(a){this.flow.remove(a)},onReaderNewDone:function(a,b){this.appendReader(b)},onReaderNewPress:function(){var a=new Wn.ReaderNewDialog({user:this.user,device:this.device});this.connect(a,"done",this.onReaderNewDone);a.open()}});Ui.Dialog.extend("Wn.DeviceEditDialog",{device:void 0,nameField:void 0,constructor:function(a){this.device=a.device;delete a.device;this.setPreferedWidth(500);this.setPreferedHeight(400);this.setFullScrolling(!0);this.setTitle("Client de consultation");this.setCancelButton(new Ui.Button({text:"Fermer"}));a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);var b=new Ui.Button({text:"Enregistrer"});this.connect(b,"press",this.onSavePress);this.setActionButtons([a,b]);a=new Ui.VBox({spacing:10,
margin:10});this.setContent(a);b=new Ui.HBox({spacing:10});a.append(b);b.append(new Ui.Text({text:"Identifiant",verticalAlign:"center",width:100,textAlign:"right"}));b.append(new Ui.Text({text:this.device.getDevice().id,verticalAlign:"center"}),!0);b=new Ui.HBox({spacing:10});a.append(b);b.append(new Ui.Text({text:"Nom",verticalAlign:"center",width:100,textAlign:"right"}));this.nameField=new Ui.TextField({value:this.device.getDevice().name,verticalAlign:"center"});b.append(this.nameField,!0);b=new Wn.ReaderSection({user:this.device.getUser(),
device:this.device.getDevice().id,readers:this.device.getUser().getData().readers,title:"Lecteurs RFID li\u00e9s \u00e0 cette interface"});a.append(b)},onDeletePress:function(){this.device["delete"]();this.close()},onSavePress:function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.device.getUser().getId()+"/devices/"+this.device.getDevice().id,content:JSON.stringify({name:this.nameField.getValue()})})).send();this.close()}});
Ui.Dialog.extend("Wn.DeviceNewDialog",{textField:void 0,user:void 0,request:void 0,constructor:function(a){this.user=a.user;delete a.user;this.addEvents("done");this.setTitle("Nouveau client de consultation");this.setPreferedWidth(400);this.setPreferedHeight(300);a=new Ui.VBox({spacing:10});this.setContent(a);a.append(new Ui.Text({text:"Enregister le navigateur actuel comme un nouveau client de consultation."}));var b=new Ui.HBox({spacing:10});b.append(new Ui.Text({text:"Nom d'usage",width:100,verticalAlign:"center"}));
this.textField=new Ui.TextField({verticalAlign:"center"});b.append(this.textField,!0);a.append(b);a=new Ui.Button({text:"Fermer"});this.setCancelButton(a);a=new Ui.Button({text:"Cr\u00e9er"});this.connect(a,"press",this.onCreatePress);this.setActionButtons([a])},onCreatePress:function(){this.request=new Core.HttpRequest({method:"POST",url:"/cloud/user/"+this.user.getId()+"/devices",content:JSON.stringify({name:this.textField.getValue()})});this.connect(this.request,"done",this.onCreateDone);this.connect(this.request,
"error",this.onCreateError);this.request.send()},onCreateDone:function(a){this.close();a=a.getResponseJSON();Ui.App.current.setDeviceId(a.id);this.fireEvent("done",this,a)},onCreateError:function(){this.close()}});
Ui.Selectionable.extend("Wn.Device",{user:void 0,device:void 0,constructor:function(a){this.addEvents("delete");this.user=a.user;delete a.user;this.device=a.device;delete a.device;a=new Ui.VBox;this.setContent(a);var b=new Ui.Icon({icon:"screen",width:48,height:48,fill:"#444444",horizontalAlign:"center"});a.append(b);var c=new Ui.CompactLabel({width:80,maxLine:2,textAlign:"center",text:this.device.name});a.append(c);"localStorage"in window&&void 0!==localStorage.getItem("deviceId")&&localStorage.getItem("deviceId")==
this.device.id&&(b.setFill("#3434e4"),c.setColor("#3434e4"))},getUser:function(){return this.user},getDevice:function(){return this.device},"delete":function(){request=new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.user.getId()+"/devices/"+this.device.id});request.send();this.fireEvent("delete",this)}},{getSelectionActions:function(){return Wn.Device.deviceActions}},{deviceActions:void 0,constructor:function(){Wn.Device.deviceActions={"delete":{text:"Supprimer",icon:"trash",color:"#d02020",
callback:Wn.Device.onDeviceDelete,multiple:!0},edit:{"default":!0,text:"Editer",icon:"pen",callback:Wn.Device.onDeviceEdit}}},onDeviceEdit:function(a){a=a.getElements();(new Wn.DeviceEditDialog({device:a[0]})).open()},onDeviceDelete:function(a){for(var b=a.getElements(),c=0;c<b.length;c++)b[c]["delete"]();a.clear()}});
Wn.OptionSection.extend("Wn.DeviceSection",{flow:void 0,user:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setTitle("Interfaces de consultation");this.flow=new Ui.Flow({uniform:!0});this.setContent(this.flow);a=new Ui.Pressable;this.connect(a,"press",this.onNewPress);this.flow.append(a);a.setContent(new Ui.Icon({icon:"plus",width:48,height:48,fill:"#444444",verticalAlign:"center",horizontalAlign:"center"}))},setDevices:function(a){for(var b=[],c,d=0;d<this.flow.getChildren();d++)c=
this.flow.getChildren()[d],Wn.Device.hasInstance(c)&&b.push(c);for(c in b)this.flow.remove(c);for(d=0;d<a.length;d++)this.appendDevice(a[d])},appendDevice:function(a){a=new Wn.Device({user:this.user,device:a});this.connect(a,"delete",this.onDeviceDelete);this.flow.insertAt(a,this.flow.getChildren().length-1)},getDevices:function(){for(var a=[],b=0;b<this.flow.getChildren().length;b++){var c=this.flow.getChildren()[b];Wn.Device.hasInstance(c)&&a.push(c.getDevice())}return a},onDeviceDelete:function(a){this.flow.remove(a)},
onDeviceNewDone:function(a,b){this.appendDevice(b)},onNewPress:function(){var a=new Wn.DeviceNewDialog({user:this.user});this.connect(a,"done",this.onDeviceNewDone);a.open()}});Ui.Dialog.extend("Wn.RfidEditDialog",{rfidTags:void 0,constructor:function(a){this.rfidTags=a.rfidTags;delete a.rfidTags;this.setTitle("Tags RFID");this.setPreferedWidth(300);this.setCancelButton(new Ui.Button({text:"Fermer"}));a=new Ui.VBox({spacing:10,margin:10,verticalAlign:"center"});this.setContent(a);for(var b=0;b<this.rfidTags.length;b++)a.append(new Ui.Label({text:this.rfidTags[b].getRfid(),horizontalAlign:"center"}));a=new Ui.Button({text:"Supprimer"});this.connect(a,"press",function(){this.close();
for(var a=0;a<this.rfidTags.length;a++)this.rfidTags[a]["delete"]()});this.setActionButtons([a])}});
Ui.Dialog.extend("Wn.RfidNewDialog",{textField:void 0,user:void 0,path:void 0,constructor:function(a){this.user=a.user;delete a.user;this.path=a.path;delete a.path;this.addEvents("done");this.setTitle("Nouveau Tag RFID");this.setPreferedWidth(300);this.setPreferedHeight(200);a=new Ui.HBox({spacing:10,verticalAlign:"center"});this.setContent(a);a.append(new Ui.Label({text:"RFID",verticalAlign:"center"}));this.textField=new Ui.TextField({verticalAlign:"center"});a.append(this.textField,!0);a.append(new Ui.Icon({icon:"rfidreader",
verticalAlign:"center",width:30,height:30}));this.setCancelButton(new Ui.Button({text:"Annuler"}));a=new Ui.Button({text:"Enregistrer"});this.connect(a,"press",this.onSavePress);this.setActionButtons([a]);this.connect(this,"close",this.onClose);this.connect(Ui.App.current.getRfidReader(),"enter",this.onRfid,!0)},onSavePress:function(){(new Core.HttpRequest({method:"POST",url:"/cloud/user/"+this.user.getId()+"/rfids",content:JSON.stringify({rfid:this.textField.getValue(),path:this.path})})).send();
this.close();this.fireEvent("done",this,this.textField.getValue())},onClose:function(){this.disconnect(Ui.App.current.getRfidReader(),"enter",this.onRfid,!0)},onRfid:function(a,b){this.textField.setValue(b);return!0}});
Ui.Selectionable.extend("Wn.RfidTag",{user:void 0,rfid:void 0,constructor:function(a){this.addEvents("delete");this.user=a.user;delete a.user;this.rfid=a.rfid;delete a.rfid;a=new Ui.VBox;this.setContent(a);a.append(new Ui.Icon({icon:"rfidtag",width:48,height:48,fill:"#444444",horizontalAlign:"center"}));var b=new Ui.CompactLabel({width:80,maxLine:2,textAlign:"center",text:this.rfid});a.append(b)},getRfid:function(){return this.rfid},"delete":function(){(new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+
this.user.getId()+"/rfids/"+this.rfid})).send();this.fireEvent("delete",this)}},{getSelectionActions:function(){return Wn.RfidTag.rfidActions}},{rfidActions:void 0,constructor:function(){Wn.RfidTag.rfidActions={"delete":{text:"Supprimer",icon:"trash",color:"#d02020",callback:Wn.RfidTag.onTagDelete,multiple:!0},edit:{"default":!0,hidden:!0,text:"Editer",icon:"pen",callback:Wn.RfidTag.onTagEdit,multiple:!0}}},onTagEdit:function(a){console.log("onTagEdit "+a.getElements().length);a=a.getElements();(new Wn.RfidEditDialog({rfidTags:a})).open()},
onTagDelete:function(a){console.log("onTagDelete "+a.getElements().length);for(var b=a.getElements(),c=0;c<b.length;c++)b[c]["delete"]();a.clear()}});
Wn.OptionSection.extend("Wn.RfidSection",{flow:void 0,user:void 0,path:void 0,constructor:function(a){this.user=a.user;delete a.user;this.path=a.path;delete a.path;this.setTitle("Association RFID");this.flow=new Ui.Flow({uniform:!0});this.setContent(this.flow);a=new Ui.Pressable;this.connect(a,"press",this.onTagNewPress);this.flow.append(a);a.setContent(new Ui.Icon({icon:"plus",width:48,height:48,fill:"#444444",verticalAlign:"center",horizontalAlign:"center"}))},setTags:function(a){for(var b=[],c,
d=0;d<this.flow.getChildren();d++)c=this.flow.getChildren()[d],Wn.RfidTag.hasInstance(c)&&b.push(c);for(c in b)this.flow.remove(c);for(d=0;d<a.length;d++)this.appendTag(a[d])},appendTag:function(a){a=new Wn.RfidTag({user:this.user,rfid:a});this.connect(a,"delete",this.onTagDelete);this.flow.insertAt(a,this.flow.getChildren().length-1)},getTags:function(){for(var a=[],b=0;b<this.flow.getChildren().length;b++){var c=this.flow.getChildren()[b];Wn.RfidTag.hasInstance(c)&&a.push(c.getRfid())}return a},
onTagDelete:function(a){this.flow.remove(a)},onTagNewDone:function(a,b){this.appendTag(b)},onTagNewPress:function(){var a=new Wn.RfidNewDialog({user:this.user,path:this.path});this.connect(a,"done",this.onTagNewDone);a.open()}});Ui.DropBox.extend("Wn.UploadFaceButton",{user:void 0,graphic:void 0,uploadable:void 0,image:void 0,constructor:function(a){this.user=a.user;delete a.user;this.addMimetype("files");this.uploadable=new Ui.Uploadable;this.setContent(this.uploadable);a=new Ui.LBox;this.uploadable.setContent(a);this.graphic=new Ui.ButtonGraphic;a.append(this.graphic);this.image=new Ui.Image({width:64,height:64,margin:10});a.append(this.image);this.connect(this.uploadable,"down",function(){this.graphic.setIsDown(!0)});
this.connect(this.uploadable,"up",function(){this.graphic.setIsDown(!1)});this.connect(this.uploadable,"focus",function(){this.graphic.setColor(this.getStyleProperty("focusColor"))});this.connect(this.uploadable,"blur",function(){this.graphic.setColor(this.getStyleProperty("color"))});this.connect(this,"dropfile",this.onUploadFile);this.connect(this.uploadable,"file",this.onUploadFile)},onUploadFile:function(a,b){var c=new Core.FilePostUploader({file:b,service:"/cloud/user/"+this.user.getId()+"/face"});
this.connect(c,"progress",this.onUploadProgress);this.connect(c,"complete",this.onUploadComplete);c.send()},onUploadProgress:function(a){},onUploadComplete:function(a){this.image.setSrc("/cloud/user/"+this.user.getId()+"/face")},onUserChange:function(){this.image.setSrc(this.user.getFaceUrl())}},{onLoad:function(){Wn.UploadFaceButton.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},onUnload:function(){Wn.UploadFaceButton.base.onUnload.call(this);this.disconnect(this.user,
"change",this.onUserChange)}});
Ui.Dialog.extend("Wn.UserProfil",{user:void 0,firstnameField:void 0,lastnameField:void 0,emailField:void 0,avatarBlob:void 0,avatarImage:void 0,notifyBox:void 0,notifyMessageSend:void 0,notifyUserAdd:void 0,notifyResourceShare:void 0,notifyCommentAdd:void 0,defaultShareField:void 0,defaultWriteField:void 0,defaultFriendField:void 0,adminField:void 0,saveButton:void 0,grid:void 0,webSection:void 0,readerSection:void 0,rfidSection:void 0,tags:void 0,saveRequests:void 0,errorRequests:void 0,constructor:function(a){this.user=
a.user;delete a.user;Ui.App.current.getUser().isAdmin()&&Wn.Contact.hasInstance(this.user)&&(this.user=new Wn.User({user:{id:this.user.getId(),face_rev:0},monitor:!1}));this.setFullScrolling(!0);this.setPreferedWidth(650);this.setPreferedHeight(550);this.setTitle("Profil utilisateur");this.setCancelButton(new Ui.Button({text:"Fermer"}));if(this.user.getIsReady())this.onUserReady();else this.connect(this.user,"ready",this.onUserReady)},onUserReady:function(){var a=[];if(Wn.User.hasInstance(this.user)&&
Ui.App.current.getUser().isAdmin()){var b=new Wn.InfoButton({text:"Commuter"});this.connect(b,"press",this.onSwitchPress);var c=new Wn.AlertButton({text:"Supprimer"});this.connect(c,"press",this.onDeletePress);Ui.App.current.getUser().getId()!==this.user.getId()&&a.push(b);a.push(c)}Ui.App.current.getUser().getId()!==this.user.getId()&&(void 0!==Ui.App.current.getUser().getContact(this.user.getId())?(b=new Ui.Button({text:"Enlever"}),this.connect(b,"press",this.onRemoveContactPress)):(b=new Ui.Button({text:"Ajouter"}),
this.connect(b,"press",this.onAddContactPress)),a.push(b));Wn.User.hasInstance(this.user)&&(this.saveButton=new Ui.Button({text:"Enregistrer"}),this.connect(this.saveButton,"press",this.onSavePress),a.push(this.saveButton));this.setActionButtons(a);a=new Ui.VBox;this.setContent(a);b=new Ui.Grid({cols:"auto,*,auto",rows:"auto,auto,auto,auto,auto,auto,auto,auto,auto,auto"});a.append(b);this.grid=b;c=new Wn.UploadFaceButton({user:this.user,marginLeft:10});b.attach(c,2,2,1,3);b.attach(new Ui.Label({text:"Pr\u00e9nom",
horizontalAlign:"right",marginRight:10}),0,3);this.firstnameField=new Ui.TextField;b.attach(this.firstnameField,1,3,1,1);b.attach(new Ui.Label({text:"Nom",horizontalAlign:"right",marginRight:10}),0,4);this.lastnameField=new Ui.TextField;b.attach(this.lastnameField,1,4,1,1);b.attach(new Ui.Label({text:"Description",horizontalAlign:"right",marginRight:10}),0,5);this.descField=new Ui.TextAreaField;b.attach(this.descField,1,5,2,1);Wn.User.hasInstance(this.user)&&(b.attach(new Ui.Label({text:"Email",horizontalAlign:"right",
marginRight:10}),0,6),this.emailField=new Ui.TextField,this.connect(this.emailField,"change",function(a,b){""==b?this.notifyBox.disable():this.notifyBox.enable()}),b.attach(this.emailField,1,6,2,1),b.attach(new Ui.Text({text:"Notifications par email",textAlign:"right",verticalAlign:"center",marginRight:10,width:80}),0,7),this.notifyBox=new Ui.VBox({uniform:!0}),this.notifyBox.disable(),b.attach(this.notifyBox,1,7,2,1),this.notifyMessageSend=new Ui.CheckBox({text:"on m'a envoy\u00e9 un message"}),
this.notifyBox.append(this.notifyMessageSend),this.notifyUserAdd=new Ui.CheckBox({text:"on m'a ajout\u00e9 en contact"}),this.notifyBox.append(this.notifyUserAdd),this.notifyResourceShare=new Ui.CheckBox({text:"on m'a partag\u00e9 une resource"}),this.notifyBox.append(this.notifyResourceShare),this.notifyCommentAdd=new Ui.CheckBox({text:"on a rajout\u00e9 un commentaire"}),this.notifyBox.append(this.notifyCommentAdd),b.attach(new Ui.Text({text:"Droit de partage",textAlign:"right",verticalAlign:"center",
marginRight:10,width:80}),0,8),c=new Ui.VBox({uniform:!0}),this.defaultShareField=new Ui.CheckBox({text:"autoriser le repartage"}),c.append(this.defaultShareField),this.defaultWriteField=new Ui.CheckBox({text:"autoriser la modification"}),c.append(this.defaultWriteField),b.attach(c,1,8,2,1),Ui.App.current.getUser().isAdmin()&&(b.attach(new Ui.Text({text:"Admin flags",textAlign:"right",verticalAlign:"center",marginRight:10,width:80,color:"red"}),0,9),c=new Ui.VBox({uniform:!0}),this.adminField=new Ui.CheckBox({text:"compte administrateur"}),
c.append(this.adminField),this.defaultFriendField=new Ui.CheckBox({text:"compte d'ami par d\u00e9fault"}),c.append(this.defaultFriendField),b.attach(c,1,9,2,1)),this.webSection=new Wn.WebAccountSection({user:this.user}),a.append(this.webSection),c=new Wn.DeviceSection({user:this.user,devices:this.user.getData().devices}),a.append(c),this.readerSection=new Wn.ReaderSection({user:this.user,device:null,readers:this.user.getData().readers,title:"Lecteurs RFID li\u00e9s \u00e0 mon compte"}),a.append(this.readerSection));
this.tags=Ui.App.current.getUser().getRfidsFromPath("user:"+this.user.getId());this.rfidSection=new Wn.RfidSection({user:Ui.App.current.getUser(),tags:this.tags,path:"user:"+this.user.getId()});a.append(this.rfidSection);Ui.App.current.getUser().isAdmin()&&(c=new Wn.UserStatsSection({contact:this.user}),a.append(c));this.firstnameField.setValue(this.user.getData().firstname);this.lastnameField.setValue(this.user.getData().lastname);this.descField.setValue(this.user.getData().description);Wn.User.hasInstance(this.user)?
(this.emailField.setValue(this.user.getData().email),""==this.user.getData().email||void 0==this.user.getData().email?this.notifyBox.disable():this.notifyBox.enable(),this.notifyMessageSend.setValue(this.user.getData().email_notify_message_received),this.notifyUserAdd.setValue(this.user.getData().email_notify_contact_added),this.notifyResourceShare.setValue(this.user.getData().email_notify_resource_shared),this.notifyCommentAdd.setValue(this.user.getData().email_notify_comment_added),this.defaultShareField.setValue(this.user.getData().default_share_right),
this.defaultWriteField.setValue(this.user.getData().default_write_right),Ui.App.current.getUser().isAdmin()&&(this.adminField.setValue(this.user.getData().admin),this.defaultFriendField.setValue(this.user.getData().default_friend))):b.disable()},onSavePress:function(){this.saveRequests=[];this.errorRequests=[];var a={};a.firstname=this.firstnameField.getValue();a.lastname=this.lastnameField.getValue();a.email=this.emailField.getValue();""===a.email&&(a.email=null);a.description=this.descField.getValue();
a.email_notify_message_received=this.notifyMessageSend.getValue();a.email_notify_contact_added=this.notifyUserAdd.getValue();a.email_notify_resource_shared=this.notifyResourceShare.getValue();a.email_notify_comment_added=this.notifyCommentAdd.getValue();a.default_share_right=this.defaultShareField.getValue();a.default_write_right=this.defaultWriteField.getValue();Ui.App.current.getUser().isAdmin()&&(a.admin=this.adminField.getValue(),a.default_friend=this.defaultFriendField.getValue());a=Core.Object.diff(this.user.getData(),
a);void 0!==a&&(a=new Core.HttpRequest({method:"PUT",url:"/cloud/user/"+this.user.getId(),content:JSON.stringify(a)}),this.connect(a,"done",this.onSaveDone),this.connect(a,"error",this.onSaveError),this.saveRequests.push(a),a.send());0===this.saveRequests.length?this.close():(this.grid.disable(),this.saveButton.disable())},testSaveEnd:function(){if(0==this.saveRequests.length)if(0<this.errorRequests.length){this.grid.enable();this.saveButton.enable();var a=new Ui.Dialog({preferedWidth:300,title:"Echec de l'enregistrement"});
a.setContent(new Ui.Text({text:"L'enregistrement \u00e0 \u00e9chou\u00e9. V\u00e9rifiez que votre mot de passe respecte la politique de s\u00e9curit\u00e9. A savoir qu'il doit faire au moins 8 caract\u00e8res et contenir des chiffres et des lettres."}));var b=new Ui.Button({text:"Fermer"});a.setActionButtons([b]);this.connect(b,"press",function(){a.close()});a.open()}else this.close()},onSaveDone:function(a){for(var b=void 0,c=0;c<this.saveRequests.length;c++)this.saveRequests[c]===a&&(b=c);void 0!==
b&&this.saveRequests.splice(b,1);this.testSaveEnd()},onSaveError:function(a){this.errorRequests.push(a);for(var b=void 0,c=0;c<this.saveRequests.length;c++)this.saveRequests[c]===a&&(b=c);void 0!==b&&this.saveRequests.splice(b,1);this.testSaveEnd()},onDeletePress:function(){var a=new Ui.Dialog({title:"Suppression de compte",fullScrolling:!0,preferedWidth:300,preferedHeight:300});a.setContent(new Ui.Text({text:"Voulez vous vraiment supprimer ce compte ? ATTENTION, cet utilisateur et toutes ses ressources n'existeront plus apr\u00e8s cette action."}));
a.setCancelButton(new Ui.Button({text:"Annuler"}));var b=new Wn.AlertButton({text:"Supprimer"});a.setActionButtons([b]);this.connect(b,"press",function(){a.disable();var b=new Core.HttpRequest({method:"DELETE",url:"/cloud/user/"+this.user.getId()});this.connect(b,"done",function(){a.close();Ui.App.current.setMainPath("");this.close()});this.connect(b,"error",function(){a.close();this.close()});b.send()});a.open()},onSwitchPress:function(){var a=new Ui.Dialog({title:"Connexion au compte",fullScrolling:!0,
preferedWidth:300,preferedHeight:300});a.setContent(new Ui.Text({text:"Voulez vous vraiment ouvrir une session sur le compte de cet utilisateur ? ATTENTION, vous ne serez plus sur votre compte et vous aller agir au nom de cette personne."}));a.setCancelButton(new Ui.Button({text:"Annuler"}));var b=new Wn.InfoButton({text:"Commuter"});a.setActionButtons([b]);this.connect(b,"press",function(){a.close();window.open("/?user="+encodeURIComponent(this.user.getId()))});a.open()},onRemoveContactPress:function(){var a=
new Ui.Dialog({title:"Enlever un contact",fullScrolling:!0,preferedWidth:300,preferedHeight:300,cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous supprimer ce contact de votre liste de contact ?\n\nCela ne vous emp\u00eachera pas de le remettre plus tard si vous changez d'avis."})}),b=new Ui.Button({text:"Enlever"});this.connect(b,"press",function(){Ui.App.current.getUser().removeContact(this.user);a.close();this.close()});a.setActionButtons([b]);a.open()},onAddContactPress:function(){var a=
new Ui.Dialog({title:"Ajout de contact",fullScrolling:!0,preferedWidth:300,preferedHeight:300,cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous ajouter ce contact dans votre liste de contact ?"})}),b=new Ui.Button({text:"Ajouter",style:{"Ui.Button":{color:"#43c3ff"}}});this.connect(b,"press",function(){Ui.App.current.getUser().prependContact(this.user);a.close();this.close()});a.setActionButtons([b]);a.open()}});Wn.FlowDropBox.extend("Wn.UserResourcesFlow",{},{checkPosition:function(a){return a==this.getLogicalChildren().length?!1:!0}});
Ui.LBox.extend("Wn.UserResourcesView",{user:void 0,resources:void 0,constructor:function(a){this.user=a.user;delete a.user;this.resources=new Wn.UserResourcesFlow({verticalAlign:"top"});this.resources.addMimetype("Wn.ResourceView");this.setContent(this.resources);this.connect(this.resources,"dropat",this.onResourceDropAt);this.resources.append(new Wn.ResourceNew({user:this.user,margin:5,width:210,height:244}))},onUserChange:function(){for(var a=[],b=[],c=0;c<this.resources.getLogicalChildren().length;c++)this.resources.getLogicalChildren()[c].userViewFound=
!1;for(var d=0;d<this.user.getBookmarks().length;d++){for(var e=this.user.getBookmarks()[d],f=void 0,c=0;void 0==f&&c<this.resources.getLogicalChildren().length;c++)Wn.ResourceView.hasInstance(this.resources.getLogicalChildren()[c])&&this.resources.getLogicalChildren()[c].getResource().getId()==e.getId()&&(f=this.resources.getLogicalChildren()[c]);void 0==f?b.push(e):f.userViewFound=!0}for(c=0;c<this.resources.getLogicalChildren().length;c++)Wn.ResourceView.hasInstance(this.resources.getLogicalChildren()[c])&&
(this.resources.getLogicalChildren()[c].userViewFound||a.push(this.resources.getLogicalChildren()[c]));for(d=0;d<a.length;d++)this.resources.remove(a[d]);if(0<b.length)for(d=0;d<b.length;d++)if(b[d].getIsReady())this.onAddNewResourceReady(b[d]);else this.connect(b[d],"ready",this.onAddNewResourceReady)},onAddNewResourceReady:function(a){var b=Wn.ResourceView.getView(a.getType());void 0===b&&(b=Wn.ResourceView);a=new b({user:this.user,resource:a,margin:5,width:210,height:244});this.resources.insertAt(a,
this.resources.getLogicalChildren().length-1)},onResourceDropAt:function(a,b,c,d){a=void 0;b=-1;for(var e=0;e<this.resources.getLogicalChildren().length&&void 0===a;e++){var f=this.resources.getLogicalChildren()[e];Wn.ResourceView.hasInstance(f)&&f===c&&(a=f,b=e)}void 0!==a&&b!=d&&b+1!=d&&(b<d&&d--,this.resources.moveAt(a,d),this.user.setBookmarkPosition(a.getResource(),d))}},{onLoad:function(){Wn.UserResourcesView.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},
onUnload:function(){Wn.UserResourcesView.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange)}});Ui.CompactLabel.extend("Wn.UserTitle",{constructor:function(a){this.setMaxLine(2);this.setWidth(100)}});
Ui.LBox.extend("Wn.UserView",{user:void 0,messages:void 0,menuBackground:void 0,menuvbox:void 0,userface:void 0,messagesScroll:void 0,contentBox:void 0,selection:void 0,menuBox:void 0,actionBox:void 0,contextBox:void 0,constructor:function(a){this.user=a.user;delete a.user;a=new Ui.VBox;this.setContent(a);this.selection=new Ui.Selection;this.connect(this.selection,"change",this.onSelectionChange);this.menuBox=new Ui.LBox;a.append(this.menuBox);this.actionBox=new Ui.MenuToolBar({margin:5,spacing:5});
this.menuBox.append(this.actionBox);this.userface=new Wn.UserFace({user:this.user});this.actionBox.append(this.userface);this.userlabel=new Wn.UserTitle({text:"",marginLeft:10,marginRight:10,textAlign:"left",verticalAlign:"center"});this.actionBox.append(this.userlabel,!0);if(Ui.App.current.getUser().isAdmin()){var b=new Ui.Button({icon:"stats"});this.connect(b,"press",this.onGlobalStatsPress);this.actionBox.append(b)}b=new Ui.Button({icon:"chathistory"});this.connect(b,"press",this.onChatHistoryPress);
this.actionBox.append(b);b=new Ui.Button({icon:"person"});this.connect(b,"press",this.onProfilPress);this.actionBox.append(b);b=new Ui.Button({icon:"exit"});this.connect(b,"press",this.onExitPress);this.actionBox.append(b);this.contextBox=new Ui.ContextBar({selection:this.selection});this.contextBox.hide();this.menuBox.append(this.contextBox);b=new Ui.ScrollingArea({scrollHorizontal:!1});a.append(b,!0);a=new Ui.VBox;b.setContent(a);this.messagesScroll=new Ui.ScrollingArea({scrollVertical:!1,directionRelease:!0});
a.append(this.messagesScroll);this.messages=new Ui.HBox({uniform:!0,horizontalAlign:"left"});this.messagesScroll.setContent(this.messages);a.append(new Wn.UserResourcesView({user:this.user}));this.user.updateUser();this.user.updateMessages()},getSelectionHandler:function(){return this.selection},onUserChange:function(){this.userlabel.setText(this.user.getUser().firstname+" "+this.user.getUser().lastname)},onUserMessagesChange:function(){for(;void 0!=this.messages.getFirstChild();)this.messages.remove(this.messages.getFirstChild());
for(var a=0,b=0;b<this.user.getMessages().length;b++){var c=this.user.getMessages()[b];c.getDestination()!=this.user.getId()||c.getSeen()||(c=new Wn.MessageView({user:this.user,message:c,width:210,height:54,margin:5}),this.messages.append(c),a++)}},onGlobalStatsPress:function(){(new Wn.UserStatsDialog).open()},onChatHistoryPress:function(){(new Wn.HistoryMessagesDialog({user:this.user})).open()},onProfilPress:function(){(new Wn.UserProfil({user:this.user})).open()},onExitPress:function(){if(void 0!=
Ui.App.current.getArguments().user){var a=new Ui.Dialog({title:"D\u00e9connexion",fullScrolling:!1,preferedWidth:350,cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous vraiment vous fermer votre session sur ce compte utilisateur ?"})}),b=new Wn.AlertButton({text:"Fermer"});this.connect(b,"press",function(){window.close()})}else a=new Ui.Dialog({title:"D\u00e9connexion",fullScrolling:!1,preferedWidth:300,cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous vraiment vous d\u00e9connecter ?"})}),
b=new Wn.AlertButton({text:"D\u00e9connecter"}),this.connect(b,"press",function(){"localStorage"in window&&(localStorage.removeItem("login"),localStorage.removeItem("password"),localStorage.removeItem("currentPath"));document.cookie="HOST_AUTH=; expires=Thu, 01-Jan-1970 00:00:01 GMT";var a=new Core.HttpRequest({method:"DELETE",url:"/cloud/authsession/current"});this.connect(a,"done",this.onAuthSessionDelete);this.connect(a,"error",this.onAuthSessionDelete);a.send()});a.setActionButtons([b]);a.open()},
onAuthSessionDelete:function(){var a=window.location.href;-1!=a.lastIndexOf("#")&&(a=a.substring(0,a.lastIndexOf("#")));window.location.replace(a)},onDeletePress:function(){var a=new Ui.Dialog({preferedWidth:300,title:"Suppression de compte"});a.setContent(new Ui.Text({text:"Voulez vous vraiment supprimer votre compte ? ATTENTION, vous ne pourrez plus connecter et toutes vos ressources seront supprim\u00e9es."}));a.setCancelButton(new Ui.Button({text:"Annuler"}));var b=new Ui.Button({text:"Supprimer"});
b.setStyle({"Ui.Button":{color:"#d04040"}});a.setActionButtons([b]);this.connect(b,"press",function(){a.disable();var b=new Core.HttpRequest({method:"DELETE",url:"/cloud/user?cmd=delete&user="+this.user.getId()});this.connect(b,"done",function(){a.close();window.location.reload()});this.connect(b,"error",function(){a.close();window.location.reload()});b.send()});a.open()},onSelectionChange:function(a){0===a.getElements().length?(this.contextBox.hide(),this.actionBox.show()):(this.contextBox.show(),
this.actionBox.hide())}},{onLoad:function(){Wn.UserResourcesView.base.onLoad.call(this);this.connect(this.user,"change",this.onUserChange);this.onUserChange();this.connect(this.user,"messageschange",this.onUserMessagesChange);this.onUserMessagesChange()},onUnload:function(){Wn.UserResourcesView.base.onUnload.call(this);this.disconnect(this.user,"change",this.onUserChange);this.disconnect(this.user,"messageschange",this.onUserMessagesChange)}});Core.Object.extend("Wn.Message",{message:void 0,ready:!1,request:void 0,constructor:function(a){this.addEvents("ready","change","delete");if("message"in a)this.message=a.message,delete a.message,this.updateData(this.message);else if("id"in a){var b=a.id;delete a.id;this.message={id:b};this.update()}},getIsReady:function(){return this.ready},update:function(){void 0!==this.request&&(this.disconnect(this.request,"done",this.onGetMessageDone),this.disconnect(this.request,"error",this.onGetMessageError),
this.request.abort());this.request=new Core.HttpRequest({url:"/cloud/message/"+this.message.id});this.connect(this.request,"done",this.onGetMessageDone);this.connect(this.request,"error",this.onGetMessageError);this.request.send()},updateData:function(a){this.message=a;this.ready||(this.ready=!0,this.fireEvent("ready",this));this.fireEvent("change",this)},getMessage:function(){return this.message},getId:function(){return this.message.id},getType:function(){return this.message.type},getOrigin:function(){return this.message.origin},
getDestination:function(){return this.message.destination},getSeen:function(){return-1!==this.message.seen},getDate:function(){return new Date(1E3*this.message.create)},getContent:function(){return this.message.content},markSeen:function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/message/"+this.message.id})).send()},onGetMessageError:function(a){404==a.getStatus()&&this.fireEvent("delete",this);this.request=void 0},onGetMessageDone:function(a){a=a.getResponseJSON();this.updateData(a);this.request=
void 0}});Ui.Pressable.extend("Wn.MessageView",{user:void 0,message:void 0,contact:void 0,comment:void 0,contactface:void 0,previewBox:void 0,label:void 0,constructor:function(a){this.user=a.user;delete a.user;this.message=a.message;delete a.message;this.append(new Wn.ContentBgGraphic({color:"#7e1967"}));var b=new Ui.HBox;this.append(b);this.label=new Ui.CompactLabel({margin:10,marginRight:0,width:142,height:40,fontSize:20,maxLine:2,color:"#f1f1f1"});b.append(this.label,!0);a=new Ui.LBox({verticalAlign:"top",
horizontalAlign:"right",margin:8});b.append(a);b=new Ui.LBox({verticalAlign:"top",marginTop:8,marginLeft:8});a.append(b);b.append(new Ui.Rectangle({fill:"#999999"}));b.append(new Ui.Rectangle({fill:"#f1f1f1",margin:1}));this.contact=Wn.Contact.getContact(this.message.getOrigin());this.contactface=new Ui.Image({width:32,height:32,margin:1,src:this.contact.getFaceUrl()});b.append(this.contactface);b="bubble";"resource"==this.message.getType()?b="resource":"contact"==this.message.getType()?b="person":
"comment"==this.message.getType()&&(b="resource-comment");b=new Wn.DualIcon({width:24,height:24,icon:b,verticalAlign:"top",horizontalAlign:"left"});a.append(b);this.displayContent();this.connect(this,"press",this.onMessageViewPress)},getMessage:function(){return this.message},onMessageViewPress:function(){this.message.markSeen();"contact"==this.message.getType()?Ui.App.current.setMainPath("user:"+this.contact.getId()):"resource"==this.message.getType()?Ui.App.current.setMainPath("resource:"+this.message.getContent().id):
"comment"==this.message.getType()?Ui.App.current.setMainPath("resource:"+this.message.getContent().resource.id+":"+this.message.getContent().file):(new Wn.ContactMessagesDialog({user:this.user,contact:this.contact})).open()},displayContent:function(){"message"==this.message.getType()?this.label.setText(this.message.getContent()):"contact"==this.message.getType()?this.label.setText("Vous a ajout\u00e9 \u00e0 ses contacts"):"resource"==this.message.getType()?this.label.setText(this.message.getContent().name):
"comment"==this.message.getType()&&this.label.setText(this.message.getContent().text)}});Ui.LBox.extend("Wn.Preview",{user:void 0,resource:void 0,constructor:function(a){this.setWidth(190);this.setHeight(190);this.resource=a.resource;delete a.resource;this.user=a.user;delete a.user},getResource:function(){return this.resource},getUser:function(){return this.user}},{},{previews:void 0,constructor:function(){this.previews={}},register:function(a,b){Wn.Preview.previews[a]=b},getPreview:function(a){return Wn.Preview.previews[a]}});Ui.LBox.extend("Wn.Viewer",{user:void 0,constructor:function(a){this.user=a.user;delete a.user},getUser:function(){return this.user}},{},{viewers:void 0,constructor:function(){this.viewers={}},register:function(a,b){Wn.Viewer.viewers[a]=b},getViewer:function(a){return Wn.Viewer.viewers[a]}});Ui.Dialog.extend("Wn.ResourcePropertiesDialog",{user:void 0,resource:void 0,flow:void 0,deleteButton:void 0,modifyButton:void 0,nameField:void 0,constructor:function(a){this.user=a.user;delete a.user;this.resource=a.resource;delete a.resource;this.setPreferedWidth(500);this.setPreferedHeight(500);this.setFullScrolling(!0);this.setTitle("Propri\u00e9t\u00e9s de la ressource");this.setCancelButton(new Ui.Button({text:"Fermer"}));a=new Ui.VBox;this.setContent(a);var b=new Ui.HBox({spacing:10});a.append(b);
b.append(new Ui.Text({text:"Nom",width:100,textAlign:"right",verticalAlign:"center"}));this.nameField=new Ui.TextField({value:this.resource.getName(),verticalAlign:"center"});b.append(this.nameField,!0);var c=new Wn.ResourceSharesSection({user:this.user,resource:this.resource});a.append(c);c=this.user.getRfidsFromPath("resource:"+this.resource.getId());c=new Wn.RfidSection({user:this.user,tags:c,path:"resource:"+this.resource.getId()});a.append(c);Ui.App.current.getUser().isAdmin()||this.resource.canWrite()?
(this.deleteButton=new Wn.AlertButton({text:"Supprimer"}),this.connect(this.deleteButton,"press",this.onDeletePress),this.saveButton=new Ui.Button({text:"Enregistrer"}),this.connect(this.saveButton,"press",this.onSavePress),this.setActionButtons([this.deleteButton,this.saveButton])):b.disable()},onSavePress:function(){this.resource.changeData({name:this.nameField.getValue()});this.close()},onDeletePress:function(){var a=new Wn.ResourceDeleteDialog({resource:this.resource});this.connect(a,"done",function(){this.close()});
a.open()}});Ui.Dialog.extend("Wn.ResourceSharesModifyDialog",{flow:void 0,selection:void 0,modifyButton:void 0,shareField:void 0,writeField:void 0,constructor:function(a){this.selection=a.selection;delete a.selection;this.setPreferedWidth(400);this.setPreferedHeight(400);this.setFullScrolling(!0);this.setTitle("Modification des droits");this.setCancelButton(new Ui.Button({text:"Fermer"}));this.modifyButton=new Ui.Button({text:"Appliquer"});this.connect(this.modifyButton,"press",this.onModifyPress);this.setActionButtons([this.modifyButton]);
a=new Ui.VBox;this.setContent(a);var b=new Ui.HBox({uniform:!0});a.append(b);this.writeField=new Ui.CheckBox({text:"Ecriture"});this.selection[0].getResource().canWrite()&&b.append(this.writeField);this.shareField=new Ui.CheckBox({text:"Partage"});b.append(this.shareField);this.flow=new Ui.Flow({uniform:!0,margin:20});a.append(this.flow);for(var b=a=!0,c=0;c<this.selection.length;c++){var d=this.selection[c],e=d.getRight(),f=d.getResource(),d=d.getUser();a&=e.share;b&=e.write;e=-1==e.user_id?new Wn.ResourceWorldRight({resource:f,
user:d,right:e,margin:5}):new Wn.ResourceContactRight({resource:f,user:d,right:e,margin:5});e.disable();this.flow.append(e)}this.writeField.setValue(b);this.shareField.setValue(a)},onModifyPress:function(){for(var a=0;a<this.selection.length;a++){var b=this.selection[a],c=Core.Util.clone(b.getRight());c.share=this.shareField.getValue();b=b.getResource();b.canWrite()&&(c.write=this.writeField.getValue());-1==c.user_id?b.addPublicRights(c):b.addRights(c)}this.close()}});
Ui.Selectionable.extend("Wn.ResourceRight",{},{getSelectionActions:function(){return Wn.ResourceRight.rightActions}},{rightActions:void 0,constructor:function(){Wn.ResourceRight.rightActions={"delete":{text:"Supprimer",icon:"trash",color:"#d02020",callback:Wn.ResourceRight.onRightDelete,multiple:!0},edit:{"default":!0,text:"Editer",icon:"pen",callback:Wn.ResourceRight.onRightEdit,multiple:!0}}},onRightEdit:function(a){a=a.getElements();(new Wn.ResourceSharesModifyDialog({selection:a})).open()},onRightDelete:function(a){for(var b=
a.getElements(),c=0;c<b.length;c++)b[c].deleteRight();a.clear()}});
Wn.ResourceRight.extend("Wn.ResourceContactRight",{user:void 0,right:void 0,contact:void 0,resource:void 0,image:void 0,label:void 0,shareRight:void 0,writeRight:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.user=a.user;delete a.user;this.right=a.right;delete a.right;a=new Ui.VBox;this.setContent(a);var b=new Ui.LBox({horizontalAlign:"center",verticalAlign:"bottom"});a.append(b);b.append(new Ui.Rectangle({fill:"#999999"}));b.append(new Ui.Rectangle({fill:"#f1f1f1",
margin:1}));this.image=new Ui.Image({width:46,height:46,margin:1});b.append(this.image);var c=new Ui.HBox({uniform:!0,verticalAlign:"bottom",horizontalAlign:"right",margin:3});this.shareRight=new Wn.DualIcon({icon:"share",fill:"#f1f1f1",width:20,height:20});c.append(this.shareRight);this.writeRight=new Wn.DualIcon({icon:"pen",fill:"#f1f1f1",width:20,height:20});c.append(this.writeRight);b.append(c);this.label=new Ui.CompactLabel({text:"",fontSize:14,width:80,maxLine:2,textAlign:"center",color:"#67696c",
horizontalAlign:"center"});a.append(this.label);this.contact=Wn.Contact.getContact(this.right.user_id)},getUser:function(){return this.user},getRight:function(){return this.right},getResource:function(){return this.resource},deleteRight:function(){this.resource.addRights({user_id:this.right.user_id,read:!1,write:!1,share:!1})},changeRight:function(a){this.resource.addRights({user_id:this.right.user_id,read:a.read,write:a.write,share:a.share})},onResourceChange:function(){for(var a={},b=0;b<this.resource.getRights().length;b++)this.resource.getRights()[b].user_id==
this.right.user_id&&(a=this.resource.getRights()[b]);a.share?this.shareRight.show():this.shareRight.hide();a.write?this.writeRight.show():this.writeRight.hide()},onContactChange:function(){this.label.setText(this.contact.getFirstname()+" "+this.contact.getLastname());this.image.setSrc(this.contact.getFaceUrl())}},{onLoad:function(){Wn.ResourceContactRight.base.onLoad.call(this);this.connect(this.contact,"change",this.onContactChange);if(this.contact.getIsReady())this.onContactChange();this.connect(this.resource,
"change",this.onResourceChange);if(this.resource.getIsReady())this.onResourceChange()},onUnload:function(){Wn.ResourceContactRight.base.onUnload.call(this);this.disconnect(this.contact,"change",this.onContactChange);this.disconnect(this.resource,"change",this.onResourceChange)}});
Wn.ResourceRight.extend("Wn.ResourceWorldRight",{user:void 0,right:void 0,resource:void 0,image:void 0,label:void 0,shareRight:void 0,writeRight:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.user=a.user;delete a.user;this.right=a.right;this.right.user_id=-1;delete a.right;a=new Ui.VBox;this.setContent(a);var b=new Ui.LBox({horizontalAlign:"center",verticalAlign:"bottom"});a.append(b);this.image=new Ui.Icon({width:48,height:48,fill:"#444444",icon:"earth",margin:1});
b.append(this.image);var c=new Ui.HBox({uniform:!0,verticalAlign:"bottom",horizontalAlign:"right",margin:3});this.shareRight=new Wn.DualIcon({icon:"share",fill:"#f1f1f1",width:20,height:20});c.append(this.shareRight);this.writeRight=new Wn.DualIcon({icon:"pen",fill:"#f1f1f1",width:20,height:20});c.append(this.writeRight);b.append(c);this.label=new Ui.CompactLabel({text:"Tout le monde",fontSize:14,width:80,maxLine:2,textAlign:"center",color:"#67696c",horizontalAlign:"center"});a.append(this.label)},
getUser:function(){return this.user},getRight:function(){return this.right},getResource:function(){return this.resource},deleteRight:function(){this.resource.addPublicRights({read:!1,write:!1,share:!1})},changeRight:function(a){this.resource.addPublicRights({read:a.read,write:a.write,share:a.share})},onResourceChange:function(){var a=this.resource.getPublicRights();a.share?this.shareRight.show():this.shareRight.hide();a.write?this.writeRight.show():this.writeRight.hide()}},{onLoad:function(){Wn.ResourceWorldRight.base.onLoad.call(this);
this.connect(this.resource,"change",this.onResourceChange);if(this.resource.getIsReady())this.onResourceChange()},onUnload:function(){Wn.ResourceWorldRight.base.onUnload.call(this);this.disconnect(this.resource,"change",this.onResourceChange)}});
Ui.Pressable.extend("Wn.ResourceContactAdd",{user:void 0,resource:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.user=a.user;delete a.user;this.setContent(new Ui.Icon({icon:"plus",width:48,height:48,fill:"#444444",horizontalAlign:"center",verticalAlign:"center"}));this.connect(this,"press",this.onAddPress)},onAddPress:function(){(new Wn.AddContactRightDialog({user:this.user,resource:this.resource})).open()}});
Wn.OptionSection.extend("Wn.ResourceSharesSection",{user:void 0,resource:void 0,flow:void 0,deleteButton:void 0,modifyButton:void 0,selection:void 0,constructor:function(a){this.user=a.user;delete a.user;this.resource=a.resource;delete a.resource;this.setTitle("Partages");this.flow=new Ui.Flow({uniform:!0});this.setContent(this.flow)},onModifyPress:function(){for(var a=[],b=0;b<this.selection.length;b++)a.push(this.selection[b].getRight());(new Wn.ResourceSharesModifyDialog({user:this.user,resource:this.resource,
selection:a})).open()},deleteSelected:function(){for(var a=0;a<this.selection.length;a++){var b=this.selection[a];b.deleteRight();this.flow.remove(b)}},onResourceChange:function(){for(;void 0!=this.flow.getFirstChild();)this.flow.remove(this.flow.getFirstChild());if(this.resource.getPublicRights().read){var a=new Wn.ResourceWorldRight({resource:this.resource,user:this.user,right:this.resource.getPublicRights()});this.resource.canShare()||a.disable();this.flow.append(a)}for(var b=0;b<this.resource.getRights().length;b++)a=
this.resource.getRights()[b],a=new Wn.ResourceContactRight({resource:this.resource,user:this.user,right:a}),this.resource.canShare()||a.disable(),this.flow.append(a);this.resource.canShare()&&(b=new Wn.ResourceContactAdd({resource:this.resource,user:this.user}),this.flow.append(b))},onDrop:function(a,b,c){this.resource.addRights({user_id:c,read:!0,write:!0,share:!0})}},{onLoad:function(){Wn.ResourceSharesSection.base.onLoad.call(this);this.connect(this.resource,"change",this.onResourceChange);if(this.resource.getIsReady())this.onResourceChange()},
onUnload:function(){Wn.ResourceSharesSection.base.onUnload.call(this);this.disconnect(this.resource,"change",this.onResourceChange)}});Ui.Dialog.extend("Wn.ResourceDeleteDialog",{resource:void 0,constructor:function(a){this.addEvents("done");this.resource=a.resource;delete a.resource;this.setPreferedWidth(300);this.setPreferedHeight(200);this.setFullScrolling(!0);this.setTitle("Suppression");Ui.App.current.getUser().isAdmin()||this.resource.canWrite()?(this.setCancelButton(new Ui.Button({text:"Annuler"})),this.setContent(new Ui.Text({text:"Voulez vous vraiment supprimer cette ressource pour vous et toutes les personnes avec qui vous la partag\u00e9e ?"})),
a=new Wn.AlertButton({text:"Supprimer"}),this.connect(a,"press",function(){this.close();this.resource.deleteResource();this.fireEvent("done",this,this.resource)}),this.setActionButtons([a])):(this.setCancelButton(new Ui.Button({text:"Fermer"})),this.setContent(new Ui.Text({text:"Voulez n'avez pas les droits n\u00e9cessaires pour supprimer cette ressource"})))}});Ui.CompactLabel.extend("Wn.ResourceViewerTitle",{constructor:function(a){this.setMaxLine(2);this.setWidth(100)}});
Ui.VBox.extend("Wn.ResourceViewer",{resource:void 0,path:void 0,user:void 0,contact:void 0,contactface:void 0,contentBox:void 0,resourcelabel:void 0,isFullscreen:!1,unfullscreenButton:void 0,selection:void 0,menuBox:void 0,actionBox:void 0,contextBox:void 0,propertyButton:void 0,fullscreenButton:void 0,bookmarkButton:void 0,constructor:function(a){this.addEvents("fullscreen","unfullscreen");this.user=a.user;delete a.user;this.resource=a.resource;delete a.resource;"contact"in a&&(this.contact=a.contact,
delete a.contact);"path"in a&&(this.path=a.path,delete a.path);this.selection=new Ui.Selection;this.connect(this.selection,"change",this.onSelectionChange);this.menuBox=new Ui.LBox;this.append(this.menuBox);this.actionBox=new Ui.MenuToolBar({margin:5,spacing:5});this.menuBox.append(this.actionBox);this.contextBox=new Ui.ContextBar({selection:this.selection});this.contextBox.hide();this.menuBox.append(this.contextBox);this.contactface=new Wn.UserFace({user:void 0!==this.contact?this.contact:this.user});
this.actionBox.append(this.contactface);this.resourcelabel=new Wn.ResourceViewerTitle({text:"",marginLeft:10,marginRight:10,textAlign:"left",verticalAlign:"center"});this.resourcelabel.setText(this.resource.getName());this.actionBox.append(this.resourcelabel,!0);this.propertyButton=new Ui.Button({icon:"tools"});this.actionBox.append(this.propertyButton);this.connect(this.propertyButton,"press",function(){(new Wn.ResourcePropertiesDialog({user:this.user,resource:this.resource})).open()});this.fullscreenButton=
new Ui.Button({icon:"fullscreen"});this.actionBox.append(this.fullscreenButton);this.connect(this.fullscreenButton,"press",function(){this.fullscreen()});void 0!=this.contact&&(this.bookmarkButton=new Ui.ToggleButton({icon:"star"}),this.resource.getBookmark()&&this.bookmarkButton.toggle(),this.connect(this.bookmarkButton,"toggle",this.onBookmarkToggle),this.connect(this.bookmarkButton,"untoggle",this.onBookmarkUntoggle),this.actionBox.append(this.bookmarkButton));this.contentBox=new Ui.LBox;this.append(this.contentBox,
!0);this.resource.markSeenByMe();this.user.watchResource(this.getResource())},getSelectionHandler:function(){return this.selection},getIsFullscreen:function(){return this.isFullscreen},fullscreen:function(){this.isFullscreen||(this.isFullscreen=!0,this.remove(this.menuBox),this.unfullscreenButton=new Ui.Pressable({verticalAlign:"top",horizontalAlign:"right"}),this.unfullscreenButton.append(new Ui.Rectangle({radius:8,margin:5,fill:"white",opacity:0.4})),this.unfullscreenButton.append(new Ui.Icon({icon:"unfullscreen",
fill:"black",width:48,height:48,margin:10,opacity:0.3})),this.connect(this.unfullscreenButton,"press",this.unfullscreen),this.contentBox.append(this.unfullscreenButton),this.fireEvent("fullscreen",this))},unfullscreen:function(){this.isFullscreen&&(this.isFullscreen=!1,this.contentBox.remove(this.unfullscreenButton),this.prepend(this.menuBox),this.fireEvent("unfullscreen",this))},deleteResource:function(){this.user.removeResource(this.resource);Ui.App.current.setDefaultMain()},setActionButtons:function(a){var b=
[];b.push(this.contactface);b.push(this.resourcelabel);for(var c=0;c<a.length;c++)b.push(a[c]);b.push(this.propertyButton);b.push(this.fullscreenButton);void 0!==this.bookmarkButton&&b.push(this.bookmarkButton);this.actionBox.setContent(b)},getResource:function(){return this.resource},getPath:function(){return this.path},setPath:function(a){this.path!=a&&(this.onPathChange(this.path,a),this.path=a)},getUser:function(){return this.user},onPathChange:function(a,b){},onResourceChange:function(){this.resourcelabel.setText(this.resource.getName());
this.resource.markSeenByMe()},onDeletePress:function(){if(this.resource.canWrite()){var a=new Ui.Dialog({preferedWidth:300,preferedHeight:200,fullScrolling:!0,title:"Suppression",cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous vraiment supprimer cette ressource pour vous et toutes les personnes avec qui vous la partag\u00e9e ?"})}),b=new Wn.AlertButton({text:"Supprimer"});this.connect(b,"press",function(){a.close();this.deleteResource()});a.setActionButtons([b]);
a.open()}},onBookmarkToggle:function(){this.user.bookmarkResource(this.resource)},onBookmarkUntoggle:function(){this.user.unbookmarkResource(this.resource)},onSelectionChange:function(a){0===a.getElements().length?(this.contextBox.hide(),this.actionBox.show()):(this.contextBox.show(),this.actionBox.hide())}},{setContent:function(a){this.contentBox.setContent(a)},onLoad:function(){Wn.ResourceViewer.base.onLoad.call(this);this.connect(this.resource,"change",this.onResourceChange)},onUnload:function(){Wn.ResourceViewer.base.onUnload.call(this);
this.disconnect(this.resource,"change",this.onResourceChange)}},{apps:void 0,constructor:function(){this.apps={}},register:function(a,b){Wn.ResourceViewer.apps[a]=b},getApplication:function(a){return Wn.ResourceViewer.apps[a]}});Ui.LBox.extend("Wn.MenuSwitch",{pos:1,movable:void 0,switchbox:void 0,value:!1,alignClock:void 0,speed:0,animNext:0,animStart:0,ease:void 0,constructor:function(a){this.setFocusable(!0);this.setClipToBounds(!0);this.movable=new Ui.Movable({moveVertical:!1,margin:1,marginBottom:2});this.movable.setFocusable(!1);this.append(this.movable);this.switchbox=new Wn.SwitchBox;this.movable.setContent(this.switchbox);this.connect(this.movable,"move",this.onMove);this.connect(this.movable,"down",this.onDown);
this.connect(this.movable,"up",this.onUp);this.addEvents("change");"ease"in a?this.setEase(a.ease):this.ease=Anim.EasingFunction.create({type:Anim.PowerEase,mode:"out"})},setEase:function(a){this.ease=Anim.EasingFunction.create(a)},getMenu:function(){return this.switchbox.getButton()},setMenu:function(a){this.switchbox.setButton(a)},getContent1:function(){return this.switchbox.getContent1()},setContent1:function(a){this.switchbox.setContent1(a)},getContent2:function(){return this.switchbox.getContent2()},
setContent2:function(a){this.switchbox.setContent2(a)},getValue:function(){return this.value},setPos:function(a){this.pos=a;this.value=0.5>this.pos;this.invalidateArrange()},setValue:function(a){this.value!=a&&((this.value=a)?this.startAnimation(2):this.startAnimation(-2))},onMove:function(a){a=this.movable.getPositionX();var b=this.switchbox.getContentWidth();a=Math.min(0,Math.max(a,-b));this.pos=-a/b;this.updatePos()},onDown:function(a){this.focus();this.stopAnimation()},onUp:function(a,b,c,d,e,
f){b=100>Math.abs(b)?0.5<this.pos?-1:1:b/this.switchbox.getContentWidth();0!=b&&this.startAnimation(b)},updatePos:function(){var a=this.switchbox.getContentWidth();this.movable.setPosition(-this.pos*a,void 0)},startAnimation:function(a){this.stopAnimation();this.speed=a;this.animStart=this.pos;this.animNext=0>this.speed?1:0;this.animStart!=this.animNext?(this.alignClock=new Anim.Clock({duration:"forever",scope:this,target:this,onTimeupdate:this.onAlignTick}),this.alignClock.begin()):this.value!=(0==
this.animNext)&&(this.value=0==this.animNext,this.fireEvent("change",this,this.value))},stopAnimation:function(){void 0!=this.alignClock&&(this.alignClock.stop(),this.alignClock=void 0)},onAlignTick:function(a,b,c){0!=c&&(a=-(a.getTime()*this.speed)/(this.animNext-this.animStart),1<=a&&(this.alignClock.stop(),this.alignClock=void 0,a=1,this.value=0==this.animNext,this.fireEvent("change",this,this.value)),a=this.ease.ease(a),this.pos=this.animStart+a*(this.animNext-this.animStart),this.updatePos())}},
{arrangeCore:function(a,b){Wn.MenuSwitch.base.arrangeCore.call(this,a,b);this.updatePos()}});
Ui.Container.extend("Wn.SwitchBox",{content1:void 0,content1Box:void 0,content2:void 0,content2Box:void 0,button:void 0,buttonBox:void 0,constructor:function(){this.content1Box=new Ui.LBox;this.appendChild(this.content1Box);this.buttonBox=new Ui.LBox;this.appendChild(this.buttonBox);this.content2Box=new Ui.LBox;this.appendChild(this.content2Box)},getButton:function(){return this.button},setButton:function(a){this.button!=a&&(void 0!=this.button&&this.buttonBox.remove(this.button),this.button=a,void 0!=
this.button&&this.buttonBox.append(this.button))},getContent1:function(){return this.content1},setContent1:function(a){this.content1!=a&&(void 0!=this.content1&&this.content1Box.remove(this.content1),this.content1=a,void 0!=this.content1&&this.content1Box.append(this.content1))},getContent2:function(){return this.content2},setContent2:function(a){this.content2!=a&&(void 0!=this.content2&&this.content2Box.remove(this.content2),this.content2=a,void 0!=this.content2&&this.content2Box.append(this.content2))},
getContentWidth:function(){return this.getLayoutWidth()-this.buttonBox.getLayoutWidth()}},{measureCore:function(a,b){var c=this.buttonBox.measure(0,0),d=this.content1Box.measure(a-c.width,b),e=this.content2Box.measure(a-c.width,b);return{width:Math.max(d.width,e.width)+c.width,height:Math.max(d.height,Math.max(e.height,c.height))}},arrangeCore:function(a,b){var c=a-this.buttonBox.getMeasureWidth();this.content1Box.arrange(0,0,c,b);this.content2Box.arrange(c+this.buttonBox.getMeasureWidth(),0,c,b);
this.buttonBox.arrange(c,0,this.buttonBox.getMeasureWidth(),b)}});Ui.Fixed.extend("Wn.CroppedImage",{image:void 0,src:void 0,constructor:function(a){this.setClipToBounds(!0);"src"in a?(this.src=a.src,delete a.src,this.image=new Ui.Image({src:this.src})):this.image=new Ui.Image;this.append(this.image,0,0);this.connect(this.image,"ready",this.onReady);this.connect(this,"resize",this.onResize);this.addEvents("ready")},setSrc:function(a){this.src=a;this.image.setSrc(this.src)},getIsReady:function(){return this.image.getIsReady()},onReady:function(){this.updateSize();
this.fireEvent("ready",this)},onResize:function(){this.updateSize()},updateSize:function(){var a=this.image.getNaturalWidth(),b=this.image.getNaturalHeight(),c=this.getLayoutWidth(),d=this.getLayoutHeight();if(a/b>c/d){var e=d,f=a*e/b;this.setPosition(this.image,-(f-c)/2,0)}else f=c,e=b*f/a,this.setPosition(this.image,0,-(e-d)/2);this.image.setWidth(f);this.image.setHeight(e)}});Ui.CanvasElement.extend("Wn.ScaledImage",{image:void 0,constructor:function(a){this.image=new Ui.Image;this.connect(this.image,"ready",this.onImageReady);this.appendChild(this.image)},setSrc:function(a){this.src=a;this.image.setSrc(this.src)},getIsReady:function(){return this.image.getIsReady()},onImageReady:function(){this.invalidateDraw()}},{updateCanvas:function(a){if(this.image.getIsReady()){var b=this.image.getNaturalWidth(),c=this.image.getNaturalHeight(),d=this.getLayoutWidth(),e=this.getLayoutHeight(),
f,g;b<=d&&c<=e?(d=(d-b)/2,e=(e-c)/2,f=b,g=c):b/c<d/e?(g=e,f=b*g/c,d=-(f-d)/2,e=0):(f=d,g=c*f/b,d=0,e=-(g-e)/2);a.drawImage(this.image.getDrawing(),0,0,b,c,d,e,f,g)}}});Ui.Fixed.extend("Wn.ScaledImage2",{image:void 0,src:void 0,constructor:function(a){this.setClipToBounds(!0);"src"in a?(this.src=a.src,delete a.src,this.image=new Ui.Image({src:this.src})):this.image=new Ui.Image;this.append(this.image,0,0);this.connect(this.image,"ready",this.onReady);this.connect(this,"resize",this.onResize);this.addEvents("ready")},setSrc:function(a){this.src=a;this.image.setSrc(this.src)},getIsReady:function(){return this.image.getIsReady()},onReady:function(){this.updateSize();
this.fireEvent("ready",this)},onResize:function(){this.updateSize()},updateSize:function(){var a=this.image.getNaturalWidth(),b=this.image.getNaturalHeight(),c=this.getLayoutWidth(),d=this.getLayoutHeight();if(a<=c&&b<=d)this.setPosition(this.image,(c-a)/2,(d-b)/2),this.image.setWidth(a),this.image.setHeight(b);else{if(a/b<c/d){var e=d,f=a*e/b;this.setPosition(this.image,-(f-c)/2,0)}else f=c,e=b*f/a,this.setPosition(this.image,0,-(e-d)/2);this.image.setWidth(f);this.image.setHeight(e)}}});Ui.Pressable.extend("Wn.ResourceNew",{user:void 0,graphic:void 0,constructor:function(a){this.user=a.user;delete a.user;this.resource=a.resource;delete a.resource;this.graphic=new Wn.AppViewGraphic({icon:"plus"});this.append(this.graphic);this.connect(this,"press",this.onResourcePress)},onResourcePress:function(){(new Wn.ResourceWizard({user:this.user})).open()}});Core.Object.extend("Wn.ResourceCreator",{data:void 0,user:void 0,isDone:!1,constructor:function(a){this.data=a.data;delete a.data;this.user=a.user;delete a.user;this.addEvents("done")},getIsDone:function(){return this.isDone},getData:function(){return this.data},getUser:function(){return this.user},done:function(){this.isDone||(this.isDone=!0,this.fireEvent("done"))}});Ui.LBox.extend("Wn.WizardItem",{data:void 0,isDone:!1,constructor:function(a){this.data=a.data;delete a.data;this.addEvents("done")},getData:function(){return this.data},getIsDone:function(){return this.isDone},done:function(){this.isDone||(this.isDone=!0,this.fireEvent("done"))},save:function(){this.onSave()},onSave:function(){}});Wn.WizardItem.extend("Wn.ResourceWizardSelector",{selectType:void 0,constructor:function(a){var b=new Ui.SFlow({uniform:!0,spacing:10,itemAlign:"stretch"});this.setContent(b);for(var c=Wn.ResourceWizard.getWizardTypes(),d=0;d<c.length;d++){var e=Wn.ResourceWizard.getWizard(c[d]),e=new Ui.Button({icon:e.icon,text:e.name,orientation:"horizontal",width:150});this.connect(e,"press",this.onItemPress);e.hostResourceWizardSelector=c[d];b.append(e)}delete a.wizardType},getSelectedType:function(){return this.selectType},
onItemPress:function(a){this.selectType=a.hostResourceWizardSelector;this.fireEvent("done",this)}});
Ui.Dialog.extend("Wn.ResourceWizard",{user:void 0,previousButton:void 0,nextButton:void 0,transBox:void 0,position:0,current:void 0,wizardType:void 0,data:void 0,constructor:function(a){this.user=a.user;delete a.user;this.setFullScrolling(!0);this.setPreferedWidth(450);this.setPreferedHeight(400);this.data={};this.setTitle("Nouvelle ressource");this.setCancelButton(new Ui.Button({text:"Annuler"}));this.previousButton=new Ui.Button({text:"Pr\u00e9c\u00e9dent"});this.previousButton.hide();this.connect(this.previousButton,
"press",this.onPreviousPress);this.nextButton=new Ui.Button({text:"Suivant"});this.connect(this.nextButton,"press",this.onNextPress);this.setActionButtons([this.previousButton,this.nextButton]);this.transBox=new Ui.TransitionBox;this.setContent(this.transBox);this.current=new Wn.ResourceWizardSelector;this.transBox.replaceContent(this.current);this.connect(this.current,"done",this.onItemDone);this.nextButton.disable();this.nextButton.hide()},onPreviousPress:function(){this.position--;this.disconnect(this.current,
"done",this.onItemDone);this.current.save();0>this.position&&(this.position=0);if(0==this.position)this.setTitle("Nouvelle ressource"),this.current=new Wn.ResourceWizardSelector({wizardType:this.wizardType}),this.nextButton.hide(),this.previousButton.hide();else{var a=Wn.ResourceWizard.getWizard(this.wizardType);this.setTitle(a.name);this.current=new a.array[this.position-1]({data:this.data})}this.nextButton.setText("Suivant");this.connect(this.current,"done",this.onItemDone);this.transBox.replaceContent(this.current);
this.current.getIsDone()?this.nextButton.enable():this.nextButton.disable()},onItemDone:function(){this.nextButton.enable();if(0==this.position)this.onNextPress()},onNextPress:function(){this.position++;this.disconnect(this.current,"done",this.onItemDone);this.current.save();this.nextButton.disable();this.previousButton.show();1==this.position&&(this.nextButton.show(),this.wizardType!=this.current.getSelectedType()&&(this.wizardType=this.current.getSelectedType(),this.data={}));var a=Wn.ResourceWizard.getWizard(this.wizardType);
if(this.position>a.array.length)if(a=new a.creator({user:this.user,data:this.data}),this.disable(),a.getIsDone())this.onCreateDone();else this.connect(a,"done",this.onCreateDone);else this.setTitle(a.name),this.current=new a.array[this.position-1]({data:this.data}),this.position==a.array.length?this.nextButton.setText("Cr\u00e9er"):this.nextButton.setText("Suivant"),this.connect(this.current,"done",this.onItemDone),this.transBox.replaceContent(this.current)},onCreateDone:function(){this.close()}},
{},{apps:void 0,constructor:function(){this.apps={}},register:function(a,b,c,d,e){Wn.ResourceWizard.apps[a]={name:b,icon:c,array:d,creator:e}},getWizardTypes:function(){var a=[],b;for(b in Wn.ResourceWizard.apps)a.push(b);return a},getWizard:function(a){return Wn.ResourceWizard.apps[a]}});Core.Object.extend("Wn.LoginCreator",{data:void 0,session:void 0,isDone:!1,constructor:function(a){this.data=a.data;delete a.data;this.session=a.session;delete a.session;this.addEvents("done","fail")},getIsDone:function(){return this.isDone},getData:function(){return this.data},getSession:function(){return this.session},done:function(a){this.isDone||(this.isDone=!0,this.fireEvent("done",this,a))},fail:function(){this.fireEvent("fail",this)}});Wn.WizardItem.extend("Wn.LoginWizardSelector",{selectItem:void 0,constructor:function(a){this.addEvents("choose");var b=new Ui.VBox({uniform:!0,spacing:10});this.setContent(b);for(var c=Wn.LoginWizard.getWizardTypes(),d=0;d<c.length;d++){var e=Wn.LoginWizard.getWizard(c[d]),e=new Ui.Button({icon:e.icon,text:e.name,orientation:"horizontal"});this.connect(e,"press",this.onItemPress);e.hostLoginWizardSelector=c[d];b.append(e)}delete a.wizardType},getSelectedType:function(){return this.selectItem.hostLoginWizardSelector},
onItemPress:function(a){this.selectItem=a;this.fireEvent("done",this)}});
Ui.Dialog.extend("Wn.LoginWizard",{previousButton:void 0,nextButton:void 0,transBox:void 0,position:0,current:void 0,wizardType:void 0,data:void 0,constructor:function(a){this.addEvents("done");this.setTitle("Connexion");this.setFullScrolling(!0);this.setPreferedWidth(450);this.setPreferedHeight(450);this.data={};this.previousButton=new Ui.Button({text:"Pr\u00e9c\u00e9dent"});this.previousButton.hide();this.connect(this.previousButton,"press",this.onPreviousPress);this.nextButton=new Ui.Button({text:"Suivant"});
this.connect(this.nextButton,"press",this.onNextPress);this.transBox=new Ui.TransitionBox;this.setContent(this.transBox);this.current=new Wn.LoginWizardSelector;this.transBox.replaceContent(this.current);this.connect(this.current,"done",this.onItemDone);this.nextButton.disable()},onPreviousPress:function(){this.position--;this.disconnect(this.current,"done",this.onItemDone);this.current.save();0>this.position&&(this.position=0);if(0==this.position)this.setTitle("Connexion"),this.current=new Wn.LoginWizardSelector({wizardType:this.wizardType}),
this.previousButton.hide(),this.setActionButtons(void 0);else{var a=Wn.LoginWizard.getWizard(this.wizardType);this.setTitle(a.name);this.current=new a.array[this.position-1]({data:this.data})}this.nextButton.setText("Suivant");this.connect(this.current,"done",this.onItemDone);this.transBox.replaceContent(this.current);this.current.getIsDone()?this.nextButton.enable():this.nextButton.disable()},onItemDone:function(){if(0==this.position)this.onNextPress();this.nextButton.enable()},onNextPress:function(){this.position++;
this.disconnect(this.current,"done",this.onItemDone);this.current.save();this.nextButton.disable();this.previousButton.show();1==this.position&&(this.setActionButtons([this.previousButton,this.nextButton]),this.wizardType!=this.current.getSelectedType()&&(this.wizardType=this.current.getSelectedType(),this.data={}));var a=Wn.LoginWizard.getWizard(this.wizardType);this.position>a.array.length?(a=new a.creator({data:this.data,item:this.current}),this.disable(),this.connect(a,"done",this.onCreatorDone),
this.connect(a,"fail",this.onCreatorFail)):(this.setTitle(a.name),this.current=new a.array[this.position-1]({data:this.data}),this.position==a.array.length?this.nextButton.setText(a.endlabel):this.nextButton.setText("Suivant"),this.connect(this.current,"done",this.onItemDone),this.transBox.replaceContent(this.current))},onCreatorDone:function(a,b){this.close();this.fireEvent("done",this,b)},onCreatorFail:function(){this.enable();this.position--;this.nextButton.enable()}},{},{apps:void 0,constructor:function(){this.apps=
{}},register:function(a,b,c,d,e,f){Wn.LoginWizard.apps[a]={name:b,icon:c,array:d,creator:e,endlabel:f}},getWizardTypes:function(){var a=[],b;for(b in Wn.LoginWizard.apps)a.push(b);return a},getWizard:function(a){return Wn.LoginWizard.apps[a]}});Ui.Selectionable.extend("Wn.AddContactIcon",{user:void 0,contact:void 0,dialog:void 0,image:void 0,label:void 0,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.dialog=a.dialog;delete a.dialog;a=new Ui.VBox({margin:5});this.append(a);this.selectableBox=new Ui.LBox({horizontalAlign:"center"});a.append(this.selectableBox);this.selectableBox.append(new Ui.Rectangle({fill:"#999999"}));this.selectableBox.append(new Ui.Rectangle({fill:"#f1f1f1",margin:1}));
this.image=new Ui.Image({width:64,height:64,margin:1,src:this.contact.getFaceUrl()});this.selectableBox.append(this.image);this.label=new Ui.CompactLabel({text:"",fontSize:14,margin:3,width:90,maxLine:2,textAlign:"center",color:"#67696c",horizontalAlign:"center"});a.append(this.label)},getContact:function(){return this.contact},onContactChange:function(){this.label.setText(this.contact.getFirstname()+" "+this.contact.getLastname())}},{getSelectionActions:function(){return Wn.AddContactIcon.contactActions},
onLoad:function(){Wn.AddContactIcon.base.onLoad.call(this);this.connect(this.contact,"change",this.onContactChange);if(this.contact.getIsReady())this.onContactChange()},onUnload:function(){Wn.AddContactIcon.base.onUnload.call(this);this.disconnect(this.contact,"change",this.onContactChange)}},{contactActions:void 0,constructor:function(){Wn.AddContactIcon.contactActions={view:{"default":!0,text:"Voir",icon:"eye",callback:Wn.AddContactIcon.onContactView,multiple:!1},add:{text:"Ajouter",icon:"plus",
testRight:Wn.AddContactIcon.testAddContactRight,callback:Wn.AddContactIcon.onContactAdd,multiple:!0}}},testAddContactRight:function(){return Ui.App.current.getUser().getId()!==this.contact.getId()&&void 0===Ui.App.current.getUser().getContact(this.contact.getId())},onContactAdd:function(a){for(var b=[],c=0;c<a.getElements().length;c++){var d=a.getElements()[c];b.push(d.getContact())}Ui.App.current.getUser().prependContacts(b);void 0!==a.getElements()[0].dialog&&a.getElements()[0].dialog.close()},
onContactView:function(a){Ui.App.current.setMainPath("user:"+a.getElements()[0].getContact().getId());a.getElements()[0].dialog.close()}});
Wn.AddContactIcon.extend("Wn.AddContactRightIcon",{constructor:function(){this.image.setWidth(46);this.image.setHeight(46);this.label.setWidth(80)}},{getSelectionActions:function(){return Wn.AddContactRightIcon.contactActions}},{contactActions:void 0,constructor:function(){Wn.AddContactRightIcon.contactActions={add:{text:"Ajouter",icon:"plus",callback:Wn.AddContactRightIcon.onContactRightAdd,multiple:!0}}},onContactRightAdd:function(a){for(var b=0;b<a.getElements().length;b++){var c=a.getElements()[b],
d=c.dialog.getRights(),e=c.dialog.getResource();d.user_id=c.getContact().getId();e.addRights(d)}a.getElements()[0].dialog.close()}});Ui.Selectionable.extend("Wn.AddWorldIcon",{user:void 0,dialog:void 0,constructor:function(a){this.user=a.user;delete a.user;this.dialog=a.dialog;delete a.dialog;a=new Ui.VBox({margin:5});this.append(a);var b=new Ui.Icon({width:48,height:48,margin:1,icon:"earth",fill:"#444444",horizontalAlign:"center"});a.append(b);b=new Ui.CompactLabel({text:"Tout le monde",fontSize:14,margin:3,width:80,maxLine:2,textAlign:"center",color:"#67696c",horizontalAlign:"center"});a.append(b)},onWorldRightAdd:function(a){a=
a.getElements()[0];var b=a.dialog.getRights();a.dialog.getResource().addPublicRights(b);a.dialog.close()}},{getSelectionActions:function(){return{add:{text:"Ajouter",icon:"plus",callback:this.onWorldRightAdd,multiple:!1}}}});Ui.Dialog.extend("Wn.AddContactDialog",{user:void 0,flow:void 0,mainVbox:void 0,searchField:void 0,searchRequest:void 0,constructor:function(a){this.addEvents("add");this.user=a.user;delete a.user;this.setFullScrolling(!0);this.setPreferedWidth(450);this.setPreferedHeight(450);this.setTitle("Ajouter des contacts");this.setCancelButton(new Ui.Button({text:"Fermer"}));this.mainVbox=new Ui.VBox;this.setContent(this.mainVbox);this.searchField=new Ui.TextButtonField({buttonIcon:"search"});this.mainVbox.append(this.searchField);
this.connect(this.searchField,"validate",this.onSearchValidate);this.flow=new Ui.Flow;this.mainVbox.append(this.flow)},onSearchValidate:function(){void 0!==this.searchRequest&&(this.disconnect(this.searchRequest,"done",this.onSearchDone),this.disconnect(this.searchRequest,"error",this.onSearchError),this.searchRequest.abort());for(;void 0!=this.flow.getFirstChild();)this.flow.remove(this.flow.getFirstChild());this.mainVbox.disable();this.searchRequest=new Core.HttpRequest({method:"GET",url:"/cloud/user?query="+
encodeURIComponent(this.searchField.getValue())});this.connect(this.searchRequest,"done",this.onSearchDone);this.connect(this.searchRequest,"error",this.onSearchError);this.searchRequest.send()},onSearchDone:function(a){a=a.getResponseJSON();for(var b=0;b<a.length;b++)this.flow.append(new Wn.AddContactIcon({user:this.user,contact:new Wn.Contact({contact:a[b],user:this.user}),dialog:this,margin:5}));this.mainVbox.enable();this.searchRequest=void 0},onSearchError:function(){this.mainVbox.enable();this.searchRequest=
void 0}});Ui.Dialog.extend("Wn.AddContactRightDialog",{user:void 0,resource:void 0,flow:void 0,mainVbox:void 0,searchField:void 0,searchRequest:void 0,shareField:void 0,writeField:void 0,constructor:function(a){this.addEvents("add");this.user=a.user;delete a.user;this.resource=a.resource;delete a.resource;this.setFullScrolling(!0);this.setPreferedWidth(400);this.setPreferedHeight(400);this.setTitle("Ajouter des partages");this.setCancelButton(new Ui.Button({text:"Fermer"}));this.mainVbox=new Ui.VBox;this.setContent(this.mainVbox);
this.searchField=new Ui.TextButtonField({buttonIcon:"search"});this.mainVbox.append(this.searchField);this.connect(this.searchField,"validate",this.onSearchValidate);a=new Ui.HBox({uniform:!0});this.mainVbox.append(a);this.writeField=new Ui.CheckBox({text:"Ecriture"});this.resource.canWrite()&&(a.append(this.writeField),this.writeField.setValue(this.user.getData().default_write_right));this.shareField=new Ui.CheckBox({text:"Partage"});this.shareField.setValue(this.user.getData().default_share_right);
a.append(this.shareField);this.flow=new Ui.Flow;this.mainVbox.append(this.flow);this.resource.getPublicRights().read||this.flow.append(new Wn.AddWorldIcon({user:this.user,dialog:this}))},onSearchValidate:function(){void 0!==this.searchRequest&&(this.disconnect(this.searchRequest,"done",this.onSearchDone),this.disconnect(this.searchRequest,"error",this.onSearchError),this.searchRequest.abort());for(;void 0!=this.flow.getFirstChild();)this.flow.remove(this.flow.getFirstChild());this.mainVbox.disable();
this.searchRequest=new Core.HttpRequest({method:"GET",url:"/cloud/user?query="+encodeURIComponent(this.searchField.getValue())});this.connect(this.searchRequest,"done",this.onSearchDone);this.connect(this.searchRequest,"error",this.onSearchError);this.searchRequest.send()},onSearchDone:function(a){a=a.getResponseJSON();for(var b=0;b<a.length;b++){for(var c=a[b],d=this.resource.getOwnerId()===c.id,e=0;!d&&e<this.resource.getRights().length;e++)d=this.resource.getRights()[e].user_id===c.id;d||this.flow.append(new Wn.AddContactRightIcon({user:this.user,
contact:new Wn.Contact({contact:c,user:this.user}),dialog:this}))}this.mainVbox.enable();this.searchRequest=void 0},onSearchError:function(){this.mainVbox.enable();this.searchRequest=void 0},getResource:function(){return this.resource},getRights:function(){return{read:!0,write:this.writeField.getValue(),share:this.shareField.getValue()}},onAddPress:function(){for(var a=[],b=[],c=0;c<this.flow.getChildren().length;c++){var d=this.flow.getChildren()[c];d.getIsSelected()&&(Wn.AddWorldIcon.hasInstance(d)?
this.resource.addPublicRights({read:!0,write:this.writeField.getValue(),share:this.shareField.getValue()}):a.push(d.getContact()),b.push(d))}for(c=0;c<a.length;c++)this.resource.addRights({user_id:a[c].getId(),read:!0,write:this.writeField.getValue(),share:this.shareField.getValue()});for(c=0;c<b.length;c++)this.flow.remove(b[c])}});Ui.Dialog.extend("Wn.CommentEditDialog",{comment:void 0,storage:void 0,file:void 0,textField:void 0,constructor:function(a){this.comment=a.comment;delete a.comment;this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.setFullScrolling(!0);this.setPreferedWidth(400);this.setPreferedHeight(300);this.setTitle("Edition de commentaire");this.setCancelButton(new Ui.Button({text:"Fermer"}));this.textField=new Ui.TextAreaField({value:this.comment.content});this.setContent(this.textField);
a=new Wn.AlertButton({text:"Supprimer"});this.connect(a,"press",this.onDeletePress);var b=new Ui.Button({text:"Enregistrer"});this.connect(b,"press",this.onSavePress);this.setActionButtons([a,b])},onSavePress:function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/comments/"+this.comment.id,content:JSON.stringify({user:Ui.App.current.getUser().getId(),content:this.textField.getValue()})})).send();this.close()},onDeletePress:function(){(new Core.HttpRequest({method:"DELETE",
url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/comments/"+this.comment.id})).send();this.close()}});Ui.Rectangle.extend("Wn.CommentSeparator",{constructor:function(){this.setHeight(1);this.setFill("#999999")}});
Ui.Selectionable.extend("Wn.CommentView",{user:void 0,comment:void 0,storage:void 0,file:void 0,contactface:void 0,dateLabel:void 0,text:void 0,constructor:function(a){this.user=a.user;delete a.user;this.comment=a.comment;delete a.comment;this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;var b=new Ui.HBox({spacing:5});this.setContent(b);a=new Ui.LBox({verticalAlign:"top"});b.append(a);a.append(new Ui.Rectangle({fill:"#999999"}));a.append(new Ui.Rectangle({fill:"#f1f1f1",margin:1}));
this.contactface=new Ui.Image({width:32,height:32,margin:1});a.append(this.contactface);this.comment.user==this.user.getId()?this.contactface.setSrc(this.user.getFaceUrl()):(a=Wn.Contact.getContact(this.comment.user),this.contactface.setSrc(a.getFaceUrl()));a=new Ui.VBox({spacing:2});b.append(a,!0);var c=new Date-new Date(1E3*this.comment.ctime),b=Math.floor(c/864E5),d=Math.floor(c/36E5),c=Math.floor(c/6E4),e="il y a ";this.dateLabel=new Ui.Label({opacity:0.8,fontSize:10,horizontalAlign:"left",text:0<
b?e+(b+" jours"):0<d?e+(d+" heures"):e+(c+" minutes")});a.append(this.dateLabel);this.text=new Wn.ImproveText({text:this.comment.content,width:150});a.append(this.text)},getComment:function(){return this.comment},onCommentDelete:function(){(new Core.HttpRequest({method:"DELETE",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/comments/"+this.comment.id})).send()},onCommentEdit:function(a){(new Wn.CommentEditDialog({comment:a.getElements()[0].getComment(),storage:this.storage,file:this.file})).open()},
testCommentEditRight:function(){return Ui.App.current.getUser().isAdmin()||Ui.App.current.getUser().getId()==this.comment.user}},{getSelectionActions:function(){return{"delete":{text:"Supprimer",icon:"trash",color:"#d02020",scope:this,callback:this.onCommentDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",testRight:this.testCommentEditRight,scope:this,callback:this.onCommentEdit,multiple:!1}}}});
Ui.LBox.extend("Wn.CommentViewer",{user:void 0,resource:void 0,storage:void 0,file:void 0,vbox:void 0,updateRequest:void 0,textField:void 0,commentsBox:void 0,submitButton:void 0,commentsLoaded:!1,scroll:void 0,constructor:function(a){this.user=a.user;delete a.user;this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.resource=a.resource;delete a.resource;this.append(new Wn.ContentBgGraphic);a=new Ui.ScrollingArea({scrollHorizontal:!1,scrollVertical:!1,directionRelease:!0,margin:4});
this.append(a);this.scroll=a;this.vbox=new Ui.VBox({margin:0,width:210,spacing:5});a.setContent(this.vbox);this.textField=new Ui.TextAreaField({textHolder:"Un commentaire ?",margin:4});this.vbox.append(this.textField);this.connect(this.textField.textarea,"focus",this.onEntryFocus);this.connect(this.textField.textarea,"blur",this.onEntryBlur);this.commentsBox=new Ui.VBox({spacing:5});this.vbox.append(this.commentsBox,!0);this.submitButton=new Ui.Button({text:"Valider",horizontalAlign:"right"});this.connect(this.submitButton,
"press",this.onCommentValidate);this.updateFile(this.file)},getComments:function(){return this.file.comments},onEntryFocus:function(){void 0==this.submitButton.getParent()&&this.vbox.insertAt(this.submitButton,1)},onEntryBlur:function(){void 0!==this.submitButton.getParent()&&""===this.textField.getValue()&&this.vbox.remove(this.submitButton)},onCommentValidate:function(){var a=this.textField.getValue();this.textField.setValue("");a=new Core.HttpRequest({method:"POST",url:"/cloud/storage/"+this.storage+
"/"+this.file.id+"/comments",content:JSON.stringify({user:this.user.getId(),content:a})});this.connect(a,"error",this.onCreateCommentError);a.send()},onCreateCommentError:function(){var a=new Ui.Dialog,b=new Ui.Button({text:"Fermer"});a.connect(b,"press",function(){this.close()});a.setActionButtons([b]);a.setContent(new Ui.Text({width:200,text:"Une erreur est survenue lors de la publication de votre commentaire. Il n'a pas pu \u00eatre pris en compte."}));a.open()},updateFile:function(a){for(;void 0!=
this.commentsBox.getFirstChild();)this.commentsBox.remove(this.commentsBox.getFirstChild());this.file=a;for(a=0;a<this.file.comments.length;a++){0!=a&&(this.scroll.setScrollVertical(!0),this.commentsBox.append(new Wn.CommentSeparator));var b=this.file.comments[a],c=new Wn.CommentView({storage:this.storage,file:this.file,user:this.user,comment:b});Ui.App.current.getUser().isAdmin()||this.resource.getOwnerId()===Ui.App.current.getUser().getId()||Ui.App.current.getUser().getId()===b.user||c.disable();
this.commentsBox.append(c)}}});Ui.CanvasElement.extend("Wn.PosButton",{},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b/2,c/2);a.fillStyle="#444444";a.beginPath();a.arc(b/2,c/2,d,0,2*Math.PI,!1);a.closePath();a.fill();a.fillStyle="rgb(240,240,240)";a.beginPath();a.arc(b/2,c/2,0.66*d,0,2*Math.PI,!1);a.closePath();a.fill()},measureCore:function(a,b){return{width:30,height:30}}});
Ui.CanvasElement.extend("Wn.PosBar",{currentPos:0,loadPos:0,setCurrentPos:function(a){a!=this.currentPos&&(this.currentPos=a,this.invalidateDraw())},getCurrentPos:function(){return this.currentPos},setLoadPos:function(a){a!=this.loadPos&&(this.loadPos=a,this.invalidateDraw())},getLoadPos:function(){return this.loadPos},drawBar:function(a,b,c,d,e){a.beginPath();a.arc(b,c,e,0,2*Math.PI,!1);a.closePath();a.fill();a.rect(b,c-e,d,2*e);a.fill();a.beginPath();a.arc(b+d,c,e,0,2*Math.PI,!1);a.closePath();
a.fill()}},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b/2,c/2);a.fillStyle="#aaaaaa";this.drawBar(a,d,c/2,b-2*d,0.5*d);a.fillStyle="#888888";0<this.loadPos&&this.drawBar(a,d,c/2,(b-2*d)*this.loadPos,0.5*d);a.fillStyle="#ffc30b";0<this.currentPos&&this.drawBar(a,d,c/2,(b-2*d)*this.currentPos,0.5*d)},measureCore:function(a,b){return{width:20,height:20}}});
Ui.Container.extend("Wn.MediaProgressBar",{posButton:void 0,posBar:void 0,pos:0,constructor:function(a){this.addEvents("up","down","move");this.posBar=new Wn.PosBar({verticalAlign:"center"});this.appendChild(this.posBar);a=new Wn.PosButton;this.posButton=new Ui.Movable({moveVertical:!1,horizontalAlign:"left",verticalAlign:"center"});this.connect(this.posButton,"move",this.onButtonMove);this.connect(this.posButton,"up",this.onButtonUp);this.connect(this.posButton,"down",this.onButtonDown);this.posButton.setContent(a);
this.appendChild(this.posButton)},getCurrentPos:function(){return this.posBar.getCurrentPos()},getLoadPos:function(){return this.posBar.getLoadPos()},setLoadPos:function(a){this.posBar.setLoadPos(a)},onButtonMove:function(a){this.pos=Math.min(1,Math.max(0,a.getPositionX()/(this.getLayoutWidth()-a.getLayoutWidth())));this.updatePos();this.fireEvent("move",this)},onButtonUp:function(a){this.fireEvent("up",this)},onButtonDown:function(a){this.fireEvent("down",this)},updatePos:function(){this.disconnect(this.posButton,
"move",this.onButtonMove);this.posButton.setPosition((this.getLayoutWidth()-this.posButton.getLayoutWidth())*this.pos,void 0);this.connect(this.posButton,"move",this.onButtonMove);this.posBar.setCurrentPos(this.pos)},setPos:function(a){this.pos!=a&&(this.pos=a,this.invalidateArrange())}},{measureCore:function(a,b){var c=this.posBar.measure(a,b),d=this.posButton.measure(a,b);return{width:Math.max(c.width,d.width),height:Math.max(c.height,d.height)}},arrangeCore:function(a,b){this.posBar.arrange(0,
0,a,b);this.posButton.arrange(0,0,a,b);this.updatePos()}});
Ui.CanvasElement.extend("Wn.PlayButton",{mode:"play",clock:void 0,backgroundVisible:!0,constructor:function(a){},setMode:function(a){a!=this.mode&&(this.mode=a,this.invalidateDraw(),"load"==a?(this.clock=new Anim.Clock({duration:"forever",scope:this,onTimeupdate:function(a,c){this.invalidateDraw()}}),this.getIsVisible()&&this.clock.begin()):void 0!=this.clock&&(this.clock.stop(),this.clock=void 0))},setBackgroundVisible:function(a){this.backgroundVisible!=a&&(this.backgroundVisible=a,this.invalidateDraw())}},
{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight(),d=Math.min(b/2,c/2);this.backgroundVisible&&(a.fillStyle="rgba(221,221,221,0.6)",a.beginPath(),a.arc(b/2,c/2,d,0,2*Math.PI,!1),a.closePath(),a.fill());a.fillStyle="#444444";if("play"==this.mode)a.beginPath(),a.moveTo(b/2-0.3*d,c/2-d/2),a.lineTo(b/2+0.6*d,c/2),a.lineTo(b/2-0.3*d,c/2+d/2),a.closePath(),a.fill();else if("pause"==this.mode)a.beginPath(),a.moveTo(b/2-0.3*d,c/2-d/2),a.lineTo(b/2-0.3*d+d/5,c/2-d/2),a.lineTo(b/
2-0.3*d+d/5,c/2+d/2),a.lineTo(b/2-0.3*d,c/2+d/2),a.closePath(),a.fill(),a.beginPath(),a.moveTo(b/2+0.1*d,c/2-d/2),a.lineTo(b/2+0.1*d+d/5,c/2-d/2),a.lineTo(b/2+0.1*d+d/5,c/2+d/2),a.lineTo(b/2+0.1*d,c/2+d/2),a.closePath(),a.fill();else for(a.translate(b/2,c/2),b=this.clock.getTime()%1,c=0;8>c;c++)a.save(),a.rotate(2*Math.PI*c/8+1*Math.PI*b),a.beginPath(),a.arc(0,d/2,5,0,2*Math.PI,!1),a.closePath(),a.fill(),a.restore()},measureCore:function(a,b){return{width:20,height:20}},onVisible:function(){void 0!=
this.clock&&this.clock.begin()},onHidden:function(){void 0!=this.clock&&this.clock.stop()}});
Ui.LBox.extend("Wn.MediaPlayBar",{media:void 0,progressBar:void 0,playButton:void 0,posLabel:void 0,totalLabel:void 0,seeking:!1,constructor:function(a){this.media=a.media;delete a.media;this.connect(this.media,"ready",this.onMediaReady);this.connect(this.media,"timeupdate",this.onMediaTimeUpdate);this.connect(this.media,"bufferingupdate",this.onMediaBufferingUpdate);this.connect(this.media,"statechange",this.onMediaStateChange);this.append(new Ui.Shadow({shadowWidth:2,radius:3,inner:!1,opacity:0.5,
color:"#555555"}));this.append(new Ui.Rectangle({fill:"rgb(240,240,240)",margin:2,radius:3}));a=new Ui.HBox({margin:5});this.append(a);var b=new Ui.Pressable;this.connect(b,"press",this.onPlayPress);this.playButton=new Wn.PlayButton({mode:"play",backgroundVisible:!1,width:60,height:60});b.setContent(this.playButton);"playing"!=this.media.getState()&&"buffering"!=this.media.getState()||this.playButton.setMode("pause");a.append(b);b=new Ui.LBox;a.append(b,!0);this.progressBar=new Wn.MediaProgressBar({height:30,
verticalAlign:"center"});this.connect(this.progressBar,"down",this.onProgressBarDown);this.connect(this.progressBar,"up",this.onProgressBarUp);b.append(this.progressBar,!0);this.media.getIsReady()||this.progressBar.disable();a=new Ui.HBox({marginLeft:10,marginRight:10,verticalAlign:"bottom"});b.append(a);this.posLabel=new Ui.Label({text:"",color:"#444444"});this.totalLabel=new Ui.Label({text:"",color:"#444444"});a.append(this.posLabel);a.append(new Ui.Element,!0);a.append(this.totalLabel)},updateLabels:function(){var a=
this.media.getDuration();if(void 0==a)this.totalLabel.setText("");else{var b=Math.round(a%60),a=Math.floor(a/60),a=10>a?"0"+a+":":a+":";this.totalLabel.setText(10>b?a+("0"+b):a+b)}a=this.media.getCurrentTime();void 0==a?this.posLabel.setText(""):(b=Math.round(a%60),a=Math.floor(a/60),a=10>a?"0"+a+":":a+":",a=10>b?a+("0"+b):a+b,this.posLabel.setText(a))},updatePos:function(){if(void 0!=this.media.getDuration()){var a=this.media.getCurrentTime();void 0==a&&(a=0);this.seeking||this.progressBar.setPos(a/
this.media.getDuration())}else this.progressBar.setPos(0)},onPlayPress:function(){var a=this.media.getState();"initial"==a?this.media.play():"paused"==a?this.media.play():"playing"==a?this.media.pause():"buffering"==a&&this.media.pause()},onProgressBarDown:function(){this.seeking=!0},onProgressBarMove:function(){this.media.setCurrentTime(this.progressBar.getCurrentPos()*this.media.getDuration())},onProgressBarUp:function(){this.seeking=!1;this.media.setCurrentTime(this.progressBar.getCurrentPos()*
this.media.getDuration())},onMediaStateChange:function(a,b){"playing"==b||"buffering"==b?this.playButton.setMode("pause"):"initial"!=b&&"paused"!=b||this.playButton.setMode("play")},onMediaReady:function(){this.progressBar.enable();this.updatePos();this.updateLabels()},onMediaTimeUpdate:function(){this.updatePos();this.updateLabels()},onMediaBufferingUpdate:function(){this.progressBar.setLoadPos((this.media.getCurrentTime()+this.media.getCurrentBufferSize())/this.media.getDuration())}});
Ui.LBox.extend("Wn.AudioPlayer",{media:void 0,playButton:void 0,mediaBar:void 0,label:void 0,constructor:function(a){this.addEvents("end");this.media=new Ui.Audio;this.append(this.media);this.connect(this.media,"statechange",this.onMediaStateChange);this.connect(this.media,"ended",this.onMediaEnded);a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});this.append(a);var b=new Ui.Shape({horizontalAlign:"center",width:150,height:150,scale:1.5,path:"M 93.161,0.071 C 59.66,-1.043 32.22,11.314 32.22,11.314 L 32.2,74.023 c -3.411,-1.354 -7.559,-1.675 -11.772,-0.651 -9.083,2.207 -15.031,9.82 -13.285,17.007 1.746,7.187 10.524,11.225 19.606,9.019 8.564,-2.081 14.338,-8.969 13.507,-15.772 l 0,0 0,-46.855 c 0,0 19.404,-6.784 44.573,-8.485 l 0,34.849 0,0 C 81.455,61.843 77.386,61.55 73.25,62.555 64.167,64.761 58.219,72.374 59.965,79.562 61.71,86.749 70.488,90.786 79.571,88.58 87.502,86.653 93.042,80.603 93.158,74.316 l 0.003,0.004 c 0,-0.002 0,-61.521 0,-74.249 z"});
a.append(b);this.label=new Ui.Text({textAlign:"center",fontSize:20,width:300});a.append(this.label);a=new Ui.Pressable({verticalAlign:"center",horizontalAlign:"center"});this.connect(a,"press",this.onPlayButtonPress);this.playButton=new Wn.PlayButton({mode:"play",width:80,height:80});a.setContent(this.playButton);this.append(a);this.mediaBar=new Wn.MediaPlayBar({media:this.media,verticalAlign:"bottom",marginBottom:20,marginLeft:20,marginRight:20});this.append(this.mediaBar)},setSrc:function(a){this.media.setSrc(a)},
setText:function(a){this.label.setText(a)},pause:function(){this.media.pause()},play:function(){this.media.play()},onMediaEnded:function(a){this.fireEvent("end",this)},onMediaStateChange:function(a,b){"playing"==b?this.playButton.setMode("pause"):"paused"==b||"initial"==b?this.playButton.setMode("play"):"buffering"==b&&this.playButton.setMode("load")},onPlayButtonPress:function(){var a=this.media.getState();"playing"==a?this.media.pause():"paused"==a?this.media.play():"buffering"==a?this.media.pause():
"initial"==a&&this.media.play()}});Ui.LBox.extend("Wn.VideoPlayer",{media:void 0,playButton:void 0,mediaBar:void 0,controlBox:void 0,controlsVisible:!0,constructor:function(a){this.addEvents("statechange","end");this.media=new Ui.Video;this.append(this.media);this.connect(this.media,"statechange",this.onMediaStateChange);this.connect(this.media,"ended",this.onMediaEnd);this.controlBox=new Ui.LBox;this.append(this.controlBox);a=new Ui.Pressable({verticalAlign:"center",horizontalAlign:"center"});this.connect(a,"press",this.onPlayButtonPress);
this.playButton=new Wn.PlayButton({mode:"play",width:80,height:80});a.setContent(this.playButton);this.controlBox.append(a);this.mediaBar=new Wn.MediaPlayBar({media:this.media,verticalAlign:"bottom",marginBottom:20,marginLeft:20,marginRight:20});this.controlBox.append(this.mediaBar)},setSrc:function(a){this.media.setSrc(a)},setPoster:function(a){this.media.setPoster(a)},pause:function(){this.media.pause()},play:function(){this.media.play()},getState:function(){return this.media.getState()},getIsControlsVisible:function(){return this.controlsVisible},
showControls:function(){this.controlsVisible=!0;this.controlBox.show()},hideControls:function(){this.controlsVisible=!1;this.controlBox.hide()},onMediaEnd:function(a){this.fireEvent("end",this)},onMediaStateChange:function(a,b){"playing"==b?(this.hideControls(),this.playButton.setMode("pause")):"paused"==b||"initial"==b?(this.showControls(),this.playButton.setMode("play")):"buffering"==b&&(this.showControls(),this.playButton.setMode("load"));this.fireEvent("statechange",this,b)},onPlayButtonPress:function(){var a=
this.media.getState();"playing"==a?this.media.pause():"paused"==a?this.media.play():"buffering"==a?this.media.pause():"initial"==a&&this.media.play()}});Wn.ResourceViewer.extend("Radio.App",{audio:void 0,constructor:function(a){a=new Ui.VBox({horizontalAlign:"center",verticalAlign:"center"});this.setContent(a);a.append(new Ui.Label({text:this.getResource().getName()}));this.audio=new Ui.Audio({src:this.getResource().getData()});a.append(this.audio);var b=new Ui.Button({text:"Jouer"});a.append(b);this.connect(b,"press",this.onPlayPress)},onPlayPress:function(){this.audio.play()}},{},{constructor:function(){this.register("radio",this)}});Wn.ResourceView.extend("Radio.Preview",{constructor:function(a){this.getGraphic().setIcon("radio")}},{},{constructor:function(){this.register("radio",this)}});Wn.ResourceCreator.extend("Radio.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"radio",name:this.getData().name,data:this.getData().url});this.done()}});Wn.WizardItem.extend("Radio.Wizard",{nameField:void 0,urlField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);a.append(new Ui.Label({text:"Nom de la ressource:",horizontalAlign:"left"}));this.nameField=new Ui.TextField({marginLeft:20});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);a.append(new Ui.Label({text:"URL du flux MP3:",horizontalAlign:"left"}));this.urlField=new Ui.TextField({marginLeft:20});this.connect(this.urlField,"change",
this.onChange);a.append(this.urlField);a=this.getData();void 0!=a.name&&this.nameField.setValue(a.name);void 0!=a.url&&this.urlField.setValue(a.url);this.onChange()},onChange:function(){""!=this.urlField.getValue()&&""!=this.nameField.getValue()&&this.urlField.getValue().match(/^http(s){0,1}:\/\/.*$/)&&this.done()}},{onSave:function(){var a=this.getData();a.name=this.nameField.getValue();a.url=this.urlField.getValue()}});Ui.Popup.extend("Calendar.EventDetail",{event:void 0,constructor:function(a){this.event=a.event;delete a.event;a=new Ui.Grid({cols:"auto,auto",rows:"auto,auto,auto"});this.setContent(a);a.attach(new Ui.Label({margin:5,text:this.event.summary,horizontalAlign:"center",fontWeight:"bold"}),0,0,2,1);a.attach(new Ui.Label({margin:5,text:"D\u00e9but",horizontalAlign:"right",fontWeight:"bold"}),0,1,1,1);a.attach(new Ui.Label({margin:5,text:this.event.start}),1,1,1,1);a.attach(new Ui.Label({margin:5,text:"Fin",
horizontalAlign:"right",fontWeight:"bold"}),0,2,1,1);a.attach(new Ui.Label({margin:5,text:this.event.end}),1,2,1,1)}});Ui.Pressable.extend("Calendar.DayViewItem",{event:void 0,text:void 0,constructor:function(a){this.event=a.event;delete a.event;this.append(new Ui.Rectangle({fill:"lightgreen",margin:2}));a=this.event.summary;void 0==a&&(a="");this.text=new Ui.Text({text:a,margin:7});this.append(this.text)},getEvent:function(){return this.event}});
Ui.LBox.extend("Calendar.DayView",{data:void 0,day:void 0,frame:void 0,shadow:void 0,background:void 0,eventbg:void 0,items:void 0,lines:void 0,interlines:void 0,hours:void 0,constructor:function(a){this.shadow=new Ui.Rectangle({fill:"#ffffff"});this.appendChild(this.shadow);a=Ui.Color.create("#eeeeee").getYuv();a=new Ui.LinearGradient({stops:[{offset:0,color:new Ui.Color({y:a.y+0.1,u:a.u,v:a.v})},{offset:1,color:new Ui.Color({y:a.y-0.05,u:a.u,v:a.v})}]});this.background=new Ui.Rectangle({fill:a});
this.appendChild(this.background);this.frame=new Ui.Frame({frameWidth:1,fill:"#cccccc"});this.appendChild(this.frame);this.eventbg=new Ui.Rectangle({radiusTopRight:2,radiusBottomRight:2,fill:new Ui.Color({r:0,g:0,b:0,a:0.03})});this.appendChild(this.eventbg);this.items=[];this.lines=[];for(a=0;24>a;a++){var b=new Ui.Rectangle({fill:new Ui.Color({r:0,g:0,b:0,a:0.1})});this.lines.push(b);this.appendChild(b)}this.interlines=[];for(a=0;24>a;a++)b=new Ui.Rectangle({fill:new Ui.Color({r:0,g:0,b:0,a:0.05})}),
this.interlines.push(b),this.appendChild(b);this.hours=[];for(a=0;24>a;a++)b=a.toString(),2>b.length&&(b="0"+b),b=new Ui.Label({color:new Ui.Color({r:0,g:0,b:0,a:0.3}),text:b+":00"}),this.hours.push(b),this.appendChild(b)},setData:function(a,b){this.data=a;this.day=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0,0);for(var c=0;c<this.items.length;c++){var d=this.items[c];this.removeChild(d)}this.items=[];for(c=0;c<this.data.length;c++)d=new Calendar.DayViewItem({event:this.data[c]}),this.connect(d,
"press",this.onDayItemPress),this.items.push(d),this.appendChild(d)},onDayItemPress:function(a){console.log("onDayItemPress "+a.getEvent().summary);(new Calendar.EventDetail({event:a.getEvent()})).show()}},{measureCore:function(a,b){for(var c=0;c<this.hours.length;c++)this.hours[c].measure(0,0);return{width:a,height:1E3}},arrangeCore:function(a,b){this.frame.arrange(0,0,a,1E3);this.shadow.arrange(1,1,a-2,998);this.background.arrange(2,2,a-4,997);this.eventbg.arrange(102,2,a-104,996);for(var c=0;c<
this.lines.length;c++)this.lines[c].arrange(3,1E3*(c+1)/24,a-6,1);for(c=0;c<this.interlines.length;c++)this.interlines[c].arrange(103,1E3*c/24+1E3/48,a-106,1);for(c=0;c<this.hours.length;c++){var d=this.hours[c];d.arrange(103-d.getMeasureWidth()-2,1E3*c/24+2,d.getMeasureWidth(),d.getMeasureHeight())}console.log("arrange items:");for(c=0;c<this.items.length;c++){var d=this.items[c],e=d.getEvent(),f=new Date(this.day.getFullYear(),this.day.getMonth(),this.day.getDate(),0,0,0,0),g=new Date(f.getTime()+
864E5),k=e.start;k<f&&(k=f);e=e.end;e>g&&(e=g);console.log("start: "+k+", end: "+e+", day: "+this.day);g=(k.getTime()-this.day.getTime())/864E5;k=(e.getTime()-this.day.getTime())/864E5;d.arrange(110,1E3*g,a-120,1E3*(k-g))}}});
Core.Object.extend("Calendar.Data",{events:void 0,constructor:function(a){var b=a.text;delete a.text;this.events=[];a=void 0;for(var b=b.split("\n"),c=0;c<b.length;c++){var d=b[c].indexOf(":");if(!(0>d)){var e=b[c].substr(0,d),d=b[c].substr(d+1);"\r"==d.charAt(d.length-1)&&(d=d.substr(0,d.length-1));"BEGIN"==e?"VEVENT"==d&&(a={},this.events.push(a)):"END"==e?"VEVENT"==d&&(a=void 0):void 0!=a&&("DTSTART"==e?a.start=this.parseDate(d):"DTEND"==e?a.end=this.parseDate(d):"SUMMARY"==e?a.summary=d:"DESCRIPTION"==
e&&(a.description=d))}}console.log("NB LINES: "+b.length)},parseDate:function(a){var b=parseInt(a.substr(0,4)),c=parseInt(a.substr(4,2))-1,d=parseInt(a.substr(6,2)),e=parseInt(a.substr(9,2)),f=parseInt(a.substr(11,2));a=parseInt(a.substr(13,2));return new Date(b,c,d,e,f,a,0)},searchDay:function(a){console.log("search for day: "+a);a=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0);for(var b=new Date(a.getTime()+864E5),c=[],d=0;d<this.events.length;d++){var e=this.events[d];void 0!=e.start&&
void 0!=e.end&&(e.start>=a&&e.start<b||e.end>=a&&e.end<b)&&c.push(e)}return c}});
Wn.ResourceViewer.extend("Calendar.App",{data:void 0,vbox:void 0,scroll:void 0,dayview:void 0,currentDay:void 0,dateLabel:void 0,constructor:function(a){this.vbox=new Ui.VBox;this.setContent(this.vbox);a=new Ui.HBox({margin:10,spacing:5});this.vbox.append(a);var b=new Ui.Button({text:"Aujourd'hui"});a.append(b);this.connect(b,"press",this.onTodayPress);b=new Ui.Button({icon:"arrowleft"});a.append(b);this.connect(b,"press",this.onPreviousPress);b=new Ui.Button({icon:"arrowright"});a.append(b);this.connect(b,
"press",this.onNextPress);this.dateLabel=new Ui.Label({horizontalAlign:"center",fontSize:20});a.append(this.dateLabel,!0);this.scroll=new Ui.ScrollingArea({margin:20,directionRelease:!0,scrollHorizontal:!1});this.vbox.append(this.scroll,!0);this.dayview=new Calendar.DayView;this.scroll.setContent(this.dayview);this.request=new Core.HttpRequest({url:"/cloud/proxy?url="+encodeURIComponent(this.getResource().getData())});this.connect(this.request,"done",this.onGetCalendarDone);this.connect(this.request,
"error",this.onGetCalendarError);this.request.send()},onGetCalendarDone:function(a){console.log("Calendar DONE");a=a.getResponseText();this.data=new Calendar.Data({text:a});this.setCurrentDate(new Date)},onGetCalendarError:function(a){},setCurrentDate:function(a){this.currentDay=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0);a=this.data.searchDay(this.currentDay);this.dayview.setData(a,this.currentDay);this.dateLabel.setText(this.currentDay.toDateString())},onPreviousPress:function(){this.setCurrentDate(new Date(this.currentDay.getTime()-
864E5))},onNextPress:function(){this.setCurrentDate(new Date(this.currentDay.getTime()+864E5))},onTodayPress:function(){this.setCurrentDate(new Date)}},{},{constructor:function(){this.register("calendar",this)}});Wn.ResourceView.extend("Calendar.Preview",{constructor:function(a){this.getGraphic().setIcon("calendar")}},{},{constructor:function(){this.register("calendar",this)}});Wn.ResourceCreator.extend("Calendar.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"calendar",name:this.getData().name,data:this.getData().url});this.done()}});Wn.WizardItem.extend("Calendar.Wizard",{nameField:void 0,urlField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);a.append(new Ui.Label({text:"Nom de la ressource:",horizontalAlign:"left"}));this.nameField=new Ui.TextField({marginLeft:20});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);a.append(new Ui.Label({text:"URL du flux ICAL du calendrier:",horizontalAlign:"left"}));this.urlField=new Ui.TextField({marginLeft:20});this.connect(this.urlField,
"change",this.onChange);a.append(this.urlField);a=this.getData();void 0!=a.name&&this.nameField.setValue(a.name);void 0!=a.url&&this.urlField.setValue(a.url);this.onChange()},onChange:function(){""!=this.urlField.getValue()&&""!=this.nameField.getValue()&&this.urlField.getValue().match(/^http(s){0,1}:\/\/.*$/)&&this.done()}},{onSave:function(){var a=this.getData();a.name=this.nameField.getValue();a.url=this.urlField.getValue()}});
Wn.ResourceWizard.register("calendar","Calendrier","calendar",[Calendar.Wizard],Calendar.Creator);Ui.CanvasElement.extend("Storage.CurrentArrow",{},{updateCanvas:function(a){a.fillStyle="#444444";a.beginPath();a.moveTo(0,this.getLayoutHeight());a.lineTo(this.getLayoutWidth(),this.getLayoutHeight());a.lineTo(this.getLayoutWidth()/2,0);a.closePath();a.fill()}});
Ui.Draggable.extend("Storage.FilePreview",{storage:void 0,file:void 0,uploader:void 0,content:void 0,label:void 0,shadow:void 0,progressbar:void 0,needUpdate:!1,isCurrent:!1,constructor:function(a){this.addEvents("activate");this.storage=a.storage;delete a.storage;"uploader"in a&&(this.uploader=a.uploader,delete a.uploader);this.shadow=new Ui.Rectangle({fill:"black",opacity:0.05,radius:7,margin:7});this.shadow.hide();this.append(this.shadow);var b=new Ui.VBox({margin:2});this.append(b);this.content=
new Ui.LBox({width:70,height:70});b.append(this.content);this.label=new Ui.CompactLabel({width:128,maxLine:3,textAlign:"center",horizontalAlign:"center"});b.append(this.label);void 0!=this.uploader?(a=new Ui.LBox,this.content.setContent(a),a.append(new Ui.Icon({icon:"uploadfile",width:48,height:48,verticalAlign:"bottom",horizontalAlign:"center"})),this.progressbar=new Wn.ProgressBar({verticalAlign:"bottom",horizontalAlign:"center",margin:5,width:50}),a.append(this.progressbar),this.connect(this.uploader,
"progress",this.onUploaderProgress),this.connect(this.uploader,"complete",this.onUploaderComplete),void 0!=this.uploader.getFile().getFileName()&&this.label.setText(this.uploader.getFile().getFileName())):"file"in a&&(this.update(a.file),delete a.file);this.arrow=new Storage.CurrentArrow({width:20,height:10,verticalAlign:"bottom",horizontalAlign:"center"});this.arrow.hide();this.append(this.arrow)},current:function(){this.isCurrent=!0;this.arrow.show()},uncurrent:function(){this.isCurrent=!1;this.arrow.hide()},
update:function(a){if(void 0==this.file||this.needUpdate||JSON.stringify(this.file)!==JSON.stringify(a)){this.file=a;a=new Ui.LBox({verticalAlign:"bottom",horizontalAlign:"center"});this.content.setContent(a);a.append(new Ui.Rectangle({fill:new Ui.Color({r:0.7,b:0.7,g:0.7})}));a.append(new Ui.Rectangle({fill:"white",margin:1}));var b=new Ui.Image({src:"/cloud/preview/"+this.storage+"/"+this.file.id+"?rev="+this.file.rev,margin:3});this.setDownloadUrl("/cloud/storage/"+this.storage+"/"+this.file.id+
"/content",this.file.mimetype,this.file.name);this.setMimetype("application/x-wn2-file");this.setData(this.storage+":"+this.file.id);this.connect(b,"error",this.onPreviewError);a.append(b);this.label.setText(this.file.name)}},getStorage:function(){return this.storage},getFile:function(){return this.file},getUploader:function(){return this.uploader},onPreviewError:function(a){this.disconnect(a,"error",this.onPreviewError);a="file";"application/x-directory"===this.file.mimetype&&(a="folder");this.content.setContent(new Ui.Icon({icon:a,
verticalAlign:"bottom",horizontalAlign:"center",width:48,height:48}))},deleteFile:function(){void 0!=this.uploader&&(this.uploader.abort(),this.uploader=void 0);void 0!=this.file&&(new Core.HttpRequest({method:"DELETE",url:"/cloud/storage/"+this.storage+"/"+this.file.id})).send()},onUploaderProgress:function(a,b,c){void 0!=this.progressbar&&this.progressbar.setValue(b/c)},onUploaderComplete:function(){var a=this.uploader.getResponseJSON();this.update(a);this.needUpdate=!0}});Ui.Dialog.extend("Storage.FilePropertiesDialog",{resource:void 0,file:void 0,storage:void 0,deleteButton:void 0,modifyButton:void 0,nameField:void 0,constructor:function(a){this.resource=a.resource;delete a.resource;this.file=a.file;delete a.file;this.storage=a.storage;delete a.storage;this.setPreferedWidth(500);this.setPreferedHeight(500);this.setFullScrolling(!0);this.setTitle("Propri\u00e9t\u00e9s du fichier");this.setCancelButton(new Ui.Button({text:"Fermer"}));a=new Ui.VBox({});this.setContent(a);
var b=new Ui.VBox({uniform:!0});a.append(b);var c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Nom",width:100,textAlign:"right",verticalAlign:"center"}));this.nameField=new Ui.TextField({value:this.file.name,verticalAlign:"center"});c.append(this.nameField,!0);c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Type",width:100,textAlign:"right",verticalAlign:"center"}));c.append(new Ui.Text({text:this.file.mimetype,verticalAlign:"center"}),!0);c=new Ui.HBox({spacing:10});
b.append(c);c.append(new Ui.Text({text:"Taille",width:100,textAlign:"right",verticalAlign:"center"}));c.append(new Ui.Text({text:this.formatSize(this.file.size),verticalAlign:"center"}),!0);c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Cr\u00e9ation",width:100,textAlign:"right",verticalAlign:"center"}));c.append(new Ui.Text({text:this.formatDate(new Date(1E3*this.file.ctime)),verticalAlign:"center"}),!0);c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Modification",
width:100,textAlign:"right",verticalAlign:"center"}));c.append(new Ui.Text({text:this.formatDate(new Date(1E3*this.file.mtime)),verticalAlign:"center"}),!0);var b=Ui.App.current.getUser(),c="resource:"+this.resource.getId()+":"+this.file.id,d=b.getRfidsFromPath(c),b=new Wn.RfidSection({user:b,tags:d,path:c});a.append(b);Ui.App.current.getUser().isAdmin()||this.resource.canWrite()?(this.deleteButton=new Wn.AlertButton({text:"Supprimer"}),this.connect(this.deleteButton,"press",this.onDeletePress),this.saveButton=
new Ui.Button({text:"Enregistrer"}),this.connect(this.saveButton,"press",this.onSavePress),this.setActionButtons([this.deleteButton,this.saveButton])):this.nameField.disable()},formatSize:function(a){return 1E9<a?(a/1E9).toFixed(2)+" Go":1E6<a?(a/1E6).toFixed(2)+" Mo":1E3<a?(a/1E3).toFixed(2)+" ko":a+" octets"},formatDate:function(a){var b="",b=10>a.getDate()?b+("0"+a.getDate()):b+a.getDate(),b=b+"/",b=10>a.getMonth()+1?b+("0"+(a.getMonth()+1)):b+(a.getMonth()+1),b=b+("/"+a.getFullYear()+" "),b=10>
a.getHours()?b+("0"+a.getHours()):b+a.getHours(),b=b+":",b=10>a.getMinutes()?b+("0"+a.getMinutes()):b+a.getMinutes(),b=b+":";return b=10>a.getSeconds()?b+("0"+a.getSeconds()):b+a.getSeconds()},onSavePress:function(){(new Core.HttpRequest({method:"PUT",url:"/cloud/storage/"+this.storage+"/"+this.file.id,content:JSON.stringify({name:this.nameField.getValue()})})).send();this.close()},onDeletePress:function(){(new Core.HttpRequest({method:"DELETE",url:"/cloud/storage/"+this.storage+"/"+this.file.id})).send();
this.close()}});Wn.ResourceView.extend("Storage.Preview",{storage:void 0,constructor:function(a){this.getGraphic().setIcon("files");this.storage=this.getResource().getStorageId();void 0!==this.getResource().getData().previewImageUrl&&this.getGraphic().setPreviewImage(this.getResource().getData().previewImageUrl)}},{},{constructor:function(){this.register("storage",this)}});Ui.HBox.extend("Storage.FileViewer",{uploader:void 0,file:void 0,storage:void 0,updateNeeded:!1,viewer:void 0,tools:void 0,contentBox:void 0,commentViewer:void 0,fullscreen:!1,playing:!1,contentViewer:void 0,supportProperties:!1,constructor:function(a){this.addEvents("toolschange","end");this.storage=a.storage;delete a.storage;this.viewer=a.viewer;delete a.viewer;this.tools=[];this.contentBox=new Ui.LBox;this.append(this.contentBox,!0);"uploader"in a?(this.uploader=a.uploader,delete a.uploader):"file"in
a&&(this.update(a.file),delete a.file);this.connect(this.viewer,"fullscreen",this.onFullscreen);this.connect(this.viewer,"unfullscreen",this.onUnFullscreen);this.connect(this,"load",this.onFileViewerLoad);this.connect(this,"unload",this.onFileViewerUnload)},getSupportProperties:function(){return this.supportProperties},showProperties:function(){(new Storage.FilePropertiesDialog({resource:this.viewer.getResource(),storage:this.storage,file:this.file})).open()},getDownloadUrl:function(){return void 0!==
this.uploader?void 0:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?attachment=true&rev="+this.file.rev},update:function(a){if(void 0===this.file||this.updateNeeded||JSON.stringify(this.file)!==JSON.stringify(a))this.file=a,this.updateNeeded=!1,this.getIsLoaded()&&this.buildContent()},removeContent:function(){void 0!==this.commentViewer&&(void 0!==this.commentViewer.getParent()&&this.commentViewer.getParent().remove(this.commentViewer),this.commentViewer=void 0);this.contentBox.setContent()},
buildContent:function(){void 0!==this.uploader?this.contentBox.setContent(new Storage.UploaderViewer({storage:this.storage,uploader:this.uploader,fileViewer:this})):(this.tools=[],this.supportProperties=!0,"image/gif"==this.file.mimetype?this.contentViewer=new Storage.GifImageFileViewer({storage:this.storage,file:this.file,fileViewer:this}):0==this.file.mimetype.indexOf("image/")?this.contentViewer=new Storage.ImageFileViewer({storage:this.storage,file:this.file,fileViewer:this}):"text/uri-list"==
this.file.mimetype?this.contentViewer=new Storage.SiteFileViewer({storage:this.storage,file:this.file,fileViewer:this}):"application/x-webnapperon2-rss-item"==this.file.mimetype?this.contentViewer=new Storage.RssItemFileViewer({storage:this.storage,file:this.file,fileViewer:this}):navigator.isIE7||navigator.isIE8||0!=this.file.mimetype.indexOf("video/")?navigator.isIE7||navigator.isIE8||0!=this.file.mimetype.indexOf("audio/")?0==this.file.mimetype.indexOf("text/plain")&&5E4>this.file.size?this.contentViewer=
new Storage.TextFileViewer({storage:this.storage,file:this.file,fileViewer:this}):0==this.file.mimetype.indexOf("application/pdf")||0==this.file.mimetype.indexOf("application/vnd.oasis.opendocument.text")||0==this.file.mimetype.indexOf("application/vnd.oasis.opendocument.presentation")||0==this.file.mimetype.indexOf("application/vnd.oasis.opendocument.graphics")||0==this.file.mimetype.indexOf("application/vnd.sun.xml.writer")||0==this.file.mimetype.indexOf("application/vnd.ms-powerpoint")||0==this.file.mimetype.indexOf("application/msword")||
0==this.file.mimetype.indexOf("application/vnd.openxmlformats-officedocument.wordprocessingml.document")||0==this.file.mimetype.indexOf("text/richtext")?this.contentViewer=new Storage.PdfFileViewer({storage:this.storage,file:this.file,fileViewer:this}):this.contentViewer=new Storage.GenericFileViewer({storage:this.storage,file:this.file,fileViewer:this}):this.contentViewer=new Storage.AudioFileViewer({storage:this.storage,file:this.file,fileViewer:this}):this.contentViewer=new Storage.VideoFileViewer({storage:this.storage,
file:this.file,fileViewer:this}),this.contentBox.setContent(this.contentViewer),this.playing&&this.play(),void 0===this.commentViewer?this.commentViewer=new Wn.CommentViewer({marginRight:5,user:Ui.App.current.getUser(),resource:this.viewer.getResource(),storage:this.storage,file:this.file,verticalAlign:"top",horizontalAlign:"right"}):(this.commentViewer.updateFile(this.file),void 0!==this.commentViewer.getParent()&&this.commentViewer.getParent().remove(this.commentViewer)),this.fullscreen&&this.commentViewer.hide(!0),
0<this.file.comments.length?(this.commentViewer.setVerticalAlign("stretch"),this.append(this.commentViewer)):this.contentBox.append(this.commentViewer))},getFile:function(){return this.file},getUploader:function(){return this.uploader},getViewer:function(){return this.viewer},getTools:function(){return this.tools},appendTool:function(a){this.tools.push(a);this.fireEvent("toolschange",this,this.tools)},play:function(){void 0===this.contentViewer?this.playing=!0:"play"in this.contentViewer?(this.connect(this.contentViewer,
"end",this.onPlayEnd),this.contentViewer.play()):new Core.DelayedTask({scope:this,delay:5,callback:this.onPlayEnd})},current:function(){0<this.contentBox.getChildren().length&&"current"in this.contentBox.getChildren()[0]&&this.contentBox.getChildren()[0].current()},uncurrent:function(){0<this.contentBox.getChildren().length&&"uncurrent"in this.contentBox.getChildren()[0]&&this.contentBox.getChildren()[0].uncurrent()},onPlayEnd:function(){this.playing=!1;this.fireEvent("end",this)},onCommentViewerUpdate:function(){void 0!==
this.commentViewer&&0<this.commentViewer.getComments().length&&this.commentViewer.getParent()===this.contentBox&&(this.contentBox.remove(this.commentViewer),this.append(this.commentViewer),this.commentViewer.setVerticalAlign("stretch"))},onFullscreen:function(){this.fullscreen=!0;void 0!==this.commentViewer&&this.commentViewer.hide(!0)},onUnFullscreen:function(){this.fullscreen=!1;void 0!==this.commentViewer&&this.commentViewer.show()},deleteFile:function(){void 0!=this.file?(new Core.HttpRequest({method:"DELETE",
url:"/cloud/storage/"+this.storage+"/"+this.file.id})).send():void 0!=this.uploader&&this.uploader.abort()},onFileViewerLoad:function(){this.buildContent()},onFileViewerUnload:function(){this.removeContent()}});
Ui.LBox.extend("Storage.UploaderViewer",{storage:void 0,uploader:void 0,progressbar:void 0,label:void 0,fileViewer:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.uploader=a.uploader;delete a.uploader;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center"});this.setContent(a);a.append(new Ui.Icon({icon:"uploadfile",fill:"#3f3f3f",width:256,height:256,horizontalAlign:"center"}));this.progressbar=new Wn.ProgressBar({width:120,
height:10});a.append(this.progressbar);void 0!=this.uploader.getFile().getFileName()&&a.append(new Ui.CompactLabel({width:256,maxLine:3,textAlign:"center",text:this.uploader.getFile().getFileName()}));this.connect(this.uploader,"progress",this.onUploaderProgress)},onUploaderProgress:function(a,b,c){this.progressbar.setValue(b/c)}});
Ui.LBox.extend("Storage.ImageFileViewer",{storage:void 0,file:void 0,image:void 0,values:void 0,quality:!1,fileViewer:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.image=new Wn.ScaledImage;this.image.setSrc("/cloud/previewhigh/"+this.storage+"/"+this.file.id+"?rev="+this.file.rev);this.setContent(this.image)},current:function(){}},{onHidden:function(){}});
Ui.LBox.extend("Storage.GifImageFileViewer",{storage:void 0,file:void 0,image:void 0,values:void 0,fileViewer:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;this.image=new Wn.ScaledImage2;this.image.setSrc("/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev);this.setContent(this.image)}});
Ui.LBox.extend("Storage.SiteFileViewer",{storage:void 0,file:void 0,text:void 0,fileViewer:void 0,linkButton:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev});this.connect(a,"done",this.onContentLoaded);a.send();a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});
this.setContent(a);var b=new Ui.LBox({verticalAlign:"bottom",horizontalAlign:"center"});a.append(b);b.append(new Ui.Rectangle({fill:new Ui.Color({r:0.7,b:0.7,g:0.7}),radius:2}));b.append(new Ui.Rectangle({fill:"white",margin:1,radius:2}));var c=new Ui.Image({src:"/cloud/previewhigh/"+this.storage+"/"+this.file.id+"?rev="+this.file.rev,width:128,margin:3});b.append(c);this.connect(c,"error",function(){b.setContent(new Ui.Icon({icon:"earth",verticalAlign:"bottom",horizontalAlign:"center",width:128,
height:128}))});this.text=new Ui.Text({textAlign:"center",text:this.file.name,fontSize:20});a.append(this.text);this.linkButton=new Ui.LinkButton({text:"Ouvrir le site",horizontalAlign:"center"});this.linkButton.disable();a.append(this.linkButton)},onContentLoaded:function(a){void 0!==this.file.meta&&"true"===this.file.meta.iframe?(a=new Ui.IFrame({src:a.getResponseText()}),this.setContent(a)):(this.linkButton.setSrc(a.getResponseText()),this.linkButton.enable())}});
Ui.LBox.extend("Storage.AudioFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,player:void 0,request:void 0,checkTask:void 0,playing:!1,constructor:function(a){this.addEvents("end");this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",
textAlign:"center"}));this.setContent(a)},checkReady:function(){void 0!==this.checkTask&&(this.checkTask=void 0);void 0===this.player&&void 0===this.request&&(this.request=new Core.HttpRequest({method:"GET",url:"/cloud/audio/"+this.storage+"/"+this.file.id+"/info"}),this.connect(this.request,"done",this.onCheckDone),this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();"ready"==a.status[a.support]?(this.player=new Wn.AudioPlayer({src:"/cloud/audio/"+
this.storage+"/"+this.file.id,text:this.file.name}),this.setContent(this.player),this.connect(this.player,"end",this.onMediaEnd),this.playing&&this.play()):"building"==a.status[a.support]?this.checkTask=new Core.DelayedTask({delay:2,scope:this,callback:this.checkReady}):this.setContent(new Ui.Text({text:"Impossible d'\u00e9couter ce fichier son"}));this.request=void 0},onCheckError:function(){this.setContent(new Ui.Text({text:"Impossible d'\u00e9couter ce fichier son",verticalAlign:"center"}));this.request=
void 0},uncurrent:function(){void 0!==this.player&&this.player.pause()},play:function(){this.playing=!0;var a=!navigator.iOs&&!navigator.Android;void 0!==this.player&&a&&this.player.play()},onMediaEnd:function(){this.fireEvent("end",this)}},{onVisible:function(){void 0===this.player&&this.checkReady()},onHidden:function(){void 0!==this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0);void 0!==this.player&&this.player.pause()}});
Ui.Pressable.extend("Storage.VideoFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,player:void 0,request:void 0,checkTask:void 0,playing:!1,constructor:function(a){this.addEvents("end");this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",
textAlign:"center"}));this.setContent(a);this.setLock(!0);this.connect(this,"press",this.onVideoPress)},checkReady:function(){void 0!==this.checkTask&&(this.checkTask=void 0);void 0===this.player&&void 0===this.request&&(this.request=new Core.HttpRequest({method:"GET",url:"/cloud/video/"+this.storage+"/"+this.file.id+"/info"}),this.connect(this.request,"done",this.onCheckDone),this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();
"ready"==a.status[a.support]?(this.player=new Wn.VideoPlayer({src:"/cloud/video/"+this.storage+"/"+this.file.id,poster:"/cloud/previewhigh/"+this.storage+"/"+this.file.id+"?rev="+this.file.rev}),this.connect(this.player,"statechange",this.onVideoStateChange),this.connect(this.player,"end",this.onVideoEnd),this.setContent(this.player),this.playing&&this.play()):"building"==a.status[a.support]?this.checkTask=new Core.DelayedTask({delay:2,scope:this,callback:this.checkReady}):this.setContent(new Ui.Text({text:"Impossible de lire ce fichier vid\u00e9o",
verticalAlign:"center",textAlign:"center"}));this.request=void 0},onCheckError:function(){this.setContent(new Ui.Text({text:"Impossible de lire ce fichier vid\u00e9o",verticalAlign:"center",textAlign:"center"}));this.request=void 0},onVideoEnd:function(a){this.playing=!1;this.fireEvent("end",this)},onVideoStateChange:function(a){this.setLock(this.player.getIsControlsVisible())},onVideoPress:function(){void 0!==this.player&&"playing"==this.player.getState()&&this.player.pause()},uncurrent:function(){void 0!==
this.player&&this.player.pause()},play:function(){this.playing=!0;var a=!navigator.iOs&&!navigator.Android;void 0!==this.player&&a&&this.player.play()}},{onVisible:function(){void 0===this.player&&this.checkReady()},onHidden:function(){void 0!==this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0);void 0!==this.player&&this.player.pause()}});
Ui.LBox.extend("Storage.TextFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,text:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.ScrollingArea({directionRelease:!0,scrollHorizontal:!1,scrollVertical:!0});this.setContent(a);var b=new Ui.LBox;b.append(new Storage.PageBackgroundGraphic({margin:7}));a.setContent(b);this.text=new Wn.ImproveText({margin:30,style:{"Wn.ImproveText":{fontSize:20}}});
b.append(this.text);a=new Ui.LinkButton({icon:"edit",src:"/app/texteditor/?storage="+this.storage+"&file="+this.file.id});this.fileViewer.appendTool(a);a=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev});this.connect(a,"done",this.onTextLoaded);a.send()},onTextLoaded:function(a){this.text.setText(a.getResponseText())}});
Ui.CanvasElement.extend("Storage.PageBackgroundGraphic",{},{updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();a.roundRectFilledShadow(5,5,b-10,c-10,2,2,2,2,!1,2,new Ui.Color({r:0,g:0,b:0,a:0.5}));a.fillStyle="#ffffff";a.fillRect(7,7,b-14,c-14)}});
Ui.LBox.extend("Storage.RssItemFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,title:void 0,content:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;var b=new Ui.ScrollingArea({directionRelease:!0,scrollHorizontal:!1,scrollVertical:!0});this.setContent(b);a=new Ui.LBox;a.append(new Storage.PageBackgroundGraphic);b.setContent(a);b=new Ui.VBox({margin:20,spacing:10});a.append(b);this.title=
new Ui.Text({text:this.file.name,fontWeight:"bold",fontSize:24,marginTop:20});b.append(this.title);this.content=new Ui.Html;this.connect(this.content,"link",this.onContentLink);b.append(this.content);a=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/"+this.file.id+"/content?rev="+this.file.rev});this.connect(a,"done",this.onTextLoaded);a.send()},onTextLoaded:function(a){var b='<div style="word-wrap: break-word; font-family: '+this.getStyleProperty("fontFamily")+";font-size: "+
this.getStyleProperty("fontSize")+"px;font-weight: "+this.getStyleProperty("fontWeight")+';">',b=b+((new Date(this.file.meta.pubDate)).toLocaleString()+"&nbsp;&nbsp;");void 0!=this.file.meta.link&&(b+='<a href="'+this.file.meta.link+'" style="cursor: pointer; text-decoration: underline; color: #4d4d4d">article complet</a><br>');b=b+"<br>"+a.getResponseText();b+="</div>";this.content.setHtml(b)},onContentLink:function(a,b){window.open(b,"_blank")}});
Ui.CanvasElement.extend("Storage.PdfPageGraphic",{src:void 0,image:void 0,ratio:1,constructor:function(a){this.src=a.src;delete a.src;this.ratio=a.ratio;delete a.ratio;this.image=new Ui.Image({src:this.src});this.connect(this.image,"ready",this.onImageReady);this.appendChild(this.image)},onImageReady:function(){this.invalidateDraw()}},{measureCore:function(a,b){return{width:a,height:(a-14)/this.ratio+14}},updateCanvas:function(a){var b=this.getLayoutWidth(),c=this.getLayoutHeight();a.roundRectFilledShadow(5,
5,b-10,c-10,2,2,2,2,!1,2,new Ui.Color({r:0,g:0,b:0,a:0.5}));a.fillStyle="#ffffff";a.fillRect(7,7,b-14,c-14);this.image.getIsReady()&&a.drawImage(this.image.getDrawing(),0,0,this.image.getNaturalWidth(),this.image.getNaturalHeight(),7,7,b-14,c-14)}});
Ui.LBox.extend("Storage.PdfPage",{storage:void 0,file:void 0,page:void 0,ratio:void 0,graphic:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.page=a.page;delete a.page;this.ratio=a.ratio;delete a.ratio}},{measureCore:function(a,b){return{width:a,height:(a-20)/this.ratio+20}},onVisible:function(){void 0===this.graphic&&(this.graphic=new Storage.PdfPageGraphic({ratio:this.ratio,src:"/cloud/pdf/"+this.storage+"/"+this.file.id+"/pages/"+this.page+
"/image?rev="+this.file.rev}),this.append(this.graphic))},onHidden:function(){void 0!==this.graphic&&(this.remove(this.graphic),this.graphic=void 0)},onChildInvalidateMeasure:function(a,b){a.measure(this.getLayoutWidth(),this.getLayoutHeight());a.arrange(0,0,this.getLayoutWidth(),this.getLayoutHeight())}});
Ui.LBox.extend("Storage.PdfFileViewer",{storage:void 0,file:void 0,fileViewer:void 0,pages:void 0,data:void 0,isCurrent:!1,scroll:void 0,checkTask:void 0,request:void 0,relativeOffset:0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));a.append(new Ui.Text({text:"Encodage en cours... Veuillez patienter",
textAlign:"center"}));this.setContent(a)},checkReady:function(){void 0!=this.checkTask&&(this.checkTask=void 0);void 0==this.request&&(this.request=new Core.HttpRequest({method:"GET",url:"/cloud/pdf/"+this.storage+"/"+this.file.id}),this.connect(this.request,"done",this.onCheckDone),this.connect(this.request,"error",this.onCheckError),this.request.send())},onCheckDone:function(){var a=this.request.getResponseJSON();"ready"==a.status?(this.data=a,this.scroll=new Ui.ScrollingArea({directionRelease:!0,
scrollHorizontal:!1,scrollVertical:!0}),this.connect(this.scroll,"scroll",this.onScroll),this.setContent(this.scroll),this.pages=new Ui.VBox({spacing:10}),this.scroll.setContent(this.pages),this.onDataDone()):"building"==a.status?this.checkTask=new Core.DelayedTask({delay:2,scope:this,callback:this.checkReady}):this.setContent(new Ui.Text({text:"Impossible de lire ce fichier PDF",verticalAlign:"center"}));this.request=void 0},onCheckError:function(){this.setContent(new Ui.Text({text:"Impossible de lire ce fichier vid\u00e9o",
verticalAlign:"center"}));this.request=void 0},onScroll:function(a){var b=a.getOffsetY();a=a.getLayoutHeight();for(var c=0;c<this.pages.getChildren().length;c++){var d=this.pages.getChildren()[c],e=d.getLayoutY(),f=d.getLayoutHeight();e>=b&&e<=b+a||e+f>=b&&e+f<=b+a||b>=e&&b<=e+f||b+a>=e&&b+a<=e+f?d.show():d.hide()}},onDataDone:function(a){for(a=0;a<this.data.pages.length;a++){var b=new Storage.PdfPage({storage:this.storage,file:this.file,page:a,ratio:this.data.pages[a].width/this.data.pages[a].height});
b.hide();this.pages.append(b)}},current:function(){this.isCurrent=!0},uncurrent:function(){this.isCurrent=!1}},{arrangeCore:function(a,b){var c=0;void 0!==this.scroll&&(c=this.scroll.getRelativeOffsetY());Storage.PdfFileViewer.base.arrangeCore.call(this,a,b);void 0!==this.scroll&&(this.scroll.setOffset(void 0,c),this.onScroll(this.scroll))},onVisible:function(){if(void 0===this.scroll)this.checkReady();else this.onScroll(this.scroll)},onHidden:function(){void 0!=this.request&&(this.request.abort(),
this.request=void 0);void 0!=this.checkTask&&(this.checkTask.abort(),this.checkTask=void 0)}});
Ui.LBox.extend("Storage.GenericFileViewer",{storage:void 0,file:void 0,text:void 0,fileViewer:void 0,constructor:function(a){this.storage=a.storage;delete a.storage;this.file=a.file;delete a.file;this.fileViewer=a.fileViewer;delete a.fileViewer;a=new Ui.VBox({verticalAlign:"center",horizontalAlign:"center",spacing:10});this.setContent(a);a.append(new Ui.Icon({icon:"file",width:128,height:128,horizontalAlign:"center"}));this.text=new Ui.Text({textAlign:"center",text:this.file.name,fontSize:20});a.append(this.text);
var b=new Ui.DownloadButton({text:"T\u00e9l\u00e9charger",horizontalAlign:"center"});b.setSrc("/cloud/storage/"+this.storage+"/"+this.file.id+"/content?attachment=true&rev="+this.file.rev);a.append(b)}});
Ui.Container.extend("Storage.ScaledImage",{image:void 0,src:void 0,ratio:1,constructor:function(a){this.setClipToBounds(!0);"src"in a?(this.src=a.src,delete a.src,this.image=new Ui.Image({src:this.src})):this.image=new Ui.Image;this.appendChild(this.image);"ratio"in a&&(this.ratio=a.ratio,delete a.ratio);this.connect(this.image,"ready",this.onReady);this.addEvents("ready")},setSrc:function(a){this.removeChild(this.image);this.src=a;this.image=void 0==this.src?new Ui.Image:new Ui.Image({src:this.src});
this.appendChild(this.image)},getIsReady:function(){return this.image.getIsReady()},onReady:function(){this.invalidateMeasure();this.fireEvent("ready",this)}},{measureCore:function(a,b){if(this.getIsReady()){var c=this.image.getNaturalWidth(),d=this.image.getNaturalHeight();return{width:a,height:d*a/c}}return{width:a,height:a/this.ratio}},arrangeCore:function(a,b){this.image.arrange(0,0,a,b)}});
Ui.Dialog.extend("Storage.NewDialog",{viewer:void 0,constructor:function(a){this.viewer=a.viewer;delete a.viewer;this.setFullScrolling(!0);this.setPreferedWidth(300);this.setPreferedHeight(350);a=new Ui.VBox({uniform:!0,spacing:8});this.setContent(a);var b;b=navigator.iOs?new Ui.UploadButton({icon:"camera",text:"Photo ou vid\u00e9o",orientation:"horizontal"}):new Ui.UploadButton({icon:"savecloud2",text:"Fichier local",orientation:"horizontal"});this.connect(b,"file",function(a,b){this.viewer.onUploadFile(a,
b);this.close()});a.append(b);b=new Ui.Button({icon:"new",text:"Fichier texte",orientation:"horizontal"});this.connect(b,"press",function(){this.close();this.viewer.onNewTextPress()});a.append(b);b=new Ui.Button({icon:"earth",text:"Lien vers un site Web",orientation:"horizontal"});this.connect(b,"press",function(){this.close();this.viewer.onNewUriPress()});a.append(b);this.setTitle("Nouveau fichier");this.setCancelButton(new Ui.Button({text:"Annuler"}))}});
Wn.ResourceViewer.extend("Storage.BaseViewer",{storage:void 0,navigation:void 0,flow:void 0,updateRequest:void 0,mainVbox:void 0,toolsBox:void 0,dropbox:void 0,showNavigation:!1,carousel:void 0,firstUpdate:!0,tools:void 0,current:void 0,currentPreview:void 0,files:void 0,autoplay:!1,autoplayButton:void 0,resourceRev:0,actionButtons:void 0,fileActionsSeparator:void 0,filePropertiesButton:void 0,constructor:function(a){this.addEvents("toolstoggle");this.actionButtons=[];this.fileActionsSeparator=new Ui.Separator;
this.filePropertiesButton=new Ui.Button({icon:"filetools"});this.connect(this.filePropertiesButton,"press",this.onPropertiesPress);this.fileDownloadButton=new Ui.DownloadButton({icon:"savedisk"});this.autoplayButton=new Ui.ToggleButton({icon:"chronoplay"})},setStorage:function(a){this.storage=a;this.dropbox=new Ui.DropBox;this.canAddFile()&&(this.dropbox.setAllowedMode("copy"),this.dropbox.addMimetype("files"));this.connect(this.dropbox,"dropfile",this.onUploadFile);this.setContent(this.dropbox);
this.mainVbox=new Ui.VBox;this.dropbox.setContent(this.mainVbox);this.carousel=new Ui.Carousel;this.mainVbox.append(this.carousel,!0);this.connect(this.carousel,"change",this.onCarouselChange);this.canAddFile()&&(a=new Ui.Button({icon:"plus"}),this.actionButtons.unshift(a),this.connect(a,"press",function(){(new Storage.NewDialog({viewer:this})).open()}));a=new Ui.ToggleButton({icon:"thumb"});this.connect(a,"toggle",this.onNavToggle);this.connect(a,"untoggle",this.onNavUntoggle);this.actionButtons.unshift(a);
this.connect(this.autoplayButton,"toggle",this.onAutoPlayToggle);this.connect(this.autoplayButton,"untoggle",this.onAutoPlayUntoggle);this.actionButtons.unshift(this.autoplayButton);this.tools=[];this.setActionButtons(this.actionButtons);this.connect(this,"fullscreen",this.onFullScreen);this.connect(this,"unfullscreen",this.onUnFullScreen);this.connect(this.getDrawing(),"keyup",this.onKeyUp);this.update()},canAddFile:function(){return this.getResource().canWrite()},canDeleteFile:function(){return this.getResource().canWrite()},
canModifyFile:function(){return this.getResource().canWrite()},getStorage:function(){return this.storage},play:function(){this.setAutoPlay(!0)},setAutoPlay:function(a){this.autoplay!=a&&((this.autoplay=a)?this.autoplayButton.toggle():this.autoplayButton.untoggle())},onFileDropAt:function(a,b,c,d){if(-1!=c.indexOf(":")&&(b=c.split(":"),2==b.length)){a=b[0];b=parseInt(b[1]);for(var e=void 0,f=-1,g=0;g<this.flow.getLogicalChildren().length&&void 0===e;g++){var k=this.flow.getLogicalChildren()[g];k.getStorage()+
":"+k.getFile().id==c&&(e=k,f=g)}void 0!==e&&f!=d&&f+1!=d&&(f<d&&d--,this.flow.moveAt(e,d),c=this.carousel.getLogicalChildren()[f],this.carousel.moveAt(c,d),(new Core.HttpRequest({method:"PUT",url:"/cloud/storage/"+a+"/"+b,content:JSON.stringify({position:d})})).send())}},update:function(){void 0===this.updateRequest&&(this.updateRequest=new Core.HttpRequest({method:"GET",url:"/cloud/storage/"+this.storage+"/0?depth=1"}),this.connect(this.updateRequest,"done",this.onUpdateDone),this.connect(this.updateRequest,
"error",this.onUpdateError),this.updateRequest.send())},deleteCurrent:function(){if(this.getResource().canWrite()){var a=this.carousel.getCurrent();void 0!=a&&Storage.FileViewer.hasInstance(a)&&a.deleteFile()}},addFile:function(a){for(var b=!1,c=0;c<this.carousel.getLogicalChildren().length;c++)if(this.carousel.getLogicalChildren()[c].getFile().id===a.id){this.carousel.setCurrentAt(c);b=!0;break}b||(void 0!==this.navigation&&(b=new Storage.FilePreview({storage:this.storage,file:a}),this.connect(b,
"press",this.onPreviewPress),this.flow.insertAt(b,a.position)),b=new Storage.FileViewer({storage:this.storage,file:a,viewer:this}),this.carousel.insertAt(b,a.position),this.carousel.setCurrent(b))},addNavigation:function(){void 0===this.navigation&&(this.navigation=new Ui.ScrollingArea({scrollHorizontal:!0,scrollVertical:!1}),this.flow=new Wn.HDropBox({spacing:10}),this.canModifyFile()&&(this.flow.addMimetype("application/x-wn2-file"),this.flow.setAllowedMode("copy"),this.flow.addMimetype("files"),
this.connect(this.flow,"dropat",this.onFileDropAt),this.connect(this.flow,"dropfileat",this.onUploadFile)),this.navigation.setContent(this.flow),this.mainVbox.append(this.navigation),this.updatePreviews(this.files),this.updatePreviewCurrent())},removeNavigation:function(){void 0!==this.navigation&&(this.mainVbox.remove(this.navigation),this.navigation=void 0)},onNavToggle:function(){this.showNavigation=!0;this.addNavigation()},onNavUntoggle:function(){this.showNavigation=!1;this.removeNavigation()},
onCarouselChange:function(a,b){if(0==a.getLogicalChildren().length)this.setTools([]);else{void 0!==this.current&&(this.current.uncurrent(),this.disconnect(this.current,"end",this.onCurrentEnd));var c=this.carousel.getLogicalChildren()[b];void 0!==c&&(c.current(),this.filePropertiesButton.setEnable(c.getSupportProperties()),void 0===c.getDownloadUrl()?this.fileDownloadButton.disable():(this.fileDownloadButton.enable(),this.fileDownloadButton.setSrc(c.getDownloadUrl())),this.setTools(c.getTools()),
void 0!==c.getFile()&&Ui.App.current.notifyMainPath("resource:"+this.getResource().getId()+":"+this.carousel.getLogicalChildren()[b].getFile().id),this.connect(c,"end",this.onCurrentEnd),this.autoplay&&c.play());this.current=c;this.updatePreviewCurrent()}},updatePreviewCurrent:function(){void 0!==this.currentPreview&&(this.currentPreview.uncurrent(),this.currentPreview=void 0);if(void 0!==this.navigation&&void 0!==this.current&&void 0!==this.current.getFile())for(var a=0;a<this.flow.getLogicalChildren().length;a++){var b=
this.flow.getLogicalChildren()[a];if(void 0!==b.getFile()&&b.getFile().id==this.current.getFile().id){"scrollIntoViewIfNeeded"in b.getDrawing()?b.getDrawing().scrollIntoViewIfNeeded():b.getDrawing().scrollIntoView();this.currentPreview=b;this.currentPreview.current();break}}},setTools:function(a){var b=[];this.tools=[];for(var c=0;c<a.length;c++)this.tools.push(a[c]),b.push(a[c]);b.push(this.fileDownloadButton);b.push(this.filePropertiesButton);b.push(this.fileActionsSeparator);for(c=0;c<this.actionButtons.length;c++)b.push(this.actionButtons[c]);
this.setActionButtons(b)},onFullScreen:function(){this.showNavigation&&this.removeNavigation()},onUnFullScreen:function(){this.showNavigation&&this.addNavigation()},updatePreviews:function(a){if(void 0!==this.navigation){for(var b=[],c=0;c<this.flow.getLogicalChildren().length;c++){var d=this.flow.getLogicalChildren()[c],e=d.getFile();if(void 0!=e){var f=void 0;if(void 0!==e&&void 0!==a)for(var g=0;void 0===f&&g<a.length;g++)a[g].id==e.id&&(f=a[g]);void 0!==f?(f.hostResourceViewerSeen=!0,d.update(f)):
b.push(d)}}for(c=0;c<b.length;c++)this.flow.remove(b[c]);if(void 0!==a)for(c=0;c<a.length;c++)a[c].hostResourceViewerSeen?delete a[c].hostResourceViewerSeen:(e=a[c],b=new Storage.FilePreview({storage:this.storage,file:e}),this.connect(b,"press",this.onPreviewPress),this.flow.insertAt(b,e.position))}},onUpdateDone:function(){var a=this.updateRequest.getResponseJSON();this.storageRev=a.storage_rev;if(0===(void 0===a.children?0:a.children.length)){var b="Il n'y a pas encore de fichier. Vous pouvez en cr\u00e9er ou les t\u00e9l\u00e9verser depuis la barre d'outil.";
navigator.supportDrag&&(b+=" Vous pouvez aussi t\u00e9l\u00e9verser des fichiers en faisant un glisser d\u00e9poser dans cette zone.");this.canAddFile()||(b="Il n'y a pas encore de fichier. Revenez plus tard.");this.dropbox.setContent(new Ui.Text({fontSize:20,text:b,textAlign:"center",verticalAlign:"center",margin:20,interLine:1.4}));this.filePropertiesButton.disable();this.fileDownloadButton.disable()}else void 0===this.mainVbox.getParent()&&this.dropbox.setContent(this.mainVbox);this.updatePreviews(a.children);
for(var c=[],b=0;b<this.carousel.getLogicalChildren().length;b++){var d=this.carousel.getLogicalChildren()[b],e=d.getFile();if(void 0!==e){var f=void 0;if("children"in a)for(var g=0;void 0===f&&g<a.children.length;g++)a.children[g].id==e.id&&(f=a.children[g]);void 0!==f?(d.update(f),f.hostResourceViewerSeen=!0):c.push(d)}}for(b=0;b<c.length;b++)this.carousel.remove(c[b]);if("children"in a){c=0===this.carousel.getLogicalChildren().length;for(b=0;b<a.children.length;b++)a.children[b].hostResourceViewerSeen?
delete a.children[b].hostResourceViewerSeen:(e=a.children[b],this.carousel.insertAt(new Storage.FileViewer({storage:this.storage,file:e,viewer:this}),e.position));c&&this.carousel.getLogicalChildren()[0].current()}this.files=a.children;this.updateRequest=void 0;if(this.firstUpdate)if(this.firstUpdate=!1,a=this.getPath(),void 0!=a)for(b=0;b<this.carousel.getLogicalChildren().length;b++){if(this.carousel.getLogicalChildren()[b].getFile().id==a){this.carousel.setCurrentAt(b);break}}else this.carousel.setCurrentAt(0);
this.onCarouselChange(this.carousel,this.carousel.getCurrentPosition())},onUpdateError:function(){this.updateRequest=void 0},onPreviousPress:function(){this.carousel.previous()},onNextPress:function(){this.carousel.next()},onPreviewPress:function(a){for(var b=0;b<this.carousel.getLogicalChildren().length;b++)if(void 0!==this.carousel.getLogicalChildren()[b].getFile()&&void 0!==a.getFile()&&this.carousel.getLogicalChildren()[b].getFile().id===a.getFile().id||void 0!==this.carousel.getLogicalChildren()[b].getUploader()&&
void 0!==a.getUploader()&&this.carousel.getLogicalChildren()[b].getUploader()===a.getUploader()){this.carousel.setCurrentAt(b);break}},onKeyUp:function(a){46==a.which&&(a.stopPropagation(),a.preventDefault(),this.onDeletePress())},onUploadFile:function(a,b,c){if(this.getResource().canWrite())a=new Core.FilePostUploader({file:b,service:"/cloud/storage/"+this.storage+"/0"}),void 0!==c&&a.setField("define",JSON.stringify({position:c})),a.hostStorage=this.storage,this.connect(a,"error",this.onUploadError),
this.connect(a,"complete",this.onUploadError),void 0!==this.navigation&&(b=new Storage.FilePreview({storage:this.storage,uploader:a}),this.connect(b,"press",this.onPreviewPress),void 0!==c?this.flow.insertAt(b,c):this.flow.append(b)),b=new Storage.FileViewer({storage:this.storage,uploader:a,viewer:this}),void 0!==c?this.carousel.insertAt(b,c):this.carousel.append(b),this.carousel.setCurrent(b),void 0===this.mainVbox.getParent()&&this.dropbox.setContent(this.mainVbox),Ui.App.current.addUploader(a),
a.send();else{var d=new Ui.Dialog({title:"Probl\u00e8me de droit",fullScrolling:!0,preferedWidth:300,preferedHeight:300});c=new Ui.Button({text:"Fermer"});d.setContent(new Ui.Text({text:"Vous n'avez pas le droit d'\u00e9crire sur cette resource"}));d.setActionButtons([c]);d.open();this.connect(c,"press",function(){d.close()})}},onUploadError:function(a){var b=void 0;if(void 0!==this.flow){for(var c=0;void 0===b&&c<this.flow.getLogicalChildren().length;c++)this.flow.getLogicalChildren()[c].getUploader()==
a&&(b=this.flow.getLogicalChildren()[c]);void 0!=b&&this.flow.remove(b)}b=void 0;for(c=0;void 0==b&&c<this.carousel.getLogicalChildren().length;c++)this.carousel.getLogicalChildren()[c].getUploader()==a&&(b=this.carousel.getLogicalChildren()[c]);void 0!=b&&this.carousel.remove(b)},onNewTextPress:function(){var a=new Ui.Dialog({title:"Nouveau fichier texte",fullScrolling:!0,preferedWidth:300,preferedHeight:300});a.setCancelButton(new Ui.Button({text:"Annuler"}));var b=new Ui.VBox({spacing:10});a.setContent(b);
b.append(new Ui.Label({text:"Nom du fichier",horizontalAlign:"left"}));var c=new Ui.TextField({marginLeft:20});b.append(c);b=new Ui.Button({text:"Cr\u00e9er"});a.setActionButtons([b]);this.connect(b,"press",function(){a.disable();var b=new Core.HttpRequest({method:"POST",url:"/cloud/storage/"+this.storage+"/0"});b.setRequestHeader("Content-Type","application/json");b.setContent(JSON.stringify({name:c.getValue(),mimetype:"text/plain"}));this.connect(b,"done",function(){this.addFile(b.getResponseJSON());
a.close()});this.connect(b,"error",function(){a.close()});b.send()});a.open()},onNewUriPress:function(){var a=new Ui.Dialog({title:"Nouveau lien vers un site",fullScrolling:!0,preferedWidth:400,preferedHeight:300});a.setCancelButton(new Ui.Button({text:"Annuler"}));var b=new Ui.VBox({spacing:10});a.setContent(b);var c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Nom",textAlign:"right",verticalAlign:"center",width:100}));var d=new Ui.TextField({verticalAlign:"center"});c.append(d,
!0);c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Adresse",textAlign:"right",verticalAlign:"center",width:100}));var e=new Ui.TextField({verticalAlign:"center"});c.append(e,!0);c=new Ui.HBox({spacing:10});b.append(c);c.append(new Ui.Text({text:"Options",textAlign:"right",verticalAlign:"center",width:100}));var f=new Ui.CheckBox({verticalAlign:"center",text:'int\u00e9gration "iframe"'});c.append(f,!0);b=new Ui.Button({text:"Cr\u00e9er"});a.setActionButtons([b]);this.connect(b,
"press",function(){a.disable();for(var b="----",c=0;16>c;c++)b+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"[Math.floor(62*Math.random())];var b=b+"----",h=new Core.HttpRequest({method:"POST",url:"/cloud/storage/"+this.storage+"/0"});h.setRequestHeader("Content-Type","multipart/form-data; boundary="+b);h.setContent("--"+b+'\r\nContent-Disposition: form-data; name="define"\r\nContent-Type: application/json; charset=UTF-8\r\n\r\n'+JSON.stringify({name:d.getValue(),mimetype:"text/uri-list",
meta:{iframe:f.getValue().toString()}})+"\r\n--"+b+'\r\nContent-Disposition: form-data; name="file"; filename="noname"\r\nContent-Type: text/plain; charset=UTF-8\r\n\r\n'+e.getValue()+"\r\n--"+b+"--\r\n");this.connect(h,"done",function(){this.addFile(h.getResponseJSON());a.close()});this.connect(h,"error",function(){a.close()});h.send()});a.open()},onAutoPlayToggle:function(){this.autoplay=!0;void 0!==this.current&&this.current.play()},onAutoPlayUntoggle:function(){this.autoplay=!1},onCurrentEnd:function(a){this.disconnect(a,
"end",this.onCurrentEnd);this.autoplay&&(this.carousel.getCurrentPosition()>=this.carousel.getLogicalChildren().length-1?this.setAutoPlay(!1):this.carousel.next())},onPropertiesPress:function(){void 0!==this.current&&this.current.showProperties()}},{onResourceChange:function(){Storage.BaseViewer.base.onResourceChange.apply(this,arguments);void 0!==this.storage&&this.resourceRev!==this.getResource().getData().rev&&(this.resourceRev=this.getResource().getData().rev,this.update())},onDeletePress:function(){if(this.canDeleteFile()){if(0==
this.carousel.getLogicalChildren().length){var a=new Ui.Dialog({title:"Suppression",preferedWidth:300,preferedHeight:200,fullScrolling:!0,cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous d\u00e9finitivement supprimer cette ressource ?"})}),b=new Wn.AlertButton({text:"Supprimer"});this.connect(b,"press",function(){a.close();this.deleteResource()});a.setActionButtons([b])}else{var a=new Ui.Dialog({title:"Suppression",preferedWidth:300,preferedHeight:200,fullScrolling:!0,
cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Que voulez vous d\u00e9finitivement supprimer ? Le fichier actuel ou la ressource et l'ensemble des fichiers ?"})}),c=new Wn.AlertButton({text:"Le fichier"});this.connect(c,"press",function(){this.deleteCurrent();a.close()});b=new Wn.AlertButton({text:"Tout"});this.connect(b,"press",function(){a.close();var b=new Ui.Dialog({title:"Suppression",preferedWidth:300,preferedHeight:200,fullScrolling:!0,cancelButton:new Ui.Button({text:"Annuler"}),
content:new Ui.Text({text:"Voulez vraiment vous d\u00e9finitivement supprimer cette ressource et TOUS les fichiers ?"})}),c=new Wn.AlertButton({text:"Supprimer"});this.connect(c,"press",function(){b.close();this.deleteResource()});b.setActionButtons([c]);b.open()});a.setActionButtons([b,c])}a.open()}else Storage.BaseViewer.base.onDeletePress.call(this)},onPathChange:function(a,b){if(void 0!==b)for(var c=0;c<this.carousel.getLogicalChildren().length;c++)if(this.carousel.getLogicalChildren()[c].getFile().id==
b){this.carousel.setCurrentAt(c);break}}});Storage.BaseViewer.extend("Storage.Viewer",{constructor:function(a){this.setStorage(this.getResource().getStorageId())}},{},{constructor:function(){Wn.ResourceViewer.register("storage",this)}});Wn.ResourceCreator.extend("Storage.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"storage",name:this.getData().name});this.done()}});Wn.WizardItem.extend("Storage.Wizard",{nameField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);a.append(new Ui.Label({text:"Nom de la ressource:",horizontalAlign:"left"}));this.nameField=new Ui.TextField({marginLeft:20});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);a=this.getData();void 0!=a.name&&this.nameField.setValue(a.name);this.onChange()},onChange:function(){""!=this.nameField.getValue()&&this.done()}},{onSave:function(){this.getData().name=
this.nameField.getValue()}});Wn.ResourceWizard.register("storage","Fichiers","files",[Storage.Wizard],Storage.Creator);Storage.BaseViewer.extend("Picasa.Viewer",{loadText:void 0,constructor:function(a){a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));this.loadText=new Ui.Text({text:"Chargement en cours... Veuillez patienter",textAlign:"center"});a.append(this.loadText);this.setContent(a)}},{canAddFile:function(){return!1},canDeleteFile:function(){return!1},onResourceChange:function(){Picasa.Viewer.base.onResourceChange.apply(this,arguments);
if(void 0===this.getStorage()){var a=this.getResource().getData();0==a.utime&&0==a.failcount?this.loadText.setText("Synchronisation Picasa en cours... Veuillez patienter"):0==a.utime&&0<a.failcount?this.setContent(new Ui.Text({text:"Echec de la synchronisation Picasa (nombre d'\u00e9chec: "+a.failcount+"). Il y a s\u00fbrement un probl\u00e8me sur cet album.",textAlign:"center",verticalAlign:"center"})):0<a.utime&&0<a.failcount&&604800<a.delta?this.setContent(new Ui.Text({text:"Echec de la synchronisation Picasa depuis une semaine. L'album a peut \u00eatre \u00e9t\u00e9 supprim\u00e9...",
textAlign:"center",verticalAlign:"center"})):this.setStorage(this.getResource().getStorageId())}},onLoad:function(){Picasa.Viewer.base.onLoad.call(this);if(this.resource.getIsReady())this.onResourceChange()}},{constructor:function(){Wn.ResourceViewer.register("picasa",this)}});Storage.Preview.extend("Picasa.Preview",{picasa:void 0,constructor:function(a){this.getGraphic().setIcon("picasa")}},{},{constructor:function(){this.register("picasa",this)}});Wn.ResourceCreator.extend("Picasa.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"picasa",name:this.getData().name,url:this.getData().url});this.done()}});Wn.WizardItem.extend("Picasa.Wizard",{nameField:void 0,urlField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);a.append(new Ui.Label({text:"Nom de la ressource:",horizontalAlign:"left"}));this.nameField=new Ui.TextField({marginLeft:20});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);a.append(new Ui.Label({text:"URL du flux RSS de l'album:",horizontalAlign:"left"}));this.urlField=new Ui.TextField({marginLeft:20});this.connect(this.urlField,
"change",this.onChange);a.append(this.urlField);a=this.getData();void 0!=a.name&&this.nameField.setValue(a.name);void 0!=a.url&&this.urlField.setValue(a.url);this.onChange()},onChange:function(){""!=this.urlField.getValue()&&""!=this.nameField.getValue()&&this.urlField.getValue().match(/^http(s){0,1}:\/\/.*google.*$/)&&this.done()}},{onSave:function(){var a=this.getData();a.name=this.nameField.getValue();a.url=this.urlField.getValue()}});
Wn.ResourceWizard.register("picasa","Picasa","picasa",[Picasa.Wizard],Picasa.Creator);Storage.BaseViewer.extend("Podcast.Viewer",{loadText:void 0,constructor:function(a){a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));this.loadText=new Ui.Text({text:"Chargement en cours... Veuillez patienter",textAlign:"center"});a.append(this.loadText);this.setContent(a)}},{canAddFile:function(){return!1},canDeleteFile:function(){return!1},onResourceChange:function(){Podcast.Viewer.base.onResourceChange.apply(this,arguments);
if(void 0===this.getStorage()){var a=this.getResource().getData();0==a.utime&&0==a.failcount?this.loadText.setText("Synchronisation Podcast en cours... Veuillez patienter"):0==a.utime&&0<a.failcount?this.setContent(new Ui.Text({text:"Echec de la synchronisation du Podcast (nombre d'\u00e9chec: "+a.failcount+"). Il y a s\u00fbrement un probl\u00e8me sur cet album.",textAlign:"center",verticalAlign:"center"})):0<a.utime&&0<a.failcount&&604800<a.delta?this.setContent(new Ui.Text({text:"Echec de la synchronisation du Podcast depuis une semaine. L'album a peut \u00eatre \u00e9t\u00e9 supprim\u00e9...",
textAlign:"center",verticalAlign:"center"})):this.setStorage(this.getResource().getStorageId())}},onLoad:function(){Podcast.Viewer.base.onLoad.call(this);if(this.resource.getIsReady())this.onResourceChange()}},{constructor:function(){Wn.ResourceViewer.register("podcast",this)}});Storage.Preview.extend("Podcast.Preview",{constructor:function(a){this.getGraphic().setIcon("note")}},{},{constructor:function(){this.register("podcast",this)}});Wn.ResourceCreator.extend("Podcast.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"podcast",name:this.getData().name,url:this.getData().url});this.done()}});Wn.WizardItem.extend("Podcast.Wizard",{nameField:void 0,urlField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);a.append(new Ui.Label({text:"Nom de la ressource:",horizontalAlign:"left"}));this.nameField=new Ui.TextField({marginLeft:20});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);a.append(new Ui.Label({text:"URL du flux RSS du Podcast:",horizontalAlign:"left"}));this.urlField=new Ui.TextField({marginLeft:20});this.connect(this.urlField,
"change",this.onChange);a.append(this.urlField);a=this.getData();void 0!=a.name&&this.nameField.setValue(a.name);void 0!=a.url&&this.urlField.setValue(a.url);this.onChange()},onChange:function(){""!=this.urlField.getValue()&&""!=this.nameField.getValue()&&this.urlField.getValue().match(/^http(s){0,1}:\/\/.*$/)&&this.done()}},{onSave:function(){var a=this.getData();a.name=this.nameField.getValue();a.url=this.urlField.getValue()}});
Wn.ResourceWizard.register("podcast","Podcast","note",[Podcast.Wizard],Podcast.Creator);Storage.BaseViewer.extend("News.Viewer",{loadText:void 0,constructor:function(a){a=new Ui.VBox({verticalAlign:"center",spacing:10});a.append(new Ui.Loading({width:50,height:50,horizontalAlign:"center"}));this.loadText=new Ui.Text({text:"Chargement en cours... Veuillez patienter",textAlign:"center"});a.append(this.loadText);this.setContent(a)}},{canAddFile:function(){return!1},canDeleteFile:function(){return!1},onResourceChange:function(){News.Viewer.base.onResourceChange.apply(this,arguments);if(void 0===
this.getStorage()){var a=this.getResource().getData();0==a.utime&&0==a.failcount?this.loadText.setText("Synchronisation des news en cours... Veuillez patienter"):0==a.utime&&0<a.failcount?this.setContent(new Ui.Text({text:"Echec de la synchronisation des news (nombre d'\u00e9chec: "+a.failcount+"). Il y a s\u00fbrement un probl\u00e8me sur cet album.",textAlign:"center",verticalAlign:"center"})):0<a.utime&&0<a.failcount&&604800<a.delta?this.setContent(new Ui.Text({text:"Echec de la synchronisation des news depuis une semaine. L'album a peut \u00eatre \u00e9t\u00e9 supprim\u00e9...",
textAlign:"center",verticalAlign:"center"})):this.setStorage(this.getResource().getStorageId())}},onLoad:function(){News.Viewer.base.onLoad.call(this);if(this.resource.getIsReady())this.onResourceChange()}},{constructor:function(){Wn.ResourceViewer.register("news",this)}});Wn.ResourceView.extend("News.Preview",{request:void 0,constructor:function(a){this.getGraphic().setIcon("newspaper")}},{},{constructor:function(){this.register("news",this)}});Wn.ResourceCreator.extend("News.Creator",{constructor:function(a){Ui.App.current.getUser().createResource({type:"news",name:this.getData().name,url:this.getData().url,fullcontent:this.getData().fullcontent});this.done()}});Wn.WizardItem.extend("News.Wizard",{nameField:void 0,urlField:void 0,fullContentField:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);a.append(new Ui.Label({text:"Nom de la ressource:",horizontalAlign:"left"}));this.nameField=new Ui.TextField({marginLeft:20});this.connect(this.nameField,"change",this.onChange);a.append(this.nameField);a.append(new Ui.Label({text:"URL du flux RSS du journal:",horizontalAlign:"left"}));this.urlField=new Ui.TextField({marginLeft:20});this.connect(this.urlField,
"change",this.onChange);a.append(this.urlField);hbox=new Ui.HBox({spacing:10});a.append(hbox);this.fullContentField=new Ui.CheckBox({text:"R\u00e9cup\u00e9rer le contenu complet"});hbox.append(this.fullContentField,!0);a=new Ui.Pressable;this.connect(a,"press",this.onHelpPress);hbox.append(a);a.setContent(new Ui.Icon({icon:"help",width:24,height:24,verticalAlign:"center"}));a=this.getData();void 0!=a.name&&this.nameField.setValue(a.name);void 0!=a.url&&this.urlField.setValue(a.url);void 0!=a.fullcontent&&
this.fullContentField.setValue(a.fullcontent);this.onChange()},onHelpPress:function(){var a=new Ui.Dialog({title:"Mise en garde",preferedWidth:300,preferedHeight:350,fullScrolling:!0});a.setContent(new Ui.Text({text:"ATTENTION, cette option va essayer de r\u00e9cup\u00e9rer le contenu complet des articles r\u00e9f\u00e9renc\u00e9s dans le flux RSS. Cela veux dire qu'il va modifier le flux RSS.\nCela peut \u00eatre inutile voir poser des probl\u00e8mes avec certains flux RSS.\nMais surtout, cela peut \u00eatre contraire au droit d'auteur. Vous engager votre responsabilit\u00e9 en le faisant. V\u00e9rifiez donc que vous avez bien le droit de le faire."}));
var b=new Ui.Button({text:"Fermer"});this.connect(b,"press",function(){a.close()});a.setActionButtons([b]);a.open()},onChange:function(){""!=this.urlField.getValue()&&""!=this.nameField.getValue()&&this.urlField.getValue().match(/^http(s){0,1}:\/\/.*$/)&&this.done()}},{onSave:function(){var a=this.getData();a.name=this.nameField.getValue();a.url=this.urlField.getValue();a.fullcontent=this.fullContentField.getValue()}});Wn.ResourceWizard.register("news","Journal","newspaper",[News.Wizard],News.Creator);Wn.LoginCreator.extend("Wn.Local.Creator",{item:void 0,constructor:function(a){this.item=a.item;delete a.item;a=new Core.HttpRequest({method:"POST",url:"/cloud/user/login",content:JSON.stringify({login:this.getData().login,password:this.getData().password})});this.connect(a,"done",this.onLoginBasicDone);this.connect(a,"error",this.onLoginBasicFails);a.send()},onLoginBasicDone:function(a){"localStorage"in window&&(this.data.localstore?(localStorage.setItem("login",this.data.login),localStorage.setItem("password",
this.data.password)):(localStorage.removeItem("login"),localStorage.removeItem("password")));this.done()},onLoginBasicFails:function(){this.fail();this.item.showError()}});
Wn.WizardItem.extend("Wn.Local.Wizard",{loginField:void 0,passwordField:void 0,localStoreField:void 0,errorMessage:void 0,errorTimeout:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);a.append(new Ui.Label({text:"Identifiant:",horizontalAlign:"left"}));this.loginField=new Ui.TextField({marginLeft:20});this.connect(this.loginField,"change",this.onChange);a.append(this.loginField);a.append(new Ui.Label({text:"Mot de passe:",horizontalAlign:"left"}));this.passwordField=new Ui.TextField({marginLeft:20,
passwordMode:!0});this.connect(this.passwordField,"change",this.onChange);a.append(this.passwordField);this.localStoreField=new Ui.CheckBox({text:"Se souvenir de moi"});"localStorage"in window&&a.append(this.localStoreField);this.errorMessage=new Ui.Text({text:"Echec: Identifiant ou mot de passe incorrect",color:"red"});this.errorMessage.hide();a.append(this.errorMessage);a=this.getData();void 0!=a.login?this.loginField.setValue(a.login):"localStorage"in window&&void 0!=localStorage.getItem("login")&&
this.loginField.setValue(localStorage.getItem("login"));void 0!=a.password?this.passwordField.setValue(a.password):"localStorage"in window&&void 0!=localStorage.getItem("password")&&this.passwordField.setValue(localStorage.getItem("password"));void 0!=a.localstore?this.localStoreField.setValue(a.localstore):"localStorage"in window&&(void 0==localStorage.getItem("password")&&void 0==localStorage.getItem("login")||this.localStoreField.setValue(!0));this.onChange()},showError:function(){void 0!=this.errorTimeout&&
this.errorTimeout.abort();this.errorMessage.show();this.errorTimeout=new Core.DelayedTask({scope:this,delay:4,callback:this.onShowErrorTimeout})},onShowErrorTimeout:function(){this.errorTimeout=void 0;this.errorMessage.hide()},onChange:function(){void 0!=this.errorTimeout&&(this.errorTimeout.abort(),this.errorTimeout=void 0,this.errorMessage.hide());""!=this.loginField.getValue()&&""!=this.passwordField.getValue()&&this.done()}},{onSave:function(){var a=this.getData();a.login=this.loginField.getValue();
a.password=this.passwordField.getValue();a.localstore=this.localStoreField.getValue()}});Wn.LoginWizard.register("local","HOST","localaccount",[Wn.Local.Wizard],Wn.Local.Creator,"Connecter");Wn.WizardItem.extend("Wn.Google.Wizard",{constructor:function(a){this.setContent(new Ui.Text({text:"Redirection en cours...",textAlign:"center",verticalAlign:"center"}));location="/cloud/googleoauth2/redirect?state=create"}});Wn.LoginWizard.register("google","Google","google",[Wn.Google.Wizard]);Wn.WizardItem.extend("Wn.Facebook.Wizard",{constructor:function(a){this.setContent(new Ui.Text({text:"Redirection en cours...",textAlign:"center",verticalAlign:"center"}));location="/cloud/facebookoauth2/redirect?state=create"}});Wn.LoginWizard.register("facebook","Facebook","facebook",[Wn.Facebook.Wizard]);Wn.LoginCreator.extend("Wn.Create.Creator",{item:void 0,newuser:void 0,newresources:void 0,resources:void 0,constructor:function(a){this.item=a.item;delete a.item;a=new Core.HttpRequest({method:"POST",url:"/cloud/user",content:JSON.stringify({login:this.getData().login,password:this.getData().password,firstname:this.getData().firstname,lastname:this.getData().lastname})});this.connect(a,"done",this.onCreateUserDone);this.connect(a,"error",this.onCreateUserError);a.send()},onCreateUserError:function(a){var b=
a.getStatus(),c="Echec de la cr\u00e9ation. V\u00e9rifier vos donn\u00e9es";409==b?c="Echec: l'identifiant existe d\u00e9j\u00e0":403==b&&1==a.getResponseJSON().code&&(c="Echec: mot de passe trop faible");this.item.showError(c);this.fail()},onCreateUserDone:function(){var a=new Core.HttpRequest({method:"POST",url:"/cloud/user/login",content:JSON.stringify({login:this.getData().login,password:this.getData().password})});this.connect(a,"done",this.onLoginBasicDone);this.connect(a,"error",this.onLoginBasicFails);
a.send()},onLoginBasicDone:function(){this.done()},onLoginBasicFails:function(){this.fail()}});
Wn.WizardItem.extend("Wn.Create.Wizard",{firstnameField:void 0,lastnameField:void 0,loginField:void 0,passwordField:void 0,errorMessage:void 0,errorTimeout:void 0,constructor:function(a){a=new Ui.VBox({spacing:10});this.setContent(a);a.append(new Ui.Label({text:"Nom:",horizontalAlign:"left"}));this.lastnameField=new Ui.TextField({marginLeft:20});this.connect(this.lastnameField,"change",this.onChange);a.append(this.lastnameField);a.append(new Ui.Label({text:"Pr\u00e9nom:",horizontalAlign:"left"}));
this.firstnameField=new Ui.TextField({marginLeft:20});this.connect(this.firstnameField,"change",this.onChange);a.append(this.firstnameField);a.append(new Ui.Label({text:"Identifiant:",horizontalAlign:"left"}));this.loginField=new Ui.TextField({marginLeft:20});this.connect(this.loginField,"change",this.onChange);a.append(this.loginField);var b=new Ui.HBox({horizontalAlign:"left"});a.append(b);b.append(new Ui.Label({text:"Mot de passe: "}));b.append(new Ui.Label({text:" 8 caract\u00e8res minium avec chiffre et lettre",
opacity:0.4}));this.passwordField=new Ui.TextField({marginLeft:20,passwordMode:!0});this.connect(this.passwordField,"change",this.onChange);a.append(this.passwordField);this.errorMessage=new Ui.Label({text:"Echec de la cr\u00e9ation. V\u00e9rifier vos donn\u00e9es",color:"red"});this.errorMessage.hide();a.append(this.errorMessage);a=this.getData();void 0!=a.login&&this.loginField.setValue(a.login);void 0!=a.password&&this.passwordField.setValue(a.password);this.onChange()},showError:function(a){void 0!=
this.errorTimeout&&this.errorTimeout.abort();this.errorMessage.setText(a);this.errorMessage.show();this.errorTimeout=new Core.DelayedTask({scope:this,delay:4,callback:this.onShowErrorTimeout})},onShowErrorTimeout:function(){void 0!=this.errorTimeout&&(this.errorTimeout.abort(),this.errorTimeout=void 0,this.errorMessage.hide());this.errorTimeout=void 0;this.errorMessage.hide()},onChange:function(){""!=this.firstnameField.getValue()&&""!=this.lastnameField.getValue()&&""!=this.loginField.getValue()&&
""!=this.passwordField.getValue()&&this.done()}},{onSave:function(){var a=this.getData();a.firstname=this.firstnameField.getValue();a.lastname=this.lastnameField.getValue();a.login=this.loginField.getValue();a.password=this.passwordField.getValue()}});Wn.LoginWizard.register("create","Nouveau compte","plus",[Wn.Create.Wizard],Wn.Create.Creator,"Cr\u00e9er");Ui.Button.extend("Wn.InfoButton");Ui.Button.extend("Wn.AlertButton");
Ui.LBox.extend("Wn.Error",{clock:void 0,progressbar:void 0,constructor:function(a){a=new Ui.VBox({verticalAlign:"center"});this.setContent(a);a.append(new Ui.Text({text:"La ressource recherch\u00e9e n'a pas \u00e9t\u00e9 trouv\u00e9e",margin:20,fontSize:20,textAlign:"center"}));this.progressbar=new Ui.ProgressBar({value:1,horizontalAlign:"center",width:100});a.append(this.progressbar)},onProgressComplete:function(){Ui.App.current.setMainPath("")}},{onLoad:function(){Wn.Error.base.onLoad.apply(this,
arguments);this.clock=new Anim.Clock({duration:5,scope:this,onTimeupdate:function(a,b){this.progressbar.setValue(1-b)}});this.connect(this.clock,"complete",this.onProgressComplete);this.clock.begin()},onUnload:function(){Wn.Error.base.onUnload.apply(this,arguments);void 0!==this.clock&&(this.disconnect(this.clock,"complete",this.onProgressComplete),this.clock.stop(),this.clock=void 0)}});
Ui.LBox.extend("Wn.MenuUser",{user:void 0,image:void 0,msglabel:void 0,uploaders:void 0,progressbox:void 0,progressbar:void 0,progresscounter:void 0,arrow:void 0,constructor:function(a){this.uploaders=[];var b=new Ui.Pressable;this.setContent(b);this.connect(b,"press",this.onPress);a=new Ui.VBox;b.setContent(a);b=new Ui.LBox;a.append(b);this.arrow=new Wn.ContactArrow({width:10,height:20,verticalAlign:"center",horizontalAlign:"left"});this.arrow.hide();b.append(this.arrow);var c=new Ui.Icon({icon:"home",
width:64,height:64,fill:"#f1f1f1",margin:3,horizontalAlign:"center"});b.append(c);this.progressbox=new Ui.HBox({margin:10,verticalAlign:"bottom",horizontalAlign:"center",spacing:2});this.progressbox.hide();b.append(this.progressbox);this.progresscounter=new Ui.Label({color:"#999999",fontSize:8,fontWeight:"bold"});this.progressbox.append(this.progresscounter);this.progressbar=new Wn.ProgressBar({width:40});this.progressbox.append(this.progressbar);this.msglabel=new Ui.Label({horizontalAlign:"center",
verticalAlign:"bottom",marginBottom:18,color:"#999999",fontWeight:"bold",text:""});b.append(this.msglabel);b=new Ui.Label({text:"Accueil",color:"#999999",marginBottom:15});a.append(b)},onPress:function(){app.setMainPath("user:"+this.user.getId())},setCurrent:function(a){a?this.arrow.show():this.arrow.hide()},setUser:function(a){this.user=a;this.connect(this.user,"messageschange",this.onUserMessagesChange);this.connect(this.user,"order",this.onUserOrder);this.connect(this.user,"call",this.onUserCall);
this.onUserMessagesChange()},getUploaders:function(){return this.uploaders},addUploader:function(a){this.uploaders.push(a);this.connect(a,"complete",this.onUploaderCompleteError);this.connect(a,"error",this.onUploaderCompleteError);this.connect(a,"progress",this.updateUploaders);this.updateUploaders()},updateUploaders:function(){for(var a=0,b=0,c=0,d=0,e=0;e<this.uploaders.length;e++){var f=this.uploaders[e];void 0!=f.getTotal()&&(c+=f.getTotal(),d+=f.getLoaded(),b++);a++}0==a?this.progressbox.hide():
(this.progressbox.show(),this.progresscounter.setText(a),b==a&&this.progressbar.setValue(d/c))},onUploaderCompleteError:function(a){this.disconnect(a,"complete",this.onUploaderCompleteError);this.disconnect(a,"error",this.onUploaderCompleteError);for(var b=0,b=0;b<this.uploaders.length&&a!=this.uploaders[b];b++);b<this.uploaders.length&&(this.uploaders.splice(b,1),this.updateUploaders())},onUserOrder:function(a,b){Ui.App.current.setMainPath(b.content)},onUserCall:function(a,b,c){(new Wn.VideoConfDialog({user:this.user,
contact:b,message:c})).open()},onUserRfid:function(a,b){var c=this.user.getRfidPath(b.content);void 0!==c?Ui.App.current.setMainPath(c):(c=new Core.HttpRequest({method:"GET",url:"/cloud/rfid/"+b.content}),this.connect(c,"done",function(a){a=a.getResponseJSON();void 0!==a&&void 0!==a.path&&Ui.App.current.setMainPath(a.path)}),c.send())},onUserMessagesChange:function(){var a=Ui.App.current.updateMessagesSeen();0<a?(this.msglabel.setText("+"+a),this.msglabel.show()):this.msglabel.hide()}});
Ui.CanvasElement.extend("Wn.ContactArrow",{},{updateCanvas:function(a){a.fillStyle="#eeeeee";a.beginPath();a.moveTo(0,0);a.lineTo(this.getLayoutWidth(),this.getLayoutHeight()/2);a.lineTo(0,this.getLayoutHeight());a.closePath();a.fill()}});
Ui.Selectionable.extend("Wn.MenuContactIcon",{user:void 0,contact:void 0,image:void 0,statusRect:void 0,newicon:void 0,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.append(new Ui.Rectangle({fill:"#999999",margin:1}));this.append(new Ui.Rectangle({fill:"#f1f1f1",margin:2}));this.image=new Ui.Image({width:64,height:64,margin:2});this.append(this.image);this.statusRect=new Ui.Rectangle({fill:"#d93737",width:10,height:10,marginBottom:5,marginRight:5,
horizontalAlign:"right",verticalAlign:"bottom"});this.append(this.statusRect);this.newicon=new Wn.NewRibbon({width:32,height:32,verticalAlign:"top",horizontalAlign:"right"});this.append(this.newicon)},getContact:function(){return this.contact},onContactChange:function(){this.statusRect.setFill(this.contact.getIsOnline()?"#13d774":"#d71354");this.image.setSrc(this.contact.getFaceUrl());this.onContactResourceChange()},onContactResourceChange:function(){for(var a=!1,b=0;!a&&b<this.contact.getResources().length;b++)a=
this.contact.getResources()[b],a=a.getSeenByMeRev()!=a.getRev();a?this.newicon.show():this.newicon.hide()},onContactDelete:function(){var a=new Ui.Dialog({title:"Enlever un contact",fullScrolling:!0,preferedWidth:300,preferedHeight:300,cancelButton:new Ui.Button({text:"Annuler"}),content:new Ui.Text({text:"Voulez vous supprimer ce contact de votre liste de contact ?\n\nCela ne vous emp\u00eachera pas de le remettre plus tard si vous changez d'avis."})}),b=new Ui.Button({text:"Enlever"});this.connect(b,
"press",function(){this.user.removeContact(this.contact);a.close()});a.setActionButtons([b]);a.open()},onContactEdit:function(){(new Wn.UserProfil({user:this.contact})).open()}},{getSelectionActions:function(){return{"delete":{text:"Enlever",icon:"trash",scope:this,callback:this.onContactDelete,multiple:!1},edit:{"default":!0,text:"Modifier",icon:"pen",scope:this,callback:this.onContactEdit,multiple:!1}}},onPress:function(){},onLoad:function(){Wn.MenuContactIcon.base.onLoad.call(this);this.connect(this.contact,
"change",this.onContactChange);this.connect(this.contact,"resourcechange",this.onContactResourceChange);if(this.contact.getIsReady())this.onContactChange()},onUnload:function(){Wn.MenuContactIcon.base.onUnload.call(this);this.disconnect(this.contact,"change",this.onContactChange);this.disconnect(this.contact,"resourcechange",this.onContactResourceChange)}});
Ui.LBox.extend("Wn.MenuContact",{user:void 0,contact:void 0,draggable:void 0,dropbox:void 0,label:void 0,arrow:void 0,constructor:function(a){this.user=a.user;delete a.user;this.contact=a.contact;delete a.contact;this.dropbox=new Ui.DropBox({marginTop:5,marginBottom:5});this.dropbox.addMimetype("Wn.ResourceView");this.connect(this.dropbox,"drop",this.onDrop);this.setContent(this.dropbox);a=new Ui.VBox;this.dropbox.setContent(a);var b=new Ui.LBox;a.append(b);this.arrow=new Wn.ContactArrow({width:10,
height:20,verticalAlign:"center",horizontalAlign:"left"});this.arrow.hide();b.append(this.arrow);this.draggable=new Wn.MenuContactIcon({horizontalAlign:"center",contact:this.contact,user:this.user});this.connect(this.draggable,"press",this.onPress);b.append(this.draggable);this.label=new Ui.CompactLabel({fontSize:14,margin:3,marginBottom:5,width:90,maxLine:2,textAlign:"center",color:"#a7a9ac",horizontalAlign:"center"});a.append(this.label);Ui.App.current.getMainPath()==="user:"+this.contact.getId()&&
this.setCurrent(!0)},setCurrent:function(a){a?this.arrow.show():this.arrow.hide()},getContact:function(){return this.contact},onPress:function(){app.setMainPath("user:"+this.contact.getId())},onContactChange:function(){this.label.setText(this.contact.getFirstname()+" "+this.contact.getLastname())},onDrop:function(a,b,c){a=Wn.Resource.getResource(c);if(a.getIsReady())this.onResourceReady(a);else this.connect(a,"ready",this.onResourceReady)},onResourceReady:function(a){if(a.canShare()){var b={user_id:this.contact.getId(),
read:!0,share:this.user.getData().default_share_right};a.canWrite()&&this.user.getData().default_write_right&&(b.write=!0);a.addRights(b)}}},{onLoad:function(){Wn.MenuContact.base.onLoad.call(this);this.connect(this.contact,"change",this.onContactChange);if(this.contact.getIsReady())this.onContactChange()},onUnload:function(){Wn.MenuContact.base.onUnload.call(this);this.disconnect(this.contact,"change",this.onContactChange)}});
Ui.LBox.extend("Wn.MenuNewContact",{user:void 0,constructor:function(a){this.user=a.user;delete a.user;a=new Ui.Pressable({horizontalAlign:"center"});this.connect(a,"press",this.onPress);this.setContent(a);a.append(new Ui.Icon({icon:"plus",margin:13,marginBottom:15,width:48,height:48,fill:"#f1f1f1"}))},onPress:function(){(new Wn.AddContactDialog({user:this.user})).open()}});
Ui.LBox.extend("Wn.Menu",{user:void 0,menuUser:void 0,contactsWatcher:void 0,resourcesWatcher:void 0,messageBox:void 0,resources:void 0,contacts:void 0,constructor:function(a){this.addEvents("launch");this.user=a.user;delete a.user;this.append(new Ui.Rectangle({fill:"#3f3f3f"}));a=new Ui.VBox({spacing:5});this.append(a);this.menuUser=new Wn.MenuUser({margin:0,user:this.user});a.append(this.menuUser);var b=new Ui.ScrollingArea({directionRelease:!0,scrollHorizontal:!1,showShadows:!0});a.append(b,!0);
a=new Ui.VBox({margin:0,spacing:5});b.setContent(a);a.append(new Wn.MenuNewContact({user:this.user}));this.contacts=new Wn.VDropBox({spacing:5});this.contacts.addMimetype("Wn.MenuContactIcon");this.connect(this.contacts,"dropat",this.onUserDropAt);a.append(this.contacts);this.connect(this.user,"change",this.onUserChange);this.onUserChange()},getUploaders:function(){return this.menuUser.getUploaders()},addUploader:function(a){this.menuUser.addUploader(a)},setCurrentUser:function(a){for(var b=0;b<this.contacts.getLogicalChildren().length;b++)this.contacts.getLogicalChildren()[b].getContact().getId()==
a?(this.contacts.getLogicalChildren()[b].setCurrent(!0),"scrollIntoViewIfNeeded"in this.contacts.getLogicalChildren()[b].getDrawing()?this.contacts.getLogicalChildren()[b].getDrawing().scrollIntoViewIfNeeded():this.contacts.getLogicalChildren()[b].getDrawing().scrollIntoView()):this.contacts.getLogicalChildren()[b].setCurrent(!1);this.menuUser.setCurrent(this.user.getId()==a)},onUserChange:function(a){for(var b=[],c=[],d=0;d<this.contacts.getLogicalChildren().length;d++)this.contacts.getLogicalChildren()[d].hostMenuFound=
!1;for(a=0;a<this.user.getContacts().length;a++){for(var e=this.user.getContacts()[a],f=void 0,d=0;void 0==f&&d<this.contacts.getLogicalChildren().length;d++)this.contacts.getLogicalChildren()[d].getContact().getId()==e.getId()&&(f=this.contacts.getLogicalChildren()[d]);void 0==f?c.push(e):f.hostMenuFound=!0}for(d=0;d<this.contacts.getLogicalChildren().length;d++)this.contacts.getLogicalChildren()[d].hostMenuFound||b.push(this.contacts.getLogicalChildren()[d]);for(a=0;a<b.length;a++)this.contacts.remove(b[a]);
if(0<c.length)for(a=0;a<c.length;a++)this.contacts.insertAt(new Wn.MenuContact({user:this.user,contact:c[a]}),c[a].getPosition());c=0;do{b=void 0;for(a=0;a<this.contacts.getLogicalChildren().length;a++)if(d=this.contacts.getLogicalChildren()[a].getContact().getPosition(),d!=a){0<d&&d<this.contacts.getLogicalChildren().length&&(b=this.contacts.getLogicalChildren()[a],this.contacts.moveAt(b,d));break}c++}while(void 0!==b&&c<=this.contacts.getLogicalChildren().length)},onUserDropAt:function(a,b,c,d){a=
void 0;b=-1;for(var e=0;e<this.contacts.getLogicalChildren().length&&void 0===a;e++){var f=this.contacts.getLogicalChildren()[e];f.getContact()===c.getContact()&&(a=f,b=e)}void 0!==a&&b!=d&&b+1!=d&&(b<d&&d--,this.contacts.moveAt(a,d),this.user.setContactPosition(a.getContact(),d))}});
Ui.Dialog.extend("Wn.ReloadDialog",{constructor:function(a){this.setTitle("Mise \u00e0 jour de l'application");this.setFullScrolling(!0);this.setPreferedWidth(300);this.setPreferedHeight(300);this.setContent(new Ui.Text({text:"Une mise \u00e0 jour est disponible. Il est souhaitable de recharger l'application.",margin:20}));a=new Ui.Button({text:"Recharger"});this.connect(a,"press",this.onReloadPress);this.setActionButtons([a]);this.setCancelButton(new Ui.Button({text:"Plus tard"}))},onReloadPress:function(){window.location.reload()}});
Ui.App.extend("Wn.App",{loginDialog:void 0,user:void 0,deviceQueue:void 0,menuswitch:void 0,contentswitch:void 0,hbox:void 0,menu:void 0,mainbox:void 0,main:void 0,isFullscreen:!1,currentPath:void 0,resource:void 0,contact:void 0,rfidReader:void 0,reloadDialog:void 0,constructor:function(a){this.setContent(new Ui.VBox);this.connect(window,"hashchange",this.onHashChange);this.rfidReader=new Wn.RfidReader;this.connect(this.rfidReader,"enter",this.onRfidEnter);void 0!=this.getArguments().user?(a=new Core.HttpRequest({url:"/cloud/user/"+
this.getArguments().user}),this.connect(a,"done",this.onGetUserDone),this.connect(a,"error",this.onGetUserError),a.send()):this.sendGetAuthSession()},getSelectionHandler:function(){if("getSelectionHandler"in this.getMain())return this.getMain().getSelectionHandler()},getRfidReader:function(){return this.rfidReader},sendGetAuthSession:function(){var a=new Core.HttpRequest({method:"GET",url:"/cloud/authsession/current?setcookie=1"});this.connect(a,"done",this.onGetAuthSessionDone);this.connect(a,"error",
this.onGetAuthSessionError);a.send()},onGetAuthSessionError:function(a){this.basicLogin()},onGetAuthSessionDone:function(a){a=a.getResponseJSON().user;a=new Core.HttpRequest({url:"/cloud/user/"+a});this.connect(a,"done",this.onGetUserDone);this.connect(a,"error",this.onGetUserError);a.send()},onGetUserDone:function(a){this.onLoginDone(a.getResponseJSON())},onGetUserError:function(a){this.basicLogin()},getUser:function(){return this.user},basicLogin:function(){this.loginDialog=new Wn.LoginWizard;this.connect(this.loginDialog,
"done",this.onBasicLoginDone);this.loginDialog.open()},onBasicLoginDone:function(a){a.close();this.sendGetAuthSession()},onLoginDone:function(a){this.user=new Wn.User({user:a});this.connect(this.user,"delete",this.onUserDelete);this.connect(this.user,"serverchange",this.onServerChange);this.hbox=new Ui.HBox;this.setContent(this.hbox);this.contentswitch=new Ui.TransitionBox;this.hbox.append(this.contentswitch,!0);this.menu=new Wn.Menu({user:this.user,width:80});this.hbox.append(this.menu);a="";a="location"in
window&&"hash"in location&&void 0!=location.hash&&""!=location.hash&&"#"!=location.hash&&"#_=_"!=location.hash?location.hash.substring(1):"user:"+this.user.getId();this.setMainPath(a);"localStorage"in window&&void 0!==localStorage.getItem("deviceId")&&null!==localStorage.getItem("deviceId")&&(this.deviceQueue=new Wn.Queue({channel:localStorage.getItem("deviceId")}),this.connect(this.deviceQueue,"message",this.onDeviceMessage))},getDeviceId:function(){if("localStorage"in window&&void 0!==localStorage.getItem("deviceId"))return localStorage.getItem("deviceId")},
setDeviceId:function(a){"localStorage"in window&&(void 0===a||null===a?localStorage.removeItem("deviceId"):(localStorage.setItem("deviceId",a),void 0!==this.deviceQueue?this.deviceQueue.setChannel(a):(this.deviceQueue=new Wn.Queue({channel:a}),this.connect(this.deviceQueue,"message",this.onDeviceMessage))))},updateMessagesSeen:function(){var a=this.getMainPath();if(void 0===a)return 0;var b=0,c=this.user.getMessages();if(0===a.indexOf("user:"))for(var d=0;d<c.length;d++){var e=c[d];e.getSeen()||e.getDestination()!=
this.user.getId()||("contact"===e.getType()&&a==="user:"+e.getContent()?e.markSeen():b++)}else if(0===a.indexOf("resource:"))for(d=0;d<c.length;d++)e=c[d],e.getSeen()||e.getDestination()!=this.user.getId()||("comment"===e.getType()&&"resource:"+e.getContent().resource.id+":"+e.getContent().file===a||"resource"===e.getType()&&"resource:"+e.getContent().id===a?e.markSeen():b++);return b},getMainPath:function(){return this.currentPath},notifyMainPath:function(a){if(a==this.currentPath)return!1;this.currentPath=
a;"location"in window&&"hash"in location&&(location.hash="#"+a);(new Core.HttpRequest({method:"POST",url:"/cloud/pathlog",content:JSON.stringify({owner:Ui.App.current.getUser().getId(),path:a})})).send();this.updateMessagesSeen();return!0},setMainPath:function(a){if(this.notifyMainPath(a)){void 0!==this.resource&&(this.disconnect(this.resource,"error",this.onResourceError),this.disconnect(this.resource,"delete",this.onResourceError),this.disconnect(this.resource,"ready",this.onResourceReady),this.resource=
void 0);void 0!==this.contact&&(this.disconnect(this.contact,"error",this.onContactError),this.disconnect(this.contact,"delete",this.onContactError),this.disconnect(this.contact,"ready",this.onContactReady),this.contact=void 0);if(""==a)app.setMain(new Wn.UserView({user:this.user})),this.menu.setCurrentUser(this.user.getId());else{var b=a.indexOf(":");if(-1===b){this.setMain(new Wn.Error);return}var c=a.substring(0,b);a=a.substring(b+1);switch(c){case "rfid":b=this.user.getRfidPath(a);void 0===b?
(b=new Core.HttpRequest({method:"GET",url:"/cloud/rfid/"+a}),this.connect(b,"done",function(a){a=a.getResponseJSON();void 0!==a&&void 0!==a.path&&(Ui.App.current.setMainPath(a.path),a=this.getMain(),"play"in a&&a.play())}),this.connect(b,"error",function(){this.setMain(new Wn.Error)}),b.send()):(this.setMainPath(b),b=this.getMain(),"play"in b&&b.play());return;case "user":this.menu.setCurrentUser(a);if(a===this.user.getId())app.setMain(new Wn.UserView({user:this.user}));else{this.contact=Wn.Contact.getContact(a);
if(void 0===this.contact){this.setMain(new Wn.Error);return}if(this.contact.getIsReady())this.onContactReady();else this.connect(this.contact,"ready",this.onContactReady),this.connect(this.contact,"error",this.onContactError),this.connect(this.contact,"delete",this.onContactError)}break;case "resource":b=a.indexOf(":");-1!=b?(c=a.substring(0,b),this.resourceSubpath=b=a.substring(b+1)):(c=a,this.resourceSubpath=void 0);this.resource=Wn.Resource.getResource(c,this.user);if(void 0===this.resource){this.setMain(new Wn.Error);
return}if(this.resource.getIsReady())this.onResourceReady();else this.connect(this.resource,"ready",this.onResourceReady),this.connect(this.resource,"error",this.onResourceError),this.connect(this.resource,"delete",this.onResourceError);break;case "error":this.setMain(new Wn.Error);break;default:this.setMain(new Wn.Error)}}this.isFullscreen&&"fullscreen"in this.getMain()&&this.getMain().fullscreen()}},onContactError:function(){this.disconnect(this.contact,"error",this.onContactError);this.disconnect(this.contact,
"delete",this.onContactError);this.disconnect(this.contact,"ready",this.onContactReady);this.contact=void 0;this.setMain(new Wn.Error)},onContactReady:function(){this.disconnect(this.contact,"error",this.onContactError);this.disconnect(this.contact,"delete",this.onContactError);this.disconnect(this.contact,"ready",this.onContactReady);this.setMain(new Wn.ContactView({user:this.user,contact:this.contact}));this.contact=void 0},onResourceError:function(){this.disconnect(this.resource,"error",this.onResourceError);
this.disconnect(this.resource,"delete",this.onResourceError);this.disconnect(this.resource,"ready",this.onResourceReady);this.resource=void 0;this.setMain(new Wn.Error)},onResourceReady:function(){this.disconnect(this.resource,"error",this.onResourceError);this.disconnect(this.resource,"delete",this.onResourceError);this.disconnect(this.resource,"ready",this.onResourceReady);if(Wn.ResourceViewer.hasInstance(this.main)&&this.main.getResource()==this.resource)void 0!==this.resourceSubpath&&this.main.setPath(this.resourceSubpath);
else{var a=Wn.ResourceViewer.getApplication(this.resource.getType());if(void 0===a)this.setMain(new Wn.Error);else{this.menu.setCurrentUser(this.resource.getOwnerId());if(this.resource.getOwnerId()==this.user.getId())a=new a({user:this.user,contact:void 0,resource:this.resource,path:this.resourceSubpath});else var b=Wn.Contact.getContact(this.resource.getOwnerId()),a=new a({user:this.user,contact:b,resource:this.resource,path:this.resourceSubpath});this.setMain(a);this.resource=void 0}}},getMain:function(){return this.main},
setMain:function(a){void 0!=this.main&&this.main.hasEvent("fullscreen")&&this.main.hasEvent("unfullscreen")&&(this.disconnect(this.main,"fullscreen",this.onContentFullscreen),this.disconnect(this.main,"unfullscreen",this.onContentUnfullscreen));a.hasEvent("fullscreen")&&a.hasEvent("unfullscreen")&&(this.connect(a,"fullscreen",this.onContentFullscreen),this.connect(a,"unfullscreen",this.onContentUnfullscreen));void 0!=this.main&&(this.main.disable(),this.mainbox.append(new Ui.Rectangle({fill:"white",
opacity:0.5})),this.mainbox.append(new Ui.Loading({width:50,height:50,verticalAlign:"center",horizontalAlign:"center"})));this.mainbox=new Ui.LBox;this.main=a;this.mainbox.setContent(this.main);this.contentswitch.replaceContent(this.mainbox)},setDefaultMain:function(){this.setMainPath("")},getUploaders:function(){return this.menu.getUploaders()},addUploader:function(a){this.menu.addUploader(a)},onContentFullscreen:function(){if(!this.isFullscreen){this.isFullscreen=!0;this.hbox.remove(this.menu);
var a=document.documentElement;"requestFullscreen"in a?a.requestFullscreen():"mozRequestFullScreen"in a?a.mozRequestFullScreen():"webkitRequestFullScreen"in a&&a.webkitRequestFullScreen()}},onContentUnfullscreen:function(){this.isFullscreen&&(this.isFullscreen=!1,this.hbox.append(this.menu),"exitFullscreen"in document?document.exitFullscreen():"mozCancelFullScreen"in document?document.mozCancelFullScreen():"webkitCancelFullScreen"in document&&document.webkitCancelFullScreen())},onHashChange:function(a){location.hash.substring(1)!==
this.currentPath&&this.setMainPath(location.hash.substring(1))},onServerChange:function(){void 0===this.reloadDialog&&(this.reloadDialog=new Wn.ReloadDialog,this.connect(this.reloadDialog,"close",function(){this.reloadDialog=void 0}),this.reloadDialog.open())},onUserDelete:function(){var a=new Ui.Dialog({title:"Compte supprim\u00e9",fullScrolling:!0,preferedWidth:300,preferedHeight:300});a.setContent(new Ui.Text({text:"Il semble que votre compte a \u00e9t\u00e9 supprim\u00e9."}));var b=new Ui.Button({text:"Quitter"});
a.setActionButtons([b]);this.connect(b,"press",function(){window.location.reload()});a.open()},onRfidEnter:function(a,b){this.setMainPath("rfid:"+b);return!0},onDeviceMessage:function(a,b){"rfid"==b.type?this.getRfidReader().fireEnter(b.content):"order"==b.type&&this.setMainPath(b.content)}});Ui.Icon.register("person","m 31.255154,11.504904 c 0.385499,1.705036 0.852155,3.545577 0.942733,5.320176 0.02391,0.473904 0.05217,1.095629 -0.145648,1.499968 1.613732,1.07389 0.823894,3.305727 -0.120288,4.44121 -0.339848,0.407238 -1.112295,0.913023 -1.284756,1.418085 -0.255067,0.742738 -0.570278,1.471708 -1.020267,2.12894 -0.376079,0.547814 -0.295647,0.13333 -0.670277,0.973892 -0.253616,1.142005 -0.638392,3.728181 -0.0942,4.789752 0.714477,1.392 2.279662,2.27314 3.575286,3.013705 1.717355,0.982586 3.636154,1.703587 5.470172,2.43618 1.688371,0.674623 3.449202,1.178235 5.073805,2.002855 0.509409,0.257965 1.023166,0.510133 1.505765,0.817374 0.389122,0.24782 1.042007,0.629697 1.134758,1.129685 v 3.930351 H 2.137661 l 0.02971,-3.930351 c 0.092752,-0.499265 0.7456362,-0.881865 1.1347583,-1.129685 0.4825983,-0.307241 0.9963555,-0.558683 1.5057649,-0.817374 1.6246029,-0.82462 3.3861595,-1.328232 5.0738045,-2.002855 1.8340193,-0.733318 3.7520943,-1.453594 5.4701723,-2.43618 1.2949,-0.740565 2.860085,-1.621705 3.574562,-3.013705 0.544915,-1.062295 0.240575,-3.659341 -0.01378,-4.799897 l 0,0 c -0.435498,-0.281878 -0.736217,-1.155047 -0.983312,-1.591995 -0.26014,-0.461584 -0.469556,-0.959399 -0.786941,-1.386925 -0.432599,-0.583322 -1.153599,-0.856505 -1.624603,-1.40287 -0.314486,-0.363759 -0.448541,-0.814476 -0.604334,-1.260842 -0.186228,-0.533321 -0.09492,-0.966646 -0.178258,-1.565908 -0.03695,-0.256518 0.0942,-0.554336 0.246372,-0.770999 0.186952,-0.26666 0.527525,-0.318834 0.613755,-0.656507 0.106519,-0.418107 -0.128258,-0.907952 -0.173185,-1.320987 -0.04783,-0.441294 -0.162315,-1.144903 -0.160141,-1.587647 0.0072,-1.606487 -0.28985,-3.055732 0.996356,-4.32527 0.452163,-0.444918 0.96592,-0.829692 1.45649,-1.231133 l 0,0 c 0.188401,-0.5999868 1.092006,-0.9695441 1.620255,-1.1709891 0.686218,-0.260864 1.407941,-0.4072376 2.111549,-0.6166535 2.123143,-0.6325951 4.562946,-0.5652052 6.4245,0.7456363 0.610857,0.4304255 1.452868,0.060868 2.096332,0.4304255 0.619552,0.3565141 1.358667,1.1804098 1.287654,1.9405378 z");
Ui.Icon.override("home","m 44,44 c 0,1.1 -0.9,2 -2,2 h -36 c -1.1,0 -2,-0.9 -2,-2 v -18.017 c 0,-1.1 0.688,-2.579 1.53,-3.287 l 16.939,-14.247 c 0.842,-0.708 2.219,-0.708 3.061,0 l 16.939,14.247 c 0.842,0.708 1.53,2.187 1.53,3.287 v 18.017 z");Ui.Icon.register("bubble","M 22.9375,3.90625 C 10.790957,3.90625 0.5,12.130045 0.5,22.78125 0.5,33.432455 10.790957,41.625 22.9375,41.625 c 2.124327,0 4.17045,-0.3792 6.125,-0.84375 7.279657,3.168207 11.862809,3.147181 18.4375,1.96875 -2.660808,-2.477164 -5.513133,-5.353739 -7.40625,-7.9375 3.222545,-3.236231 5.28125,-7.390481 5.28125,-12.03125 0,-10.651205 -10.291328,-18.875 -22.4375,-18.875 z m 0,4.59375 c 10.113871,0 17.84375,6.639208 17.84375,14.28125 -0.698708,5.363994 -3.032958,8.351365 -6.65625,11.25 0.926077,2.069229 3.275767,4.207025 4.59375,5.6875 -3.489625,-0.707366 -6.340952,-1.85199 -8.78125,-3.75 -2.352313,0.645471 -4.924033,1.051885 -7,1.0625 -10.114319,0 -17.84375,-6.608273 -17.84375,-14.25 C 5.09375,15.139208 12.823181,8.5 22.9375,8.5 z");
Ui.Icon.register("earth","m 46.985785,24 c 0,12.8259 -10.1334,23.0301 -22.959233,23.0301 -12.755325,0 -23.03009452,-10.2042 -23.03009452,-23.0301 0,-12.6841 10.27476952,-22.8883 23.03009452,-22.8883 12.826193,0 22.959233,10.2042 22.959233,22.8883 z m -34.084356,5.8817 c -0.283453,-1.7716 -0.425178,-3.7558 -0.425178,-5.6691 0,-1.4172 0.07086,-2.551 0.212589,-3.8974 -3.2593405,-0.6378 -5.1729935,-1.1338 -6.6611155,-1.7716 -0.495686,1.7007 -0.779137,3.614 -0.779137,5.4564 0,0.9213 0,1.8425 0.141371,2.622 0.921573,1.0629 3.259695,2.4802 7.5114705,3.2597 z m 3.89746,11.4089 c -1.630202,-2.2676 -2.693145,-5.173 -3.401775,-8.5744 -2.834517,-0.6378 -5.3852275,-1.4173 -7.0859375,-2.3385 1.062944,2.6219 2.40934,4.9604 4.4643635,6.8737 1.700711,1.8421 3.826598,3.1176 6.023349,4.0392 z m -9.7082205,-25.2272 c 0.638121,0.5669 1.700711,0.6378 5.8816225,1.7716 0.779491,-4.5353 2.125888,-8.2906 4.251775,-11.1252 -2.409338,1.1339 -4.535226,2.1259 -6.448171,4.181 -1.6302015,1.4881 -2.8348705,3.3305 -3.6852265,5.1726 z m 8.3614705,14.3143 c 2.409339,0.4252 4.747816,0.6378 7.157156,0.7086 v -9.9916 c -2.551066,-0.071 -5.10213,-0.2126 -7.511471,-0.4961 0,1.2756 -0.07051,2.3385 -0.07051,3.614 0,2.0551 0.141725,4.2518 0.424823,6.1651 z m 0,-12.1884 c 2.338831,0.2126 4.747816,0.3543 7.157156,0.4252 v -13.1805 c 0,0 -0.07086,0 -0.141726,0 -3.188832,1.2758 -5.881269,6.2363 -7.01543,12.7553 z m 7.157511,24.5186 v -9.1414 c -2.196752,-0.071 -4.393503,-0.2125 -6.519036,-0.4251 0.424823,1.8424 1.062589,3.4722 1.912945,4.9604 1.062943,2.5507 2.692437,4.6061 4.606091,4.6061 z m 2.692436,-37.2736 v 13.1802 c 2.480202,-0.071 4.818679,-0.2126 7.227669,-0.4252 -0.92122,-5.1021 -2.97589,-9.5665 -5.385233,-11.7629 -0.637412,-0.4252 -1.346042,-0.9921 -1.842436,-0.9921 z m 7.157159,25.0143 c 0.35431,-1.9133 0.42482,-4.1101 0.42482,-6.236 0,-1.2755 0,-2.3384 -0.0705,-3.5431 -2.40934,0.2126 -4.889543,0.3543 -7.51147,0.4252 v 9.9916 c 2.480202,-0.071 4.81868,-0.2834 7.15716,-0.6377 z m -0.56691,2.6928 c -2.19639,0.2126 -4.393145,0.3543 -6.590249,0.4251 v 9.1414 c 3.685229,0 5.669039,-6.3777 6.590249,-9.5665 z m -1.13345,-26.5024 c 2.12554,2.7636 3.47229,6.6611 4.18092,11.2672 3.82659,-0.7086 5.38522,-1.3464 5.95213,-1.7716 -1.98416,-4.3935 -5.7399,-7.9366 -10.13305,-9.4956 z m 10.69995,24.0222 c -1.84244,0.8503 -4.25178,1.5589 -6.87335,2.1258 -0.77949,3.4015 -1.77157,6.1648 -3.47264,8.5036 2.19675,-0.9212 4.3935,-2.1967 6.09421,-4.0392 1.98381,-1.8428 3.33021,-4.11 4.25178,-6.5902 z m -6.02335,-6.4486 c 0,1.9133 -0.14173,3.9684 -0.35431,5.7399 7.36974,-1.2046 7.65319,-2.9053 7.65319,-5.9525 0,-1.7715 -0.28345,-3.6848 -0.85,-5.3855 -1.34675,0.5669 -3.75609,1.4172 -6.59061,1.7007 0.14173,1.3464 0.14173,2.4802 0.14173,3.8974 z");
Ui.Icon.register("twitter","M 14.461732,39.914886 C 10.071167,38.992913 6.5495922,37.142869 3.2204514,34.009333 2.5838669,33.41015 1.7583132,32.534692 1.385888,32.06387 L 0.70875479,31.207832 1.7474522,31.921654 c 4.8015164,3.299739 10.4033288,3.205609 15.0304198,-0.252563 l 1.176779,-0.879496 -1.144837,-0.257839 c -1.440857,-0.32451 -2.050462,-0.905059 -2.050462,-1.952734 0,-0.60638 0.140455,-0.901263 0.606138,-1.272586 0.696494,-0.555366 0.614812,-0.643571 -0.783672,-0.846293 -1.163736,-0.168693 -2.84796,-1.223604 -3.366458,-2.108575 -0.317047,-0.541138 -0.312391,-0.614582 0.06544,-1.032083 0.223729,-0.247217 0.831039,-0.556314 1.349579,-0.686886 l 0.942799,-0.2374 -1.232884,-0.50108 C 10.833066,21.281534 9.5743131,20.094399 9.091495,18.830153 8.6873491,17.771915 8.8391158,17.511822 9.881572,17.476128 c 0.296768,-0.01013 0.719523,-0.08926 0.939457,-0.175781 0.343847,-0.135264 0.27557,-0.239568 -0.487282,-0.7444 -1.4153354,-0.936624 -2.2533124,-2.27021 -2.7031275,-4.301856 -0.1893921,-0.855408 0.267032,-0.789993 3.5013655,0.501822 5.47833,2.188082 9.395285,4.253136 11.256225,5.934382 l 0.876351,0.791733 0.455458,-1.050976 c 2.032166,-4.68924 3.379403,-6.939615 5.266251,-8.796557 0.632971,-0.6229412 1.209731,-1.1607725 1.889862,-1.4049485 -0.159253,0.2899797 -0.269642,0.4266676 -0.324194,0.5750155 -0.116522,0.3168623 0.07048,0.2955969 1.084398,-0.215832 0.566606,-0.285803 1.728237,-0.5859722 2.661004,-0.6008624 -0.688242,0.3888564 -0.953288,0.5309353 -1.208661,0.7768018 -0.25537,0.2458655 -0.403488,0.5209182 -0.403488,0.5209182 l 1.013725,-0.3454114 c 1.094809,-0.3730375 2.082375,-0.263868 2.082375,0.2301974 0,0.4061483 -0.788209,0.9443134 -1.726648,1.1789034 -0.415475,0.103856 -1.046779,0.260082 -1.4029,0.347159 -0.568836,0.13909 -0.459401,0.191322 0.900833,0.429955 0.85158,0.149398 2.094332,0.521601 2.761668,0.827117 2.278759,1.043251 4.508082,3.821054 5.307768,6.61364 0.152968,0.534182 0.370135,1.092644 0.482593,1.241028 0.28615,0.37756 2.854336,0.345723 4.164145,-0.05163 0.582724,-0.176773 1.086275,-0.322459 1.118999,-0.323745 0.03273,-0.0013 -0.08232,0.271925 -0.255666,0.607132 -0.398861,0.771309 -1.770753,1.686276 -3.035634,2.024581 -0.537298,0.143706 -0.976905,0.326123 -0.976905,0.405369 0,0.239342 1.254235,0.413878 2.97415,0.413878 l 1.625204,0 -0.411155,0.454628 c -0.64857,0.717146 -1.998131,1.307828 -3.607689,1.579032 l -1.483007,0.249877 -0.378928,1.0705 c -2.462943,6.957975 -9.391366,12.328731 -17.794875,13.79418 -2.68789,0.468729 -7.045334,0.415475 -9.581512,-0.117095 z");
Ui.Icon.register("fullscreen","M 1.375 1.8125 L 1.375 9.1875 L 3.71875 6.8125 L 6.96875 9.9375 L 9.4375 7.46875 L 6.3125 4.34375 L 8.84375 1.8125 L 1.375 1.8125 z M 39.125 1.84375 L 41.46875 4.1875 L 38.34375 7.4375 L 40.8125 9.90625 L 43.9375 6.78125 L 46.46875 9.3125 L 46.46875 1.84375 L 39.125 1.84375 z M 13.53125 8.6875 C 10.781246 8.6875 8.53125 10.937496 8.53125 13.6875 L 8.53125 34.53125 C 8.53125 37.281254 10.781246 39.53125 13.53125 39.53125 L 34.375 39.53125 C 37.125004 39.53125 39.40625 37.281254 39.40625 34.53125 L 39.40625 13.6875 C 39.40625 10.937496 37.125004 8.6875 34.375 8.6875 L 13.53125 8.6875 z M 13.53125 11.75 L 34.375 11.75 C 35.473033 11.75 36.3125 12.589467 36.3125 13.6875 L 36.3125 34.53125 C 36.3125 35.629283 35.473033 36.46875 34.375 36.46875 L 13.53125 36.46875 C 12.433217 36.46875 11.625 35.629283 11.625 34.53125 L 11.625 13.6875 C 11.625 12.589467 12.433217 11.75 13.53125 11.75 z M 40.90625 38.71875 L 38.4375 41.1875 L 41.5625 44.28125 L 39.03125 46.8125 L 46.5 46.8125 L 46.5 39.46875 L 44.15625 41.8125 L 40.90625 38.71875 z M 7.0625 38.90625 L 3.9375 42 L 1.4375 39.46875 L 1.4375 46.96875 L 8.78125 46.96875 L 6.40625 44.59375 L 9.53125 41.375 L 7.0625 38.90625 z");
Ui.Icon.register("unfullscreen","M 6.53125 1.40625 C 3.7812459 1.40625 1.53125 3.6562459 1.53125 6.40625 L 1.53125 41.375 C 1.53125 44.125004 3.781246 46.40625 6.53125 46.40625 L 41.53125 46.40625 C 44.281254 46.40625 46.53125 44.125004 46.53125 41.375 L 46.53125 6.40625 C 46.53125 3.656246 44.281254 1.40625 41.53125 1.40625 L 6.53125 1.40625 z M 6.53125 4.46875 L 41.53125 4.46875 C 42.629284 4.46875 43.46875 5.308217 43.46875 6.40625 L 43.46875 41.375 C 43.46875 42.473032 42.629284 43.3125 41.53125 43.3125 L 6.53125 43.3125 C 5.433217 43.3125 4.625 42.473032 4.625 41.375 L 4.625 6.40625 C 4.625 5.3082171 5.4332171 4.46875 6.53125 4.46875 z M 39.375 5.78125 L 36.25 8.90625 L 33.71875 6.375 L 33.71875 13.84375 L 41.0625 13.84375 L 38.71875 11.5 L 41.84375 8.25 L 39.375 5.78125 z M 9.21875 6.40625 L 6.75 8.875 L 9.84375 12 L 7.3125 14.53125 L 14.8125 14.53125 L 14.8125 7.1875 L 12.4375 9.53125 L 9.21875 6.40625 z M 7.75 33.1875 L 10.09375 35.5625 L 6.96875 38.78125 L 9.4375 41.25 L 12.5625 38.15625 L 15.09375 40.6875 L 15.09375 33.1875 L 7.75 33.1875 z M 33.5 33.625 L 33.5 40.96875 L 35.84375 38.625 L 39.09375 41.71875 L 41.5625 39.25 L 38.4375 36.15625 L 40.96875 33.625 L 33.5 33.625 z");
Ui.Icon.register("thumb","M 4.15625 11.84375 L 4.15625 21.84375 L 14.15625 21.84375 L 14.15625 11.84375 L 4.15625 11.84375 z M 19.15625 11.84375 L 19.15625 21.84375 L 29.15625 21.84375 L 29.15625 11.84375 L 19.15625 11.84375 z M 34.15625 11.84375 L 34.15625 21.84375 L 44.15625 21.84375 L 44.15625 11.84375 L 34.15625 11.84375 z M 4.15625 26.84375 L 4.15625 36.84375 L 14.15625 36.84375 L 14.15625 26.84375 L 4.15625 26.84375 z M 19.15625 26.84375 L 19.15625 36.84375 L 29.15625 36.84375 L 29.15625 26.84375 L 19.15625 26.84375 z");
Ui.Icon.register("tools","M 10.0625 1.84375 C 9.3364045 1.84375 8.6394735 1.947946 7.96875 2.125 L 11.375 5.53125 C 12.779786 6.9360357 12.666423 9.3335769 11.09375 10.90625 C 9.5210769 12.478923 7.1235357 12.623536 5.71875 11.21875 L 2.1875 7.6875 C 1.9600984 8.4402891 1.84375 9.2358617 1.84375 10.0625 C 1.84375 14.599125 5.5258752 18.28125 10.0625 18.28125 C 10.509115 18.28125 10.947724 18.256096 11.375 18.1875 L 38.15625 44.9375 C 39.561036 46.342286 42.204505 45.951745 44.09375 44.0625 C 45.982995 42.173255 46.373536 39.529786 44.96875 38.125 L 18.1875 11.3125 C 18.249824 10.904613 18.28125 10.487809 18.28125 10.0625 C 18.28125 5.5258752 14.599125 1.84375 10.0625 1.84375 z M 43.625 2.75 L 33.4375 9.8125 L 32.53125 13.5625 L 27.96875 17.90625 L 31.40625 21.21875 L 35.875 16.8125 L 39.40625 15.875 L 46.65625 5.78125 L 43.625 2.75 z M 15.03125 25.90625 C 7.8033753 33.086151 7.2145886 33.648419 2.03125 38.78125 C 0.72083335 40.091667 1.3282724 42.797022 3.375 44.84375 L 3.78125 45.28125 C 5.8279776 47.327978 8.5333334 47.904167 9.84375 46.59375 C 15.445521 41.004056 17.293476 39.184722 22.78125 33.75 L 21.375 32.375 L 9.4375 44.3125 C 8.9976541 44.752346 8.2764647 44.776465 7.84375 44.34375 L 7.8125 44.28125 C 7.3797853 43.848535 7.3726541 43.158596 7.8125 42.71875 L 19.75 30.78125 L 17.96875 28.96875 L 6.09375 40.8125 C 5.6539041 41.252346 4.963964 41.276464 4.53125 40.84375 L 4.5 40.78125 C 4.0672853 40.348535 4.0601541 39.658596 4.5 39.21875 L 16.46875 27.34375 L 15.03125 25.90625 z M 40.53125 36.84375 C 42.405073 36.84375 43.9375 38.376177 43.9375 40.25 C 43.9375 42.123823 42.405073 43.65625 40.53125 43.65625 C 38.657427 43.65625 37.15625 42.123823 37.15625 40.25 C 37.15625 38.376177 38.657427 36.84375 40.53125 36.84375 z");
Ui.Icon.register("play","m 8.2857143,3.8571429 34.9999997,20.0000001 -34.9999997,20 z");Ui.Icon.register("pause","m 11.857143,4.1428571 0,39.9999999 10,0 0,-39.9999999 -10,0 z m 15,0 0,39.9999999 10,0 0,-39.9999999 -10,0 z");Ui.Icon.register("savedisk","M 21.40625 4.875 L 21.40625 18.21875 L 18.09375 14.875 L 14.75 18.21875 L 24.75 28.21875 L 34.75 18.21875 L 31.40625 14.875 L 28.09375 18.21875 L 28.09375 4.875 L 21.40625 4.875 z M 14.78125 24.71875 L 6.875 31.71875 L 6.875 41.71875 L 41.875 41.71875 L 41.875 31.71875 L 33.78125 24.71875 L 29.9375 24.71875 L 26.9375 27.71875 L 31.875 27.71875 L 36.875 31.71875 L 11.875 31.71875 L 16.6875 27.71875 L 22.375 27.71875 L 19.375 24.71875 L 14.78125 24.71875 z M 11.875 33.71875 L 36.875 33.71875 L 36.875 38.71875 L 11.875 38.71875 L 11.875 33.71875 z");
Ui.Icon.register("savecloud2","M 18.925659,0.85824567 C 18.466137,0.87874855 18.003081,0.91002316 17.536594,0.9650968 13.362924,1.7467762 10.354728,4.6672589 8.5254823,8.3734417 4.0378644,9.813485 0.68973223,13.8927 0.68973223,18.844853 c 0,6.125009 4.99228227,11.127337 11.11251777,11.148135 0.01276,4.3e-5 0.02284,0 0.03562,0 l 4.737067,-4.365632 c -1.582261,0.0085 -3.146117,-0.377948 -4.737067,-0.371435 -3.5744989,0 -6.3754507,-2.836462 -6.3754507,-6.411068 0,-3.132226 2.201163,-5.57977 5.1288547,-6.161749 l 1.282213,-0.284936 0.498639,-1.246597 c 1.233002,-3.2144752 4.272134,-5.5206414 7.942601,-5.5206414 3.23259,0 6.045809,1.7834186 7.515196,4.4165134 l 0.96166,1.709618 c 0.998006,-0.382707 2.139449,-0.642362 3.098683,-0.747958 2.071738,0 3.76846,1.379977 4.202811,3.276768 l 0.391788,1.780852 1.816469,0.106851 c 2.418062,0.128106 4.202812,1.997185 4.202812,4.452131 0,2.539231 -1.948541,4.487748 -4.487748,4.487748 -1.033002,0 -2.035388,-0.0019 -3.063066,0 l 4.630216,4.630215 c 4.364358,-0.748996 7.728899,-4.549598 7.728899,-9.117963 0,-4.362392 -3.120225,-7.864218 -7.194643,-8.833027 -1.389825,-3.245245 -4.507316,-5.5918757 -8.227538,-5.5918757 -0.31137,0 -0.585584,0.1113395 -0.890426,0.1424682 C 28.564553,3.0571996 24.70393,0.85824567 20.314724,0.85824567 c -0.50564,-0.0269379 -0.929544,-0.0205029 -1.389065,0 z M 24.731237,20.80379 13.333783,32.201245 l 3.811024,3.84664 3.775406,-3.84664 0,15.244095 7.622048,0 0,-15.244095 3.775407,3.84664 3.811024,-3.84664 z");
Ui.Icon.register("mask","m 3.74,18.99 c 0.44,9.20 4.38,18.61 11.95,24.17 4.08,3.06 9.87,4.52 14.60,2.05 5.97,-3.13 9.76,-9.20 12.197133,-15.293521 3.414999,-8.8245 3.932861,-18.843926 0.950976,-27.8646626 C 38.310743,4.4704945 32.727896,5.9868712 27.03672,5.9943319 19.958912,6.293711 13.019189,4.4574879 6.4266049,2.0478522 4.4742764,7.4565945 3.4616896,13.23241 3.7424481,18.988404 z M 34.535245,15.557069 c 1.987764,-0.989965 5.640663,1.357904 5.475148,4.24902 -1.665611,-0.672877 -3.538893,-1.546511 -5.522954,-0.62016 -1.665542,0.777635 -2.409065,1.901635 -3.562775,2.449806 -1.155929,-2.895182 0.63153,-5.14092 3.610581,-6.078666 z m -6.89125,18.340348 c 4.694403,-0.874832 8.269298,-2.869329 10.344911,-7.136025 -0.714728,7.030404 -7.013746,11.815598 -14.18948,10.881943 -4.488488,-0.470107 -8.281739,-4.204006 -8.955984,-8.645415 2.817723,3.994704 8.050456,5.894049 12.800553,4.899497 z M 12.821029,21.201077 c 0.634185,-4.112248 5.60789,-6.027859 9.134551,-3.621197 2.048586,1.31704 2.499819,3.593051 1.49747,5.801003 -1.325506,-1.072323 -2.122194,-2.448113 -4.184278,-2.56 -2.41,-0.50 -4.36,0.07 -6.22,1.47 -0.61,0.23 -0.23,-0.84 -0.23,-1.093 z");
Ui.Icon.register("share","M 35.15625 1.4375 C 31.014114 1.4375 27.65625 4.795364 27.65625 8.9375 C 27.65625 9.2720571 27.676295 9.5832816 27.71875 9.90625 L 14.15625 18.03125 C 12.898871 17.079306 11.354924 16.5 9.65625 16.5 C 5.5141144 16.5 2.15625 19.857864 2.15625 24 C 2.15625 28.142136 5.5141144 31.5 9.65625 31.5 C 11.354924 31.5 12.898871 30.920694 14.15625 29.96875 L 27.78125 38.15625 C 27.738909 38.478794 27.71875 38.82215 27.71875 39.15625 C 27.71875 43.298386 31.076614 46.65625 35.21875 46.65625 C 39.360886 46.65625 42.71875 43.298386 42.71875 39.15625 C 42.71875 35.014114 39.360886 31.65625 35.21875 31.65625 C 33.599996 31.65625 32.10059 32.159189 30.875 33.03125 L 17.09375 24.78125 C 17.119355 24.529122 17.15625 24.258883 17.15625 24 C 17.15625 23.741117 17.119355 23.470878 17.09375 23.21875 L 30.78125 15.03125 C 32.00986 15.910429 33.530263 16.4375 35.15625 16.4375 C 39.298386 16.4375 42.65625 13.079636 42.65625 8.9375 C 42.65625 4.795364 39.298386 1.4375 35.15625 1.4375 z");
Ui.Icon.register("pen","m 35.491031,1.9380056 c -0.880041,-0.0019 -1.665618,0.25809 -2.25,0.8125 L 7.2097806,28.719256 c -1.081049,1.081049 -1.081049,2.856993 0,3.9375 1.080507,1.081049 2.8257434,1.081049 3.9062504,0 L 34.397281,9.4067556 c 0.325127,-0.281777 0.847379,-0.277621 1.15625,0.03125 0.308329,0.308871 0.312485,0.7675394 0.03125,1.0937504 l 0,0.03125 -22.03125,22 c -1.833719,1.833719 -1.833719,4.822531 0,6.65625 1.833177,1.833177 4.823073,1.833177 6.65625,0 l 24.5625,-24.5625 c 0.06773,-0.06774 0.1241,-0.147222 0.1875,-0.21875 1.627805,-1.913375 0.470025,-5.6862252 -2.78125,-8.9375002 -2.279584,-2.279956 -4.751409,-3.558416 -6.6875,-3.5625 z M 5.8035306,35.781756 c -0.629799,-0.0038 -1.217236,0.248215 -1.625,0.65625 -0.389069,0.389069 -0.65969,0.915496 -0.8125,1.5625 l -0.96875,4.1875 c -0.258476,1.098931 -1.067342,2.993711 -0.40625,3.625 0.658925,0.631289 2.695866,-0.10063 3.78125,-0.40625 l 4.0625,-1.15625 c 0.5955254,-0.167441 1.1018984,-0.445648 1.4687504,-0.8125 0.442715,-0.442715 0.661127,-0.992264 0.65625,-1.59375 -0.0065,-0.725034 -0.321746,-1.437171 -0.96875,-2.0625 l -3.1875004,-3.0625 c -0.679787,-0.657299 -1.370201,-0.933707 -2,-0.9375 z");
Ui.Icon.register("resource","M 12.8125 3.875 C 9.1508311 3.875 6.125 6.9008 6.125 10.5625 L 6.125 37.21875 C 6.125 40.88035 9.1508311 43.875 12.8125 43.875 L 35.46875 43.875 C 39.130419 43.875 42.125 40.88035 42.125 37.21875 L 42.125 10.5625 C 42.125 6.9008 39.130419 3.875 35.46875 3.875 L 12.8125 3.875 z M 10.125 16.46875 L 38.125 16.46875 L 38.125 37.21875 C 38.125 38.73355 36.983608 39.875 35.46875 39.875 L 12.8125 39.875 C 11.297642 39.875 10.125 38.73355 10.125 37.21875 L 10.125 16.46875 z");
Ui.Icon.register("resource-comment","M 15 1.96875 C 7.3023577 1.96875 0.78125 7.1875 0.78125 13.9375 C 0.78125 20.6875 7.3023577 25.875 15 25.875 C 16.346252 25.875 17.636341 25.63815 18.875 25.34375 C 23.297706 28.31325 28.03125 27.25 28.03125 27.25 L 30.5625 26.59375 L 28.6875 24.78125 C 28.6875 24.78125 27.986264 24.1144 27.1875 23.25 C 26.650882 22.6693 26.28985 22.1178 25.875 21.5625 C 27.917227 19.5116 29.21875 16.8785 29.21875 13.9375 C 29.21875 7.1875 22.697407 1.96875 15 1.96875 z M 15 4.875 C 21.409475 4.875 26.3125 9.0945 26.3125 13.9375 C 26.3125 16.3945 25.117941 18.6359 23.03125 20.3125 L 22.09375 21.0625 L 22.65625 22.125 C 23.108689 22.9611 23.821875 23.7378 24.5 24.5 C 23.171481 24.3515 21.569059 23.92875 20 22.71875 L 19.4375 22.28125 L 18.71875 22.46875 C 17.55345 22.79525 16.310816 22.96865 15 22.96875 C 8.5902415 22.96875 3.6875 18.7803 3.6875 13.9375 C 3.6875 9.0945 8.5902415 4.875 15 4.875 z M 30.34375 12.125 C 30.446203 12.7438 30.53125 13.3499 30.53125 14 C 30.53125 17.2197 29.120287 20.10555 26.96875 22.34375 C 27.382667 22.77555 27.59375 23 27.59375 23 L 43.71875 23 L 43.71875 40.90625 C 43.71875 42.21385 42.713889 43.1875 41.40625 43.1875 L 21.84375 43.1875 C 20.536111 43.1875 19.53125 42.21385 19.53125 40.90625 L 19.53125 27.53125 C 19.144904 27.30055 18.749593 27.0441 18.375 26.75 C 17.620347 26.8923 16.866022 27.0431 16.09375 27.125 L 16.09375 40.90625 C 16.09375 44.06695 18.682966 46.65625 21.84375 46.65625 L 41.40625 46.65625 C 44.567034 46.65625 47.15625 44.06695 47.15625 40.90625 L 47.15625 17.90625 C 47.15625 14.74545 44.567034 12.125 41.40625 12.125 L 30.34375 12.125 z");
Ui.Icon.register("group","m 23.130121,8.752257 c -1.726597,0.098014 -3.104222,0.7517754 -2.666061,1.454215 -2.467192,-0.4542201 -1.908658,5.120049 -1.908658,5.120049 l 0.545331,1.454215 c -1.051264,0.676063 -0.308371,1.48013 -0.272665,2.423692 0.05151,1.391344 0.878588,1.120958 0.878588,1.120958 0.05326,2.296858 1.211846,2.575172 1.211846,2.575172 0.160674,1.081701 0.118381,1.213218 0.09089,1.211846 l -1.030069,0.121185 c 0.04507,0.364663 -0.09089,0.969476 -0.09089,0.969476 -1.195842,0.527974 -1.450459,0.848231 -2.635765,1.363327 -2.291004,0.997412 -4.768424,2.282745 -5.210937,4.029388 -0.442514,1.746642 -1.757177,8.664698 -1.757177,8.664698 l 26.812091,0 c 0,-1.816297 -2.060138,-9.51299 -2.060138,-9.51299 0,-1.122089 -1.45177,-2.403325 -4.362645,-3.1508 -1.510167,-0.387492 -2.787246,-1.242142 -2.787246,-1.242142 -0.186722,-0.105945 -0.151481,-1.090661 -0.151481,-1.090661 l -0.93918,-0.151481 c 0,-0.08019 -0.09089,-1.242142 -0.09089,-1.242142 1.121504,-0.37403 0.999773,-2.575173 0.999773,-2.575173 0.712354,0.392175 1.18155,-1.363326 1.18155,-1.363326 0.842299,-2.426218 -0.424146,-2.272211 -0.424146,-2.272211 0.400955,-1.815712 0,-4.48383 0,-4.48383 C 28.14682,9.4116558 25.350031,8.6262386 23.130121,8.752257 z M 8.8909315,11.32743 c -1.805176,1.126771 -1.5039686,2.802483 -1.4542151,3.787018 0.033365,0.66143 0.1211846,1.120958 0.1211846,1.120958 -0.7328405,0.31491 -0.3519884,0.740165 -0.3332576,1.817768 0.023414,1.490851 0.7574037,1.242143 0.7574037,1.242143 0.3459335,2.03053 1.4239189,3.271984 1.4239189,3.271984 0,0 -0.3082495,1.748578 -0.424146,1.969249 -0.3324708,0.07434 -1.0849274,0.601644 -2.6963572,1.272438 -2.3747079,0.988047 -1.6421662,0.397523 -3.5749455,1.363327 -3.0548682,1.527727 -2.45398793,7.907295 -2.45398793,7.907295 l 9.63417503,0 0.9694766,-4.48383 0,-0.06059 0.0303,-0.06059 c 0.655577,-2.830685 4.045795,-4.187589 5.907749,-4.998864 -1.130284,-0.516267 -1.72034,-0.875964 -1.999546,-0.939181 -0.11414,-0.228866 -0.363554,-1.969249 -0.363554,-1.969249 0,0 1.361329,-1.21574 1.666288,-3.514354 0,0 0.685549,0.368884 0.727108,-1.030069 0.03102,-1.077603 0.188095,-1.472562 -0.545331,-1.787472 0,0 0.06748,-0.761904 0.09089,-1.423919 0.03629,-0.981024 0.212963,-2.346306 -1.484511,-3.453761 C 14.648415,11.200275 13.413257,10.505926 13.405062,10.509439 12.961377,10.240184 12.405289,10.054996 12.405289,10.054996 10.429138,9.7931513 9.6513809,10.848764 8.8909315,11.32743 z M 37.005757,10.206465 c -1.345103,0.07492 -2.276268,0.636723 -2.908431,1.030069 -0.630991,0.393346 -0.999672,1.196869 -1.272438,1.787473 -0.272181,0.589436 -0.757404,4.15001 -0.757404,4.27176 0,0.120579 -0.152106,1.486407 -0.393849,2.332803 -0.241744,0.846982 -1.060366,2.302507 -1.060366,2.302507 1.136127,0.701936 2.381338,0.97755 3.69613,1.393623 l -0.0303,1.151254 c -0.211306,0.03102 -1.060385,0.57611 -1.18155,0.848292 -0.07902,0.177943 -0.254984,0.476725 -0.424146,0.696811 2.193254,0.884443 3.492555,2.186246 3.54465,3.635538 0.03571,0.258719 1.378122,5.020702 1.454215,6.089526 l 10.118913,0 c 0.0088,-0.0439 -0.300034,-6.194765 -0.302961,-6.241007 0,0 -0.592903,-1.48556 -1.514808,-1.635992 -0.922485,-0.151597 -2.11027,-0.474258 -2.605464,-0.848288 -0.289742,-0.220086 -1.229043,-0.598192 -1.666288,-0.757403 -0.204283,-0.07317 -0.545936,-0.666999 -0.666516,-0.939181 -0.120579,-0.272182 -0.939362,-0.817269 -1.151253,-0.848292 l -0.06059,-1.151254 c 1.282571,-0.333871 2.645628,-0.809405 3.726427,-1.393623 0,0 -0.819207,-1.516703 -1.060366,-2.363099 -0.242329,-0.846982 -0.39385,-2.151632 -0.39385,-2.272211 0,-0.12175 -0.515518,-3.682324 -0.787699,-4.271757 -0.272182,-0.590604 -0.640276,-1.394127 -1.272439,-1.787473 -0.632162,-0.393346 -1.562743,-0.955146 -2.90843,-1.030069 -0.0199,-0.0012 -0.04011,0.0017 -0.06059,0 -0.0199,0.0017 -0.03952,-0.0012 -0.0606,-7e-6 z");
Ui.Icon.register("note","M 44.06787,0.7851872 C 28.491486,0.26722979 15.73318,6.0126519 15.73318,6.0126519 l -0.0093,29.1567271 c -1.585954,-0.629546 -3.514579,-0.778796 -5.473424,-0.302684 -4.223167,1.026151 -6.9887065,4.565837 -6.1768988,7.907453 0.8118076,3.341616 4.8931633,5.219095 9.1158648,4.193409 3.981856,-0.967567 6.666494,-4.170162 6.280118,-7.333236 l 0,0 0,-21.785365 c 0,0 9.021945,-3.15424 20.724342,-3.945124 l 0,16.203141 0,0 c -1.568751,-0.600719 -3.460644,-0.73695 -5.383689,-0.269673 -4.223166,1.025686 -6.988706,4.565372 -6.176898,7.907453 0.811343,3.341616 4.892699,5.218631 9.115865,4.192945 3.687541,-0.895965 6.26338,-3.708929 6.317314,-6.632088 l 0.0014,0.0019 c -4e-6,-11.507441 6e-6,-23.014882 -4e-6,-34.5223228 z");
Ui.Icon.register("radio","m 46.189099,43.018201 0,-25.871376 c 0,-0.737199 -0.629619,-1.335089 -1.404991,-1.335089 l -6.638682,0 -24.631551,-8.7174923 c 0.0352,-0.1799619 0.05453,-0.365873 0.05453,-0.5562458 0,-1.5968517 -1.294437,-2.8917839 -2.891784,-2.8917839 -1.5973475,0 -2.891784,1.2949322 -2.891784,2.8917839 0,1.5968517 1.2944365,2.8917838 2.891784,2.8917838 0.993508,0 1.870016,-0.5017118 2.390567,-1.2651864 l 20.02931,7.6466447 -29.880606,0 c -0.7758687,0 -1.4049915,0.597889 -1.4049915,1.335585 l 0,25.871872 c 0,0.737695 0.6291228,1.335584 1.4049915,1.335089 l 41.568711,0 c 0.775373,0 1.404992,-0.597889 1.404496,-1.335585 z m -5.613026,-5.766215 -21.317796,0 c -0.410987,0 -0.743644,-0.444204 -0.743644,-0.991031 0,-0.547321 0.332657,-0.990533 0.743644,-0.990533 l 21.317796,0 c 0.410492,0 0.743644,0.443212 0.743644,0.990533 0,0.547323 -0.333152,0.991031 -0.743644,0.991031 z m 0,-4.456411 -21.317796,0 c -0.410987,0 -0.743644,-0.444204 -0.743644,-0.991031 0,-0.547321 0.332657,-0.990533 0.743644,-0.990533 l 21.317796,0 c 0.410492,0 0.743644,0.443707 0.743644,0.990533 0,0.546827 -0.333152,0.991031 -0.743644,0.991031 z m 0,-4.454924 -21.317796,0 c -0.410987,0 -0.743644,-0.443708 -0.743644,-0.991526 0,-0.547322 0.332657,-0.990534 0.743644,-0.990534 l 21.317796,0 c 0.410492,-4.95e-4 0.743644,0.443708 0.743644,0.990534 0,0.547818 -0.333152,0.991526 -0.743644,0.991526z");
Ui.Icon.register("book","m 24,9.9639828 c 0,0 -5.614406,-5.6144067 -22.4576276,-5.6144067 l 0,33.6864409 C 18.561212,38.036017 24,43.650424 24,43.650424 c 0,0 5.438789,-5.876576 22.457628,-5.876576 l 0,-33.4242719 C 29.614407,4.3495761 24,9.9639828 24,9.9639828 z m -16.8432207,0 C 14.292916,10.561356 18.670805,12.211991 21.192797,13.549568 l 0,22.611237 C 18.670805,34.828619 14.292916,33.177983 7.1567793,32.57522 z M 40.843221,32.57522 c -7.138831,0.603212 -11.51672,2.253848 -14.036017,3.585585 l 0,-22.611237 c 2.519297,-1.338026 6.897186,-2.988212 14.036017,-3.5855852 z");
Ui.Icon.register("camera","M 45,45 3,45 C 1.341,45 0,43.659 0,42 L 0,12 C 0,10.344 1.341,9 3,9 l 9,0 0,-3 c 0,-1.656 1.341,-3 3,-3 l 18,0 c 1.659,0 3,1.344 3,3 l 0,3 9,0 c 1.659,0 3,1.344 3,3 l 0,30 c 0,1.659 -1.341,3 -3,3 z m -3,-30 -9,0 -3,0 0,-6 -12,0 0,6 -3,0 -9,0 0,24 36.40678,0 z M 10.5,18 C 11.328,18 12,18.672 12,19.5 12,20.328 11.328,21 10.5,21 9.672,21 9,20.328 9,19.5 9,18.672 9.672,18 10.5,18 z M 24,18 c 4.971,0 9,4.029 9,9 0,4.968 -4.029,9 -9,9 -4.971,0 -9,-4.032 -9,-9 0,-4.971 4.029,-9 9,-9 z m 0,15 c 3.312,0 6,-2.688 6,-6 0,-3.312 -2.688,-6 -6,-6 -3.312,0 -6,2.688 -6,6 0,3.312 2.688,6 6,6 z");
Ui.Icon.register("stats","M 13.1875,2.40625 C 6.8058707,2.40625 1.59375,7.6183707 1.59375,14 c 0,6.381629 5.2121207,11.59375 11.59375,11.59375 6.381629,0 11.59375,-5.212121 11.59375,-11.59375 0,-6.3816293 -5.212121,-11.59375 -11.59375,-11.59375 z m -0.75,4.21875 c 0.0104,-0.00105 0.02084,0.001 0.03125,0 l 0.125,7.40625 6.96875,3.75 c -1.286674,2.170122 -3.652079,3.625 -6.375,3.625 -4.1117809,0 -7.40625,-3.294469 -7.40625,-7.40625 0,-3.854795 2.9063058,-6.998001 6.65625,-7.375 z m 15.25,7.375 0,30 5,0 0,-30 -5,0 z m 10,5 0,24.9375 5.3125,0 L 43,19 37.6875,19 z m -20,10 0,15 5,0 0,-15 -5,0 z");
Ui.Icon.register("picasa","m 24.044065,1.2054636 c -3.683387,0 -7.140941,0.8842703 -10.215992,2.4429546 L 34.074984,18.565248 38.257618,6.1654017 C 34.371993,3.0409341 29.418138,1.2054636 24.044065,1.2054636 z M 11.97735,4.6848231 C 5.618278,8.7008337 1.391213,15.781289 1.391213,23.858316 c 0,1.291582 0.1256694,2.54288 0.3331302,3.775475 L 22.304385,12.642933 11.97735,4.6848231 z M 40.071327,7.794038 c -1.150472,3.393746 -5.433262,15.926968 -8.180196,24.133431 l 13.362221,-0.111044 c 0.934433,-2.483233 1.480579,-5.148174 1.480579,-7.958109 0,-6.279417 -2.538197,-11.958518 -6.662604,-16.064278 z M 13.050769,21.859534 2.1685168,29.743615 C 4.4704985,38.302387 11.666595,44.832301 20.564705,46.215051 L 13.050769,21.859534 z M 44.40202,33.815206 c -3.774474,0.0027 -16.828153,0.03701 -25.465952,0.03701 l 4.108606,12.621932 c 0.337346,0.0149 0.658371,0.07403 0.999391,0.07403 8.941546,0 16.667186,-5.213673 20.357955,-12.732976 z");
Ui.Icon.register("newspaper","M 7 1.5 C 6.9991798 1.5 6.406959 1.6247011 6.40625 1.625 C 6.405541 1.6252989 5.9380352 1.9369648 5.9375 1.9375 C 5.9369648 1.9380352 5.6252989 2.405541 5.625 2.40625 C 5.6247011 2.406959 5.5 2.9991798 5.5 3 L 5.5 46 C 5.5 46.00082 5.6247011 46.593041 5.625 46.59375 C 5.6252989 46.594459 5.9369648 47.061965 5.9375 47.0625 C 5.9380352 47.063035 6.405541 47.374701 6.40625 47.375 C 6.406959 47.375299 6.9991798 47.5 7 47.5 L 42 47.5 C 42.00082 47.5 42.593041 47.375299 42.59375 47.375 C 42.594459 47.374701 43.061965 47.063035 43.0625 47.0625 C 43.063035 47.061965 43.374701 46.594459 43.375 46.59375 C 43.375299 46.593041 43.5 46.00082 43.5 46 L 43.5 3 C 43.5 2.9991798 43.375299 2.406959 43.375 2.40625 C 43.374701 2.405541 43.063035 1.9380352 43.0625 1.9375 C 43.061965 1.9369648 42.594459 1.6252989 42.59375 1.625 C 42.593041 1.6247011 42.00082 1.5 42 1.5 L 7 1.5 z M 8.5 4.5 L 40.5 4.5 L 40.5 44.5 L 8.5 44.5 L 8.5 4.5 z M 12 8 L 12 17 L 21 17 L 21 8 L 12 8 z M 24 8 L 24 10 L 38 10 L 38 8 L 24 8 z M 24 12 L 24 14 L 38 14 L 38 12 L 24 12 z M 24 16 L 24 18 L 38 18 L 38 16 L 24 16 z M 12 20 L 12 22 L 38 22 L 38 20 L 12 20 z M 12 24 L 12 26 L 38 26 L 38 24 L 12 24 z M 12 28 L 12 30 L 38 30 L 38 28 L 12 28 z M 12 32 L 12 34 L 38 34 L 38 32 L 12 32 z M 12 36 L 12 38 L 38 38 L 38 36 L 12 36 z M 12 40 L 12 42 L 38 42 L 38 40 L 12 40 z");
Ui.Icon.register("files","m 18.9375,1.9375 c -6.06e-4,0 -0.436976,0.093529 -0.4375,0.09375 -5.24e-4,2.209e-4 -0.343355,0.2183545 -0.34375,0.21875 -3.95e-4,3.955e-4 -0.249779,0.3432261 -0.25,0.34375 -2.21e-4,5.239e-4 -0.09375,0.4368939 -0.09375,0.4375 l 0,4.21875 c -2.27779,-0.00646 -2.977884,0.018659 -6.1875,0 -6.06e-4,0 -0.436976,0.093529 -0.4375,0.09375 -5.24e-4,2.209e-4 -0.343355,0.2183545 -0.34375,0.21875 -3.95e-4,3.955e-4 -0.249779,0.3432261 -0.25,0.34375 C 10.593529,7.9067739 10.5,8.3431439 10.5,8.34375 l 0,3.6875 2.21875,0 0,-2.5625 7.3125,0 0,-5.3125 16.46875,0 0,5.84375 c 0,6.06e-4 0.09353,0.436976 0.09375,0.4375 2.21e-4,5.24e-4 0.249605,0.343355 0.25,0.34375 3.95e-4,3.95e-4 0.343226,0.218529 0.34375,0.21875 5.24e-4,2.21e-4 0.436894,0.09375 0.4375,0.09375 l 6.0625,0 0,22.625 -5.09375,0 c -1.41e-4,-9.172465 0,-19.53125 0,-19.53125 l -7.125,-6.90625 0,2.6875 4.40625,4.21875 -4.46875,0 0,-6.9375 C 31.38601,7.2502347 27.689866,7.292833 20.0625,7.28125 l 0,2.1875 9.125,0 0,5.84375 c 0,6.06e-4 0.09353,0.436976 0.09375,0.4375 2.21e-4,5.24e-4 0.218355,0.343355 0.21875,0.34375 3.95e-4,3.95e-4 0.374476,0.218529 0.375,0.21875 5.24e-4,2.21e-4 0.436894,0.09375 0.4375,0.09375 l 6.0625,0 0,22.625 -5.6875,0 0,-20.03125 -7.125,-6.875 0,2.65625 L 27.96875,19 23.5,19 l 0,-6.9375 -10.71875,0.03125 0,2.1875 8.5,0 0,5.84375 c 0,6.06e-4 0.09353,0.436976 0.09375,0.4375 2.21e-4,5.24e-4 0.218355,0.343355 0.21875,0.34375 3.95e-4,3.95e-4 0.343226,0.218529 0.34375,0.21875 5.24e-4,2.21e-4 0.436894,0.09375 0.4375,0.09375 l 6.09375,0 0,22.59375 -23.65625,0 0,-29.53125 7.90625,0 0,-2.21875 c -2.9797505,-0.0028 -6.5309745,0.0017 -9,0 -6.061e-4,0 -0.4682261,0.09353 -0.46875,0.09375 -5.239e-4,2.21e-4 -0.3433545,0.218355 -0.34375,0.21875 -3.955e-4,3.95e-4 -0.2185291,0.343226 -0.21875,0.34375 -2.209e-4,5.24e-4 -0.09375,0.436894 -0.09375,0.4375 l 0,31.78125 c 0,6.06e-4 0.093529,0.436976 0.09375,0.4375 2.209e-4,5.24e-4 0.2183545,0.343355 0.21875,0.34375 3.955e-4,3.95e-4 0.3432261,0.218529 0.34375,0.21875 5.239e-4,2.21e-4 0.4681439,0.09375 0.46875,0.09375 l 25.84375,0 c 6.06e-4,0 0.436976,-0.09353 0.4375,-0.09375 5.24e-4,-2.21e-4 0.343355,-0.218355 0.34375,-0.21875 3.95e-4,-3.95e-4 0.249779,-0.343226 0.25,-0.34375 2.21e-4,-5.24e-4 0.09375,-0.436894 0.09375,-0.4375 -7.8e-5,-1.289078 2.4e-5,-2.530694 0,-3.71875 l 6.78125,0 c 6.06e-4,0 0.436976,-0.06228 0.4375,-0.0625 5.24e-4,-2.21e-4 0.374605,-0.249605 0.375,-0.25 3.95e-4,-3.95e-4 0.218529,-0.343226 0.21875,-0.34375 2.21e-4,-5.24e-4 0.09375,-0.436894 0.09375,-0.4375 -1.55e-4,-2.096577 6.7e-5,-2.1471 0,-4.1875 l 6.1875,0 c 6.06e-4,0 0.468226,-0.09353 0.46875,-0.09375 5.24e-4,-2.21e-4 0.343355,-0.249605 0.34375,-0.25 3.95e-4,-3.95e-4 0.218529,-0.343226 0.21875,-0.34375 2.21e-4,-5.24e-4 0.09375,-0.436894 0.09375,-0.4375 -9.61e-4,-12.986263 0,-25.9375 0,-25.9375 L 38.75,1.9375 l 0,2.71875 4.4375,4.21875 -4.46875,0 0,-6.9375 c -0.02606,8.413e-4 -3.028173,0.097394 -19.78125,0 z");
Ui.Icon.register("help","M 24 2.375 C 12.051981 2.375 2.375 12.051981 2.375 24 C 2.375 35.94802 12.051981 45.625 24 45.625 C 35.948019 45.625 45.625 35.94802 45.625 24 C 45.625 12.051981 35.948019 2.375 24 2.375 z M 24.46875 5.9375 C 26.596734 5.9375354 28.337399 6.2464518 29.71875 6.84375 C 31.100063 7.403784 32.184728 8.1101166 32.96875 8.96875 C 33.752727 9.8274482 34.29506 10.767198 34.59375 11.8125 C 34.929726 12.820529 35.093725 13.785445 35.09375 14.71875 C 35.093725 15.801443 34.885476 16.791525 34.4375 17.6875 C 34.02681 18.583523 33.484477 19.434772 32.8125 20.21875 C 32.177812 21.002771 31.465396 21.759437 30.71875 22.46875 C 29.972064 23.140769 29.265731 23.796768 28.59375 24.46875 C 27.959066 25.140767 27.416733 25.853183 26.96875 26.5625 C 26.558067 27.271848 26.374984 27.997264 26.375 28.78125 L 20.09375 28.78125 C 20.05641 28.594597 20.03124 28.310847 20.03125 27.9375 C 20.03124 26.444182 20.43474 25.031517 21.21875 23.6875 C 22.002739 22.306186 23.011904 21.107854 24.28125 20.0625 C 25.139902 19.353189 25.940818 18.596523 26.6875 17.8125 C 27.43415 16.991192 27.812483 16.120859 27.8125 15.1875 C 27.812483 14.067528 27.408983 13.216279 26.625 12.65625 C 25.840985 12.058946 24.882152 11.75003 23.6875 11.75 C 22.492821 11.75003 21.307489 11.939197 20.1875 12.3125 C 19.067491 12.648529 17.869159 13.146612 16.5625 13.78125 L 14.65625 8.53125 C 15.962911 7.7099503 17.495326 7.0730343 19.25 6.625 C 21.004656 6.1770352 22.751404 5.9375354 24.46875 5.9375 z M 23.6875 32.8125 C 24.28482 32.812509 24.846236 32.932259 25.40625 33.15625 C 25.966235 33.342925 26.464317 33.651842 26.875 34.0625 C 27.322983 34.435841 27.67615 34.902674 27.9375 35.5 C 28.198816 36.060006 28.312482 36.696922 28.3125 37.40625 C 28.312482 38.862253 27.845649 39.991169 26.875 40.8125 C 25.941651 41.633834 24.882152 42.0625 23.6875 42.0625 C 23.090154 42.0625 22.497488 41.94275 21.9375 41.71875 C 21.377489 41.532084 20.88549 41.223167 20.4375 40.8125 C 19.989491 40.401835 19.636324 39.935002 19.375 39.375 C 19.113658 38.815003 18.968742 38.15292 18.96875 37.40625 C 18.968742 36.696922 19.113658 36.060006 19.375 35.5 C 19.636324 34.902674 19.989491 34.435841 20.4375 34.0625 C 20.88549 33.651842 21.377489 33.342925 21.9375 33.15625 C 22.497488 32.932259 23.090154 32.812509 23.6875 32.8125 z");
Ui.Icon.register("uploadfile","M 8.0625 2.21875 C 8.0617248 2.21875 7.4694201 2.3434686 7.46875 2.34375 C 7.4680799 2.3440327 7.0317558 2.6244948 7.03125 2.625 C 7.0307442 2.6255052 6.7502825 3.0618298 6.75 3.0625 C 6.7497175 3.0631702 6.625 3.6242249 6.625 3.625 L 6.625 44.28125 C 6.625 44.282025 6.7497173 44.84308 6.75 44.84375 C 6.7502825 44.84442 7.0307442 45.280745 7.03125 45.28125 C 7.0317558 45.281755 7.4680799 45.562217 7.46875 45.5625 C 7.4694201 45.562783 8.0617248 45.65625 8.0625 45.65625 L 41.125 45.65625 C 41.125775 45.65625 41.68683 45.562781 41.6875 45.5625 C 41.68817 45.562217 42.124495 45.281755 42.125 45.28125 C 42.125505 45.280745 42.437217 44.84442 42.4375 44.84375 C 42.437783 44.84308 42.5625 44.282025 42.5625 44.28125 C 42.767515 33.395948 42.5625 22.367308 42.5625 11.09375 L 33.4375 2.3125 L 33.40625 6.625 L 38.15625 11.09375 L 33.375 11.09375 L 33.375 2.21875 C 24.475085 2.2568748 16.581521 2.22416 8.0625 2.21875 z M 30.25 5.5625 L 30.25 13.03125 C 30.25 13.032025 30.374719 13.59308 30.375 13.59375 C 30.375283 13.59442 30.655745 14.030745 30.65625 14.03125 C 30.656755 14.031755 31.09308 14.312217 31.09375 14.3125 C 31.09442 14.312783 31.655475 14.4375 31.65625 14.4375 L 39.4375 14.4375 L 39.4375 42.125 L 9.90625 42.1875 L 9.8125 5.71875 L 30.25 5.5625 z M 23.21875 17.75 L 23.21875 24.75 L 21.5 22.96875 L 19.78125 24.75 L 25 29.96875 L 30.21875 24.75 L 28.5 22.96875 L 26.75 24.75 L 26.75 17.75 L 23.21875 17.75 z M 14.21875 28.75 L 14.21875 34.84375 L 35.5 34.84375 L 35.5 28.75 L 32.46875 28.75 L 32.46875 31.8125 L 17.25 31.8125 L 17.25 28.75 L 14.21875 28.75 z");
Ui.Icon.register("filetools","m 28.842851,0.26562499 c -0.370798,0 -0.743188,0.0215878 -1.085709,0.11071641 l 1.759598,1.7345571 c 0.717389,0.7071772 0.65337,1.9024055 -0.149753,2.6940992 -0.803124,0.7916938 -2.015608,0.8548002 -2.732994,0.1476219 L 24.799517,3.181157 c -0.116124,0.3789583 -0.149754,0.8017462 -0.149754,1.2178806 0,2.2837643 1.876352,4.1334132 4.193088,4.1334132 0.228075,0 0.455691,-0.00232 0.673889,-0.036902 L 43.181713,21.92914 c 0.717388,0.707178 2.067712,0.508192 3.032501,-0.442866 0.964788,-0.951058 1.166647,-2.282164 0.44926,-2.989343 L 32.998501,5.0264304 c 0.03183,-0.2053325 0.03745,-0.4132892 0.03745,-0.6273928 0,-2.2837648 -1.876351,-4.13341261 -4.193088,-4.13341261 z M 45.989584,0.70849073 40.785663,4.2514157 40.298965,6.1335946 37.977792,8.3479225 39.737391,10.008669 42.021127,7.7943407 43.818163,7.3145695 47.524554,2.2216149 z M 8.2892342,5.8752562 c -7.414e-4,0 -0.5609331,0.1104449 -0.5615747,0.1107165 -6.406e-4,2.669e-4 -0.4487753,0.2578611 -0.4492593,0.2583382 -4.839e-4,4.772e-4 -0.2617973,0.442233 -0.2620679,0.4428659 -2.708e-4,6.33e-4 -0.1123149,0.515945 -0.1123149,0.516676 l 0,38.3447832 c 0,7.31e-4 0.1120392,0.55295 0.1123149,0.553581 2.706e-4,6.32e-4 0.261584,0.405483 0.2620679,0.405961 4.84e-4,4.77e-4 0.4486187,0.258071 0.4492593,0.258338 6.416e-4,2.67e-4 0.5608333,0.110717 0.5615747,0.110717 l 31.6353478,0 c 7.42e-4,0 0.523495,-0.110458 0.524137,-0.110717 6.4e-4,-2.67e-4 0.448775,-0.257861 0.449259,-0.258338 4.83e-4,-4.78e-4 0.299235,-0.405329 0.299506,-0.405961 2.71e-4,-6.31e-4 0.112315,-0.55285 0.112315,-0.553581 0.150406,-7.872165 0.08309,-15.840553 0.03745,-23.914745 l -4.032501,-4.095294 0,24.837379 -25.551617,0.07382 -0.112322,-31.861382 18.381218,0.03214 c -4.317916,-0.8330858 -5.894232,-3.2962736 -6.43053,-4.7452988 -5.071425,-4.251e-4 -10.156912,0.00319 -15.3122628,1e-6 z M 31.388654,12.370619 c -3.691087,3.614407 -4.017018,3.874558 -6.664014,6.458457 -0.669195,0.659673 -0.333884,2.032818 0.711327,3.063153 l 0.187192,0.221434 c 1.045211,1.030335 2.438182,1.323971 3.107377,0.664298 2.860679,-2.813887 3.786674,-3.722584 6.589139,-6.458457 l -0.711328,-0.701203 -6.102441,6.01559 c -0.224617,0.221421 -0.565227,0.217831 -0.786203,0 l -0.03745,-0.0369 c -0.220976,-0.217831 -0.224617,-0.553594 0,-0.775015 l 6.10244,-6.015592 -0.898519,-0.88573 -6.065001,5.94178 c -0.224619,0.221421 -0.602667,0.254737 -0.823642,0.0369 l 0,-0.0369 c -0.220976,-0.217831 -0.224619,-0.590499 0,-0.81192 l 6.102445,-5.97869 z m 13.028523,5.498915 c 0.956912,0 1.722161,0.754357 1.722161,1.697652 0,0.943293 -0.765249,1.734555 -1.722161,1.734555 -0.956913,0 -1.7596,-0.791262 -1.7596,-1.734555 0,-0.943295 0.802687,-1.697652 1.7596,-1.697652 z");
Ui.Icon.register("rfidtag","M 12.5625 2.4375 C 9.037028 2.4375 6.15625 5.3182785 6.15625 8.84375 L 6.15625 38.28125 C 6.15625 41.806721 9.0370277 44.71875 12.5625 44.71875 L 35.5625 44.71875 C 39.087972 44.71875 42 41.806722 42 38.28125 L 42 8.84375 C 42 5.318278 39.087971 2.4375 35.5625 2.4375 L 12.5625 2.4375 z M 12.5625 6.125 L 35.5625 6.125 C 37.102171 6.125 38.28125 7.304079 38.28125 8.84375 L 38.28125 38.28125 C 38.28125 39.82092 37.10217 41 35.5625 41 L 12.5625 41 C 11.022828 41 9.84375 39.820921 9.84375 38.28125 L 9.84375 8.84375 C 9.84375 7.3040785 11.022828 6.125 12.5625 6.125 z M 24.21875 11.84375 C 19.573065 11.846643 14.910493 13.647585 11.375 17.1875 L 13.0625 18.84375 C 19.231188 12.667346 29.198595 12.643787 35.375 18.8125 C 35.39567 18.833137 35.416945 18.885493 35.4375 18.90625 L 37.09375 17.21875 C 37.070119 17.194883 37.055011 17.179982 37.03125 17.15625 C 33.491335 13.620756 28.864435 11.840847 24.21875 11.84375 z M 24.21875 16.59375 C 20.807024 16.595679 17.375852 17.902152 14.78125 20.5 L 16.46875 22.15625 C 20.755657 17.86398 27.67648 17.869341 31.96875 22.15625 C 31.983104 22.17057 31.985728 22.173132 32 22.1875 L 33.6875 20.53125 C 33.670147 20.513748 33.642449 20.486156 33.625 20.46875 C 31.027152 17.874147 27.630476 16.591619 24.21875 16.59375 z M 24.21875 21.5 C 22.040983 21.501446 19.872462 22.344218 18.21875 24 L 19.875 25.65625 C 22.280126 23.248113 26.154365 23.251098 28.5625 25.65625 C 28.570538 25.664254 28.554506 25.679448 28.5625 25.6875 L 30.25 24.03125 C 30.23893 24.020064 30.229883 23.97984 30.21875 23.96875 C 28.562969 22.315037 26.396517 21.49864 24.21875 21.5 z M 24.21875 25.78125 C 21.746052 25.78125 19.75 27.777303 19.75 30.25 C 19.75 32.722698 21.746052 34.71875 24.21875 34.71875 C 26.691447 34.71875 28.6875 32.722698 28.6875 30.25 C 28.6875 27.777303 26.691447 25.78125 24.21875 25.78125 z");
Ui.Icon.register("facebook","M 7.15625 2.15625 C 4.94025 2.15625 3.15625 3.94025 3.15625 6.15625 L 3.15625 42.15625 C 3.15625 44.37225 4.94025 46.15625 7.15625 46.15625 L 42.15625 46.15625 C 44.37225 46.15625 46.15625 44.37225 46.15625 42.15625 L 46.15625 6.15625 C 46.15625 3.94025 44.37225 2.15625 42.15625 2.15625 L 7.15625 2.15625 z M 37.03125 9.1875 C 37.68801 9.1927408 38.391498 9.1964286 39.15625 9.21875 L 39.15625 13.6875 C 37.567149 13.6875 35.637808 13.576474 34.90625 14.59375 C 34.174693 15.611021 34.15625 16.46148 34.15625 21.15625 L 39.15625 21.15625 L 39.15625 26.15625 L 34.15625 26.15625 L 34.15625 43.15625 L 28.15625 43.15625 L 28.15625 26.15625 L 23.15625 26.15625 L 23.15625 21.15625 L 28.15625 21.15625 C 28.15625 14.805452 28.130229 13.408331 29.3125 11.375 C 30.346992 9.5958355 32.433931 9.1508144 37.03125 9.1875 z");
Ui.Icon.register("google","M 7.03125 2 C 4.81525 2 3.03125 3.784 3.03125 6 L 3.03125 12.25 C 3.1302477 11.866836 3.238964 11.490393 3.40625 11.125 C 3.912429 10.019382 4.587611 9.094808 5.34375 8.25 C 6.099889 7.405191 7.044629 6.642653 7.9375 6 C 8.830372 5.357348 9.325384 5.078791 10.65625 4.6875 C 11.6544 4.394032 13.184548 4.16305 14.65625 4.15625 C 15.146817 4.154 15.631404 4.20302 16.09375 4.25 C 17.94313 4.437959 19.823803 5.200897 21.125 5.9375 C 22.426196 6.674105 23.360273 7.363239 24.125 8.375 C 24.889727 9.38676 25.411077 10.762961 25.71875 11.96875 C 26.026426 13.17454 25.974063 14.30012 25.8125 15.53125 C 25.650937 16.762381 24.857498 18.352498 24.15625 19.46875 C 23.455001 20.585001 22.13826 21.559565 21.28125 22.40625 C 20.424239 23.252936 20.314504 23.389945 19.90625 24.09375 C 19.498062 24.797557 19.41406 25.233687 19.5 25.75 C 19.585938 26.266313 19.891888 26.531749 20.34375 27.03125 C 20.795611 27.530752 21.107652 27.715 21.9375 28.46875 C 22.767347 29.222501 24.495602 30.176141 25.53125 31.34375 C 26.566897 32.511358 27.371051 33.75443 27.84375 35.28125 C 28.316442 36.808068 28.29653 38.631069 27.90625 40.0625 C 27.515971 41.49393 26.699792 43.22593 25.9375 44.0625 C 25.280282 44.78376 24.578382 45.425825 23.8125 46 L 42.03125 46 C 44.24725 46 46.03125 44.216 46.03125 42 L 46.03125 6 C 46.03125 3.784 44.24725 2 42.03125 2 L 7.03125 2 z M 12.46875 6.1875 C 12.101083 6.206124 11.717862 6.280756 11.28125 6.4375 C 10.408027 6.750991 9.724957 7.132817 9.0625 7.9375 C 8.400044 8.742184 7.928805 9.809566 7.6875 11 C 7.446197 12.190436 7.590794 13.622757 7.875 14.90625 C 8.159205 16.189743 8.613326 17.286769 9.3125 18.4375 C 10.011674 19.588229 11.119377 20.968676 12.0625 21.6875 C 13.005624 22.406325 13.734674 22.715243 14.65625 22.875 C 15.577826 23.034757 16.58934 22.955681 17.4375 22.625 C 18.28566 22.294319 18.981405 21.915834 19.53125 21.34375 C 20.081095 20.771666 20.405645 20.275214 20.75 19.1875 C 21.094356 18.099787 20.95477 15.934293 20.75 14.53125 C 20.545232 13.128206 20.245037 12.116328 19.6875 10.96875 C 19.129962 9.821173 18.340739 8.515394 17.59375 7.78125 C 16.846761 7.047108 16.282709 6.756004 15.65625 6.5625 C 15.02979 6.368997 14.023783 6.17364 13.46875 6.1875 C 13.191234 6.1945 12.836418 6.16888 12.46875 6.1875 z M 3.03125 17.65625 L 3.03125 35.0625 C 3.5490608 34.410928 4.1847785 33.90628 4.8125 33.46875 C 5.703009 32.848054 6.895613 32.151116 8.09375 31.71875 C 9.291886 31.286385 9.990597 30.955339 11.375 30.65625 C 12.759402 30.357152 16.09375 30.34375 16.09375 30.34375 C 16.09375 30.34375 15.695985 30.051675 15.375 29.71875 C 15.054016 29.385827 14.474793 28.954401 14.21875 28.3125 C 13.962705 27.6706 14.02848 26.625972 14.0625 26 C 14.096515 25.374027 14.28125 24.59375 14.28125 24.59375 C 14.28125 24.59375 12.264623 24.766414 10.84375 24.5 C 9.422876 24.233586 8.515258 23.885412 7.5 23.34375 C 6.484743 22.802088 5.628774 21.920741 4.8125 21.0625 C 3.996227 20.204259 3.621516 19.682342 3.1875 18.25 C 3.1209161 18.030258 3.0810785 17.854931 3.03125 17.65625 z M 14.65625 32.34375 C 13.604496 32.387205 12.182232 32.405853 10.875 32.84375 C 9.567768 33.281652 8.016124 34.118997 7 35.0625 C 5.983877 36.006002 5.131522 37.029519 4.875 38.25 C 4.618478 39.47048 4.799362 40.853463 5.3125 41.9375 C 5.825634 43.021536 6.646935 43.89795 7.59375 44.59375 C 8.540566 45.28955 9.282534 45.642071 10.78125 45.96875 C 10.845188 45.982687 10.932438 45.987169 11 46 L 18.15625 46 C 19.273668 45.842863 20.347335 45.592306 21.0625 45.28125 C 22.13198 44.816088 22.595862 44.476174 23.21875 43.6875 C 23.841639 42.898826 24.240608 41.703023 24.375 40.75 C 24.509392 39.796977 24.396703 38.696229 24.21875 38.03125 C 24.040799 37.366272 23.270015 36.297243 22.5 35.4375 C 21.729984 34.577757 20.542988 33.721469 19.625 33.25 C 18.707014 32.778531 18.020888 32.646687 17.1875 32.5 C 16.354112 32.353337 15.708004 32.3003 14.65625 32.34375 z");
Ui.Icon.register("rfidreader","m 5.125,4.9375 c 0,12.414096 0,24.157202 0,35 l 3.125,3.15625 c 12.072033,0 24.512164,0 34.875,0 0,-12.126444 0,-24.621857 0,-35.03125 L 40,4.9375 l -1.5,0 c -11.125,0 -22.25,0 -33.375,0 z M 36.84375,7.84375 C 37.028224,17.742761 37.007516,28.002562 37,36.9375 27.341523,36.9811 17.621811,36.91937 8.0625,36.875 8.11322,27.008331 8.12731,16.54436 8.125,7.9375 18.624437,7.98052 26.931042,7.84375 36.84375,7.84375 z m -13.65625,3.375 c -4.645685,0.0029 -9.308257,1.803835 -12.84375,5.34375 l 1.6875,1.65625 c 6.168688,-6.176404 16.136095,-6.199963 22.3125,-0.03125 0.02067,0.02064 0.04194,0.07299 0.0625,0.09375 l 1.65625,-1.6875 C 36.03887,16.56988 36.02376,16.55498 36,16.53125 32.460085,12.995756 27.833185,11.215847 23.1875,11.21875 z m 0,4.75 c -3.411726,0.0019 -6.842898,1.308402 -9.4375,3.90625 l 1.6875,1.65625 c 4.286907,-4.29227 11.20773,-4.286909 15.5,0 0.01435,0.01432 0.01698,0.01688 0.03125,0.03125 l 1.6875,-1.65625 c -0.01735,-0.0175 -0.04505,-0.04509 -0.0625,-0.0625 -2.597848,-2.594603 -5.994524,-3.877131 -9.40625,-3.875 z m 0,4.90625 c -2.177767,0.0014 -4.346288,0.844218 -6,2.5 l 1.65625,1.65625 c 2.405126,-2.408137 6.279365,-2.405152 8.6875,0 0.008,0.008 -0.008,0.0232 0,0.03125 l 1.6875,-1.65625 c -0.01107,-0.01119 -0.02012,-0.05141 -0.03125,-0.0625 -1.655781,-1.653713 -3.822233,-2.47011 -6,-2.46875 z m 0,4.28125 c -2.472698,0 -4.46875,1.996053 -4.46875,4.46875 0,2.472698 1.996052,4.46875 4.46875,4.46875 2.472697,0 4.46875,-1.996052 4.46875,-4.46875 0,-2.472697 -1.996053,-4.46875 -4.46875,-4.46875 z");
Ui.Icon.register("screen","M 6 7.5 C 4.0869362 7.5 2.5 9.0869 2.5 11 L 2.5 32 C 2.5 33.9131 4.0869362 35.5 6 35.5 L 14.25 35.5 C 13.294006 35.941056 12.75 36.453943 12.75 37 C 12.75 38.656854 17.786797 40 24 40 C 30.213203 40 35.25 38.656854 35.25 37 C 35.25 36.453943 34.705994 35.941056 33.75 35.5 L 42 35.5 C 43.913064 35.5 45.5 33.9131 45.5 32 L 45.5 11 C 45.5 9.0869 43.913064 7.5 42 7.5 L 6 7.5 z M 6 10.5 L 42 10.5 C 42.302955 10.5 42.5 10.697 42.5 11 L 42.5 32 C 42.5 32.303 42.302955 32.5 42 32.5 L 6 32.5 C 5.6970445 32.5 5.5 32.303 5.5 32 L 5.5 11 C 5.5 10.697 5.6970445 10.5 6 10.5 z");
Ui.Icon.override("plus","M 21.5 4 L 21.5 21.5 L 4 21.5 L 4 26.5 L 21.5 26.5 L 21.5 44 L 26.5 44 L 26.5 26.5 L 44 26.5 L 44 21.5 L 26.5 21.5 L 26.5 4 L 21.5 4 z");Ui.Icon.register("chronoplay","M 40.125 0.5 C 38.635277 0.5 37.40625 1.2501296 37.40625 2.15625 C 37.40625 2.8131873 38.051922 3.3629636 38.96875 3.625 L 38.96875 4.03125 C 35.432247 4.5826204 32.71875 7.6247822 32.71875 11.3125 C 32.71875 15.388498 36.049001 18.71875 40.125 18.71875 C 44.200998 18.71875 47.5 15.388498 47.5 11.3125 C 47.5 7.6247822 44.786502 4.5826204 41.25 4.03125 L 41.25 3.625 C 42.166828 3.3629636 42.8125 2.8131873 42.8125 2.15625 C 42.8125 1.2501296 41.614723 0.5 40.125 0.5 z M 40.125 5.46875 C 43.359397 5.46875 45.9375 8.0781029 45.9375 11.3125 C 45.9375 14.546897 43.359397 17.15625 40.125 17.15625 C 36.890603 17.15625 34.28125 14.546897 34.28125 11.3125 C 34.28125 8.0781029 36.890603 5.46875 40.125 5.46875 z M 10.375 6.65625 L 10.375 41.34375 L 40.75 24 L 10.375 6.65625 z M 42.84375 6.71875 L 40.03125 10.71875 L 41 11.40625 L 43.8125 7.40625 L 42.84375 6.71875 z");
Ui.Icon.register("menu","m 29,4 -10,0 0,10 10,0 z m 0,15 -10,0 0,10 10,0 z m 0,15 -10,0 0,10 10,0 z");Ui.Icon.override("trash","M 22.125 1.90625 C 21.497549 1.90625 21 2.435049 21 3.0625 L 21 4.0625 C 12.485248 4.335055 7.1085409 6.95393 7 9.875 L 7 11.03125 C 7 11.658701 7.435049 12.1875 8.0625 12.1875 L 39.78125 12.1875 C 40.408701 12.1875 41 11.658701 41 11.03125 C 41.0034 10.284715 41.0023 10.585192 41 9.875 C 40.893471 6.994604 35.364149 4.392504 27 4.0625 L 27 3.0625 C 27 2.435049 26.471201 1.90625 25.84375 1.90625 L 22.125 1.90625 z M 7 14.375 C 6.372549 14.375 5.875 14.872549 5.875 15.5 L 5.875 17.8125 C 5.875 18.439951 6.372549 18.9375 7 18.9375 L 10.40625 18.9375 L 10.40625 21.5625 C 10.785413 21.926045 11 22.430799 11 23 L 11 40 C 11 40.569201 10.785413 41.073955 10.40625 41.4375 L 10.40625 41.5625 C 10.40625 44.072303 12.427697 46.125 14.9375 46.125 L 33.0625 46.125 C 35.572302 46.125 37.59375 44.072303 37.59375 41.5625 L 37.59375 41.375 C 37.292632 41.025106 37.09375 40.593701 37.09375 40.09375 L 37.09375 23.09375 C 37.09375 22.593799 37.292632 22.131144 37.59375 21.78125 L 37.59375 18.9375 L 41 18.9375 C 41.627451 18.9375 42.125 18.439951 42.125 17.8125 L 42.125 15.5 C 42.125 14.872549 41.627451 14.375 41 14.375 L 33.0625 14.375 L 14.9375 14.375 L 7 14.375 z M 24.0625 21.40625 C 25.003676 21.40625 25.78125 22.152574 25.78125 23.09375 L 25.78125 40.09375 C 25.78125 41.034926 25.003676 41.78125 24.0625 41.78125 C 23.121324 41.78125 22.375 41.034926 22.375 40.09375 L 22.375 23.09375 C 22.375 22.152574 23.121324 21.40625 24.0625 21.40625 z M 16.625 21.46875 C 17.795708 21.46875 18.411699 22.320019 18.4375 23.1875 L 18.4375 40.09375 C 18.4375 41.180955 17.575274 41.757074 16.625 41.78125 C 15.683824 41.78125 14.9375 41.034926 14.9375 40.09375 L 14.9375 23.1875 C 14.9375 22.246324 15.683824 21.46875 16.625 21.46875 z M 31.375 21.46875 C 32.316176 21.46875 33.0625 22.246324 33.0625 23.1875 L 33.0625 40.15625 C 33.0625 41.097426 32.316176 41.875 31.375 41.875 C 30.433824 41.875 29.65625 41.097426 29.65625 40.15625 L 29.65625 23.1875 C 29.65625 22.246324 30.433824 21.46875 31.375 21.46875 z");
Ui.Icon.register("localaccount","M 16.453336,46.016255 C 9.1766794,44.556739 4.6121591,40.58043 2.8358757,34.153628 2.073397,31.394889 1.5160004,26.079143 1.9442961,25.650847 c 0.2388648,-0.238865 1.0953516,-0.238857 3.5269672,3.6e-5 8.8983167,0.874211 14.2188537,4.825066 16.4073387,12.183545 0.537405,1.806948 1.111257,5.767056 1.116143,7.702415 l 0.0022,0.886118 -2.385703,-0.02563 c -1.312183,-0.01409 -3.183256,-0.185576 -4.157987,-0.381084 z m 9.079708,-2.483651 c 0.494665,-8.740486 4.328938,-14.339041 11.425467,-16.682721 2.26622,-0.748438 6.364371,-1.421116 8.657831,-1.421116 l 0.828701,0 0,1.872848 c 0,2.48441 -0.6566,6.138229 -1.510936,8.407988 -2.501298,6.645335 -8.026972,10.187514 -16.595243,10.638219 l -2.973997,0.156439 z M 1.8848631,20.629014 C 2.384716,12.112354 5.2422657,6.9434079 11.088435,3.9809302 13.003182,3.0106554 16.935025,2.0829762 20.068158,1.8622565 22.363093,1.7005847 22.751603,1.7345267 22.895397,2.1092517 23.123246,2.703011 22.561949,7.7436138 22.04442,9.7512827 19.975884,17.775821 14.182563,22.100132 4.8116557,22.614348 L 1.7585082,22.781884 z M 40.992005,22.435088 C 35.980149,21.781148 31.198405,19.075329 28.739943,15.502079 26.946556,12.89548 25.78615,8.918572 25.530489,4.5027342 l -0.161802,-2.7946817 0.927199,0.00215 c 1.629395,0.00391 5.782036,0.5502579 7.433649,0.9779778 7.686403,1.9905634 12.09008,7.9928777 12.633167,17.2193007 l 0.164501,2.794681 -2.017806,-0.03575 c -1.109794,-0.01966 -2.69262,-0.123795 -3.517392,-0.231407 z");
Ui.Icon.register("chathistory","M 35.875 1.5625 C 33.742651 1.5625 32 2.6092541 32 3.90625 C 32 4.8488881 32.932455 5.6886603 34.25 6.0625 L 34.25 6.625 C 29.184312 7.4110617 25.28125 11.78141 25.28125 17.0625 C 25.28125 22.896772 30.040728 27.65625 35.875 27.65625 C 41.709272 27.65625 46.46875 22.896772 46.46875 17.0625 C 46.46875 11.786461 42.558604 7.4172046 37.5 6.625 L 37.5 6.0625 C 38.817545 5.6886603 39.75 4.8488881 39.75 3.90625 C 39.75 2.6092541 38.007349 1.5625 35.875 1.5625 z M 35.875 8.6875 C 40.504627 8.6875 44.21875 12.432873 44.21875 17.0625 C 44.21875 21.692127 40.504627 25.40625 35.875 25.40625 C 31.245373 25.40625 27.5 21.692127 27.5 17.0625 C 27.5 12.432873 31.245373 8.6875 35.875 8.6875 z M 39.78125 10.46875 L 35.75 16.21875 L 37.125 17.1875 L 41.15625 11.46875 L 39.78125 10.46875 z M 20.8125 15.625 C 11.591715 15.625 3.78125 21.88315 3.78125 29.96875 C 3.78125 38.05435 11.591715 44.25 20.8125 44.25 C 22.425137 44.25 23.953746 43.9777 25.4375 43.625 C 30.735333 47.1821 36.40625 45.90625 36.40625 45.90625 L 39.4375 45.125 L 37.1875 42.9375 C 37.1875 42.9375 36.363067 42.1604 35.40625 41.125 C 34.763451 40.4294 34.340687 39.75885 33.84375 39.09375 C 36.290075 36.63695 37.84375 33.49165 37.84375 29.96875 C 37.84375 29.56885 37.81868 29.17155 37.78125 28.78125 C 36.944621 28.98335 36.086212 29.09375 35.1875 29.09375 C 34.879419 29.09375 34.582967 29.05525 34.28125 29.03125 C 34.31437 29.33725 34.34375 29.65775 34.34375 29.96875 C 34.34375 32.91195 32.937088 35.58545 30.4375 37.59375 L 29.3125 38.5 L 29.96875 39.75 C 30.510713 40.7515 31.375193 41.68075 32.1875 42.59375 C 30.596105 42.41585 28.660781 41.91825 26.78125 40.46875 L 26.125 39.9375 L 25.25 40.1875 C 23.85412 40.5786 22.382689 40.78115 20.8125 40.78125 C 13.134435 40.78125 7.25 35.76975 7.25 29.96875 C 7.25 24.16745 13.134435 19.09375 20.8125 19.09375 C 22.000051 19.09375 23.1326 19.2116 24.21875 19.4375 C 24.15919 18.9724 24.125 18.4813 24.125 18 C 24.125 17.2905 24.18497 16.6099 24.3125 15.9375 C 23.176783 15.7364 22.009737 15.625 20.8125 15.625 z");
Ui.Icon.register("file","m 6,2 0,44 L 42,46 42,11 33,2 l -27,0 z M 10,6 l 19,0 L 29,15 l 9,0 0,27 -28,0 0,-36 z M 33,7 37,11 33,11 33,7 z");Ui.Icon.register("folder","m 4,7 0,35 40,0 0,-25 -34,0 0,21 -2,0 0,-23 32,0 0,-4 -21,0 0,-4 z");
var app=new Wn.App({webApp:!1,style:{"Ui.Element":{fontFamily:"Ubuntu,Sans-Serif",fontWeight:100,fontSize:16},"Ui.Text":{interLine:1.4},"Ui.Separator":{color:"#999999"},"Ui.CheckBox":{checkColor:"#222222"},"Ui.ScrollingArea":{color:"#999999",showScrollbar:!1,overScroll:!0,radius:0},"Ui.ButtonGraphic":{background:"rgba(250,250,250,1)",iconSize:30,spacing:6},"Ui.ActionButton":{"Ui.ButtonGraphic":{background:"rgba(250,250,250,0)",iconSize:30,spacing:6}},"Wn.AlertButton":{"Ui.ButtonGraphic":{background:"#f26d7f",
foreground:"#910011"}},"Wn.InfoButton":{"Ui.ButtonGraphic":{background:"#90a5ff",foreground:"#00229f"}},"Ui.MenuToolBarButton":{"Ui.ButtonGraphic":{background:"rgba(250,250,250,0)",iconSize:28,spacing:0}},"Ui.Slider":{color:"rgba(204,204,204,1)"},"Ui.ToggleButton":{color:new Ui.Color({r:0.8,g:0.8,b:0.8}),toggleColor:"#dc6c36",iconSize:30,spacing:6,fontWeight:700},"Wn.ResourceTitle":{fontWeight:400,fontSize:24,color:"#e1e1e1"},"Wn.ResourceViewerTitle":{fontWeight:400,fontSize:24,color:"#111111"},"Wn.UserTitle":{fontWeight:400,
fontSize:24,color:"#111111"}}});app.requireFont("Ubuntu","100");app.requireFont("Ubuntu","400");app.requireFont("Ubuntu","700");
